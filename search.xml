<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>daily problems</title>
    <url>/2022/08/30/daily-problems/</url>
    <content><![CDATA[<h1 id="npm"><a href="#npm" class="headerlink" title="npm"></a>npm</h1><blockquote>
<p>npm run scripts</p>
</blockquote>
<p>  ä¸ºä½• npm æ‰§è¡Œ package.json ä¸­çš„ scripts å‘½ä»¤æ—¶,å³ä½¿å…¨å±€ç¯å¢ƒå˜é‡ä¸‹ä¸å­˜åœ¨çš„è„šæœ¬å‘½ä»¤ä¹Ÿèƒ½æ‰§è¡Œ?</p>
<p>  è§£: é¦–å…ˆ npm run package.json ä¸­çš„ scripts è„šæœ¬å‘½ä»¤æ—¶,ä¼šæ–°å»ºä¸€ä¸ª shell è„šæœ¬,å¹¶å°† scripts ä¸­çš„è„šæœ¬å‘½ä»¤æ”¾å…¥å…¶ä¸­æ‰§è¡Œ,å› æ­¤ shell å‘½ä»¤(ä¸€èˆ¬æ˜¯ bash)å®Œå…¨å¯ä»¥æ‰§è¡Œ;å…¶æ¬¡,shell å‘½ä»¤æ‰§è¡Œæ—¶,node_modules/.bin å­ç›®å½•ä¸‹çš„æ‰€æœ‰å¯æ‰§è¡Œè„šæœ¬å‘½ä»¤ä¼šæ”¾å…¥è‡³ $PATH å…¨å±€ç¯å¢ƒå˜é‡ä¸­,ç­‰åˆ° shell å‘½ä»¤æ‰§è¡Œå®Œæ¯•,$PATH æ‰ä¼šæ¢å¤åŸæ ·.æœ€å node_modules/.bin å­ç›®å½•ä¸‹çš„æ‰€æœ‰å¯æ‰§è¡Œè„šæœ¬å‘½ä»¤å®é™…ä¸Šæ˜¯ä¸ node_modules ä¸‹å¯æ‰§è¡Œæ¨¡å—å»ºç«‹äº†è½¯é“¾æ¥çš„,å› æ­¤åœ¨ node æ­¤ç±»é¡¹ç›®ä¸‹,å³ä½¿å…¨å±€ç¯å¢ƒå˜é‡ä¸‹ä¸å­˜åœ¨çš„è„šæœ¬å‘½ä»¤,ä¾ç„¶å¯ä»¥é€šè¿‡ node_modules ä¸­çš„å¯æ‰§è¡Œæ¨¡å—åœ¨å½“å‰é¡¹ç›®ä¸‹è½¬åŒ–æ‰§è¡Œ.</p>
<p>  çº¿æ€§å›¾: node_modules/(å¯æ‰§è¡Œæ¨¡å—) -&gt; é€šè¿‡è½¯é“¾æ¥ =&gt; node_modules/.bin/(å¯æ‰§è¡Œè„šæœ¬å‘½ä»¤) -&gt; é€šè¿‡ shell è„šæœ¬å‘½ä»¤æ‰§è¡Œ(æ·»åŠ è‡³ $PATH å…¨å±€ç¯å¢ƒå˜é‡) =&gt; å³ä½¿å…¨å±€ç¯å¢ƒå˜é‡ä¸‹ä¸å­˜åœ¨çš„è„šæœ¬å‘½ä»¤ä¹Ÿèƒ½æ‰§è¡Œ.</p>
<h1 id="javascript"><a href="#javascript" class="headerlink" title="javascript"></a>javascript</h1><blockquote>
<p>é—­åŒ…</p>
</blockquote>
<p>  ä»€ä¹ˆæ˜¯é—­åŒ…?</p>
<p>  è§£: A å‡½æ•°å†…åŒ…è£¹ B å‡½æ•°,B å‡½æ•°åœ¨é A å‡½æ•°ä½œç”¨åŸŸå†…å®è¡Œè°ƒç”¨,ä¾ç„¶èƒ½å¤Ÿä½¿ç”¨æˆ–è€…è°ƒç”¨ A å‡½æ•°å†…çš„å˜é‡æˆ–è€…å‡½æ•°,è¿™å°±æ˜¯é—­åŒ….</p>
<blockquote>
<p>script</p>
</blockquote>
<p>  defer ä¸ async çš„åŒºåˆ«?</p>
<ul>
<li>defer ä¸ä¼šé˜»æ­¢æ–‡æ¡£çš„æ¸²æŸ“,å½“é¡µé¢å¤„ç†ã€è§£æã€æ¸²æŸ“å®Œæˆä¹‹å,defer è„šæœ¬ä¼šé¡ºåºåŠ è½½,åŠ è½½æ‰§è¡Œå®Œæ¯•ä¹‹å,è§¦å‘ DOMContentLoaded äº‹ä»¶</li>
<li>async ä¸ä¼šé˜»æ­¢æ–‡æ¡£çš„æ¸²æŸ“,è„šæœ¬ä¼šåœ¨åŠ è½½å®Œæˆä¹‹åç«‹å³æ‰§è¡Œ,ä¸è®¡å…¥ DOMContentLoaded äº‹ä»¶ç»Ÿè®¡</li>
</ul>
<h1 id="webpack"><a href="#webpack" class="headerlink" title="webpack"></a>webpack</h1><blockquote>
<p>terser-webpack-plugin</p>
</blockquote>
<p>  ä¼—æ‰€å‘¨çŸ¥,åœ¨ webpack 4.xä»¥åŠä¹‹åçš„ç‰ˆæœ¬,å¼€å¯ mode: â€˜productionâ€™,ç›¸å½“äºé»˜è®¤æ·»åŠ äº† terser-webpack-plugin,ä¼šè‡ªåŠ¨ä¸ºæ„å»ºæ‰“åŒ…æ–‡ä»¶å‹ç¼©æ··æ·†.é‚£ä¹ˆæœ‰æ—¶ä¼šå‘ç°å¼€å¯äº† mode: â€˜productionâ€™,å´ä¸èƒ½å®ç°å‹ç¼©æ··æ·†,è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢?</p>
<p>  è§£: åŸå› å¾ˆæœ‰å¯èƒ½åœ¨ optimization.minimizer é‡Œ,æœ‰æ—¶ä¼šåœ¨é‡Œé¢é…ç½®ä¸€äº›å¯¹å…¶ä»–èµ„æºæ¨¡å—çš„å‹ç¼©ç­‰åŠŸèƒ½çš„æ’ä»¶,è€Œå¿˜è®° minimizer å±æ€§å€¼æœ¬èº«ä¼šå¯¹é»˜è®¤å€¼è¿›è¡Œè¦†ç›–,å¯¼è‡´é»˜è®¤å¼€å¯çš„ terser-webpack-plugin ä¸ç”Ÿæ•ˆ,é‚£ä¹ˆåœ¨è¿™æ—¶å€™éœ€è¦å¯¹é»˜è®¤å€¼è¿›è¡Œåˆå¹¶,åœ¨ minimizer çš„æœ€åæ·»åŠ  â€˜â€¦â€™ å…ƒç´ å°±å¯ç”Ÿæ•ˆ.</p>
  <figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line">  <span class="attr">optimization</span>: &#123;</span><br><span class="line">      <span class="attr">minimizer</span>: [</span><br><span class="line">          <span class="comment">//...</span></span><br><span class="line">          <span class="string">&#x27;...&#x27;</span></span><br><span class="line">      ]</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="ssr"><a href="#ssr" class="headerlink" title="ssr"></a>ssr</h1><blockquote>
<p>ä½œç”¨</p>
</blockquote>
<p>  ssr æœåŠ¡ç«¯æ¸²æŸ“ç›¸å¯¹äºæµè§ˆå™¨å®¢æˆ·ç«¯æ¸²æŸ“,å…¶ä½œç”¨æ˜¯ä»€ä¹ˆ?åˆæœ‰ä»€ä¹ˆä¼˜åŠ¿?</p>
<ul>
<li>HTML æ¨¡æ¿ä»¥åŠæ•°æ®ç­‰èµ„æºéƒ½å­˜æ”¾äºæœåŠ¡ç«¯,å†…ç½‘æ‹‰å–èµ„æºé€Ÿåº¦æ›´å¿«.</li>
<li>ç›¸æ¯”äºæµè§ˆå™¨åŠ è½½ HTML ä»¥åŠæ¥å£æ•°æ®ç­‰å¤šä¸ªèµ„æºè¯·æ±‚,ssr æœåŠ¡ç«¯æ¸²æŸ“åªéœ€è¦åŠ è½½æ‹¼è£…å¥½æ•°æ®çš„ä¸€ä¸ª HTML æ¨¡æ¿å³å¯,å¤§å¤§å‡å°‘äº†èµ„æºè¯·æ±‚æ¬¡æ•°.</li>
<li>å¯¹äºç”¨æˆ·æ¥è¯´,æœ€ç›´è§‚çš„å°±æ˜¯,å¤§å¤§å‡å°‘äº†é¡µé¢ç™½å±çš„æ—¶é—´;è€Œå¯¹äºå¼€å‘ä¸€æ–¹æ¥è®²,SEO çˆ¬è™«é¡µé¢è§£ææ›´å‹å¥½.</li>
</ul>
<h1 id="node"><a href="#node" class="headerlink" title="node"></a>node</h1><blockquote>
<p>__dirname</p>
</blockquote>
<p>  __dirname ä¸ process.cwd() çš„åŒºåˆ«æ˜¯ä»€ä¹ˆ?</p>
<p>  è§£: __dirname æŒ‡çš„æ˜¯å½“å‰æ–‡ä»¶æ‰€åœ¨çš„ä½ç½®ç›®å½•. process.cwd() æŒ‡çš„æ˜¯ node æ‰€ä½œç”¨çš„ä½ç½®ç›®å½•.é»˜è®¤å€¼ä¸ºå½“å‰é¡¹ç›®çš„æ ¹ç›®å½•,å¯ä»¥å®è¡Œä¿®æ”¹: process.chdir(//â€¦),ä¿®æ”¹å process.cwd() å°±ä¼šå‘ç”Ÿæ”¹å˜.</p>
<blockquote>
<p>require</p>
</blockquote>
<p>  require.resolve çš„ä½œç”¨æ˜¯ä»€ä¹ˆ?</p>
<p>  è§£: ç”¨äºæ¢æŸ¥æŸä¸ªæ¨¡å—çš„å®Œæ•´è·¯å¾„</p>
<blockquote>
<p>nvm</p>
</blockquote>
<p>  åœ¨ node ç‰ˆæœ¬ä¸º v18,ä½¿ç”¨ nvm æ—¶,ä¸ºä½•å…¨å±€ä¸‹è½½ @angular/cli,ä½¿ç”¨ angular ä¼šæŠ¥ä»¥ä¸‹é”™è¯¯?</p>
<p>  <img src="https://image.white-than-wood.zone/daily_problems/nvm_node%3Afs.png"></p>
<p>  è§£: ç”±äºåœ¨ node v14.18.0 åŠå…¶ä¹‹å,fs æ–‡ä»¶ç³»ç»Ÿé€šè¿‡ node: åè®®çš„ URL çš„æ–¹æ³•æ¥å®è¡Œè®¿é—® Node.js çš„å†…ç½®æ¨¡å—,ä¾‹å¦‚: node:fs,è€Œæœ¬åœ° nvm é»˜è®¤ä½¿ç”¨çš„ node ç‰ˆæœ¬ä¸º v12.22.11,æ— æ³•é€šè¿‡ä¸Šè¿° node: åè®®çš„ URL çš„æ–¹æ³•æ¥å®è¡Œè®¿é—® Node.js çš„å†…ç½®æ¨¡å—,ç”±æ­¤ä¼šå‡ºç°æ­¤ç±»é”™è¯¯</p>
<h1 id="browser"><a href="#browser" class="headerlink" title="browser"></a>browser</h1><blockquote>
<p>console</p>
</blockquote>
<p>  â€œWarning: Mixed Content: The page at â€˜&lt;URL&gt;â€˜ was loaded over HTTPS, but requested an insecure element â€˜&lt;URL&gt;â€˜. This request was automatically upgraded to HTTPS, For more information see &lt;URL&gt;â€œæ‰€è¡¨ç¤ºçš„å«ä¹‰?å¦‚ä½•æ¶ˆé™¤?</p>
<p>  è§£: è¡¨ç¤º web https å®‰å…¨åè®®é¡µé¢ä¸­å­˜åœ¨ http è¯·æ±‚çš„èµ„æº,ä¹Ÿå°±æ˜¯æ­¤é¡µé¢æ˜¯ç”± http å’Œ https åè®®æ··åˆå†…å®¹çš„,ç”±æ­¤ä¼šå‡ºç°è¿™ç§è­¦å‘Š</p>
<h1 id="react"><a href="#react" class="headerlink" title="react"></a>react</h1><blockquote>
<p>hooks</p>
</blockquote>
<p>  ä¸ºä½• hooks ä¸å¯å†™åœ¨å¾ªç¯ã€æ¡ä»¶åˆ¤æ–­ä»¥åŠåµŒå¥—å‡½æ•°ä¸­å‘¢?</p>
<p>  è§£: ç”±äº react hooks ä½¿ç”¨çš„æ˜¯æ–°çš„æ•°æ®ç»“æ„: é‡‡ç”¨é“¾è¡¨çš„æ–¹å¼,å¯éšæ—¶ä¸­æ–­,ä¹Ÿå¯æ¥å›é‡è¿.å¦‚æœå°† hooks æ”¾å…¥å¾ªç¯ã€æ¡ä»¶åˆ¤æ–­ä»¥åŠåµŒå¥—å‡½æ•°ä¸­,å°±ææœ‰å¯èƒ½ä¼šå¯¼è‡´ hooks çš„å–å€¼å‡ºç°åç§»,ä»è€Œå¯¼è‡´å¼‚å¸¸å‘ç”Ÿ</p>
]]></content>
      <categories>
        <category>problems</category>
      </categories>
      <tags>
        <tag>problems</tag>
      </tags>
  </entry>
  <entry>
    <title>think of nodejs</title>
    <url>/2022/08/30/think-of-nodejs/</url>
    <content><![CDATA[<h1 id="nodejs"><a href="#nodejs" class="headerlink" title="nodejs"></a>nodejs</h1><h4 id="æœ¬-nodejs"><a href="#æœ¬-nodejs" class="headerlink" title="æœ¬ nodejs"></a>æœ¬ nodejs</h4><blockquote>
<p>æ¦‚å¿µ</p>
</blockquote>
<p>Nodejs æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ Javascript è¿è¡Œç¯å¢ƒ</p>
<blockquote>
<p>ç‰¹æ€§</p>
</blockquote>
<ul>
<li>äº‹ä»¶é©±åŠ¨</li>
<li>éé˜»å¡ I/O</li>
</ul>
<blockquote>
<p>éé˜»å¡ I/O</p>
</blockquote>
<p>å®é™…ä¸Šå°±æ˜¯ç³»ç»Ÿåœ¨æ¥æ”¶è¾“å…¥ä¸è¾“å‡ºä¹‹é—´æ—¶,è¿˜å¯ä»¥ç»§ç»­å¤„ç†å…¶ä»–è¾“å…¥</p>
<blockquote>
<p>è§„èŒƒ</p>
</blockquote>
<p>nodejs ä¸­çš„å†…ç½®æ¨¡å—åŸºæœ¬éƒ½éµä»å›è°ƒå‡½æ•° callback(err, result) çš„å½¢å¼</p>
<h4 id="browserslist"><a href="#browserslist" class="headerlink" title="browserslist"></a>browserslist</h4><blockquote>
<p>ä½œç”¨</p>
</blockquote>
<p>ç”¨äºç¼–è¯‘è½¬åŒ–æ ·å¼æ–‡ä»¶ä»¥å…¼å®¹æµè§ˆå™¨çš„å¯¹äºå„ç±»æµè§ˆå™¨ç‰ˆæœ¬çš„ç­›é€‰.</p>
<blockquote>
<p>åˆ†ç±»</p>
</blockquote>
<p>[â€œ&gt;0.2%â€]: æŒ‡çš„æ˜¯ç°é˜¶æ®µçš„ç”¨æˆ·æ¯”ä¾‹&gt;0.2%çš„æ‰€æœ‰æµè§ˆå™¨ç‰ˆæœ¬.<br>[â€œlast 2 versionsâ€]: æŒ‡çš„æ˜¯ç°é˜¶æ®µæ‰€æœ‰æµè§ˆå™¨æœ€è¿‘å‘å¸ƒçš„ä¸¤ä¸ªç‰ˆæœ¬.<br>[â€œnot deadâ€]: æŒ‡çš„æ˜¯ç°é˜¶æ®µæ²¡æœ‰è¢«åˆ é™¤é”€æ¯çš„æ‰€æœ‰æµè§ˆå™¨ç‰ˆæœ¬.<br>[â€œdefaultsâ€]: ç›¸å½“äº â€œ&gt;0.2%â€ã€â€last 2 versionsâ€ä»¥åŠâ€not deadâ€ æµè§ˆå™¨ç‰ˆæœ¬çš„å¹¶é›†.<br>[â€œ&gt;0.2%â€,â€last 2 versionsâ€,â€not deadâ€]: ç›¸å½“äº â€œ&gt;0.2%â€ã€â€last 2 versionsâ€ä»¥åŠâ€not deadâ€ æµè§ˆå™¨ç‰ˆæœ¬çš„å¹¶é›†.<br>[â€œ&gt;0.2% and last 2 versions and not deadâ€]: ç›¸å½“äº â€œ&gt;0.2%â€ã€â€last 2 versionsâ€ä»¥åŠâ€not deadâ€ æµè§ˆå™¨ç‰ˆæœ¬çš„äº¤é›†.<br>[â€œ&gt;0.2% or last 2 versions or not deadâ€]: ç›¸å½“äº â€œ&gt;0.2%â€ã€â€last 2 versionsâ€ä»¥åŠâ€not deadâ€ æµè§ˆå™¨ç‰ˆæœ¬çš„å¹¶é›†.<br>[â€œnot &gt;0.2%â€]: æŒ‡çš„æ˜¯ç°é˜¶æ®µçš„ç”¨æˆ·æ¯”ä¾‹ &lt;=0.2% çš„æ‰€æœ‰æµè§ˆå™¨ç‰ˆæœ¬.</p>
<h4 id="version"><a href="#version" class="headerlink" title="version"></a>version</h4><blockquote>
<p>ä½œç”¨</p>
</blockquote>
<p>ç”¨äºå‘å¸ƒæ„å»º/ä¾èµ–/å·¥å…·æ—¶,å¯¹äºç‰ˆæœ¬å·çš„åˆ†ç±»ç®¡ç†.</p>
<blockquote>
<p>åˆ†ç±»</p>
</blockquote>
<ul>
<li>patch: æ˜¯å¯¹æ­¤æ„å»º/ä¾èµ–/å·¥å…·çš„è¡¥ä¸,å¸¸æŒ‡ä¿®å¤ä¸€äº›Bugã€ä»£ç æ ·å¼ç¾åŒ–ä»¥åŠå˜æ›´æ–‡æ¡£ç­‰.</li>
<li>minor: æ˜¯å¯¹æ­¤æ„å»º/ä¾èµ–/å·¥å…·åœ¨å½“å‰ API ä¸‹æ–°å¢ä¸€ä¸ªåŠŸèƒ½.</li>
<li>major: æ˜¯å¯¹æ­¤æ„å»º/ä¾èµ–/å·¥å…·ä¸å½“å‰ API å‡ºç°æ¯”è¾ƒå¤§çš„ä¸å…¼å®¹,ä¹Ÿå°±æ˜¯ BREAKING CHANGES çš„é‡æ„.</li>
</ul>
<h4 id="pre-version"><a href="#pre-version" class="headerlink" title="pre-version"></a>pre-version</h4><blockquote>
<p>ä½œç”¨</p>
</blockquote>
<p>å…ˆè¡Œç‰ˆæœ¬å·æ˜¯ä½œä¸ºæ„å»º/ä¾èµ–/å·¥å…·ç¨³å®šç‰ˆæœ¬ç”Ÿå‘½å‘¨æœŸçš„çº¿æ€§å›¾,å¯ç¡®ä¿å…¶ä¸Šçº¿çš„è´¨é‡ã€å®‰å…¨ä»¥åŠç¨³å®šæ€§.</p>
<blockquote>
<p>åˆ†ç±»</p>
</blockquote>
<ul>
<li>alpha: æ˜¯å†…æµ‹ç‰ˆæœ¬,ä¸€èˆ¬ä¼šæœ‰å¾ˆå¤š Bug,å†…æµ‹äººå‘˜ä½¿ç”¨.</li>
<li>beta: æµ‹è¯•ç‰ˆæœ¬,ä¼šå¼€æ”¾ä¸€éƒ¨åˆ†å¤–éƒ¨äººå‘˜æµ‹è¯•,è¿™é˜¶æ®µè¿˜æ˜¯ä¼šç»§ç»­å¼€å‘æ–°åŠŸèƒ½.</li>
<li>rc: å…¬æµ‹ç‰ˆæœ¬,ä¼šå®Œå…¨å¯¹å¤–å¼€æ”¾æµ‹è¯•,ä¸å†å¼€å‘æ·»åŠ æ–°åŠŸèƒ½.</li>
</ul>
<h4 id="npx"><a href="#npx" class="headerlink" title="npx"></a>npx</h4><blockquote>
<p>ä½œç”¨</p>
</blockquote>
<p>æ˜¯ npm è‡ªå¸¦çš„åŒ…æ‰§è¡Œå™¨.å…¶ä¸»è¦ä½œç”¨å°±æ˜¯å¯éšæ—¶æ‰§è¡Œé¡¹ç›®å†…å®‰è£…çš„å¯æ‰§è¡Œæ¨¡å—,ä¸”å¯åœ¨å…¨å±€ç¯å¢ƒå˜é‡ä¸‹è„šæœ¬å‘½ä»¤ä¸å­˜åœ¨æ—¶,è‡ªåŠ¨å®‰è£…æ‰§è¡Œ.</p>
<blockquote>
<p>åŸç†</p>
</blockquote>
<p>å…¶åŸç†éå¸¸ç®€å•,å°±æ˜¯è½®è¯¢ node_modules/.bin å­ç›®å½•ä»¥åŠ $PATH å…¨å±€ç¯å¢ƒå˜é‡ä¸‹æ˜¯å¦å­˜åœ¨æŒ‡å®šçš„è„šæœ¬å‘½ä»¤,å¦‚æœå­˜åœ¨å°±æ‰§è¡Œ,æœ¬åœ°ä¸å­˜åœ¨åˆ™è‡ªåŠ¨å®‰è£…ä¸‹è½½æ‰§è¡Œ.</p>
<blockquote>
<p>å‚æ•°</p>
</blockquote>
<ul>
<li>â€“no-install: æŒ‡çš„æ˜¯å¼ºåˆ¶ä½¿ç”¨æœ¬åœ°æ¨¡å—,ç¦æ­¢ä¸‹è½½è¿œç¨‹æ¨¡å—.</li>
</ul>
<h4 id="inquirer"><a href="#inquirer" class="headerlink" title="inquirer"></a>inquirer</h4><blockquote>
<p>ä½œç”¨</p>
</blockquote>
<p>æ˜¯ç”¨äºä¸ç”¨æˆ·è¿›è¡Œç®€å•äº’åŠ¨çš„ä¾èµ–,å­˜åœ¨è¾“å…¥é€‰æ‹©ã€åˆ¤æ–­é€‰æ‹©ã€åˆ—è¡¨é€‰æ‹©ç­‰äº’åŠ¨æ–¹å¼.</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> inquirer = <span class="built_in">require</span>(<span class="string">&#x27;inquirer&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> prompt = inquirer.<span class="title function_">createPromptModule</span>();</span><br><span class="line"><span class="keyword">const</span> env = <span class="title function_">prompt</span>([&#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&#x27;list&#x27;</span>,</span><br><span class="line">    <span class="attr">message</span>: <span class="string">&#x27;è¯·é€‰æ‹© webpack æ„å»ºæ‰“åŒ…æ—¶æ‰€å±çš„ç¯å¢ƒ:&#x27;</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;env&#x27;</span>,</span><br><span class="line">    <span class="attr">choices</span>: [</span><br><span class="line">        <span class="string">&#x27;development&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;production&#x27;</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="title function_">filter</span>(<span class="params">value</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> value.<span class="title function_">toLowerCase</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;]);</span><br><span class="line"><span class="keyword">const</span> _env = env[<span class="string">&#x27;env&#x27;</span>];</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(_env);</span><br></pre></td></tr></table></figure>

<h4 id="shelljs"><a href="#shelljs" class="headerlink" title="shelljs"></a>shelljs</h4><blockquote>
<p>ä½œç”¨</p>
</blockquote>
<p>æ˜¯é€šè¿‡ js æ–°å»º shell è„šæœ¬æ‰§è¡Œ shell å‘½ä»¤çš„ä¾èµ–,ç®€æ´æ˜“ç”¨.</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123;exec&#125; = <span class="built_in">require</span>(<span class="string">&#x27;shelljs&#x27;</span>);</span><br><span class="line"><span class="title function_">exec</span>(<span class="string">&#x27;webpack&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h4 id="yargs"><a href="#yargs" class="headerlink" title="yargs"></a>yargs</h4><blockquote>
<p>ä½œç”¨</p>
</blockquote>
<p>æ˜¯ç”¨äºè§£æå‘½ä»¤è¡Œçš„ä¾èµ–,å¯å¯¹å‘½ä»¤è¡Œå‚æ•°é€ä¸ªè§£æ,åŠŸèƒ½æå…¶å¼ºå¤§.</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> yargs = <span class="built_in">require</span>(<span class="string">&#x27;yargs&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> argv = process.<span class="property">argv</span>;</span><br><span class="line"><span class="keyword">const</span> env = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">yargs.<span class="title function_">parse</span>(argv.<span class="title function_">slice</span>(<span class="number">2</span>), <span class="function">(<span class="params">err, argv</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">error</span>(err);</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(err);</span><br><span class="line">    &#125;</span><br><span class="line">    env = argv[<span class="string">&#x27;env&#x27;</span>];</span><br><span class="line">&#125;);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(env);</span><br></pre></td></tr></table></figure>

<h4 id="rimraf"><a href="#rimraf" class="headerlink" title="rimraf"></a>rimraf</h4><blockquote>
<p>ä½œç”¨</p>
</blockquote>
<p>æ˜¯ç”¨äºé€’å½’å‰ƒæ‰åˆ é™¤é¡¹ç›®ç›®å½•çš„ä¾èµ–,å…¶ç»å¯¹æ ¹ç›®å½•æ˜¯ node æ‰€ä½œç”¨çš„ä½ç½®ç›®å½•,ä¹Ÿå°±æ˜¯ process.cwd().</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> rimraf = <span class="built_in">require</span>(<span class="string">&#x27;rimraf&#x27;</span>);</span><br><span class="line"><span class="comment">// é¦–å‚æ•°: ç›¸å¯¹äº node æ‰€ä½œç”¨çš„ä½ç½®ç›®å½•.</span></span><br><span class="line"><span class="comment">// å›è°ƒå‡½æ•°: åœ¨æ“ä½œè¿‡åæ‰§è¡Œçš„æ­¥éª¤.</span></span><br><span class="line"><span class="title function_">rimraf</span>(<span class="string">&#x27;./dist&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="spritesmith"><a href="#spritesmith" class="headerlink" title="spritesmith"></a>spritesmith</h4><blockquote>
<p>ä½œç”¨</p>
</blockquote>
<p>æ˜¯ç”¨äºåˆå¹¶å¤šä¸ªå›¾ç‰‡å½¢æˆé›ªç¢§å›¾çš„ä¾èµ–.</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123;run&#125; = <span class="built_in">require</span>(<span class="string">&#x27;spritesmith&#x27;</span>);</span><br><span class="line"><span class="comment">// ä½ç½®ç›®å½•å¿…é¡»ä¸ºç»å¯¹è·¯å¾„</span></span><br><span class="line"><span class="title function_">run</span>(&#123;<span class="attr">src</span>: [<span class="string">&#x27;pic1.png&#x27;</span>, <span class="string">&#x27;pic2.png&#x27;</span>]&#125;, <span class="function">(<span class="params">err, image</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// ä¼šç”Ÿæˆ 16è¿›åˆ¶ Buffer</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(image.<span class="property">image</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h4 id="jszip"><a href="#jszip" class="headerlink" title="jszip"></a>jszip</h4><blockquote>
<p>ä½œç”¨</p>
</blockquote>
<p>ç”¨äºä½¿ç”¨ js å®ç° zip å‹ç¼©æ‰“åŒ…çš„ä¾èµ–.</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">JsZip</span> = <span class="built_in">require</span>(<span class="string">&#x27;jszip&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> jszip = <span class="keyword">new</span> <span class="title class_">JsZip</span>();</span><br><span class="line"><span class="comment">// ç”Ÿæˆç©ºçš„å‹ç¼©æ‰“åŒ…æ–‡ä»¶</span></span><br><span class="line">jszip.<span class="title function_">folder</span>(<span class="string">&#x27;offline&#x27;</span>);</span><br><span class="line"><span class="comment">// ç”Ÿæˆå¡«å…¥å†…å®¹çš„å‹ç¼©æ‰“åŒ…æ–‡ä»¶</span></span><br><span class="line">jszip.<span class="title function_">file</span>(<span class="string">&#x27;index.js&#x27;</span>, <span class="string">&#x27;console.log(&quot;wtw&quot;)&#x27;</span>);</span><br><span class="line"><span class="comment">// å°†å‹ç¼©æ‰“åŒ…æ–‡ä»¶å®è¡Œå„ç§æ•°æ®ç±»å‹è½¬æ¢</span></span><br><span class="line">jszip.<span class="title function_">generatorAsync</span>(&#123;<span class="attr">type</span>: <span class="string">&#x27;nodebuffer&#x27;</span>&#125;).<span class="title function_">then</span>(<span class="function">(<span class="params">content</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(content);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>è‡ªå®šä¹‰ webpack æ’ä»¶ä»¥ç”Ÿæˆç¦»çº¿å‹ç¼©åŒ…</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line"><span class="keyword">const</span> &#123;resolve&#125; = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è‡ªå®šä¹‰çš„ç”Ÿæˆç¦»çº¿å‹ç¼©åŒ…çš„ webpack æ’ä»¶</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">JsZipPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;./lib/jsZipPlugin.js&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">OUTPUT_DIR</span> = <span class="title function_">resolve</span>(process.<span class="title function_">cwd</span>(), <span class="string">&#x27;./build&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> webpackConfig = &#123;</span><br><span class="line">    <span class="attr">mode</span>: <span class="string">&#x27;production&#x27;</span>,</span><br><span class="line">    <span class="attr">entry</span>: <span class="string">&#x27;./src/index.js&#x27;</span>,</span><br><span class="line">    <span class="attr">output</span>: &#123;</span><br><span class="line">        <span class="attr">path</span>: <span class="variable constant_">OUTPUT_DIR</span>,</span><br><span class="line">        <span class="attr">filename</span>: <span class="string">&#x27;index.js&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">plugins</span>: [</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">JsZipPlugin</span>(&#123;</span><br><span class="line">            <span class="attr">name</span>: <span class="string">&#x27;offline&#x27;</span></span><br><span class="line">        &#125;)</span><br><span class="line">    ]</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = wbpackConfig;</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">JsZip</span> = <span class="built_in">require</span>(<span class="string">&#x27;jszip&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> &#123;<span class="title class_">RawSource</span>&#125; = <span class="built_in">require</span>(<span class="string">&#x27;webpack-sources&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">JsZipPlugin</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">options</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">options</span> = options;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ‰€æœ‰çš„ webpack æ’ä»¶éƒ½éµå¾ªå…¶ tapable æ’ä»¶ä½“åˆ¶,ç±»ä¼¼äº EnventEmitter é‚£ç§è§‚å¯Ÿè®¢é˜…æ¨¡å¼</span></span><br><span class="line">    <span class="title function_">apply</span>(<span class="params">compiler</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123;name = <span class="string">&#x27;&#x27;</span>&#125; = <span class="variable language_">this</span>.<span class="property">options</span>;</span><br><span class="line">        <span class="keyword">const</span> jszip = <span class="keyword">new</span> <span class="title class_">JsZipPlugin</span>();</span><br><span class="line">        <span class="comment">// è®¢é˜…ç”Ÿæˆæ–‡ä»¶æ—¶çš„ hooks äº‹ä»¶,emit æ˜¯ AsyncSeriesHook(å¼‚æ­¥ä¸²è¡Œ hook)</span></span><br><span class="line">        compiler.<span class="property">hooks</span>.<span class="property">emit</span>.<span class="title function_">tapAsync</span>(<span class="string">&#x27;JsZipPlugin&#x27;</span>, <span class="function">(<span class="params">compilation, callback</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">// ç”Ÿæˆç©ºçš„å‹ç¼©æ‰“åŒ…æ–‡ä»¶</span></span><br><span class="line">            <span class="keyword">const</span> folder = jszip.<span class="title function_">folder</span>(name);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">let</span> filename <span class="keyword">in</span> compilation.<span class="property">assets</span>) &#123;</span><br><span class="line">                <span class="comment">// ç”Ÿæˆå¡«å…¥ webpack æ„å»ºæ‰“åŒ…æºä»£ç çš„å‹ç¼©æ‰“åŒ…æ–‡ä»¶</span></span><br><span class="line">                folder.<span class="title function_">file</span>(filename, compilation.<span class="property">assets</span>[filename].<span class="title function_">source</span>());</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// å®è¡Œ nodebuffer æ•°æ®ç±»å‹è½¬æ¢,å°†æºä»£ç è½¬æ¢ä¸º buffer,å¹¶æ”¾å…¥è‡³ webpack æ„å»ºæ‰“åŒ…ç”Ÿæˆçš„èµ„æºæ¨¡å—å†….</span></span><br><span class="line">            jszip.<span class="title function_">generatorAsync</span>(&#123;<span class="attr">type</span>: <span class="string">&#x27;nodebuffer&#x27;</span>&#125;).<span class="title function_">then</span>(<span class="function">(<span class="params">content</span>) =&gt;</span> &#123;</span><br><span class="line">                compilation.<span class="property">assets</span>[<span class="string">`<span class="subst">$&#123;name&#125;</span>.zip`</span>] = <span class="keyword">new</span> <span class="title class_">RawSource</span>(content);</span><br><span class="line">                <span class="title function_">callback</span>();</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="import-local"><a href="#import-local" class="headerlink" title="import-local"></a>import-local</h4><blockquote>
<p>ä½œç”¨</p>
</blockquote>
<p>ç”¨äºä¼˜å…ˆä½¿ç”¨æœ¬åœ° node_modules ä¸‹çš„å¯æ‰§è¡Œæ¨¡å—,æ¯”å¦‚å…¨å±€ç¯å¢ƒå˜é‡ä¸‹çš„ webpack è„šæœ¬å‘½ä»¤ç‰ˆæœ¬æ˜¯ 5.x,æœ¬åœ°ä¸‹è½½çš„ node_modules ä¸‹çš„ webpack å¯æ‰§è¡Œæ¨¡å—æ˜¯ 4.x,ä¼šä¼˜å…ˆä½¿ç”¨æœ¬åœ°ä¸‹è½½çš„ node_modules ä¸‹çš„å¯æ‰§è¡Œæ¨¡å—</p>
<h4 id="express"><a href="#express" class="headerlink" title="express"></a>express</h4><blockquote>
<p>ç‰¹æ€§</p>
</blockquote>
<ul>
<li>æ‹¥æœ‰å¼ºå¤§çš„è·¯ç”±åˆ†å‘åŠŸèƒ½</li>
<li>å¯¹äº http å¤„ç†æ–¹é¢åšäº†ä¸€ç³»åˆ—çš„å°è£…,æ¯”å¦‚è¯´ 302 é‡å®šå‘</li>
<li>å¯é…åˆå¤šç§æ¨¡æ¿å¼•æ“</li>
<li>æ´‹è‘±æ¨¡å‹çš„æœºåˆ¶,å¤„ç†æ›´åŠ çµæ´»</li>
</ul>
<blockquote>
<p>ç¼ºé™·</p>
</blockquote>
<ul>
<li>æ´‹è‘±æ¨¡å‹ä¸å¯å¤„ç†å¼‚æ­¥äº‹ä»¶</li>
</ul>
<blockquote>
<p>åº”ç”¨</p>
</blockquote>
<ul>
<li>æ¯”è¾ƒé€‚åˆäºè¾ƒå°çš„å·¥ç¨‹å’Œåº”ç”¨</li>
</ul>
<h4 id="koa"><a href="#koa" class="headerlink" title="koa"></a>koa</h4><blockquote>
<p>ç‰¹æ€§</p>
</blockquote>
<ul>
<li>é‡‡ç”¨ async/await,è§£å†³äº†å¤„ç†å¼‚æ­¥äº‹ä»¶çš„é—®é¢˜</li>
<li>ä½¿ç”¨ä¸­é—´ä»¶ã€å¾®å†…æ ¸çš„æ¨¡å¼,æ›´å…³æ³¨æ€§èƒ½</li>
</ul>
<blockquote>
<p>ç¼ºé™·</p>
</blockquote>
<ul>
<li>ç”±äºé‡‡ç”¨å¾®å†…æ ¸,ä¸å†æ‹¥æœ‰è·¯ç”±åˆ†å‘åŠŸèƒ½,å¦‚éœ€è¦è·¯ç”±,åˆ™å¼€å‘è€…è‡ªå·±è®¾è®¡ä¸­é—´ä»¶</li>
</ul>
<blockquote>
<p>åº”ç”¨</p>
</blockquote>
<ul>
<li>æ¯”è¾ƒé€‚åˆäºå¤§å‹çš„å·¥ç¨‹é¡¹ç›®</li>
</ul>
<h4 id="RPC"><a href="#RPC" class="headerlink" title="RPC"></a>RPC</h4><blockquote>
<p>ç‰¹ç‚¹</p>
</blockquote>
<p>RPC ä¸ Ajax å¯¹æ¯”å¯çŸ¥:</p>
<ul>
<li>å¯»å€æœåŠ¡ä¸ä¸€å®šåŸºäº DNS</li>
<li>åŸºäº TCP æˆ–è€… UDP åè®®,äºŒè¿›åˆ¶æ•°æ®ä¼ è¾“,æ›´å°çš„æ•°æ®åŒ…ä½“ç§¯,æ›´å¿«çš„ç¼–è§£ç é€Ÿåº¦,æ€§èƒ½æ›´å¥½</li>
<li>é€šä¿¡æ–¹å¼<ul>
<li>å•å·¥é€šä¿¡: S/C ä¸¤ç«¯åªèƒ½ä¸€ç«¯å‘å¦å¤–ä¸€ç«¯æ¨é€æ•°æ®åŒ…</li>
<li>åŠåŒå·¥é€šä¿¡: S/C ä¸¤ç«¯åœ¨ä¸€æ®µæ—¶é—´å†…,åªèƒ½ä¸€ç«¯å‘å¦å¤–ä¸€ç«¯æ¨é€æ•°æ®åŒ…(åœ¨ä¸€ç«¯æ¥æ”¶åˆ°æ•°æ®åŒ…ä¹‹å,æ‰å¯ä»¥ç»§ç»­æ­¤ç±»æ“ä½œ)</li>
<li>å…¨åŒå·¥é€šä¿¡: S/C ä¸¤ç«¯å¯è‡ªç”±æ¨é€æ•°æ®åŒ…</li>
</ul>
</li>
</ul>
]]></content>
      <categories>
        <category>nodejs</category>
      </categories>
      <tags>
        <tag>npm</tag>
        <tag>nodejs</tag>
      </tags>
  </entry>
  <entry>
    <title>hexo next</title>
    <url>/2022/08/30/hexo-next/</url>
    <content><![CDATA[<h1 id="å¼•è¨€"><a href="#å¼•è¨€" class="headerlink" title="å¼•è¨€"></a>å¼•è¨€</h1><p><b>æ­¤åšå®¢ç”¨äºæ­å»º hexo next ä¸»é¢˜çš„å­—å…¸å·¥å…·ç±»åšå®¢.åŸºæœ¬ä¸ä¼šæ¢ç´¢æ·±ç©¶é…ç½®çš„åŸå› ,æ•¬è¯·çŸ¥æ‚‰~</b></p>
<h1 id="hexo-å®‰è£…"><a href="#hexo-å®‰è£…" class="headerlink" title="hexo å®‰è£…"></a>hexo å®‰è£…</h1><blockquote>
<p>æ­¥éª¤</p>
</blockquote>
<p>é¦–å…ˆè¦ç”¨ npm èµ„æºä¾èµ–ç®¡ç†å·¥å…·å®‰è£…å…¨å±€å‘½ä»¤ hexo-cli.</p>
<pre><code>npm install hexo-cli -g
</code></pre>
<p>ç„¶åä½¿ç”¨ hexo åˆå§‹åŒ–åšå®¢ç›®å½•,æ¯”å¦‚ blog ç›®å½•,ç›®å½•åè¦ä¸åç»­ä¸ªäººå»ºç«‹çš„ github ä¸Š hexo æ‰˜ç®¡ä»£ç çš„ repository åº“åŒå.</p>
<pre><code>hexo init blog
</code></pre>
<p>æ¥ç€ github å»ºåº“: å»ºç«‹ä¸€ä¸ªä»¥ w-t-w(æˆ‘çš„è´¦å·).github.io ç»“å°¾çš„ repository åº“,ä½œä¸º hexo æ‰˜ç®¡ä»£ç çš„åº“, github é»˜è®¤<br>.github.io ç»“å°¾ä½œä¸ºç”¨æˆ·çš„ç½‘ç«™äºŒçº§åŸŸå,å»ºç«‹ä¸€ä¸ªæ–°çš„åˆ†æ”¯ä½œä¸ºåˆ›ä½œåˆ†æ”¯(å› ä¸ºä¸»åˆ†æ”¯æ˜¯ç”¨æ¥å‘å¸ƒå‘ˆç°ç½‘ç«™çš„); ä¹‹å,è¿›å…¥ç”Ÿæˆçš„ blog<br>æ–‡ä»¶å¤¹,åœ¨æœ¬åœ°æ·»åŠ ä¸è¿œç¨‹ repository åº“é“¾æ¥å…³è”çš„å¥æŸ„ç®€ç§°,å¹¶è®¾ç½®æœ¬åœ°å¥æŸ„ç®€ç§°æ¨é€/åŒæ­¥è¿œç¨‹åº“ä¸Šæ¸¸çš„åˆ†æ”¯,ä¸è¿œç¨‹åº“å»ºç«‹å®‰å…¨å…³è”,æœ€ååŒæ­¥è¿œç¨‹æœ€æ–°èµ„æº.</p>
<pre><code>git remote add origin git@github.com:w-t-w/w-t-w.github.io.git
git pull --set-upstream origin master
</code></pre>
<p>å† npm ä¸‹è½½å¤–éƒ¨èµ„æºä¾èµ–åŒ….</p>
<pre><code>npm i/npm install
</code></pre>
<p>æˆ–è€…ä½¿ç”¨ yarn ä¸‹è½½å¤–éƒ¨èµ„æºä¾èµ–åŒ….</p>
<pre><code>yarn
</code></pre>
<p>æœ€åå¯åŠ¨ hexo è‡ªèº«æ­å»ºçš„æœåŠ¡,ç”Ÿæˆæœ¬åœ°çš„åšå®¢ç½‘ç«™æœåŠ¡,é»˜è®¤ç«¯å£åœ¨æœ¬åœ° ip åœ°å€ä¸‹çš„ 4000 ç«¯å£,å‡å¦‚ä½ ä¸æƒ³å¯åŠ¨åœ¨ 4000 ç«¯å£,ä¹Ÿå¯ä½¿ç”¨-p<br>å…¶ä»–ç«¯å£å·è¿›è¡Œé…ç½®,æ¯”å¦‚-p 9777.</p>
<pre><code>hexo server
hexo server -p 9777
</code></pre>
<p>PS: æœ€å¥½å…ˆå°†æœ¬åœ°ä»£ç ä¸Šä¼ è‡³è¿œç¨‹ä¹‹å,å†æ‰§è¡Œ hexo é…ç½®.</p>
<pre><code>git add .
git commit &#39;build:hexo next&#39;
git push
</code></pre>
<p>é»˜è®¤çš„ä¸»é¢˜é£æ ¼ theme æ˜¯ landscape<br>,å‡å¦‚ä½ æƒ³æ›´æ¢,å¯ä»¥é€šè¿‡<a href='https://hexo.io/themes/'>https://hexo.io/themes</a>è¿›è¡Œç­›é€‰,ç­›é€‰ä¹‹åè¿›è¡Œé…ç½®,ä¸»é¢˜é…ç½®è§ä¸‹æ–‡<br>.</p>
<h1 id="hexo-é…ç½®"><a href="#hexo-é…ç½®" class="headerlink" title="hexo é…ç½®"></a>hexo é…ç½®</h1><p>PS: ä»¥ä¸‹æ‰€è¯´çš„â€æ ¹ç›®å½•â€æŒ‡çš„å°±æ˜¯å½“å‰åˆ›ä½œçš„ repository ç›®å½•,â€ä¸»é¢˜ç›®å½•â€å°±æ˜¯æ ¹ç›®å½•ä¸‹/themesç›®å½•ä¸‹çš„ä¸»é¢˜ç¯å¢ƒ.</p>
<h4 id="hexo-deploy-å‘å¸ƒé…ç½®"><a href="#hexo-deploy-å‘å¸ƒé…ç½®" class="headerlink" title="hexo deploy å‘å¸ƒé…ç½®"></a>hexo deploy å‘å¸ƒé…ç½®</h4><p>å‘å¸ƒéƒ¨ç½²å¯ä»¥éƒ¨ç½²è‡³ Github Page ä¸ªäººç½‘ç«™,ä¹Ÿå¯ä»¥éƒ¨ç½²è‡³ä¸ªäººç”³è¯·è´­ä¹°çš„äº‘æœåŠ¡å™¨ä¸­.</p>
<p>ä¸€. éƒ¨ç½²è‡³ Github Page ä¸ªäººç½‘ç«™.</p>
<blockquote>
<p>æ­¥éª¤</p>
</blockquote>
<p>è¦æƒ³éƒ¨ç½²åˆ° Github Page ä¸ªäººç½‘ç«™,é¦–å…ˆè¦ä¸‹è½½ hexo-deployer-git æ’ä»¶.</p>
<pre><code>npm install hexo-deployer-git --save
</code></pre>
<p>ç„¶ååœ¨æ ¹ç›®å½•åº•ä¸‹çš„ _config.yml æ–‡ä»¶ä¸­æ›´æ”¹ deploy å‘å¸ƒé…ç½®,å°† source ç›®å½•ä¸‹é¢çš„å†…å®¹è¿›è¡Œæ„å»ºå‘å¸ƒåˆ° repository github<br>åœ°å€çš„ä¸»åˆ†æ”¯ä¸Š.</p>
<pre><code>deploy:
    type: git
    #ä½ çš„ä¸ªäººç½‘ç«™ github åº“çš„é“¾æ¥åœ°å€,æœ€å¥½ä½¿ç”¨ git@ å¼€å¤´çš„, https@ å¼€å¤´çš„ä¼šæŠ¥é”™
    repo: git@github.com:w-t-w/w-t-w.github.io.git
    #åˆ†æ”¯å
    branch: master
</code></pre>
<p>äºŒ. éƒ¨ç½²è‡³ä¸ªäººç”³è¯·è´­ä¹°çš„äº‘æœåŠ¡å™¨.</p>
<blockquote>
<p>æ­¥éª¤</p>
</blockquote>
<p>å°†ç”Ÿæˆçš„ç½‘ç«™åšå®¢é¡¹ç›®ç›´æ¥é€šè¿‡ <a href='https://filezilla-project.org' />Filezilla</a> è¿œç¨‹æœåŠ¡æ–‡ä»¶ä¼ è¾“å·¥å…·æ”¾å…¥äº‘æœåŠ¡å™¨ä¸­;æ¥ç€é€šè¿‡ <a href='https://macwk.com/soft/royal-tsx'>Royal TSX(ç ´è§£ç‰ˆğŸ˜œ)</a> è¿œç¨‹æœåŠ¡ç®¡ç†å·¥å…·å¯¹æœåŠ¡å™¨è¿›è¡Œæ·±åº¦ç®¡ç†,é“¾æ¥æˆåŠŸå,ä¸‹è½½ nginx ä»£ç†.</p>
<pre><code># è¿™é‡Œç›´æ¥ä½¿ç”¨é˜¿é‡Œäº‘CentOSæœåŠ¡å™¨ä¸­é»˜è®¤çš„åŸºäºRPMçš„è½¯ä»¶åŒ…ç®¡ç†å™¨yumæ¥ä¸‹è½½nginx
yum install nginx
</code></pre>
<p>ä¸‹è½½ä¹‹åæŸ¥çœ‹å…¨å±€å‘½ä»¤ nginx æ˜¯å¦å­˜åœ¨,æŸ¥çœ‹ nginx çš„ç‰ˆæœ¬.</p>
<pre><code>nginx -v
</code></pre>
<p>å¦‚æœå…¨å±€å‘½ä»¤ä¸å­˜åœ¨ nginx,åˆ™è¿è¡Œ source ~/.bash_profile,ä½¿å¾—é…ç½®åœ¨ä¿®æ”¹äº†ç¯å¢ƒå˜é‡çš„æƒ…å†µä¸‹è¿›è¡Œé‡ç½®.</p>
<pre><code>source ~/.bash_profile
</code></pre>
<p>å¯åŠ¨ nginx.</p>
<pre><code>nginx
</code></pre>
<ul>
<li><p>é¡ºä¾¿æä¸€ä¸‹ nginx çš„å…¶ä»–å‘½ä»¤.é‡å¯ nginx.</p>
<pre><code>nginx -s reload
</code></pre>
</li>
<li><p>åœæ­¢ nginx.</p>
<pre><code>nginx -s stop
</code></pre>
</li>
<li><p>é€šè¿‡æµ(pipe)æŸ¥è¯¢å…¨éƒ¨ç”¨æˆ·ç»„ nginx å®Œæ•´çš„è¿›ç¨‹çŠ¶æ€.</p>
<pre><code>ps -ef | grep nginx
</code></pre>
</li>
<li><p>å¼ºåˆ¶æ€æ‰ nginx è¿›ç¨‹.</p>
<pre><code>#28009æ˜¯ nginx è¿›ç¨‹å·,é€šè¿‡ ps -ef | grep nginx å¯ä»¥æŸ¥è¯¢åˆ°
kill -9 28009
</code></pre>
</li>
</ul>
<p>é…ç½® nginx,å°†æœåŠ¡å™¨ä»£ç† root é¡µé¢æŒ‡å‘åšå®¢ç½‘ç«™.</p>
<pre><code>#é€šè¿‡æµ‹è¯• nginx,æŸ¥è¯¢ nginx é…ç½®æ–‡ä»¶æ‰€åœ¨ç›®å½•
nginx -t
vim /etc/nginx/nginx.conf
</code></pre>
  <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">...</span></span><br><span class="line">server &#123;</span><br><span class="line">    listen       80 default_server;</span><br><span class="line">    listen       [::]:80 default_server;</span><br><span class="line">    #åŸŸåé…ç½®,éœ€è¦ç”³è¯·è´­ä¹°å¤‡æ¡ˆ(å›½å†…åŸŸåéœ€è¦å¤‡æ¡ˆ,å›½å¤–åŸŸååˆ™ä¸éœ€è¦)</span><br><span class="line">    server_name  localhost;</span><br><span class="line">    #ä¿®æ”¹rooté¡µé¢æŒ‡å‘ç½‘ç«™åšå®¢é¡¹ç›®</span><br><span class="line">    root         /root/w-t-w;</span><br><span class="line"></span><br><span class="line">    # Load configuration files for the default server block.</span><br><span class="line">    include /etc/nginx/default.d/*.conf;</span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">        index index.html index.htm;</span><br><span class="line">        # å°† router è·¯ç”±ä¸­ä¸å­˜åœ¨çš„é¡µé¢é‡å®šå‘è‡³ index.html.</span><br><span class="line">        try_files $uri $uri/ /index.html;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    error_page 404 /404.html;</span><br><span class="line">        location = /40x.html &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    error_page 500 502 503 504 /50x.html;</span><br><span class="line">        location = /50x.html &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">...</span></span><br></pre></td></tr></table></figure>

<p>é€šè¿‡é˜¿é‡Œäº‘å¹³å°å‘äº‘æœåŠ¡å™¨æ·»åŠ å®‰å…¨ç»„,å¼€æ”¾ 80(HTTP) ç«¯å£å’Œ 443(HTTPS) ç«¯å£.</p>
<p><img src="https://image.white-than-wood.zone/hexo/security_group.png"></p>
<p>é…ç½®å®Œä¹‹å,åŸºæœ¬å¯ä»¥é€šè¿‡ ip æ¥è¿›è¡Œè®¿é—®åšå®¢ç½‘ç«™.ä½†è¦æƒ³å®ç°é€šè¿‡åŸŸåæ¥è®¿é—®è¿˜éœ€è¦å®è¡ŒåŸŸåè§£æ,é€šè¿‡ Aè®°å½• å°†åŸŸåæŒ‡å‘ä¸€ä¸ª IPV4 åœ°å€,ä¹Ÿå°±æ˜¯è´­ä¹°çš„é˜¿é‡Œäº‘æœåŠ¡å™¨ ECS ip.</p>
<p><img src="https://image.white-than-wood.zone/hexo/hexo_dns.png"></p>
<pre><code>&#39;@&#39; æ˜¯æºåŸŸå(ä¸»åŸŸå white-than-wood.zone).
&#39;www&#39; åˆ™æ˜¯ www.white-than-wood.zone.
</code></pre>
<p>è¿™æ ·å°±å¯ä»¥å®ç°é€šè¿‡åŸŸåæ¥è®¿é—®åšå®¢ç½‘ç«™,ä½†å¹¶æ²¡æœ‰å¼€å¯ SSL è¯ä¹¦,ä¹Ÿå°±æ˜¯å¹¶æ²¡æœ‰å¯åŠ¨ https,è¦æƒ³å®Œæ•´å®ç°å¼€å¯ SSL è¯ä¹¦çš„åŸŸåè¿˜éœ€è¦ç”³è¯· SSL è¯ä¹¦ä»¥åŠå†æ¬¡é…ç½® nginx.</p>
<p>ä¸€. SSL è¯ä¹¦</p>
<p>é€šè¿‡é˜¿é‡Œäº‘å¹³å°è´­ä¹°æˆ–è€…å…è´¹ç”³è¯·,å¯ä»¥è·å¾— SSL è¯ä¹¦,è¿™é‡Œç”³è¯·çš„æ˜¯ä¸€å¹´æœŸé™çš„æ™®é€šç‰ˆ DV SSL è¯ä¹¦.</p>
<p><img src="https://image.white-than-wood.zone/hexo/hexo_ssl.png"></p>
<p>å°†ç”³è¯·å¥½çš„ SSL è¯ä¹¦ä¸‹è½½å¹¶é€šè¿‡ Filezilla ä¼ è¾“è‡³è¿œç¨‹æœåŠ¡å™¨ä¸­,æ¥ç€é…ç½® nginx.</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">For more information on configuration, see:</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">  * Official English Documentation: http://nginx.org/en/docs/</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">  * Official Russian Documentation: http://nginx.org/ru/docs/</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è¿™é‡Œæ¯”è¾ƒç®€å•ç²—æš´çš„å°†ç”¨æˆ·ç»„ç½®ä¸º root root,ä½¿å¾— nginx å¯ä»¥è®¿é—®å¸¦æœ‰ root æƒé™çš„æ–‡ä»¶ä»¥åŠæ–‡ä»¶å¤¹.</span></span><br><span class="line">user root;</span><br><span class="line">worker_processes auto;</span><br><span class="line">error_log /var/log/nginx/error.log;</span><br><span class="line">pid /run/nginx.pid;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Load dynamic modules. See /usr/share/doc/nginx/README.dynamic.</span></span><br><span class="line">include /usr/share/nginx/modules/*.conf;</span><br><span class="line"></span><br><span class="line">events &#123;</span><br><span class="line">    worker_connections 1024;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">http &#123;</span><br><span class="line">    log_format  main  &#x27;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#x27;</span><br><span class="line">    &#x27;$status $body_bytes_sent &quot;$http_referer&quot; &#x27;</span><br><span class="line">    &#x27;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#x27;;</span><br><span class="line"></span><br><span class="line">    access_log  /var/log/nginx/access.log  main;</span><br><span class="line"></span><br><span class="line">    sendfile             on;</span><br><span class="line">    tcp_nopush          on;</span><br><span class="line">    tcp_nodelay         on;</span><br><span class="line">    keepalive_timeout   65;</span><br><span class="line">    types_hash_max_size 2048;</span><br><span class="line"></span><br><span class="line">    include             /etc/nginx/mime.types;</span><br><span class="line">    default_type        application/octet-stream;</span><br><span class="line"></span><br><span class="line">    # Load modular configuration files from the /etc/nginx/conf.d directory.</span><br><span class="line">    # See http://nginx.org/en/docs/ngx_core_module.html#include</span><br><span class="line">    # for more information.</span><br><span class="line">    include /etc/nginx/conf.d/*.conf;</span><br><span class="line">    </span><br><span class="line">    # http é…ç½®</span><br><span class="line">    server &#123;</span><br><span class="line">        listen       80 default_server;</span><br><span class="line">        listen       [::]:80 default_server;</span><br><span class="line">        server_name  localhost;</span><br><span class="line">        root         /root/w-t-w;</span><br><span class="line"></span><br><span class="line">        # Load configuration files for the default server block.</span><br><span class="line">        include /etc/nginx/default.d/*.conf;</span><br><span class="line"></span><br><span class="line">        location / &#123;</span><br><span class="line">	        index index.html;</span><br><span class="line">	        # å°† router è·¯ç”±ä¸­ä¸å­˜åœ¨çš„é¡µé¢é‡å®šå‘è‡³ index.html.</span><br><span class="line">	        try_files $uri /$uri /index.html;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        error_page 404 /404.html;</span><br><span class="line">            location = /40x.html &#123;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        error_page 500 502 503 504 /50x.html;</span><br><span class="line">            location = /50x.html &#123;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    # Settings for a TLS enabled server.</span><br><span class="line">    # https é…ç½®,æ·»åŠ  SSL è¯ä¹¦.</span><br><span class="line">    server &#123;</span><br><span class="line">        # https è®¿é—®ç«¯å£ä¸€èˆ¬ä¸º 443 ç«¯å£</span><br><span class="line">        listen       443 ssl http2 default_server;</span><br><span class="line">        listen       [::]:443 ssl http2 default_server;</span><br><span class="line">        # å¼€å¯ SSL è¯ä¹¦</span><br><span class="line">        ssl          on;</span><br><span class="line">        # SSL è¯ä¹¦ç»‘å®šçš„åŸŸå</span><br><span class="line">        server_name  white-than-wood.zone www.white-than-wood.zone;</span><br><span class="line">        root         /root/w-t-w;</span><br><span class="line">        </span><br><span class="line">        # SSL è¯ä¹¦å…·ä½“é…ç½®</span><br><span class="line">        # è¯ä¹¦æ–‡ä»¶é…ç½®,è¯ä¹¦æ–‡ä»¶ä½ç½®ç›®å½•å¿…é¡»ä¸ºç»å¯¹è·¯å¾„</span><br><span class="line">        ssl_certificate           &quot;/etc/nginx/cert/xxxx_white-than-wood.zone.pem&quot;;</span><br><span class="line">        ssl_certificate_key       &quot;/etc/nginx/cert/xxxx_white-than-wood.zone.key&quot;;</span><br><span class="line">        # SSL è¯ä¹¦ç¼“å­˜æœ‰æ•ˆæœŸ</span><br><span class="line">        ssl_session_timeout       5m;</span><br><span class="line">        # å®‰å…¨é“¾æ¥å¯é€‰çš„åŠ å¯†åè®®</span><br><span class="line">        ssl_protocols             TLSv1 TLSv1.1 TLSv1.2;</span><br><span class="line">        # å®‰å…¨é“¾æ¥åŠ å¯†ç®—æ³•</span><br><span class="line">        ssl_ciphers               ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4;</span><br><span class="line">        # ä½¿ç”¨æœåŠ¡å™¨ç«¯çš„é¦–é€‰ç®—æ³•</span><br><span class="line">        ssl_prefer_server_ciphers on;</span><br><span class="line"></span><br><span class="line">        # Load configuration files for the default server block.</span><br><span class="line">        include /etc/nginx/default.d/*.conf;</span><br><span class="line"></span><br><span class="line">        location / &#123;</span><br><span class="line">	        index index.html;</span><br><span class="line">	        # å°† router è·¯ç”±ä¸­ä¸å­˜åœ¨çš„é¡µé¢é‡å®šå‘è‡³ index.html.</span><br><span class="line">	        try_files $uri $uri/ /index.html;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">	    location = /login/oauth/access_token &#123;</span><br><span class="line">            add_header Access-Control-Allow-Origin &#x27;https://white-than-wood.zone/&#x27;;</span><br><span class="line">            add_header Access-Control-Allow-Methods &#x27;GET, POST, OPTIONS&#x27;;</span><br><span class="line">            add_header Access-Control-Allow-Headers &#x27;DNT,X-Mx-ReqToken,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Authorization&#x27;;</span><br><span class="line">            if ($request_method = &#x27;OPTIONS&#x27;) &#123;</span><br><span class="line">                return 204;</span><br><span class="line">            &#125;</span><br><span class="line">            proxy_pass https://github.com/;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        error_page 404 /404.html;</span><br><span class="line">            location = /40x.html &#123;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        error_page 500 502 503 504 /50x.html;</span><br><span class="line">            location = /50x.html &#123;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é‡å¯ä¸€ä¸‹ nginx,æœ€åç›´æ¥è®¿é—® <a href="https://white-than-wood.zone/">https://white-than-wood.zone</a> ~ Bingo!!</p>
<p><img src="https://image.white-than-wood.zone/hexo/hexo_https_bingo.png"></p>
<h4 id="hexo-theme-ä¸»é¢˜é…ç½®"><a href="#hexo-theme-ä¸»é¢˜é…ç½®" class="headerlink" title="hexo theme ä¸»é¢˜é…ç½®"></a>hexo theme ä¸»é¢˜é…ç½®</h4><blockquote>
<p>ç¤ºä¾‹</p>
</blockquote>
<p>ç­›é€‰å¥½ä¸ªäººé€‰ä¸­çš„ä¸»é¢˜ä¹‹å,å°±éœ€è¦åœ¨é¡¹ç›®é‡Œé¢è¿›è¡Œé…ç½®æ›´æ¢ã€‚é¦–å…ˆéœ€è¦ä¸‹è½½è¿œç¨‹ github åº“é‡Œé¢çš„ä¸»é¢˜é¡¹ç›®åˆ°é¡¹ç›®æ ¹ç›®å½•é‡Œé¢çš„ themes<br>æ–‡ä»¶å¤¹åº•ä¸‹,æ¯”å¦‚æœ¬äººç”¨çš„æ˜¯ next ä¸»é¢˜çš„ hexo.</p>
<pre><code># æ³¨æ„ hexo 6.x ä¹‹å‰ä¸‹è½½ next ä¸»é¢˜è¿œç¨‹ github é“¾æ¥ä¸ hexo 6.x ä¹‹åä¸åŒ!
# hexo 6.x ä¹‹å‰
git clone https://github.com/iissnan/hexo-theme-next.git themes/next
# hexo 6.x ä¹‹å
git clone https://github.com/theme-next/hexo-theme-next themes/next
</code></pre>
<img src='https://image.white-than-wood.zone/hexo/next_theme.png' style='width: 100%; height: auto;'/>

<p>éšååœ¨æ ¹ç›®å½•é‡Œé¢çš„ _config.yml æ–‡ä»¶ä¸­æ›´æ”¹ theme é…ç½®.</p>
<pre><code>theme: next
</code></pre>
<p>æ¥ç€é€‰æ‹©ä¸»é¢˜å±•ç¤ºçš„æ–¹å¼,éœ€è¦åœ¨ä¸»é¢˜ç›®å½•ä¸‹,åœ¨ _config.yml æ–‡ä»¶ä¸­æ›´æ”¹ Scheme é…ç½®,æ¯”å¦‚ next ä¸»é¢˜åº•ä¸‹çš„ Scheme é…ç½®.</p>
<pre><code>scheme:
    #scheme: Muse
    #scheme: Mist
    scheme: Pisces
    #scheme: Gemini
</code></pre>
<h4 id="hexo-language-è¯­è¨€é…ç½®"><a href="#hexo-language-è¯­è¨€é…ç½®" class="headerlink" title="hexo language è¯­è¨€é…ç½®"></a>hexo language è¯­è¨€é…ç½®</h4><blockquote>
<p>æ­¥éª¤</p>
</blockquote>
<p>æ¯ä¸ªä¸»é¢˜çš„è¯­è¨€éƒ½æ˜¯æ ¹æ®åšå®¢ä½œè€…çš„æ¯è¯­æ¥é…ç½®çš„,è¦æƒ³é…ç½®å¼€å‘è€…ä¸ªäººå›½å®¶çš„è¯­è¨€,è¿˜æ˜¯åœ¨é¡¹ç›®æ ¹ç›®å½•åº•ä¸‹çš„ _config.yml æ–‡ä»¶ä¸­æ›´æ”¹<br>language é…ç½®.</p>
<pre><code>language: zh-CN
</code></pre>
<p>å†åœ¨ä¸»é¢˜ç›®å½•åº•ä¸‹çš„ _config.yml æ–‡ä»¶ä¸­æ›´æ”¹ language é…ç½®.</p>
<pre><code>language: zh-CN
</code></pre>
<h4 id="hexo-page-é¡µé¢é…ç½®"><a href="#hexo-page-é¡µé¢é…ç½®" class="headerlink" title="hexo page é¡µé¢é…ç½®"></a>hexo page é¡µé¢é…ç½®</h4><blockquote>
<p>æ­¥éª¤</p>
</blockquote>
<p>hexo æä¾›äº†å‡ ä¸ªå¯ä¾›ç­›é€‰çš„é¡µé¢,å¸¸ç”¨çš„æœ‰è¿™ä¹ˆå‡ ä¸ªï¼šhome(é¦–é¡µ)ã€tags(æ ‡ç­¾)ã€about(å…³äºæˆ‘)ã€archives(æ¡£æ¡ˆ)å’Œcategories(åˆ†ç±»)<br>,é¦–å…ˆè¦åˆ›å»ºé¡µé¢.</p>
<pre><code>hexo new page tags
hexo new page about
hexo new page archives
hexo new page categories
</code></pre>
<p>æ¥ç€åœ¨ä¸»é¢˜ç›®å½•ä¸‹,åœ¨ _config.yml æ–‡ä»¶ä¸­æ›´æ”¹ menu é…ç½®,å½“ç„¶æ¯ä¸ªä¸»é¢˜çš„é…ç½®ä¸å°½ç›¸åŒ.</p>
<pre><code>menu:
    home: / || fa fa-home
    about: /about/ || fa fa-user
    tags: /tags/ || fa fa-tags
    categories: /categories/ || fa fa-th
    archives: /archives/ || fa fa-archive
</code></pre>
<p>éšåæ›´æ”¹ source ç›®å½•åº•ä¸‹åˆ›å»ºçš„é¡µé¢é…ç½®,ä»¥ tags ä¸ºä¾‹.</p>
<pre><code>----------------------------
    title: æ ‡ç­¾
    date: 2018-04-24 17:57:26
    type: &quot;tags&quot;
    comments: false
----------------------------
</code></pre>
<h4 id="hexo-avatar-å¤´åƒé…ç½®"><a href="#hexo-avatar-å¤´åƒé…ç½®" class="headerlink" title="hexo avatar å¤´åƒé…ç½®"></a>hexo avatar å¤´åƒé…ç½®</h4><blockquote>
<p>æ­¥éª¤</p>
</blockquote>
<p>é…ç½®ä¸ªäººåšå®¢ç½‘ç«™çš„å¤´åƒ,éœ€è¦æ›´æ”¹ä¸»é¢˜ç›®å½•åº•ä¸‹çš„ _config.yml æ–‡ä»¶,æ·»åŠ  avatar é…ç½®.</p>
<pre><code>#å¤´åƒurlé“¾æ¥
avatar: https://avatars.githubusercontent.com/u/112366447?v=4
</code></pre>
<h4 id="hexo-search-å…¨ç«™æœç´¢é…ç½®"><a href="#hexo-search-å…¨ç«™æœç´¢é…ç½®" class="headerlink" title="hexo search å…¨ç«™æœç´¢é…ç½®"></a>hexo search å…¨ç«™æœç´¢é…ç½®</h4><blockquote>
<p>æ­¥éª¤</p>
</blockquote>
<p>å‡å¦‚æƒ³è¦é…ç½® hexo ä¸ªäººåšå®¢ç½‘ç«™çš„å…¨ç«™æœç´¢é…ç½®,é¦–å…ˆè¦ä¸‹è½½ hexo search å¤–éƒ¨ä¾èµ–åŒ….</p>
<pre><code>npm install hexo-generator-search --save
npm install hexo-generator-searchdb --save
</code></pre>
<p>æ›´æ”¹æ ¹ç›®å½•åº•ä¸‹çš„ _config.yml æ–‡ä»¶,æ·»åŠ  search é…ç½®.</p>
<pre><code>search:
    path: search.xml
    field: post
    format: html
    limit: 10000
</code></pre>
<p>å¼€å¯ä¸»é¢˜ç›®å½•åº•ä¸‹çš„ _config.yml æ–‡ä»¶ä¸­çš„ local_search é…ç½®.</p>
<pre><code>local_search:
    enable: true
</code></pre>
<h4 id="hexo-åšå®¢æ–‡ä»¶é…ç½®"><a href="#hexo-åšå®¢æ–‡ä»¶é…ç½®" class="headerlink" title="hexo åšå®¢æ–‡ä»¶é…ç½®"></a>hexo åšå®¢æ–‡ä»¶é…ç½®</h4><blockquote>
<p>æ­¥éª¤</p>
</blockquote>
<p>å‡å¦‚æƒ³è¦æ›´æ”¹æ¯ä¸€ç¯‡åšå®¢çš„æ–‡ä»¶åç§°,ä¸å†æ˜¯é»˜è®¤çš„:title.mdçš„æ–‡ä»¶å,éœ€è¦åœ¨æ ¹ç›®å½•åº•ä¸‹çš„ _config.yml æ–‡ä»¶ä¸­æ›´æ”¹ new_post_name<br>é…ç½®.</p>
<pre><code>new_post_name: :year-:month-:day-:title.md
</code></pre>
<h4 id="hexo-auto-excerpt-é˜…è¯»å…¨æ–‡é…ç½®"><a href="#hexo-auto-excerpt-é˜…è¯»å…¨æ–‡é…ç½®" class="headerlink" title="hexo auto_excerpt é˜…è¯»å…¨æ–‡é…ç½®"></a>hexo auto_excerpt é˜…è¯»å…¨æ–‡é…ç½®</h4><blockquote>
<p>æ­¥éª¤</p>
</blockquote>
<p>åšå®¢æ–‡ç« ä¸€èˆ¬éƒ½ä¼šå¾ˆé•¿çš„,æ‰€ä»¥åœ¨é¦–é¡µè¦å¯¹åšå®¢è¿›è¡Œè¶…é•¿çœç•¥,è¦æƒ³çœ‹æ‰€æœ‰çš„å†…å®¹,ç‚¹å‡»é˜…è¯»å…¨æ–‡æˆ–è€…æ–‡ç« æ ‡é¢˜è¿›å…¥å…¨æ–‡æŸ¥çœ‹.åœ¨<br>hexo-theme-next ä¸»é¢˜ç‰ˆæœ¬ 7.6 ä¹‹å‰éœ€è¦å†ä¸»é¢˜ç›®å½•åº•ä¸‹çš„ _config.yml æ–‡ä»¶ä¸­æ›´æ”¹ auto_excerpt é…ç½®.</p>
<pre><code>auto_excerpt:
    enable: true
    length: 200
</code></pre>
<p>åœ¨ hexo-theme-next ä¸»é¢˜ç‰ˆæœ¬ 7.6 ä¹‹å,ç”±äº auto_excerpt<br>è¿™ç§è¶…é•¿çœç•¥ä¸åº”è¯¥æ˜¯ä¸»é¢˜æ’ä»¶åº”è¯¥åšçš„,ä½œè€…å°†æ­¤é…ç½®ç§»é™¤,å¹¶ç»™å‡ºæ–°çš„ä¸“é—¨é’ˆå¯¹æ­¤é…ç½®çš„æ’ä»¶ <a href='https://github.com/chekun/hexo-excerpt'><br>hexo-excerpt</a>.</p>
<p><img src="https://image.white-than-wood.zone/hexo/remove_auto_excerpt.png"></p>
<pre><code>excerpt:
    #æ˜¾ç¤ºçš„ markdown ä»£ç å—å±‚æ•°
    depth: 5
    excerpt_excludes: []
    more_excludes: []
    #è®¾ç½®ä¸ºtrue: æ˜¾ç¤ºè¶…é•¿çœç•¥,åªå±•ç¤ºéƒ¨åˆ†,éšè—å…¨æ–‡
    #è®¾ç½®ä¸ºfalse: å±•ç¤ºå…¨æ–‡
    hideWholePostExcerpts: true
    excerpt_description: true
    #æ˜¯å¦æ˜¾ç¤ºé˜…è¯»å…¨æ–‡æŒ‰é’®
    read_more_btn: true
</code></pre>
<h4 id="hexo-browsersync-çƒ­åŠ è½½é…ç½®"><a href="#hexo-browsersync-çƒ­åŠ è½½é…ç½®" class="headerlink" title="hexo browsersync çƒ­åŠ è½½é…ç½®"></a>hexo browsersync çƒ­åŠ è½½é…ç½®</h4><blockquote>
<p>æ­¥éª¤</p>
</blockquote>
<p>åœ¨åˆ›ä½œåšå®¢æ—¶,éœ€è¦æ¯æ¬¡æ‰‹åŠ¨åˆ·æ–°é¡µé¢æ‰èƒ½çœ‹åˆ°ä¿®æ”¹åçš„ç»“æœ,æ„Ÿè§‰éå¸¸æ²¡æœ‰æ•ˆç‡,å¦‚æœå­˜åœ¨ç±»hrmçƒ­åŠ è½½è¿™ç§æ’ä»¶å°±å¤ªçˆ½äº†! <a href='https://github.com/hexojs/hexo-browsersync'><br>hexo-browsersync</a> å¯ä»¥ç›´æ¥è§£å†³è¿™ä¸ªé—®é¢˜.</p>
<pre><code>npm install hexo-browsersync --save
</code></pre>
<p>æ­¤æ’ä»¶åŸç†åŸºäº browser-sync ,ä¸ hexo å»ºç«‹å…³è”,å½“åˆ›ä½œçš„æ–‡ä»¶å†…å®¹å‘ç”Ÿæ”¹å˜æ—¶, browser-sync<br>å°±ä¼šç›‘å¬åˆ°å¹¶åˆ·æ–°æµè§ˆå™¨æ•´ä¸ªé¡µé¢çš„å†…å®¹,åšåˆ°ä¸éœ€æ‰‹åŠ¨åˆ·æ–°,å¤§å¤§æé«˜äº†åˆ›ä½œæ•ˆç‡.</p>
<pre><code>#æ›´æ”¹æ ¹ç›®å½•åº•ä¸‹çš„ _config.yml æ–‡ä»¶,æ·»åŠ  browsersync å±æ€§
#è®¾ç½®ç›‘å¬ watch å±æ€§ä¸º true å°±å¯ä»¥äº†!
browsersync:
    watch: true
    logLevel: &quot;warn&quot;
</code></pre>
<h4 id="hexo-busuanzi-count-åœç®—å­ç»Ÿè®¡é…ç½®"><a href="#hexo-busuanzi-count-åœç®—å­ç»Ÿè®¡é…ç½®" class="headerlink" title="hexo busuanzi_count åœç®—å­ç»Ÿè®¡é…ç½®"></a>hexo busuanzi_count åœç®—å­ç»Ÿè®¡é…ç½®</h4><blockquote>
<p>æ­¥éª¤</p>
</blockquote>
<p>ä¸Šçº¿ä¹‹å,éœ€è¦å¯¹ä¸ªäººåšå®¢è¿›è¡Œç®¡ç†,é˜…è¯»äººæ•°ä»¥åŠæ¬¡æ•°å¯¹äºåˆ›ä½œè€…æ¥è¯´æ˜¯å¾ˆé‡è¦åé¦ˆç‚¹.ç»Ÿè®¡é…ç½®éœ€è¦æ›´æ”¹ä¸»é¢˜ç›®å½•åº•ä¸‹çš„ _config.yml<br>æ–‡ä»¶,é…ç½® busuanzi_count åœç®—å­ç»Ÿè®¡.</p>
<pre><code>#å¯é…ç½®æŸ¥çœ‹ä¸ªäººåšå®¢çš„é˜…è¯»äººæ•°ã€æ¬¡æ•°ä»¥åŠæ¯ç¯‡åšå®¢æ–‡ç« çš„æ¬¡æ•°
busuanzi_count:
    enable: true
    total_visitors: true
    total_visitors_icon: fa fa-user
    total_views: true
    total_views_icon: fa fa-eye
    post_views: true
    post_views_icon: fa fa-eye
</code></pre>
<h4 id="hexo-baidu-analytics-ç™¾åº¦ç»Ÿè®¡é…ç½®"><a href="#hexo-baidu-analytics-ç™¾åº¦ç»Ÿè®¡é…ç½®" class="headerlink" title="hexo baidu_analytics ç™¾åº¦ç»Ÿè®¡é…ç½®"></a>hexo baidu_analytics ç™¾åº¦ç»Ÿè®¡é…ç½®</h4><blockquote>
<p>æ­¥éª¤</p>
</blockquote>
<p>åœç®—å­ç»Ÿè®¡æœ‰æ—¶å€™ä¼šå‡ºç°ä¸€äº›å¼‚å¸¸,æ¯”å¦‚pvè«åä¼šåŠ 100,uvä¸å†åŒºåˆ†å•ä¸ªip.ä¸ºäº†è¿½æ±‚æ›´ç²¾ç¡®ã€æ›´æ™ºèƒ½,è¿™é‡Œé‡‡ç”¨ç™¾åº¦ç»Ÿè®¡.<br>ç»Ÿè®¡é…ç½®éœ€è¦æ›´æ”¹ä¸»é¢˜ç›®å½•åº•ä¸‹çš„ _config.yml æ–‡ä»¶,é…ç½® baidu_analytics ç™¾åº¦ç»Ÿè®¡.</p>
<p>æ ¹æ®<a href='https://tongji.baidu.com/main/setting/10000339309/home/site/getjs?siteId=18040501'><br>ç™¾åº¦ç»Ÿè®¡-ä½¿ç”¨é…ç½®-ä»£ç è·å–</a>,å°† hm.js åæ–¹è‡ªåŠ¨ç”Ÿæˆçš„ id é…ç½®è‡³ baidu_analytics.</p>
<p><img src="https://image.white-than-wood.zone/hexo/baidu_analytics.png"></p>
<pre><code># Baidu Analytics
# See: https://tongji.baidu.com
baidu_analytics: 31f07c2ec89d10385ec28e8eea5bbc3a
</code></pre>
<h4 id="hexo-Gitalk-ç•™è¨€æ¿é…ç½®"><a href="#hexo-Gitalk-ç•™è¨€æ¿é…ç½®" class="headerlink" title="hexo Gitalk ç•™è¨€æ¿é…ç½®"></a>hexo Gitalk ç•™è¨€æ¿é…ç½®</h4><blockquote>
<p>æ­¥éª¤</p>
</blockquote>
<p>ç•™è¨€æ¿ comments æ˜¯åˆ›ä½œè€…ä¸é˜…è¯»è€…è¿›è¡Œäº’åŠ¨åé¦ˆçš„çª—å£,å¯ä»¥ä½¿é˜…è¯»è€…ä¸åˆ›ä½œè€…å…±åŒè¿›æ­¥.å¯¹äº hexo æ¥è¯´,æ”¯æŒçš„ç•™è¨€æ¿æ¨¡å¼æœ‰å¾ˆå¤šç§: â€˜disqus | disqusjs | changyan | livere | gitalk | utterancesâ€™,æ¯”è¾ƒå¸¸è§ã€ç”¨æˆ·é‡æ¯”è¾ƒå¤§ä¸”ä¸ github å…³è”æ€§æ¯”è¾ƒå¼ºçš„å°±æ˜¯ gitalk ä»¥åŠ disqus,disqusjs éœ€è¦â€™æ¢¯å­â€™ğŸ¶æ‰èƒ½è¯„è®º,é‚£ä¹ˆè¿˜æ˜¯é€‰ç”¨ gitalk .ç•™è¨€æ¿é…ç½®éœ€è¦æ›´æ”¹ä¸»é¢˜ç›®å½•ä¸‹çš„ _config.yml æ–‡ä»¶.</p>
<p>é…ç½®comments:</p>
<pre><code># Multiple Comment System Support
comments:
    # Available values: tabs | buttons
    style: tabs
    # Choose a comment system to be displayed by default.
    # Available values: disqus | disqusjs | changyan | livere | gitalk | utterances
    active: gitalk
    # Setting `true` means remembering the comment system selected by the visitor.
    storage: true
    # Lazyload all comment systems.
    lazyload: false
    # Modify texts or order for any naves, here are some examples.
    nav:
        gitalk:
            order: -2
        disqus:
            text: Load Disqus
            order: -1
</code></pre>
<p>é…ç½®gitalk:</p>
<pre><code># Gitalk
# For more information: https://gitalk.github.io
gitalk:
    enable: true
    github_id: w-t-w # GitHub repo owner
    repo: w-t-w.github.io # Repository name to store issues
    client_id: 1191ab5290535c1acb09 # GitHub Application Client ID
    client_secret: 8d2cbebac1ae1230f84d1f9f7a36f8008a42c14b # GitHub Application Client Secret
    admin_user: w-t-w # GitHub repo owner and collaborators, only these guys can initialize gitHub issues
    distraction_free_mode: true # Facebook-like distraction free mode
    # When the official proxy is not available, you can change it to your own proxy address
    proxy: https://cors-anywhere.azm.workers.dev/https://github.com/login/oauth/access_token
    # proxy: login/oauth/access_token # This is official proxy address
    # Gitalk&#39;s display language depends on user&#39;s browser or system environment
    # If you want everyone visiting your site to see a uniform language, you can set a force language value
    # Available values: en | es-ES | fr | ru | zh-CN | zh-TW
    language: zh-CN
</code></pre>
<p>ä¸Šé¢çš„é…ç½®é¡¹ä¸­æœ‰å‡ ä¸ªéœ€è¦è¯´æ˜çš„ï¼š</p>
<ul>
<li>client_id ä¸ client_secret æ˜¯ Github çš„ OAuth è®¤è¯(ä¸‹ä¸€ä¸ªéƒ¨åˆ†ä¼šä»‹ç»).</li>
<li>github_id ä¸ admin_user è¿™é‡Œå»ºè®®å¡«ä¸€æ ·,å¡«æˆä¸ªäººçš„ github è´¦å·å(ä¸æ˜¯é‚®ç®±,ä¹Ÿä¸æ˜¯ç”¨æˆ·å).</li>
<li>proxy é»˜è®¤å³æ˜¯ä¸Šé¢çš„åœ°å€,å®ƒå…¶å®ä¼šå›è°ƒåˆ°è¿™é‡Œ <a href='https://github.com/login/oauth/access_token'>https://github.com/login/oauth/access_token</a>.</li>
<li>æ— è®ºæ˜¯éƒ¨ç½²è‡³ GitHub Page ä¸ªäººç½‘ç«™,è¿˜æ˜¯éƒ¨ç½²è‡³ä¸ªäººç”³è¯·è´­ä¹°çš„äº‘æœåŠ¡å™¨,ä¸Šé¢ä¸‰ç‚¹æ˜¯å¿…é¡»è¦å®è¡Œçš„,proxy 403 é—®é¢˜ä¸»è¦æ˜¯åœ¨éƒ¨ç½²è‡³ä¸ªäººç”³è¯·è´­ä¹°çš„äº‘æœåŠ¡å™¨ä¸­æ—¶ä¼šé‡åˆ°,è€Œéƒ¨ç½²è‡³ GitHub Page ä¸ªäººç½‘ç«™ä¸èƒ½è¿›è¡Œè‡ªå®šä¹‰é…ç½®åå‘ä»£ç†,æ‰€ä»¥åªèƒ½ä½¿ç”¨ Gitalk å®˜æ–¹æ­å»ºçš„ä»£ç†.</li>
</ul>
<p>ä¸€. Github çš„ OAuth è®¤è¯.</p>
<p>å‰ææ˜¯å¾—æœ‰ä¸€ä¸ª github è´¦å·,æ‰èƒ½æ³¨å†Œ OAuth application ,è¿™æ˜¯<a href='https://github.com/settings/applications/new'> OAuth åº”ç”¨æ³¨å†Œåœ°å€</a>.</p>
<p><img src="https://image.white-than-wood.zone/hexo/github_auth_registers.png"></p>
<p>PS: å¦‚æœæœ‰è‡ªå®šä¹‰åŸŸå(å¦‚ä¸ªäººç”³è¯·çš„é˜¿é‡Œäº‘åŸŸå),åˆ™åœ¨ä¸Šå›¾ä¸­å¡«å…¥è‡ªå®šä¹‰åŸŸå.</p>
<p>æ³¨å†Œä¹‹å,ç‚¹å‡»ä¸‹å›¾ä¸­â€™Generate a new client secretâ€™æŒ‰é’®,åœ¨ä¸ªäººè´¦å·ä¸‹çš„Settings -&gt; Developer settings -&gt; OAuth Appsä¸‹é¢å¯ä»¥æŸ¥çœ‹ OAuth è®¤è¯ client_id ä¸ client_secret.</p>
<p><img src="https://image.white-than-wood.zone/hexo/developer_setting.png"></p>
<p>äºŒ. Gitalk è‡ªåŠ¨åˆå§‹åŒ–.</p>
<p>åŸç†: é€šè¿‡ sitemap ä¸­çš„ä¿¡æ¯,è¯·æ±‚ github å¼€æ”¾ api è¾¾åˆ°è‡ªåŠ¨äº§ç”Ÿ issues çš„ç›®çš„.<br>åŸºæœ¬çš„è¦æ±‚: github API éœ€è¦è¯·æ±‚ token.</p>
<ul>
<li><p>ç”³è¯· github Token.</p>
<p>éœ€è¦ä½¿ç”¨ Personal access tokens æ–¹å¼,è¿™ç§æ–¹å¼é™åˆ¶æ¯å°æ—¶5000æ¬¡,ç»“åˆç¼“å­˜åŠŸèƒ½,åŸºæœ¬æ»¡è¶³éœ€æ±‚.<br>ä» Github çš„ <a href='https://github.com/settings/tokens'>Personal access tokens</a> é¡µé¢,ç‚¹å‡» <a href='https://github.com/settings/tokens/new'>Generate new token</a>.</p>
</li>
</ul>
<p><img src="https://image.white-than-wood.zone/hexo/access_tokens.png"></p>
<ul>
<li><p>å®‰è£… npm ä¾èµ–é¡¹.</p>
<pre><code>npm i -D md5 moment request xml-parser
npm i -S hexo-generator-sitemap
</code></pre>
</li>
<li><p>é…ç½® sitemap.</p>
<p>åœ¨æ ¹ç›®å½•ä¸­åˆ›å»º sitemap_template.xml.</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">urlset</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.sitemaps.org/schemas/sitemap/0.9&quot;</span>&gt;</span></span><br><span class="line">  &#123;% for post in posts %&#125;</span><br><span class="line">  <span class="tag">&lt;<span class="name">url</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">loc</span>&gt;</span>&#123;&#123; post.permalink | uriencode &#125;&#125;<span class="tag">&lt;/<span class="name">loc</span>&gt;</span></span><br><span class="line">    &#123;% if post.updated %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">lastmod</span>&gt;</span>&#123;&#123; post.updated.toISOString() &#125;&#125;<span class="tag">&lt;/<span class="name">lastmod</span>&gt;</span></span><br><span class="line">    &#123;% elif post.date %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">lastmod</span>&gt;</span>&#123;&#123; post.date.toISOString() &#125;&#125;<span class="tag">&lt;/<span class="name">lastmod</span>&gt;</span></span><br><span class="line">    &#123;% endif %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">date</span>&gt;</span>&#123;&#123; post.date &#125;&#125;<span class="tag">&lt;/<span class="name">date</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>&#123;&#123; post.title + &#x27; | &#x27; + config.title &#125;&#125;<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    &#123;# nunjucks æ¨¡ç‰ˆè¯­æ³• https://github.com/mozilla/nunjucks #&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">desc</span>&gt;</span>&#123;&#123; post.description | default(post.excerpt) | default(post.content) | default(config.description) | striptags | truncate(200, true, &#x27;&#x27;) &#125;&#125;<span class="tag">&lt;/<span class="name">desc</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">  &#123;% endfor %&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">urlset</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>ä¿®æ”¹æ ¹ç›®å½•ä¸‹çš„ _config.yml.</p>
<pre><code>#Sitemap
sitemap:
  path: sitemap.xml
  template: ./sitemap_template.xml
  rel: false
  tag: true
  category: false
</code></pre>
</li>
<li><p>ç”Ÿæˆ sitemap.xml ç”Ÿäº§ç¯å¢ƒæ–‡ä»¶.</p>
<pre><code>hexo clean &amp;&amp; hexo generate
</code></pre>
</li>
<li><p>æ ¹ç›®å½•æ·»åŠ  talk-auto-init.js (æ³¨æ„è¿˜æ˜¯ä¸è¦å°†æ­¤æ–‡ä»¶ç½®äºgithubä¸­,å»ºè®®ignore).</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> url = <span class="built_in">require</span>(<span class="string">&#x27;url&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> request = <span class="built_in">require</span>(<span class="string">&#x27;request&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> xmlParser = <span class="built_in">require</span>(<span class="string">&#x27;xml-parser&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> md5 = <span class="built_in">require</span>(<span class="string">&#x27;md5&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// é…ç½®ä¿¡æ¯</span></span><br><span class="line"><span class="keyword">const</span> config = &#123;</span><br><span class="line">  <span class="attr">username</span>: <span class="string">&#x27;w-t-w&#x27;</span>, <span class="comment">// GitHub repository æ‰€æœ‰è€…ï¼Œå¯ä»¥æ˜¯ä¸ªäººæˆ–è€…ç»„ç»‡ã€‚å¯¹åº” Gitalk é…ç½®ä¸­çš„ owner</span></span><br><span class="line">  <span class="attr">repo</span>: <span class="string">&quot;w-t-w.github.io&quot;</span>, <span class="comment">// å‚¨å­˜è¯„è®º issue çš„ github ä»“åº“åï¼Œä»…éœ€è¦ä»“åº“åå­—å³å¯ã€‚å¯¹åº” Gitalk é…ç½®ä¸­çš„ repo</span></span><br><span class="line">  <span class="attr">token</span>: <span class="string">&#x27;ghp_EuXHDkOxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&#x27;</span>, <span class="comment">// å‰é¢ç”³è¯·çš„ personal access token</span></span><br><span class="line">  <span class="attr">sitemap</span>: path.<span class="title function_">join</span>(__dirname, <span class="string">&#x27;./public/sitemap.xml&#x27;</span>), <span class="comment">// ä¸ªäººç«™ç‚¹çš„ sitemap æ–‡ä»¶åœ°å€</span></span><br><span class="line">  <span class="attr">cache</span>: <span class="literal">true</span>, <span class="comment">// æ˜¯å¦å¯ç”¨ç¼“å­˜ï¼Œå¯ç”¨ç¼“å­˜ä¼šå°†å·²ç»åˆå§‹åŒ–çš„æ•°æ®å†™å…¥é…ç½®çš„ gitalkCacheFile æ–‡ä»¶ï¼Œä¸‹ä¸€æ¬¡ç›´æ¥é€šè¿‡ç¼“å­˜æ–‡ä»¶åˆ¤æ–­</span></span><br><span class="line">  <span class="attr">gitalkCacheFile</span>: path.<span class="title function_">join</span>(__dirname, <span class="string">&#x27;./gitalk-init-cache.json&#x27;</span>), <span class="comment">// ç”¨äºä¿å­˜ gitalk å·²ç»åˆå§‹åŒ–çš„ id åˆ—è¡¨</span></span><br><span class="line">  <span class="attr">gitalkErrorFile</span>: path.<span class="title function_">join</span>(__dirname, <span class="string">&#x27;./gitalk-init-error.json&#x27;</span>), <span class="comment">// ç”¨äºä¿å­˜ gitalk åˆå§‹åŒ–æŠ¥é”™çš„æ•°æ®</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> api = <span class="string">&#x27;https://api.github.com/repos/&#x27;</span> + config.<span class="property">username</span> + <span class="string">&#x27;/&#x27;</span> + config.<span class="property">repo</span> + <span class="string">&#x27;/issues&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è¯»å– sitemap æ–‡ä»¶</span></span><br><span class="line"><span class="comment">   * è¿œç¨‹ sitemap æ–‡ä»¶è·å–å¯å‚è€ƒ https://www.npmjs.com/package/sitemapper</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">sitemapXmlReader</span> = (<span class="params">file</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> data = fs.<span class="title function_">readFileSync</span>(file, <span class="string">&#x27;utf8&#x27;</span>);</span><br><span class="line">      <span class="keyword">const</span> sitemap = <span class="title function_">xmlParser</span>(data);</span><br><span class="line">      <span class="keyword">let</span> ret = [];</span><br><span class="line">      sitemap.<span class="property">root</span>.<span class="property">children</span>.<span class="title function_">forEach</span>(<span class="keyword">function</span> (<span class="params">url</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> loc = url.<span class="property">children</span>.<span class="title function_">find</span>(<span class="keyword">function</span> (<span class="params">item</span>) &#123;</span><br><span class="line">          <span class="keyword">return</span> item.<span class="property">name</span> === <span class="string">&#x27;loc&#x27;</span>;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">if</span> (!loc) &#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">const</span> title = url.<span class="property">children</span>.<span class="title function_">find</span>(<span class="keyword">function</span> (<span class="params">item</span>) &#123;</span><br><span class="line">          <span class="keyword">return</span> item.<span class="property">name</span> === <span class="string">&#x27;title&#x27;</span>;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">const</span> desc = url.<span class="property">children</span>.<span class="title function_">find</span>(<span class="keyword">function</span> (<span class="params">item</span>) &#123;</span><br><span class="line">          <span class="keyword">return</span> item.<span class="property">name</span> === <span class="string">&#x27;desc&#x27;</span>;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">const</span> date = url.<span class="property">children</span>.<span class="title function_">find</span>(<span class="keyword">function</span> (<span class="params">item</span>) &#123;</span><br><span class="line">          <span class="keyword">return</span> item.<span class="property">name</span> === <span class="string">&#x27;date&#x27;</span>;</span><br><span class="line">        &#125;);</span><br><span class="line">        ret.<span class="title function_">push</span>(&#123;</span><br><span class="line">          <span class="attr">url</span>: loc.<span class="property">content</span>,</span><br><span class="line">          <span class="attr">title</span>: title.<span class="property">content</span>,</span><br><span class="line">          <span class="attr">desc</span>: desc.<span class="property">content</span>,</span><br><span class="line">          <span class="attr">date</span>: date.<span class="property">content</span>,</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;);</span><br><span class="line">      <span class="keyword">return</span> ret;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">      <span class="keyword">return</span> [];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å– gitalk ä½¿ç”¨çš„ id</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">getGitalkId</span> = (<span class="params">&#123;</span></span><br><span class="line"><span class="params">                       url: u,</span></span><br><span class="line"><span class="params">                       date</span></span><br><span class="line"><span class="params">                     &#125;</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> link = url.<span class="title function_">parse</span>(u);</span><br><span class="line">  <span class="comment">// é“¾æ¥ä¸å­˜åœ¨ï¼Œä¸éœ€è¦åˆå§‹åŒ–</span></span><br><span class="line">  <span class="keyword">if</span> (!link || !link.<span class="property">pathname</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (!date) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">md5</span>(link.<span class="property">pathname</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * é€šè¿‡ä»¥è¯·æ±‚åˆ¤æ–­æ˜¯å¦å·²ç»åˆå§‹åŒ–</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> &#123;<span class="type">string</span>&#125; gitalk åˆå§‹åŒ–çš„id</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@return</span> &#123;<span class="type">[boolean, boolean]</span>&#125; ç¬¬ä¸€ä¸ªå€¼è¡¨ç¤ºæ˜¯å¦å‡ºé”™ï¼Œç¬¬äºŒä¸ªå€¼ false è¡¨ç¤ºæ²¡åˆå§‹åŒ–ï¼Œ true è¡¨ç¤ºå·²ç»åˆå§‹åŒ–</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">getIsInitByRequest</span> = (<span class="params">id</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> options = &#123;</span><br><span class="line">      <span class="attr">headers</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;Authorization&#x27;</span>: <span class="string">&#x27;token &#x27;</span> + config.<span class="property">token</span>,</span><br><span class="line">        <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/67.0.3396.99 Safari/537.36&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;Accept&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">url</span>: api + <span class="string">&#x27;?labels=&#x27;</span> + id + <span class="string">&#x27;,Gitalk&#x27;</span>,</span><br><span class="line">      <span class="attr">method</span>: <span class="string">&#x27;GET&#x27;</span></span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">request</span>(options, <span class="keyword">function</span> (<span class="params">err, response, body</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (err) &#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="title function_">resolve</span>([err, <span class="literal">false</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (response.<span class="property">statusCode</span> != <span class="number">200</span>) &#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="title function_">resolve</span>([response, <span class="literal">false</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">const</span> res = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(body);</span><br><span class="line">        <span class="keyword">if</span> (res.<span class="property">length</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="title function_">resolve</span>([<span class="literal">false</span>, <span class="literal">true</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">resolve</span>([<span class="literal">false</span>, <span class="literal">false</span>]);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * é€šè¿‡ç¼“å­˜åˆ¤æ–­æ˜¯å¦å·²ç»åˆå§‹åŒ–</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> &#123;<span class="type">string</span>&#125; gitalk åˆå§‹åŒ–çš„id</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@return</span> &#123;<span class="type">boolean</span>&#125; false è¡¨ç¤ºæ²¡åˆå§‹åŒ–ï¼Œ true è¡¨ç¤ºå·²ç»åˆå§‹åŒ–</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line"><span class="keyword">const</span> getIsInitByCache = (<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// åˆ¤æ–­ç¼“å­˜æ–‡ä»¶æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">    <span class="keyword">let</span> gitalkCache = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      gitalkCache = <span class="built_in">require</span>(config.<span class="property">gitalkCacheFile</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;&#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params">id</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (!gitalkCache) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (gitalkCache.<span class="title function_">find</span>(<span class="function">(<span class="params">&#123;</span></span></span><br><span class="line"><span class="params"><span class="function">                              id: itemId</span></span></span><br><span class="line"><span class="params"><span class="function">                            &#125;</span>) =&gt;</span> (itemId === id))) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;)();</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ ¹æ®ç¼“å­˜ï¼Œåˆ¤æ–­é“¾æ¥æ˜¯å¦å·²ç»åˆå§‹åŒ–</span></span><br><span class="line"><span class="comment">// ç¬¬ä¸€ä¸ªå€¼è¡¨ç¤ºæ˜¯å¦å‡ºé”™ï¼Œç¬¬äºŒä¸ªå€¼ false è¡¨ç¤ºæ²¡åˆå§‹åŒ–ï¼Œ true è¡¨ç¤ºå·²ç»åˆå§‹åŒ–</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">idIsInit</span> = <span class="keyword">async</span> (<span class="params">id</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (!config.<span class="property">cache</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">await</span> <span class="title function_">getIsInitByRequest</span>(id);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// å¦‚æœé€šè¿‡ç¼“å­˜æŸ¥è¯¢åˆ°çš„æ•°æ®æ˜¯æœªåˆå§‹åŒ–ï¼Œåˆ™å†é€šè¿‡è¯·æ±‚åˆ¤æ–­æ˜¯å¦å·²ç»åˆå§‹åŒ–ï¼Œé˜²æ­¢å¤šæ¬¡åˆå§‹åŒ–</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="title function_">getIsInitByCache</span>(id) === <span class="literal">false</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">await</span> <span class="title function_">getIsInitByRequest</span>(id);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> [<span class="literal">false</span>, <span class="literal">true</span>];</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆå§‹åŒ–</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">gitalkInit</span> = (<span class="params">&#123;</span></span><br><span class="line"><span class="params">                      url,</span></span><br><span class="line"><span class="params">                      id,</span></span><br><span class="line"><span class="params">                      title,</span></span><br><span class="line"><span class="params">                      desc</span></span><br><span class="line"><span class="params">                    &#125;</span>) =&gt; &#123;</span><br><span class="line">  <span class="comment">//åˆ›å»ºissue</span></span><br><span class="line">  <span class="keyword">const</span> reqBody = &#123;</span><br><span class="line">    <span class="string">&#x27;title&#x27;</span>: title,</span><br><span class="line">    <span class="string">&#x27;labels&#x27;</span>: [id, <span class="string">&#x27;Gitalk&#x27;</span>],</span><br><span class="line">    <span class="string">&#x27;body&#x27;</span>: url + <span class="string">&#x27;\r\n\r\n&#x27;</span> + desc</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> options = &#123;</span><br><span class="line">    <span class="attr">headers</span>: &#123;</span><br><span class="line">      <span class="string">&#x27;Authorization&#x27;</span>: <span class="string">&#x27;token &#x27;</span> + config.<span class="property">token</span>,</span><br><span class="line">      <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/67.0.3396.99 Safari/537.36&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;Accept&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/json;charset=UTF-8&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">url</span>: api,</span><br><span class="line">    <span class="attr">body</span>: <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(reqBody),</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&#x27;POST&#x27;</span></span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">request</span>(options, <span class="keyword">function</span> (<span class="params">err, response, body</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">resolve</span>([err, <span class="literal">false</span>]);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (response.<span class="property">statusCode</span> != <span class="number">201</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">resolve</span>([response, <span class="literal">false</span>]);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="title function_">resolve</span>([<span class="literal">false</span>, <span class="literal">true</span>]);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å†™å…¥å†…å®¹</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> &#123;<span class="type">string</span>&#125; fileName æ–‡ä»¶å</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> &#123;<span class="type">string</span>&#125; content å†…å®¹</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">write</span> = <span class="keyword">async</span> (<span class="params">fileName, content, flag = <span class="string">&#x27;w+&#x27;</span></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">      fs.<span class="title function_">open</span>(fileName, flag, <span class="keyword">function</span> (<span class="params">err, fd</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (err) &#123;</span><br><span class="line">          <span class="title function_">resolve</span>([err, <span class="literal">false</span>]);</span><br><span class="line">          <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        fs.<span class="title function_">writeFile</span>(fd, content, <span class="keyword">function</span> (<span class="params">err</span>) &#123;</span><br><span class="line">          <span class="keyword">if</span> (err) &#123;</span><br><span class="line">            <span class="title function_">resolve</span>([err, <span class="literal">false</span>]);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">          &#125;</span><br><span class="line">          fs.<span class="title function_">close</span>(fd, <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (err) &#123;</span><br><span class="line">              <span class="title function_">resolve</span>([err, <span class="literal">false</span>]);</span><br><span class="line">              <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;);</span><br><span class="line">          <span class="title function_">resolve</span>([<span class="literal">false</span>, <span class="literal">true</span>]);</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">init</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> urls = <span class="title function_">sitemapXmlReader</span>(config.<span class="property">sitemap</span>);</span><br><span class="line">  <span class="comment">// æŠ¥é”™çš„æ•°æ®</span></span><br><span class="line">  <span class="keyword">const</span> errorData = [];</span><br><span class="line">  <span class="comment">// å·²ç»åˆå§‹åŒ–çš„æ•°æ®</span></span><br><span class="line">  <span class="keyword">const</span> initializedData = [];</span><br><span class="line">  <span class="comment">// æˆåŠŸåˆå§‹åŒ–æ•°æ®</span></span><br><span class="line">  <span class="keyword">const</span> successData = [];</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> item <span class="keyword">of</span> urls) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123;</span><br><span class="line">      url,</span><br><span class="line">      date,</span><br><span class="line">      title,</span><br><span class="line">      desc</span><br><span class="line">    &#125; = item;</span><br><span class="line">    <span class="keyword">const</span> id = <span class="title function_">getGitalkId</span>(&#123;</span><br><span class="line">      url,</span><br><span class="line">      date</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">if</span> (!id) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`id: ç”Ÿæˆå¤±è´¥ [ <span class="subst">$&#123;id&#125;</span> ] `</span>);</span><br><span class="line">      errorData.<span class="title function_">push</span>(&#123;</span><br><span class="line">        ...item,</span><br><span class="line">        <span class="attr">info</span>: <span class="string">&#x27;id ç”Ÿæˆå¤±è´¥&#x27;</span>,</span><br><span class="line">      &#125;);</span><br><span class="line">      <span class="keyword">continue</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> [err, res] = <span class="keyword">await</span> <span class="title function_">idIsInit</span>(id);</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Error: æŸ¥è¯¢è¯„è®ºå¼‚å¸¸ [ <span class="subst">$&#123;title&#125;</span> ] , ä¿¡æ¯ï¼š`</span>, err || <span class="string">&#x27;æ— &#x27;</span>);</span><br><span class="line">      errorData.<span class="title function_">push</span>(&#123;</span><br><span class="line">        ...item,</span><br><span class="line">        <span class="attr">info</span>: <span class="string">&#x27;æŸ¥è¯¢è¯„è®ºå¼‚å¸¸&#x27;</span>,</span><br><span class="line">      &#125;);</span><br><span class="line">      <span class="keyword">continue</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (res === <span class="literal">true</span>) &#123;</span><br><span class="line">      <span class="comment">// console.log(`--- Gitalk å·²ç»åˆå§‹åŒ– --- [ $&#123;title&#125; ] `);</span></span><br><span class="line">      initializedData.<span class="title function_">push</span>(&#123;</span><br><span class="line">        id,</span><br><span class="line">        url,</span><br><span class="line">        title,</span><br><span class="line">      &#125;);</span><br><span class="line">      <span class="keyword">continue</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Gitalk åˆå§‹åŒ–å¼€å§‹... [ <span class="subst">$&#123;title&#125;</span> ] `</span>);</span><br><span class="line">    <span class="keyword">const</span> [e, r] = <span class="keyword">await</span> <span class="title function_">gitalkInit</span>(&#123;</span><br><span class="line">      id,</span><br><span class="line">      url,</span><br><span class="line">      title,</span><br><span class="line">      desc</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">if</span> (e || !r) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Error: Gitalk åˆå§‹åŒ–å¼‚å¸¸ [ <span class="subst">$&#123;title&#125;</span> ] , ä¿¡æ¯ï¼š`</span>, e || <span class="string">&#x27;æ— &#x27;</span>);</span><br><span class="line">      errorData.<span class="title function_">push</span>(&#123;</span><br><span class="line">        ...item,</span><br><span class="line">        <span class="attr">info</span>: <span class="string">&#x27;åˆå§‹åŒ–å¼‚å¸¸&#x27;</span>,</span><br><span class="line">      &#125;);</span><br><span class="line">      <span class="keyword">continue</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    successData.<span class="title function_">push</span>(&#123;</span><br><span class="line">      id,</span><br><span class="line">      url,</span><br><span class="line">      title,</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Gitalk åˆå§‹åŒ–æˆåŠŸ! [ <span class="subst">$&#123;title&#125;</span> ] - <span class="subst">$&#123;id&#125;</span>`</span>);</span><br><span class="line">    <span class="keyword">continue</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;&#x27;</span>); <span class="comment">// ç©ºè¾“å‡ºï¼Œç”¨äºæ¢è¡Œ</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;--------- è¿è¡Œç»“æœ ---------&#x27;</span>);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;&#x27;</span>); <span class="comment">// ç©ºè¾“å‡ºï¼Œç”¨äºæ¢è¡Œ</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (errorData.<span class="property">length</span> !== <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`æŠ¥é”™æ•°æ®ï¼š <span class="subst">$&#123;errorData.length&#125;</span> æ¡ã€‚å‚è€ƒæ–‡ä»¶ <span class="subst">$&#123;config.gitalkErrorFile&#125;</span>ã€‚`</span>);</span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">write</span>(config.<span class="property">gitalkErrorFile</span>, <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(errorData, <span class="literal">null</span>, <span class="number">2</span>));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`æœ¬æ¬¡æˆåŠŸï¼š <span class="subst">$&#123;successData.length&#125;</span> æ¡ã€‚`</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å†™å…¥ç¼“å­˜</span></span><br><span class="line">  <span class="keyword">if</span> (config.<span class="property">cache</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`å†™å…¥ç¼“å­˜ï¼š <span class="subst">$&#123;(initializedData.length + successData.length)&#125;</span> æ¡ï¼Œå·²åˆå§‹åŒ– <span class="subst">$&#123;initializedData.length&#125;</span> æ¡ï¼Œæœ¬æ¬¡æˆåŠŸï¼š <span class="subst">$&#123;successData.length&#125;</span> æ¡ã€‚å‚è€ƒæ–‡ä»¶ <span class="subst">$&#123;config.gitalkCacheFile&#125;</span>ã€‚`</span>);</span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">write</span>(config.<span class="property">gitalkCacheFile</span>, <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(initializedData.<span class="title function_">concat</span>(successData), <span class="literal">null</span>, <span class="number">2</span>));</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`å·²åˆå§‹åŒ–ï¼š <span class="subst">$&#123;initializedData.length&#125;</span> æ¡ã€‚`</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="title function_">init</span>();</span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li><p>ä¿®æ”¹ package.json ä¸­ scripts ä¸­çš„è„šæœ¬,æ·»åŠ  â€œgitalkâ€:â€node talk-auto-init.jsâ€.</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;clean&quot;</span><span class="punctuation">:</span> <span class="string">&quot;hexo clean&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;publish&quot;</span><span class="punctuation">:</span> <span class="string">&quot;git push &amp;&amp; yarn run clean &amp;&amp; hexo generate -d&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;server&quot;</span><span class="punctuation">:</span> <span class="string">&quot;hexo server&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;start&quot;</span><span class="punctuation">:</span> <span class="string">&quot;yarn run clean &amp;&amp; yarn run server -p 9777&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;gitalk&quot;</span><span class="punctuation">:</span> <span class="string">&quot;node talk-auto-init.js&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></li>
<li><p>æµ‹è¯• gitalk.</p>
<pre><code>yarn run gitalk
</code></pre>
</li>
<li><p>å·²ç»ç¼“å­˜è¿‡åçš„ç»“æœ:</p>
<pre><code>hexo-site@0.0.0 gitalk
node talk-auto-init.js
--------- è¿è¡Œç»“æœ ---------
æœ¬æ¬¡æˆåŠŸï¼š 0 æ¡ã€‚
å†™å…¥ç¼“å­˜ï¼š 7 æ¡ï¼Œå·²åˆå§‹åŒ– 7 æ¡ï¼Œæœ¬æ¬¡æˆåŠŸï¼š 0 æ¡ã€‚å‚è€ƒæ–‡ä»¶ /Users/wtw/frontEnd/w-t-w.github.io/gitalk-init-cache.json.
</code></pre>
</li>
</ul>
<blockquote>
<p>proxy 403é”™è¯¯</p>
</blockquote>
<p>éƒ¨ç½²è‡³ä¸ªäººç”³è¯·è´­ä¹°çš„äº‘æœåŠ¡å™¨æ—¶,ç”±äºè·¨åŸŸé—®é¢˜,ä¼šå‡ºç° proxy 403 forbidden.è§£å†³å®ƒä¸»è¦æœ‰è¿™ä¹ˆå‡ ä¸ªæ–¹æ¡ˆ.</p>
<ul>
<li><p>nginx åå‘ä»£ç†è§£å†³æ–¹æ¡ˆ(æ¨è).</p>
<p>åœ¨äº‘æœåŠ¡å™¨ nginx çš„åšå®¢é…ç½®ä¸­åŠ å…¥å¦‚ä¸‹å†…å®¹(æ³¨æ„ä¸ªäººåšå®¢çš„åŸŸåå¿…é¡»ç»è¿‡ https ssl å®‰å…¨è¯ä¹¦å¤‡æ¡ˆ).</p>
  <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen 443 ssl http2 default_server;</span><br><span class="line">    #...</span><br><span class="line">    #è¿™é‡Œçœç•¥çš„éƒ¨åˆ†éƒ½æ˜¯å¯¹äº ssl http2 è¯ä¹¦çš„é…ç½®</span><br><span class="line">    location = /login/oauth/access_token &#123;</span><br><span class="line">        add_header Access-Control-Allow-Origin &#x27;https://white-than-wood.zone/&#x27;;  //è¿™é‡Œæ”¹æˆä¸ªäººçš„åŸŸå,å¹¶åˆ é™¤æ³¨é‡Š</span><br><span class="line">        add_header Access-Control-Allow-Methods &#x27;GET, POST, OPTIONS&#x27;;</span><br><span class="line">        add_header Access-Control-Allow-Headers &#x27;DNT,X-Mx-ReqToken,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Authorization&#x27;;</span><br><span class="line">        if ($request_method = &#x27;OPTIONS&#x27;) &#123;</span><br><span class="line">              return 204;</span><br><span class="line">        &#125;</span><br><span class="line">        proxy_pass https://github.com/;</span><br><span class="line">    &#125;</span><br><span class="line">    #...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>PS: nginx åå‘ä»£ç†ä¹‹å,è¦å°† proxy æŒ‡å‘ä»£ç†åŸŸåä¸‹çš„é“¾æ¥å›è°ƒè¿›è¡Œä¿®æ”¹.</p>
<pre><code>proxy: https://white-than-wood.zone/https://github.com/login/oauth/access_token
</code></pre>
</li>
<li><p>è‡ªå»ºä¸€ä¸ª workers.</p>
<p>åœ°å€: <a href='https://workers.cloudflare.com/'>CloudFlare Workers</a>.<br>å‚è€ƒæ–‡ç« : <a href='https://blog.dsrkafuu.net/post/2020/cloudflare-worker-cors-anywhere/'>ä½¿ç”¨ CloudFlare Workers å®ç° CORS Anywhere</a>.</p>
</li>
<li><p>ä½¿ç”¨å…¶ä»–äººæ­å»ºçš„ä»£ç†.</p>
<p>æ¯”å¦‚è¿™ä¸ª <a href='https://github.com/gitalk/gitalk/issues/429#issuecomment-778291781'>issues</a> ä»‹ç»åˆ°çš„:</p>
<pre><code> proxy: https://shielded-brushlands-08810.herokuapp.com/https://github.com/login/oauth/access_token
</code></pre>
</li>
<li><p>ä½¿ç”¨ Gitalk å®˜æ–¹æ­å»ºçš„ä»£ç†.</p>
<p>æ®gitalk issue<a href='https://github.com/gitalk/gitalk/issues/433'> gitalk æˆæƒç™»å½•åæŠ¥é”™ 403</a>,ç›´æ¥å°†ä½¿ç”¨ Gitalk å®˜æ–¹æ­å»ºçš„ä»£ç†å°±å¯è§£å†³ 403 forbidden çš„é—®é¢˜,ä¹‹å‰ Gitalk å®˜æ–¹æ­å»ºçš„ä»£ç†ç”±äºå¤ªå¤šäººæ¥å…¥å¯¼è‡´è¢«å®˜æ–¹é™åˆ¶ä½¿ç”¨,ç”¨æˆ·ç»å¸¸å‘ç°ä¸èƒ½æ­£å¸¸ä½¿ç”¨,ç°åœ¨å·²ç»å¯¹ä»£ç†è¿›è¡Œä¼˜åŒ–æ”¹è¿›,ä¸ä¼šå‡ºç°é™åˆ¶ä½¿ç”¨çš„æƒ…å†µ.</p>
<p><img src="https://image.white-than-wood.zone/hexo/gitalk_403.png"></p>
<pre><code> https://cors-anywhere.azm.workers.dev/https://github.com/login/oauth/access_token
</code></pre>
</li>
<li><p>æ›´æ–° gitalk ç‰ˆæœ¬è‡³1.7.2.</p>
<p>æ®gitalk issue<a href='https://github.com/gitalk/gitalk/issues/433'> gitalk æˆæƒç™»å½•åæŠ¥é”™ 403</a>,ç›´æ¥å°† gitalk ç‰ˆæœ¬å‡çº§è‡³ 1.7.2 å°±å¯è§£å†³ 403 forbidden çš„é—®é¢˜.</p>
<p><img src="https://image.white-than-wood.zone/hexo/gitalk_403.png"></p>
</li>
</ul>
<h4 id="hexo-GitHub-Page-ä¸ªäººç½‘ç«™è‡ªå®šä¹‰åŸŸå"><a href="#hexo-GitHub-Page-ä¸ªäººç½‘ç«™è‡ªå®šä¹‰åŸŸå" class="headerlink" title="hexo GitHub Page ä¸ªäººç½‘ç«™è‡ªå®šä¹‰åŸŸå"></a>hexo GitHub Page ä¸ªäººç½‘ç«™è‡ªå®šä¹‰åŸŸå</h4><p>éƒ¨ç½²è‡³ GitHub Page ä¸ªäººç½‘ç«™é…ç½®è‡ªå®šä¹‰åŸŸåæ—¶,éœ€è¦å°†ä¸ªäººç”³è¯·è´­ä¹°çš„åŸŸå(æœ€å¥½æ˜¯é€šè¿‡ https ssl å®‰å…¨è¯ä¹¦å¤‡æ¡ˆ)è¿›è¡ŒåŸŸåè§£æ,GitHub Page ä¹Ÿéœ€è¦ CNAME é…ç½®.</p>
<p>ä¸€. é˜¿é‡Œäº‘åŸŸåè§£æ.</p>
<blockquote>
<p>æ­¥éª¤</p>
</blockquote>
<p>åŸŸåè§£æç®€å•æ¥è¯´å®é™…ä¸Šå°±æ˜¯é€šè¿‡é…ç½®,å°†åŸŸåè§£æè‡³æŸä¸€ä¸ª IP åœ°å€æˆ–è€…åŸŸå.é¦–å…ˆè¿›å…¥é˜¿é‡Œäº‘æœåŠ¡ç®¡ç†å¹³å°,å¯¹å·²ç»ç”³è¯·è´­ä¹°çš„åŸŸåè¿›è¡Œè§£æ.</p>
<p><img src="https://image.white-than-wood.zone/hexo/website_host_analy.png"></p>
<p>æ·»åŠ è®°å½•æˆ–è€…å¯¹æŸä¸€ä¸ªåˆ—è¡¨é¡¹è¿›è¡Œä¿®æ”¹.å¯ä»¥ä½¿ç”¨ Aè®°å½• ä¹Ÿå¯ä»¥ä½¿ç”¨ CNAME.</p>
<pre><code>Aè®°å½• æ˜¯å°†åŸŸåæŒ‡å‘ä¸€ä¸ª IPV4 åœ°å€.
CNAME æ˜¯å°†åŸŸåæŒ‡å‘å¦å¤–ä¸€ä¸ªåŸŸå.
</code></pre>
<p><img src="https://image.white-than-wood.zone/hexo/website_host_analy_details.png"></p>
<p>è¿™é‡Œä½¿ç”¨çš„æ˜¯ Aè®°å½•,å°† w-t-w.github.io çš„ IP åœ°å€ä½œä¸ºè®°å½•å€¼.</p>
<pre><code>ping w-t-w.github.io
</code></pre>
<p><img src="https://image.white-than-wood.zone/hexo/website_host_analy_pings.png"></p>
<p>ä¸»æœºè®°å½•,è§£æåçš„åŸŸååŸºæœ¬ä¸Šå°±ä¸¤ç§,â€˜@â€™å’Œâ€™wwwâ€™.</p>
<pre><code>&#39;@&#39; æ˜¯æºåŸŸå(ä¸»åŸŸå white-than-wood.zone).
&#39;www&#39; åˆ™æ˜¯ www.white-than-wood.zone.
</code></pre>
<p>äºŒ. GitHub Pageä¸ªäººç½‘ç«™CNAMEé…ç½®.</p>
<p>åœ¨ source ç›®å½•ä¸‹æ–°å»º CNAME æ–‡ä»¶(ä¸å¸¦ä»»ä½•åç¼€),åœ¨æ–‡ä»¶å†…å†™å…¥ä½ çš„ä¸»åŸŸå.</p>
  <figure class="highlight text"><table><tr><td class="code"><pre><span class="line">white-than-wood.zone</span><br></pre></td></tr></table></figure>

<p>æˆ–è€…åœ¨ Github Page ä¸ªäººé…ç½®ä¸‹è®¾ç½®è‡ªå®šä¹‰åŸŸå,Github ä¼šè‡ªåŠ¨æ·»åŠ  CNAME æ–‡ä»¶.</p>
<p><img src="https://image.white-than-wood.zone/hexo/website_host_github_cnames.png"></p>
<p>è¿™ä¸¤ç§æ–¹å¼è¿™é‡Œæ˜¯å…¨éƒ¨ä½¿ç”¨çš„.å…¨éƒ¨æå®šä¹‹å,å°±å¯ä»¥é€šè¿‡ white-than-wood.zone è®¿é—® w-t-w.github.io GitHub Page ä¸ªäººç½‘ç«™.</p>
<blockquote>
<p>å»¶ä¼¸</p>
</blockquote>
<p>æ—¢ç„¶å·²ç»é€šè¿‡é˜¿é‡Œäº‘æœåŠ¡ Aè®°å½• æˆ–è€… CNAME è§£æåŸŸå,ä¸ºä»€ä¹ˆè¿˜éœ€è¦åœ¨ GitHub Page ä¸ªäººç½‘ç«™ä¸Šé…ç½® CNAME ?</p>
<p>è§£: äº‘æœåŠ¡ Aè®°å½• æˆ–è€… CNAME åŸŸåè§£æè‡³ GitHub Page,é€šè¿‡ white-than-wood.zone å¯ä»¥è®¿é—® GitHub Page ä¸ªäººç½‘ç«™,é‚£åŸæ¥çš„ w-t-w.github.io åŸŸåæ€ä¹ˆåŠå‘¢? GitHub Page ä¹Ÿé€šè¿‡ CNAME åŸŸåè§£æè‡³ white-than-wood.zone. ä½¿å¾— github.io åŸŸåä¹Ÿå¯ä»¥ç›´æ¥è®¿é—®ä¸ªäººç”³è¯·è´­ä¹°çš„åŸŸå.</p>
<h4 id="hexo-å…¶ä»–é…ç½®"><a href="#hexo-å…¶ä»–é…ç½®" class="headerlink" title="hexo å…¶ä»–é…ç½®"></a>hexo å…¶ä»–é…ç½®</h4><blockquote>
<p>ç¤ºä¾‹</p>
</blockquote>
<p>åœ¨æ ¹ç›®å½•åº•ä¸‹çš„ _config.yml æ–‡ä»¶ä¸­æ›´æ”¹ç½‘ç«™title(æ ‡é¢˜)ã€author(ä½œè€…)ã€keywords(å…³é”®å­—)ã€description(æè¿°)é…ç½®,æ¯”å¦‚æœ¬äººçš„é…ç½®.</p>
<pre><code>title: wtw&#39;s Frontend
author: wtw(æ¯”æœ¨ç™½)
keywords: hexo,hexo blog,webpack
subtitle: é“é˜»ä¸”é•¿,è¡Œåˆ™å°†è‡³
description: å‰ç«¯é¢†åŸŸå†…æ‰€ä¸çŸ¥é“çš„éƒ½æ¢ç´¢äºæ­¤!
</code></pre>
<p>å†ä¸»é¢˜ç›®å½•åº•ä¸‹çš„ _config.yml æ–‡ä»¶é‡è®¾ç½®ä¸ªäººçš„github(githubæ‰˜ç®¡ä»£ç ç½‘å€)ã€google(googleä¸ªäººèµ„æ–™ç½‘å€)ã€gmail(gmailé‚®ç®±ç½‘å€)<br>ã€twitter(twitterä¸ªäººå¾®åšç½‘å€)ç­‰ç­‰,æ¯”å¦‚æœ¬äººçš„é…ç½®.</p>
<pre><code>social:
  GitHub: https://github.com/w-t-w || fab fa-github
  E-Mail: https://dreamthen.00@gmail.com || fab fa-envelope
  Google: https://plus.google.com/u/0/103833130011211353424 || fab fa-google
</code></pre>
<p>å‘å¸ƒåˆ° GitHub Page ä¸Šä¹‹å,ä½ ä¼šå‘ç° README.md è«åçš„æ¶ˆå¤±,ä¸»è¦æ˜¯å› ä¸º hexo æ„å»ºå‘å¸ƒåˆ°è¿œç¨‹çš„ç›®å½•åªæ˜¯ source ç›®å½•,æ‰€ä»¥åªè¦å°†<br>README.md copy ä¸€ä»½æ”¾åˆ° source ç›®å½•ä¸‹,å¹¶ä¸”é…ç½®æ¸²æŸ“æ—¶éœ€è¦è·³è¿‡çš„æ–‡ä»¶å°±å¯ä»¥äº†.</p>
<pre><code>#hexo æ„å»ºæ¸²æŸ“æ—¶ä¼šå°† source ç›®å½•ä¸‹ markdown ç±»å‹æ–‡ä»¶è½¬è¯‘ä¸º html,ä¸éœ€è¦å°† README.md è½¬è¯‘,æ‰€ä»¥ç›´æ¥ skip render
#æ›´æ”¹æ ¹ç›®å½•åº•ä¸‹çš„ _config.yml æ–‡ä»¶,ä¿®æ”¹ skip_render å±æ€§
skip_render: README.md
</code></pre>
<p>å½“åˆ›ä½œä¸­å›¾ç‰‡è¿‡å°,é˜…è¯»è€…æ— æ³•çœ‹æ¸…çš„æƒ…å†µä¸‹,æ”¾å¤§é…ç½®å°±å·²ç„¶æˆä¸ºå¿…è¦ .fancybox<br>é…ç½®å¯ä»¥ç‚¹å‡»ä½¿å›¾ç‰‡æ”¾å¤§,å¹¶å¯åŒæ—¶æŸ¥çœ‹å…¨æ–‡çš„å›¾ç‰‡.æ›´æ”¹ä¸»é¢˜ç›®å½•ä¸‹çš„ _config.yml æ–‡ä»¶ fancybox å±æ€§.</p>
<pre><code># FancyBox is a tool that offers a nice and elegant way to add zooming functionality for images.
# For more information: https://fancyapps.com/fancybox/
fancybox: true
</code></pre>
]]></content>
      <categories>
        <category>hexo</category>
      </categories>
      <tags>
        <tag>hexo</tag>
        <tag>hexo blog</tag>
      </tags>
  </entry>
  <entry>
    <title>create Simplepack</title>
    <url>/2022/10/14/create-simplepack/</url>
    <content><![CDATA[<h1 id="create-Simplepack"><a href="#create-Simplepack" class="headerlink" title="create Simplepack"></a>create Simplepack</h1><p>æ­å»ºä¸€ä¸ªç®€æ˜“çš„ webpack â€”â€” Simplepack.</p>
<blockquote>
<p>é…ç½®æ–‡ä»¶</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// simplepack.config.js</span></span><br><span class="line"><span class="keyword">const</span> &#123;resolve&#125; = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">OUTPUT_DIR</span> = <span class="title function_">resolve</span>(process.<span class="title function_">cwd</span>(), <span class="string">&#x27;./build&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> simplepackConfig = &#123;</span><br><span class="line">    <span class="comment">// å…¥å£</span></span><br><span class="line">    <span class="attr">entry</span>: <span class="string">&#x27;./src/index.js&#x27;</span>,</span><br><span class="line">    <span class="comment">// ä½œä¸º simplepack æ„å»ºæ‰“åŒ…çš„å‡ºå£</span></span><br><span class="line">    <span class="attr">output</span>: &#123;</span><br><span class="line">        <span class="comment">// ä½œä¸º simplepack æ„å»ºæ‰“åŒ…æ–‡ä»¶å¯¼å‡ºçš„ä½ç½®ç›®å½•</span></span><br><span class="line">        <span class="attr">path</span>: <span class="variable constant_">OUTPUT_DIR</span>,</span><br><span class="line">        <span class="comment">// ä½œä¸º simplepack æ„å»ºæ‰“åŒ…å¯¼å‡ºæ–‡ä»¶çš„åç§°</span></span><br><span class="line">        <span class="attr">filename</span>: <span class="string">&#x27;main.js&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = simplepackConfig;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ç›®å½•</p>
</blockquote>
<p><img src="https://image.white-than-wood.zone/webpack/simplepack_path.png"></p>
<blockquote>
<p>Simplepack</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123;resolve&#125; = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> &#123;writeFileSync&#125; = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>); </span><br><span class="line">    </span><br><span class="line"><span class="keyword">const</span> utils = <span class="built_in">require</span>(<span class="string">&#x27;../utils&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Simplepack</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">options</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">options</span> = options;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">resources</span> = [];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¿è¡Œ</span></span><br><span class="line">    <span class="title function_">run</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="comment">// é€’å½’è·å–èµ„æºåˆ—è¡¨</span></span><br><span class="line">        (<span class="keyword">function</span> <span class="title function_">getFileInfo</span>(<span class="params">entry, upperLevel = <span class="string">&#x27;&#x27;</span></span>) &#123;</span><br><span class="line">            <span class="keyword">let</span> path = entry;</span><br><span class="line">            <span class="keyword">const</span> cwd = process.<span class="title function_">cwd</span>();</span><br><span class="line">            <span class="comment">// åˆ¤æ–­æ˜¯å¦æ˜¯ç»å¯¹è·¯å¾„</span></span><br><span class="line">            <span class="keyword">if</span> (!path.<span class="title function_">includes</span>(cwd)) &#123;</span><br><span class="line">                <span class="comment">// æ‹¼æ¥çˆ¶å­ä¾èµ–ç›®å½•</span></span><br><span class="line">                path = <span class="title function_">resolve</span>(cwd, upperLevel, <span class="string">`<span class="subst">$&#123;path.endsWith(<span class="string">&#x27;.js&#x27;</span>) ? path : <span class="string">`<span class="subst">$&#123;path&#125;</span>/index.js`</span>&#125;</span>`</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (!<span class="title function_">existsSync</span>(path)) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">`è¯·æ£€æŸ¥ç›®å½•,ä¸å­˜åœ¨ <span class="subst">$&#123;entry&#125;</span> æ¨¡å—`</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">const</span> fileInfo = <span class="variable language_">this</span>.<span class="title function_">compile</span>(path);</span><br><span class="line">            <span class="keyword">const</span> &#123; <span class="attr">dependencies</span>: fileDependencies &#125; = fileInfo;</span><br><span class="line">            <span class="keyword">if</span> (fileDependencies.<span class="property">length</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                fileDependencies.<span class="title function_">forEach</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">                    getFileInfo.<span class="title function_">call</span>(<span class="variable language_">this</span>, item, entry.<span class="title function_">substring</span>(<span class="number">0</span>, entry.<span class="title function_">lastIndexOf</span>(<span class="string">&#x27;/&#x27;</span>) + <span class="number">1</span>));</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">            fileInfo.<span class="property">filename</span> = entry;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">resources</span>.<span class="title function_">push</span>(fileInfo);</span><br><span class="line">        &#125;.<span class="title function_">bind</span>(<span class="variable language_">this</span>))(<span class="variable language_">this</span>.<span class="property">entry</span>);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">emit</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è§£æ</span></span><br><span class="line">    <span class="title function_">compile</span>(<span class="params">path</span>) &#123;</span><br><span class="line">        <span class="comment">// å¯¹ç›¸å¯¹è·¯å¾„è¿›è¡Œæ ¡éªŒ,å°†ç›¸å¯¹è·¯å¾„è½¬åŒ–ä¸ºç»å¯¹è·¯å¾„</span></span><br><span class="line">        <span class="keyword">const</span> isRelative = <span class="regexp">/\.\/|\.\\/</span>;</span><br><span class="line">        <span class="keyword">if</span> (isRelative.<span class="title function_">test</span>(path)) &#123;</span><br><span class="line">            path = <span class="title function_">resolve</span>(process.<span class="title function_">cwd</span>(), path);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// è·å–å…¥å£æˆ–è€…ä¾èµ–æ¨¡å—çš„ AST æŠ½è±¡è¯­æ³•æ ‘</span></span><br><span class="line">        <span class="keyword">const</span> ast = utils.<span class="title function_">getAST</span>(path);</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="comment">// è·å–ç›¸å…³ä¾èµ–åˆ—è¡¨</span></span><br><span class="line">            <span class="attr">dependencies</span>: utils.<span class="title function_">getDependencies</span>(ast),</span><br><span class="line">            <span class="comment">// è·å–ç›¸å…³ä»£ç </span></span><br><span class="line">            <span class="attr">source</span>: utils.<span class="title function_">getTransformFromAST</span>(ast)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç”Ÿæˆæ–‡ä»¶</span></span><br><span class="line">    <span class="title function_">emitFile</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123;entry = <span class="string">&#x27;&#x27;</span>, <span class="attr">output</span>: &#123;filename = <span class="string">&#x27;&#x27;</span>, path = <span class="string">&#x27;&#x27;</span>&#125;&#125; = <span class="variable language_">this</span>.<span class="property">options</span>;</span><br><span class="line">        <span class="keyword">const</span> outputPath = <span class="title function_">resolve</span>(path, filename);</span><br><span class="line">        <span class="comment">// æ¨¡æ‹Ÿ webpack IIFE è‡ªæ‰§è¡Œå‡½æ•°è¡¨è¾¾å¼é—­åŒ…,å°†æ¯ä¸€ä¸ªæ¨¡å—å¤–åŠ ä¸€å±‚åŒ…è£¹,å¹¶å°† import è½¬åŒ–ä¸º __WEBPACK_REQUIRE__</span></span><br><span class="line">        <span class="keyword">const</span> <span class="variable language_">module</span> = <span class="variable language_">this</span>.<span class="property">resources</span>.<span class="title function_">map</span>(<span class="function"><span class="params">item</span> =&gt;</span> <span class="string">`&#x27;<span class="subst">$&#123;item.filename&#125;</span>&#x27;: function(require, modules, exports) &#123;<span class="subst">$&#123;item.source&#125;</span>`</span>).<span class="title function_">join</span>(<span class="string">&#x27;,&#x27;</span>);</span><br><span class="line">        <span class="keyword">const</span> bundle = <span class="string">`(function (module) &#123;</span></span><br><span class="line"><span class="string">            function require(filename) &#123;</span></span><br><span class="line"><span class="string">                var fn = module[filename];</span></span><br><span class="line"><span class="string">                var modules = &#123;exports: &#123;&#125;&#125;;</span></span><br><span class="line"><span class="string">                fn(require, modules, modules.exports);</span></span><br><span class="line"><span class="string">                return modules.exports;</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">            require(&#x27;<span class="subst">$&#123;entry&#125;</span>&#x27;);</span></span><br><span class="line"><span class="string">        &#125;)(&#123;<span class="subst">$&#123;<span class="variable language_">module</span>&#125;</span>&#125;)`</span>;</span><br><span class="line">        <span class="title function_">writeFileSync</span>(outputPath, bundle);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Simplepack Parse è§£æå·¥å…·</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123;readFileSync&#125; = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> &#123;parse&#125; = <span class="built_in">require</span>(<span class="string">&#x27;babylon&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> &#123;traverse, transformFromAST&#125; = <span class="built_in">require</span>(<span class="string">&#x27;@babel/core&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> utils = &#123;</span><br><span class="line">    <span class="comment">// é€šè¿‡ babylon è§£æå…¥å£æˆ–è€…ä¾èµ–æ¨¡å—çš„æŠ½è±¡è¯­æ³•æ ‘</span></span><br><span class="line">    <span class="title function_">getAST</span>(<span class="params">path</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> content = <span class="title function_">readFileSync</span>(path, <span class="string">&#x27;utf-8&#x27;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">parse</span>(content, &#123;</span><br><span class="line">            <span class="attr">sourceType</span>: <span class="string">&#x27;module&#x27;</span></span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// é€šè¿‡ traverse éå†è·å– import å¯¼å…¥çš„ä¾èµ–æ¨¡å—</span></span><br><span class="line">    <span class="title function_">getDependencies</span>(<span class="params">ast</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> dependencies = [];</span><br><span class="line">        <span class="title function_">traverse</span>(ast, &#123;</span><br><span class="line">            <span class="title class_">ImportDeclaration</span>(&#123;node&#125;) &#123;</span><br><span class="line">                dependencies.<span class="title function_">push</span>(node.<span class="property">source</span>.<span class="property">value</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">return</span> dependencies;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// é€šè¿‡ transformFromAST è·å–è¢« babel å¤„ç†åçš„ä»£ç </span></span><br><span class="line">    <span class="title function_">getTransformFromAST</span>(<span class="params">ast</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123;code&#125; = <span class="title function_">transformFromAST</span>(ast, <span class="literal">null</span>, &#123;</span><br><span class="line">            <span class="attr">presets</span>: [<span class="string">&#x27;@babel/preset-env&#x27;</span>]</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">return</span> code;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = utils;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Result</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">(<span class="keyword">function</span>(<span class="params"><span class="variable language_">module</span></span>) &#123;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">require</span>(<span class="params">filename</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> fn = <span class="variable language_">module</span>[filename];</span><br><span class="line">        <span class="keyword">var</span> modules = &#123;<span class="attr">exports</span>: &#123;&#125;&#125;;</span><br><span class="line">        <span class="title function_">fn</span>(<span class="built_in">require</span>, modules, <span class="built_in">exports</span>);</span><br><span class="line">        <span class="keyword">return</span> modules.<span class="property">exports</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">require</span>(<span class="string">&#x27;./src/index.js&#x27;</span>);</span><br><span class="line">&#125;)(&#123;</span><br><span class="line">    <span class="string">&#x27;./src/index.js&#x27;</span>: <span class="keyword">function</span> (<span class="params"><span class="built_in">require</span>, modules, <span class="built_in">exports</span></span>) &#123;<span class="string">&quot;use strict&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> _modules = <span class="built_in">require</span>(<span class="string">&quot;./modules&quot;</span>);</span><br><span class="line">        <span class="keyword">var</span> wtw = (<span class="number">0</span>, _modules.<span class="property">getName</span>)(<span class="string">&#x27;wtw&#x27;</span>);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;wtw&#x27;</span>);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(wtw);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&#x27;./modules&#x27;</span>: <span class="keyword">function</span> (<span class="params"><span class="built_in">require</span>, modules, <span class="built_in">exports</span></span>) &#123;<span class="string">&quot;use strict&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(<span class="built_in">exports</span>, <span class="string">&quot;__esModule&quot;</span>, &#123;</span><br><span class="line">            <span class="attr">value</span>: <span class="literal">true</span></span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="built_in">exports</span>.<span class="property">getName</span> = getName;</span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">getName</span>(<span class="params">name</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;My name is &quot;</span>.<span class="title function_">concat</span>(name);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>webpack</category>
      </categories>
      <tags>
        <tag>webpack</tag>
      </tags>
  </entry>
  <entry>
    <title>unresolved problems</title>
    <url>/2022/09/20/unresolved-problems/</url>
    <content><![CDATA[<h1 id="webpack"><a href="#webpack" class="headerlink" title="webpack"></a>webpack</h1><h4 id="speed-measure-webpack-plugin"><a href="#speed-measure-webpack-plugin" class="headerlink" title="speed-measure-webpack-plugin"></a>speed-measure-webpack-plugin</h4><p>  ä¸ºä½• speed-measure-webpack-plugin é€Ÿåº¦åˆ†ææ’ä»¶å¯¹äº webpack 5.x çš„æ”¯æŒå¾ˆæœ‰é™åˆ¶,å¦‚ä½•å®Œç¾çš„è§£å†³è¿™äº›é™åˆ¶?</p>
<p>ç°é˜¶æ®µå¹¶æ²¡æœ‰å‘ç°è§£å†³çš„æœ€å®Œç¾çš„æ–¹å¼, speed-measure-webpack-plugin é€Ÿåº¦åˆ†ææ’ä»¶å¯¹äº webpack 5.x ä¼šå‡ºç°ä»¥ä¸‹ä¸¤ä¸ªé—®é¢˜:</p>
<p><img src="https://image.white-than-wood.zone/webpack/speed-measure-webpack-plugin-problem.png"></p>
<p>ä½¿ç”¨ .wrap åŒ…è£¹å,ä¼šç›´æ¥æŠ¥ TypeError ç±»å‹é”™è¯¯,ç»è¿‡æŸ¥è¯¢å¯çŸ¥,å®˜æ–¹ç»™å‡ºçš„è§£å†³æ–¹æ¡ˆæ˜¯,å°† optimization.minimizer çš„é»˜è®¤å€¼å»æ‰,ä¹Ÿå°±æ˜¯ â€˜â€¦â€™.<br>é‚£å°±æœ‰ç–‘é—®äº†,å¦‚æœä¸åˆå¹¶ minimizer é»˜è®¤å€¼,å¯¹äºprod ç”Ÿäº§ç¯å¢ƒçš„æ‰“åŒ…é€Ÿåº¦åˆ†ææ—¶,æˆ‘è¿˜éœ€è¦é¢å¤–ä¸‹è½½ terser-webpack-webpack å¯¹æ„å»ºæ‰“åŒ…æ–‡ä»¶å®è¡Œå‹ç¼©æ··æ·†,è¿˜éœ€è¦é¢å¤–å¼•å…¥ new webpack.optimize.ModuleConcatenationPlugin æ¥å¼€å¯ Scope Hoisting å—?è¿˜æ˜¯è¯´è¦æ”¾å¼ƒ css-minimizer-webpack-plugin å‹ç¼© css æ–‡ä»¶,ä½¿ç”¨å…¶ä»–çš„æ¯”è¾ƒéº»çƒ¦çš„æ–¹æ¡ˆå‘¢?è¿™äº›æ–¹å¼å‹‰å¼ºå¯ä»¥å¤„ç†,ä½†æ˜¯éƒ½å¤ªå¾—ä¸å¿å¤±.<br>å‚è€ƒé“¾æ¥: <a href='https://github.com/stephencookdev/speed-measure-webpack-plugin/issues/171'>Not working with Webpack 5: â€œTypeError: Cannot create proxy with a non-object as target or handlerâ€</a>.</p>
<p><img src="https://image.white-than-wood.zone/webpack/speed-measure-webpack-plugin-problem-ano.png"></p>
<p>å³ä½¿æŒ‰ç…§å®˜æ–¹çš„è§£å†³æ–¹æ¡ˆ,å»æ‰ optimization.minimizer çš„é»˜è®¤å€¼ â€˜â€¦â€™,ä¹Ÿä¼šæŠ¥ â€œYou forgot to add â€˜mini-css-extract-pluginâ€™ pluginâ€ è¿™ä¸ªé—®é¢˜,é’ˆå¯¹äºæ­¤å®˜æ–¹çš„è§£å†³æ–¹æ¡ˆæ˜¯,å…ˆè¯•ç”¨ speed-measure-webpack-plugin é€Ÿåº¦åˆ†æ,è€Œåå†å°† mini-css-extract-plugin æŠ½å– css æ–‡ä»¶æ’ä»¶æ·»åŠ åˆ° webpack plugins ä¸­.æ„Ÿè§‰è¿˜æ˜¯å¥½æ„šè ¢çš„åšæ³•,å¾ˆä¸ä¼˜é›…è€Œä¸”å¤šä½™.<br>å‚è€ƒé“¾æ¥: <a href='https://github.com/stephencookdev/speed-measure-webpack-plugin/issues/167#issuecomment-976836861'>â€œYou forgot to add â€˜mini-css-extract-pluginâ€™ pluginâ€</a>.</p>
]]></content>
      <categories>
        <category>unresolved</category>
      </categories>
      <tags>
        <tag>unresolved</tag>
      </tags>
  </entry>
  <entry>
    <title>think of webpack</title>
    <url>/2022/08/30/think-of-webpack/</url>
    <content><![CDATA[<h1 id="webpack"><a href="#webpack" class="headerlink" title="webpack"></a>webpack</h1><h4 id="webpack-cli"><a href="#webpack-cli" class="headerlink" title="webpack-cli"></a>webpack-cli</h4><blockquote>
<p>ä½œç”¨</p>
</blockquote>
<ul>
<li>å¼•å…¥ yargs,å¯¹å‘½ä»¤è¡Œå®è¡Œå®šåˆ¶</li>
<li>åˆ†æå‘½ä»¤è¡Œå‚æ•°,å¯¹å„ä¸ªå‚æ•°å®è¡Œè½¬æ¢,ç»„æˆç¼–è¯‘é…ç½®é¡¹</li>
<li>å¯¼å…¥ webpack,æ ¹æ®ç¼–è¯‘é…ç½®é¡¹è¿›è¡Œç¼–è¯‘å’Œæ„å»º</li>
</ul>
<h4 id="entry"><a href="#entry" class="headerlink" title="entry"></a>entry</h4><blockquote>
<p>ä½œç”¨</p>
</blockquote>
<p>  ä½œä¸º webpack æ„å»ºæ‰“åŒ…çš„å…¥å£,æœç´¢å…¨å±€èµ„æºçš„èµ·ç‚¹.</p>
<blockquote>
<p>å±æ€§å€¼</p>
</blockquote>
<p>  ä¸ºä½•è®¾ç½® entry çš„å±æ€§å€¼å¿…é¡»ä¸ºç›¸å¯¹è·¯å¾„,è€Œç»å¯¹è·¯å¾„å´ä¼šæŠ¥é”™?</p>
<p>  è§£: entry æ˜¯ webpack æ„å»ºæ‰“åŒ…çš„å…¥å£,æ˜¯æœç´¢å…¨å±€èµ„æºçš„èµ·ç‚¹,å®ƒçš„å±æ€§å€¼æ˜¯è®¾ç½®ä¸ºç›¸å¯¹äºæ•´ä¸ªé¡¹ç›®è€Œè¨€çš„,ä¹Ÿå°±æ˜¯å½“å‰é¡¹ç›®æ ¹ç›®å½•,åœ¨ webpack context å±æ€§ä¸å˜çš„æƒ…å†µä¸‹, entry å±æ€§å€¼æ°¸è¿œç›¸å¯¹äºå½“å‰é¡¹ç›®æ ¹ç›®å½•,å½“ç„¶å¦‚è‹¥ context å±æ€§å€¼å‘ç”Ÿæ”¹å˜,entry æ˜¯å¯ä»¥è®¾ç½®ç»å¯¹è·¯å¾„çš„,å› ä¸º webpack æ„å»ºæ‰“åŒ…æ‰€ä½œç”¨çš„é¡¹ç›®æ ¹ç›®å½•å‘ç”Ÿäº†æ”¹å˜,å½“ç„¶ä¹Ÿå¯ä»¥å¼ºåˆ¶è®¾ç½® entry å±æ€§å€¼ä¸ºç»å¯¹è·¯å¾„,ä½†æ˜¯å…¶åªæ˜¯ç›¸å¯¹äºå½“å‰è®¾å¤‡ç›®å½•è€Œè¨€,æ˜¯å­˜åœ¨å¾ˆå¤§çš„é…ç½®é£é™©çš„.</p>
<h4 id="output"><a href="#output" class="headerlink" title="output"></a>output</h4><blockquote>
<p>filename</p>
</blockquote>
<p>  output.filename çš„ä½œç”¨æ˜¯ä»€ä¹ˆ?</p>
<p>  è§£: ä½œä¸º webpack æ„å»ºæ‰“åŒ…å¯¼å‡ºæ–‡ä»¶çš„åç§°.  </p>
<blockquote>
<p>path</p>
</blockquote>
<p>  output.path çš„ä½œç”¨æ˜¯ä»€ä¹ˆ?</p>
<p>  è§£: ä½œä¸º webpack æ„å»ºæ‰“åŒ…æ–‡ä»¶å¯¼å‡ºçš„ä½ç½®ç›®å½•.</p>
<blockquote>
<p>publicPath</p>
</blockquote>
<p>  output.publicPath çš„ä½œç”¨æ˜¯ä»€ä¹ˆ?</p>
<p>  è§£: ä½œä¸º webpack æ„å»ºæ‰“åŒ…æ–‡ä»¶å¯¼å‡ºçš„ä½ç½®ç›®å½•å‰ç¼€.</p>
<blockquote>
<p>chunkFilename</p>
</blockquote>
<p>  output.chunkFilename çš„ä½œç”¨æ˜¯ä»€ä¹ˆ?</p>
<p>  è§£: ä½œä¸º webpack æ„å»ºæ‰“åŒ…å¯¼å‡ºæ¨¡å—çš„åç§°.</p>
<blockquote>
<p>crossOriginLoading</p>
</blockquote>
<p>  output.crossOriginLoading çš„ä½œç”¨æ˜¯ä»€ä¹ˆ?</p>
<p>  è§£: å…¶åªåœ¨ target: â€˜webâ€™ æ—¶ç”Ÿæ•ˆ,åˆ©ç”¨ JSONP å‘æ–‡ä»¶å†…è” &lt;script&gt; æ ‡ç­¾,å®ç°æŒ‰éœ€åŠ è½½æ¨¡å—.</p>
<h4 id="watch"><a href="#watch" class="headerlink" title="watch"></a>watch</h4><blockquote>
<p>åŸç†åˆ†æ</p>
</blockquote>
<p>  webpack â€“watch æ–‡ä»¶ç›‘å¬çš„åŸç†æ˜¯ä»€ä¹ˆ?</p>
<p>  è§£: è½®è¯¢å¯ç›‘å¬çš„ç¼–è¾‘æ–‡ä»¶çš„æœ€åä¿®æ”¹æ—¶é—´æ˜¯å¦å‘ç”Ÿå˜åŒ–,å¦‚æœå‘ç”Ÿäº†å˜åŒ–,åˆ™ä¼šå¼•èµ· webpack é‡æ–°æ„å»ºæ‰“åŒ….</p>
<blockquote>
<p>å‚æ•°</p>
</blockquote>
<p>  webpack â€“watch æ–‡ä»¶ç›‘å¬æœ‰å“ªäº›å‚æ•°?</p>
<p>  è§£: webpack â€“watch æ–‡ä»¶ç›‘å¬æœ‰ä¸€äº›å‚æ•°,å…¨éƒ½åœ¨å±æ€§ watchOptions ä¸­,å…¶ä¸­åŒ…å«ä¸‰ä¸ªä¸»è¦å‚æ•°: ignoredã€aggregateTimeoutå’Œpoll.</p>
<p>  webpack â€“watch æ–‡ä»¶ç›‘å¬é‡Œä¸»è¦å‚æ•°çš„ä½œç”¨æ˜¯ä»€ä¹ˆ?</p>
<ul>
<li>ignored =&gt; ç­›é€‰ä¸å®è¡Œç›‘å¬çš„ä½ç½®ç›®å½•.</li>
<li>aggregateTimeout =&gt; å½“è½®è¯¢åˆ°å¯ç›‘å¬çš„ç¼–è¾‘æ–‡ä»¶çš„æœ€åä¿®æ”¹æ—¶é—´å‘ç”Ÿäº†å˜åŒ–,ä¸ä¼šç«‹å³å‘ŠçŸ¥ç›‘å¬è€…å¼•èµ· webpack é‡æ–°æ„å»ºæ‰“åŒ…,è€Œæ˜¯ä¼šåŠ å…¥è‡³ç¼“å­˜ä¸­,åœ¨ aggregateTimeout æ—¶é—´æ®µå†…é‡å¤æ­¤ç±»æ“ä½œ,ç­‰æ—¶é—´æ®µç»“æŸä¹‹å,å°†ç¼“å­˜ä¸­çš„æ–‡ä»¶åˆ—è¡¨ç»Ÿä¸€å®è¡Œæ„å»ºæ‰“åŒ….</li>
<li>poll =&gt; åœ¨æŸä¸€ä¸ªæ—¶é—´æ®µå†…,è½®è¯¢çš„å¯ç›‘å¬çš„ç¼–è¾‘æ–‡ä»¶çš„æœ€åä¿®æ”¹æ—¶é—´æ˜¯å¦å‘ç”Ÿå˜åŒ–çš„æ¬¡æ•°.</li>
</ul>
<h4 id="devtool"><a href="#devtool" class="headerlink" title="devtool"></a>devtool</h4><blockquote>
<p>sourceMap</p>
</blockquote>
<p>  sourceMap çš„ä½œç”¨æ˜¯ä»€ä¹ˆ?</p>
<p>  è§£: ç”¨äºå‰ç«¯å¼€å‘è€…æ ¹æ® sourceMap æ–‡ä»¶ç²¾ç¡®æ¢å¯»æºä»£ç çš„ä¸€äº›é—®é¢˜,å¼€å‘ç¯å¢ƒä¸€èˆ¬å¼€å¯,ç”Ÿäº§ç¯å¢ƒåˆ™å¿…é¡»å…³é—­.</p>
<blockquote>
<p>å‚æ•°</p>
</blockquote>
<p>  é¦–å…ˆäº†è§£å‡ ä¸ªæ¦‚å¿µ: cheapã€evalã€inlineã€moduleã€source-map</p>
<ul>
<li>cheap: æ„å»ºæ‰“åŒ…çš„ sourceMap æ–‡ä»¶åªèƒ½é€šè¿‡è¡Œè¿½è¸ª.</li>
<li>eval: è¡¨è¾¾å¼é€šè¿‡ eval è¯­æ³•åŒ…è£¹,æ³¨é‡Šç´§è·Ÿ eval è¯­æ³•å¤‡æ³¨æ‰€å‡ºäºçš„æºä»£ç ä½ç½®ç›®å½•.</li>
<li>inline: sourceMap é€šè¿‡å†…è” sourceMap dataURI è‡³æ„å»ºæ‰“åŒ…æ–‡ä»¶,ä¸ä¼šå•ç‹¬å¯¼å‡º .map æ–‡ä»¶.</li>
<li>module: ä¼šå¯¼å‡ºæœªè¢« loader å¤„ç†çš„æºä»£ç .</li>
<li>source-map: æ„å»ºæ‰“åŒ…ä¼šé¢å¤–å•ç‹¬å¯¼å‡º .map æ–‡ä»¶.</li>
</ul>
<p>  è¿™å‡ ä¸ªæ¦‚å¿µæŒ‰ç…§é€»è¾‘æ’åˆ—ç»„åˆ,è‡ªç„¶å½¢æˆäº†å„ç§å‚æ•°.ä¸¾å‡ ä¸ªğŸŒ°:</p>
<ul>
<li>source-map: ä¼šé¢å¤–å•ç‹¬å¯¼å‡º .map æ–‡ä»¶,å¯ç›´æ¥ç²¾ç¡®æ¢å¯»æºä»£ç .</li>
<li>cheap-source-map: ä¼šé¢å¤–å•ç‹¬å¯¼å‡º .map æ–‡ä»¶,å¯ç›´æ¥ç²¾ç¡®æ¢å¯»æºä»£ç ,ä½†å †æ ˆè¿½è¸ªé”™è¯¯åªèƒ½é€šè¿‡è¡Œ,ä¸ä¼šæ˜¾ç¤ºåˆ—.</li>
<li>inline-source-map: ä¸ä¼šé¢å¤–å•ç‹¬å¯¼å‡º .map æ–‡ä»¶,ä¼šé€šè¿‡å†…è” sourceMap dataURI è‡³æ„å»ºæ‰“åŒ…æ–‡ä»¶(ä½“ç§¯ä¼šæ˜æ˜¾å¢å¤§),å¯ç›´æ¥ç²¾ç¡®æ¢å¯»æºä»£ç .</li>
<li>cheap-module-source-map: ä¼šé¢å¤–å•ç‹¬å¯¼å‡º .mapæ–‡ä»¶,å¯ç›´æ¥ç²¾ç¡®æ¢å¯»æœªè¢« loader å¤„ç†æ—¶çš„æºä»£ç ,ä½†å †æ ˆè¿½è¸ªé”™è¯¯åªèƒ½é€šè¿‡è¡Œ,ä¸ä¼šæ˜¾ç¤ºåˆ—.</li>
<li>eval: ä¸ä¼šé¢å¤–å•ç‹¬å¯¼å‡º .map æ–‡ä»¶,è¡¨è¾¾å¼é€šè¿‡ eval è¯­æ³•åŒ…è£¹,æ³¨é‡Šç´§è·Ÿ eval è¯­æ³•å¤‡æ³¨æ‰€å‡ºäºçš„æºä»£ç ä½ç½®ç›®å½•,æ— æ³•ç›´æ¥ç²¾ç¡®æ¢å¯»æºä»£ç .</li>
</ul>
<h4 id="splitChunks"><a href="#splitChunks" class="headerlink" title="splitChunks"></a>splitChunks</h4><blockquote>
<p>å‚æ•°</p>
</blockquote>
<ul>
<li>chunks: æœ‰ä¸‰ä¸ªæšä¸¾é€‰é¡¹,â€asyncâ€ã€â€initial â€œä»¥åŠ â€œallâ€,é»˜è®¤ä¸º â€œasyncâ€,è¡¨ç¤ºå¯¹äºå¼‚æ­¥ã€éå¼‚æ­¥ä»¥åŠå…¨éƒ¨çš„æ¨¡å—ä»£ç åˆ†å‰²çš„é€‰æ‹©.</li>
<li>minChunks: è¡¨ç¤ºæ¨¡å—æœ€å°‘å¯è¢«å¯¼å…¥å®ç°åˆ†å‰²çš„æ¬¡æ•°,é»˜è®¤ä¸º 1.</li>
<li>minSize: è¡¨ç¤ºæ¨¡å—æœ€å°‘å¯è¢«åˆ†å‰²çš„ä½“ç§¯å¤§å°,é»˜è®¤ä¸º 30000,ä¹Ÿå°±æ˜¯ 30kb.</li>
<li>maxInitialRequests: è¡¨ç¤ºå…¥å£æ¨¡å—å¹¶å‘è¯·æ±‚çš„æœ€å¤§æ¬¡æ•°,é»˜è®¤ä¸º 3.</li>
<li>maxAsyncRequests: è¡¨ç¤ºæ¨¡å—æŒ‰éœ€åŠ è½½å¹¶å‘è¯·æ±‚çš„æœ€å¤§æ¬¡æ•°,é»˜è®¤ä¸º 5.</li>
<li>name: æ¨¡å—ä»£ç åˆ†å‰²åå¯¼å‡ºæ¨¡å—çš„åç§°.</li>
<li>cacheGroups: ç¼“å­˜ç»„å¯é…ç½®å¤šä¸ªç»„,ç»„ä¸­çš„å…ƒç´ ä¼šè¦†ç›–æˆ–è€…ç»§æ‰¿ç»„å¤–çš„å±æ€§å€¼,é™¤äº† testã€priority ä»¥åŠ reuseExistingChunk.</li>
<li>cacheGroups.test: ç­›é€‰è¦åˆ†å‰²å¯¼å‡ºçš„æ¨¡å—.</li>
<li>cacheGroups.priority: å¯é€šè¿‡ä¼˜å…ˆçº§æ¥æ”¹å˜æ„å»ºæ‰“åŒ…æ¨¡å—ä»£ç åˆ†å‰²çš„é¡ºåº,é»˜è®¤å€¼ä¸º -20.</li>
</ul>
<h4 id="TreeShaking"><a href="#TreeShaking" class="headerlink" title="TreeShaking"></a>TreeShaking</h4><blockquote>
<p>ä½œç”¨</p>
</blockquote>
<p>  å¯ç”¨äºå°†æ°¸è¿œæ‰§è¡Œä¸åˆ°çš„ã€æ— ç”¨çš„å˜é‡ä»¥åŠæ‰§è¡Œçš„ä»£ç ç»“æœä¸ä¼šè¢«ä½¿ç”¨çš„è¡¨è¾¾å¼,å‰”é™¤å‡ºæ„å»ºæ‰“åŒ…æ–‡ä»¶.<br>  PS: åªèƒ½ä½œç”¨äºå¯é™æ€åˆ†æçš„ ESM æ¨¡å—, commonjs æˆ–è€… commonjs2 æ¨¡å—éƒ½ä¸ä¼šç”Ÿæ•ˆ.</p>
<h4 id="Scope-Hoisting"><a href="#Scope-Hoisting" class="headerlink" title="Scope Hoisting"></a>Scope Hoisting</h4><blockquote>
<p>ä½œç”¨</p>
</blockquote>
<p>  å¯¹äºä¸å¼€å¯ Scope Hoisting çš„æ„å»ºæ‰“åŒ…æ–‡ä»¶æ¥è¯´,ä¼šå­˜åœ¨å¤§é‡çš„ IIFE è‡ªæ‰§è¡Œå‡½æ•°è¡¨è¾¾å¼é—­åŒ…,webpack ä¼šå¯¹æ¯ä¸ªå¯¼å…¥æ¨¡å—å¤–åŠ ä¸€å±‚åŒ…è£¹,ä¸”å°† import è½¬åŒ–æˆ <strong>webpack_require</strong>,è¿™æ ·å°±ä¼šå¯¼è‡´æ„å»ºæ‰“åŒ…æ–‡ä»¶ä½“ç§¯å¢å¤§,è€Œå¤§é‡çš„é—­åŒ…ä¹Ÿä¼šå¯¼è‡´è®¾å¤‡çš„å†…å­˜ç©ºé—´åƒç´§,è€Œ Scope Hoisting å°±æ˜¯ç”¨æ¥è§£å†³æ­¤ç±»é—®é¢˜çš„,Webpack 4.x å½“ä¸­åªè¦å°† mode è®¾ç½®ä¸º â€œproductionâ€,å°±ä¼šå¼€å¯ Scope Hoisting,è€Œåœ¨ Webpack 4.x ä¹‹å‰çš„ç‰ˆæœ¬åˆ™éœ€å¼•å…¥ new webpack.optimize.ModuleConcatenationPlugin(),Scope Hoisting ä¼šå°†å¯¼å…¥çš„æ¨¡å—å†…è”è¿›ä¸€ä¸ªå¤§çš„å‡½æ•°ä½œç”¨åŸŸä¸­,ä½¿æ¨¡å—æŒ‰ç…§å¼•ç”¨çš„é¡ºåºè¿›è¡Œæ’åˆ—,é€‚å½“çš„é‡å‘½åä¸€äº›å˜é‡ä»¥é˜²æ­¢å˜é‡åå†²çª,è¿™æ ·å°±ä¼šå¤§å¤§å‡å°‘æ–‡ä»¶ä»¥åŠå†…å­˜ç©ºé—´çš„ä½“ç§¯.</p>
<p>  PS: åªèƒ½ä½œç”¨äºå¯é™æ€åˆ†æçš„ ESM æ¨¡å—, commonjs æˆ–è€… commonjs2 æ¨¡å—éƒ½ä¸ä¼šç”Ÿæ•ˆ.</p>
<h4 id="resolve"><a href="#resolve" class="headerlink" title="resolve"></a>resolve</h4><blockquote>
<p>alias</p>
</blockquote>
<p>  resolve.alias çš„ä½œç”¨æ˜¯ä»€ä¹ˆ?</p>
<p>  è§£: ä½¿ç”¨åˆ«åæ›¿ä»£å¤æ‚çš„æ¨¡å—å¯¼å…¥è·¯å¾„.</p>
<blockquote>
<p>mainFields</p>
</blockquote>
<p>  resolve.mainFields çš„ä½œç”¨æ˜¯ä»€ä¹ˆ?</p>
<p>  è§£: è‡ªå®šä¹‰ä¾èµ–è¢«å¯¼å…¥çš„æ–‡ä»¶ä½ç½®.</p>
<blockquote>
<p>extensions</p>
</blockquote>
<p>  resolve.extensions çš„ä½œç”¨æ˜¯ä»€ä¹ˆ?</p>
<p>  è§£: é€‰æ‹©çœç•¥å¯¼å…¥æ¨¡å—çš„åç¼€.</p>
<blockquote>
<p>modules</p>
</blockquote>
<p>  resolve.modules çš„ä½œç”¨æ˜¯ä»€ä¹ˆ?</p>
<p>  è§£: æŒ‡å®šå¯¼å…¥ä¾èµ–çš„ä½ç½®ç›®å½•.</p>
<blockquote>
<p>enforceExtensions</p>
</blockquote>
<p>  resolve.enforceExtensions çš„ä½œç”¨æ˜¯ä»€ä¹ˆ?</p>
<p>  è§£: å¼ºåˆ¶å¯¼å…¥æ¨¡å—å¿…é¡»æ·»åŠ åç¼€.</p>
<h4 id="module"><a href="#module" class="headerlink" title="module"></a>module</h4><blockquote>
<p>noParse</p>
</blockquote>
<p>  module.noParse çš„ä½œç”¨æ˜¯ä»€ä¹ˆ?</p>
<p>  è§£: ç”¨äº webpack ç­›é€‰å¯å¿½ç•¥çš„æœªä½¿ç”¨æ ‡å‡†æ¨¡å—çš„ä¾èµ–,å¦‚ jQuery ç­‰,PS: ç­›é€‰å¯å¿½ç•¥çš„ä¾èµ–åº”è¯¥ä¸åŒ…å« import,define,require ç­‰æ ‡å‡†æ¨¡å—è¯­ä¹‰çš„è¯­å¥.</p>
<h4 id="externals"><a href="#externals" class="headerlink" title="externals"></a>externals</h4><blockquote>
<p>ä½œç”¨</p>
</blockquote>
<p>  ç”¨äº webpack ç­›é€‰ä¸å®è¡Œæ„å»ºæ‰“åŒ…çš„ä¾èµ–,æ¯”å¦‚ jQuery è¿™ç§ä½“ç§¯éå¸¸åºå¤§,æ„å»ºæ‰“åŒ…æ²¡æœ‰ä»»ä½•æ”¶ç›Šçš„ä¾èµ–,æœ€åç›´æ¥ä½œä¸ºå…¨å±€å˜é‡å†…è”å…¥æ„å»ºæ‰“åŒ…æ–‡ä»¶å†….</p>
<h4 id="loaders"><a href="#loaders" class="headerlink" title="loaders"></a>loaders</h4><blockquote>
<p>babel-loader</p>
</blockquote>
<p>  @babel/preset-env çš„å‚æ•° modules çš„ä½œç”¨æ˜¯ä»€ä¹ˆ?</p>
<p>  è§£: modules =&gt; é€šè¿‡ babel è½¬åŒ–çš„æ¨¡å—å¯¼å‡ºæ˜¯å¦ä¸ºå…¶ä»–ç±»å‹,é»˜è®¤æ¨¡å—å¯¼å‡ºä¸º â€˜EsModuleâ€™,å…¶ä»–ç±»å‹å¦‚ â€˜commonjsâ€™,â€™commonjs2â€™,â€™amdâ€™ ç­‰,è®¾ç½®ä¸º false è¡¨æ˜ä¸æ”¹å˜æ¨¡å—å¯¼å‡ºç±»å‹.</p>
<p>  @babel/preset-env çš„å‚æ•° loose çš„ä½œç”¨æ˜¯ä»€ä¹ˆ?</p>
<p>  è§£: loose =&gt; é€šè¿‡ babel è½¬åŒ–æ˜¯å¦å¼€å¯æ¾æ•£æ¨¡å¼.</p>
<ul>
<li><p>ä½•ä¸º loose æ¾æ•£æ¨¡å¼?</p>
<p>è§£: babel åœ¨è½¬æ¢æ—¶ä¸€èˆ¬æœ‰ä¸¤ç§è½¬æ¢æ¨¡å¼: æ¾æ•£æ¨¡å¼(loose)ä¸æ ‡å‡†æ¨¡å¼(normal),æ¾æ•£æ¨¡å¼ä¼šè½¬æ¢ä¸ºå‰ç«¯å¼€å‘è€…æœ€ç†Ÿæ‚‰çš„ç®€æ´çš„ ES5 ä»£ç ,è€Œæ ‡å‡†æ¨¡å¼è½¬æ¢å‡ºçš„ä»£ç åˆ™æ›´è´´è¿‘ ES6 çš„è¯­ä¹‰.</p>
</li>
<li><p>loose æ¾æ•£æ¨¡å¼çš„ä¼˜ç¼ºç‚¹?</p>
<ul>
<li>ä¼˜ç‚¹: è½¬æ¢å‡ºçš„ä»£ç æ›´åŠ æ˜“è¯»,ä½“ç§¯æ›´å°,æ‰§è¡Œæ•ˆç‡æ›´é«˜,å¯¹äºè€æµè§ˆå™¨å…¼å®¹æ€§æ›´å¥½.</li>
<li>ç¼ºç‚¹: å¯¹äºåŸç”Ÿ ES6 è¯­æ³•çš„ä»£ç è½¬æ¢æ—¶ç»å¸¸ä¼šå‡ºç°é—®é¢˜.</li>
<li>æ€»ç»“: åŸºæœ¬ä¸Šåœ¨ä½¿ç”¨æ—¶ä¸ä¼šå¼€å¯ loose æ¾æ•£æ¨¡å¼.</li>
</ul>
</li>
</ul>
<p>  @babel/preset-env çš„å‚æ•° useBuiltIns çš„ä½œç”¨æ˜¯ä»€ä¹ˆ?</p>
<p>  è§£: æ˜¯ç”¨äºæ ¹æ® browserslist çš„æµè§ˆå™¨ç‰ˆæœ¬é›†åˆæ¥å…¼å®¹çš„åŠ¨æ€ polyfill ç­–ç•¥.</p>
<ul>
<li><p>â€˜entryâ€™</p>
<p>ä¼šå°† browserslist çš„æ‰€æœ‰æµè§ˆå™¨ç‰ˆæœ¬ä¸å…¼å®¹çš„ polyfill ä¼˜å…ˆå…¨éƒ¨å¯¼å…¥è‡³ chunks å…¥å£å¤„.é…åˆ <a href="mailto:&#99;&#111;&#114;&#101;&#45;&#106;&#x73;&#64;&#51;&#x2e;&#120;">&#99;&#111;&#114;&#101;&#45;&#106;&#x73;&#64;&#51;&#x2e;&#120;</a> å¯å®ç°æŒ‰éœ€åŠ è½½,å¯è‡ªå®šä¹‰å¯¼å…¥è‡³å…¥å£çš„ polyfill æ¨¡å—,PS: å¿…é¡»æ˜¯åœ¨ browserslist æ‰€æœ‰æµè§ˆå™¨ç‰ˆæœ¬ä¸å…¼å®¹çš„ polyfill èŒƒå›´å†….</p>
</li>
<li><p>â€˜usageâ€™</p>
<p>ä¼šå°† browserslist çš„æ‰€æœ‰æµè§ˆå™¨ç‰ˆæœ¬ä¸å…¼å®¹çš„ polyfill æ ¹æ®æ¨¡å—ä½¿ç”¨å¤„çš„ API ç‰¹å®šæŒ‰éœ€å¯¼å…¥.</p>
</li>
<li><p>false(æä¸æ¨è)</p>
<p>ä¼šæ— è§† browserslist å°†æ‰€æœ‰çš„ @babel/polyfill å¯¼å…¥è‡³ chunks å…¥å£å¤„.</p>
</li>
</ul>
<p>  @babel/preset-env çš„å‚æ•° corejs çš„ä½œç”¨æ˜¯ä»€ä¹ˆ?</p>
<p>  è§£: å¿…é¡»é…åˆ useBuiltIns: â€˜entryâ€™ æˆ–è€… useBuiltIns: â€˜usageâ€™ ä½¿ç”¨,åŸºæœ¬ä¸Šç”¨äºå°†æœªçº³å…¥ ECMASCRIPT ç¨³å®šè¯­æ³•çš„ proposal æ–°ç‰¹æ€§æ³¨å…¥è‡³ polyfill ä¸­.</p>
  <figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line">  <span class="attr">presets</span>: [[</span><br><span class="line">      <span class="string">&#x27;@babel/preset-env&#x27;</span>, &#123;</span><br><span class="line">          <span class="attr">useBuiltIns</span>: <span class="string">&#x27;usage&#x27;</span>,</span><br><span class="line">          <span class="attr">corejs</span>: &#123;</span><br><span class="line">              <span class="attr">version</span>: <span class="number">3</span>,</span><br><span class="line">              <span class="attr">proposal</span>: <span class="literal">true</span></span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">  ]]</span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>css-loader</p>
</blockquote>
<p>  ä¸ºä½• css-loader options å‚æ•° minimize å‹ç¼©åŠŸèƒ½å¤±æ•ˆ?</p>
<p>  è§£: é€šè¿‡æŸ¥è¯¢,webpack 3.x =&gt; 4.x &amp;&amp; css-loader 0.x =&gt; 1.x å·²ç»å°† options minimize å‚æ•°å‹ç¼©åŠŸèƒ½åˆ æ‰.</p>
<blockquote>
<p>postcss-loader</p>
</blockquote>
<p>  ä¸ºä½•é€‰ç”¨ postcss-preset-env æ›¿ä»£ autoprefixer æ¥ç¼–è¯‘è½¬åŒ–æ ·å¼æ–‡ä»¶å…¼å®¹æµè§ˆå™¨å‘¢?</p>
<p>  è§£: postcss æœ¬è´¨çš„ä½œç”¨å°±æ˜¯å°†æ›´å¤š css çš„æ–°æ ·å¼ã€æ–°ç‰¹æ€§å…¼å®¹æ›´å¤šçš„æµè§ˆå™¨.postcss-preset-env ä¸­å¼•ç”¨äº† autoprefixer,ä¸”å…¶æ¯” autoprefixer èƒ½ç¼–è¯‘è½¬åŒ– css çš„æ–°ç‰¹æ€§,è¿™æ˜¯ autoprefixer ä¸­ä¸å­˜åœ¨çš„åŠŸèƒ½,å¦‚ color: #12345678 è¿™æ ·åŒ…æ‹¬é€æ˜åº¦çš„åå…­è¿›åˆ¶ css é¢œè‰²æ–°ç‰¹æ€§,æ‰€ä»¥é€‰ç”¨ postcss-preset-env æ›¿ä»£ autoprefixer æ¥ç¼–è¯‘è½¬åŒ–æ ·å¼æ–‡ä»¶.</p>
<p>  ä¸ºä½• postcss.config.js &gt; plugins ä¸ postcss-loader &gt; postcssOptions &gt; plugins åŒæ—¶å­˜åœ¨çš„æƒ…å†µä¸‹,ä¸¤è€…åŒæ—¶ç”Ÿæ•ˆ?</p>
<p>  è§£: ä¸¤è€…åŒæ—¶å­˜åœ¨çš„æƒ…å†µä¸‹,postcss.config.js &gt; plugins ä¸ä¼šè¢«è¦†ç›–,è€Œæ˜¯ä¼šè¢«ç»§æ‰¿åˆå¹¶åŒæ—¶ç”Ÿæ•ˆ.</p>
<p>  ç°åœ¨ç§»åŠ¨ç«¯åˆ†è¾¨ç‡é€‚é…ä½¿ç”¨çš„æ˜¯ vw/vh çš„ç­–ç•¥,é‚£ä¹ˆå¦‚ä½•å°† UI å›¾ä¸Šçš„ç»å¯¹åƒç´ å€¼( px )åŠ¨æ€è½¬åŒ–ä¸º vw å‘¢?</p>
<p>  é¦–å…ˆè¦äº†è§£å‡ ä¸ªæ¦‚å¿µ: </p>
<ul>
<li>vw/vh: ç±»ä¼¼äºç™¾åˆ†æ¯”,ä¸è¿‡æ˜¯ç›¸å¯¹äºç†æƒ³è§†å£è®¾ç½®çš„å®½åº¦ä»¥åŠé«˜åº¦.</li>
<li>ç†æƒ³è§†å£: åœ¨ä¸å®è¡Œç¼©æ”¾çš„æƒ…å†µä¸‹,å°†ç‰©ç†åƒç´ ç²¾ç¡®è½¬åŒ–ä¸ºå„ä¸ªè®¾å¤‡çš„ CSS åƒç´ (dpr)çš„ç¯å¢ƒ.</li>
<li>DPR: DPR = ç‰©ç†åƒç´ /åˆ†è¾¨ç‡.</li>
</ul>
<p>  ä½¿ç”¨ postcss-px-to-viewport æ¥å°† px åŠ¨æ€è½¬åŒ–ä¸º vw.</p>
  <figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//postcss.config.js</span></span><br><span class="line"><span class="keyword">const</span> postcssConfig = &#123;</span><br><span class="line">    <span class="attr">plugins</span>: [</span><br><span class="line">        <span class="string">&#x27;postcss-preset-env&#x27;</span>,</span><br><span class="line">        [</span><br><span class="line">            <span class="string">&#x27;postcss-px-to-viewport&#x27;</span>,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">unitToConvert</span>: <span class="string">&#x27;px&#x27;</span>,</span><br><span class="line">                <span class="attr">unitPrecision</span>: <span class="number">8</span>,</span><br><span class="line">                <span class="attr">viewportUnit</span>: <span class="string">&#x27;vw&#x27;</span>,</span><br><span class="line">                <span class="attr">viewportWidth</span>: <span class="number">750</span></span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    ]</span><br><span class="line">&#125;;</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = postcssConfig;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>url-loader</p>
</blockquote>
<p>  url-loader ä¸ file-loader çš„åŒºåˆ«æ˜¯ä»€ä¹ˆ?</p>
<p>  è§£: url-loader ä¸ file-loader åœ¨å¤„ç†æ–‡ä»¶èµ„æºåŠŸèƒ½ä¸Šé¢å¹¶æ²¡æœ‰å¾ˆå¤§çš„åŒºåˆ«,url-loader ä¸­æ˜¯å¼•ç”¨äº† file-loader çš„,ä½†æ˜¯ url-loader æ ¹æ®å‚æ•°é™åˆ¶èƒ½å¤Ÿè½¬åŒ–ä¸ºæ›´å°çš„æ–‡ä»¶èµ„æº dataURI,æ¯”å¦‚å›¾ç‰‡ Base64.</p>
<blockquote>
<p>Asset Module</p>
</blockquote>
<p>  webpack 5.x ä¸­å¯¹äºèµ„æºæ¨¡å—çš„å¤„ç†è¿›è¡Œäº†å‡çº§ä¼˜åŒ–,æ— éœ€é¢å¤–é…ç½®å³å¯å¤„ç†èµ„æºæ–‡ä»¶(å­—ä½“ï¼Œå›¾æ ‡ç­‰).</p>
<p>  èµ„æºæ¨¡å—ç±»å‹(asset module type),é€šè¿‡æ·»åŠ  4 ç§æ–°çš„æ¨¡å—ç±»å‹,æ¥æ›¿æ¢æ‰€æœ‰è¿™äº› loader:</p>
<ul>
<li>asset/resource å‘é€ä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶å¹¶å¯¼å‡º URL.ä¹‹å‰é€šè¿‡ä½¿ç”¨ file-loader å®ç°.</li>
<li>asset/inline å¯¼å‡ºä¸€ä¸ªèµ„æºçš„ data URI.ä¹‹å‰é€šè¿‡ä½¿ç”¨ url-loader å®ç°.</li>
<li>asset/source å¯¼å‡ºèµ„æºçš„æºä»£ç .ä¹‹å‰é€šè¿‡ä½¿ç”¨ raw-loader å®ç°.</li>
<li>asset åœ¨å¯¼å‡ºä¸€ä¸ª data URI å’Œå‘é€ä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶ä¹‹é—´è‡ªåŠ¨é€‰æ‹©.ä¹‹å‰é€šè¿‡ä½¿ç”¨ url-loader,å¹¶ä¸”é…ç½®èµ„æºä½“ç§¯é™åˆ¶å®ç°.</li>
</ul>
<p>  asset å®é™…ä¸Šå¯ä»¥ç†è§£ä¸ºæ¯”è¾ƒé€šç”¨çµæ´»çš„é…ç½®,é€šå¸¸å¼€å‘æ—¶åŸºæœ¬ä¸Šä½¿ç”¨ type: â€˜assetâ€™.</p>
<ul>
<li><p>generator</p>
<p>åœ¨é…ç½® module.rules æ—¶,å¯é…ç½® generator æ¥å¯¹èµ„æºæ¨¡å—å¤„ç†è¿›è¡Œè¿›ä¸€æ­¥æ§åˆ¶,è¯¥é…ç½®æœ‰ä»¥ä¸‹å‡ ä¸ªå±æ€§:</p>
<ul>
<li><p>filename</p>
<ul>
<li>å€¼å¿…é¡»ä¸ºç›¸å¯¹è·¯å¾„,å¯æ”¹å˜èµ„æºè¾“å‡ºçš„ç›®å½•;</li>
<li>å¦‚æœåŒæ—¶æŒ‡å®šäº†è¯¥å±æ€§å’Œ output.assetModuleFilename,å°†å¿½ç•¥ output.assetModuleFilename çš„å€¼;</li>
<li>è¯¥å±æ€§ä»…é€‚ç”¨äº asset å’Œ asset/resource èµ„æºç±»å‹.</li>
</ul>
</li>
<li><p>dataUrl</p>
<ul>
<li>åœ¨å¤„ç† inline ç±»å‹çš„èµ„æºæ—¶,è¯¥èµ„æºé»˜è®¤å¯¹èµ„æºè¿›è¡Œ base64 ç¼–ç ,å¯é€šè¿‡è¯¥å±æ€§æ¥æ”¹å˜å…¶ç¼–ç æ–¹å¼;</li>
<li>è¯¥å±æ€§å€¼ä¸ºå‡½æ•°,å…¶ç­¾åä¸º (content: string) =&gt; string;</li>
<li>è¯¥å±æ€§ä»…é€‚ç”¨äº asset å’Œ asset/inline èµ„æºç±»å‹.</li>
</ul>
</li>
</ul>
</li>
<li><p>parser</p>
<ul>
<li><p>dataUrlCondition.maxSize:</p>
<ul>
<li>å½“ type ä¸º asset æ—¶,å¦‚æœèµ„æºå¤§å°å°äº 8kb,æŒ‰ç…§ asset/inline çš„è§„åˆ™å¤„ç†èµ„æº,å¦åˆ™æŒ‰ç…§ asset/resource çš„è§„åˆ™å¤„ç†èµ„æº;</li>
<li>å¯é€šè¿‡æŒ‡å®šè¯¥å±æ€§æ¥æ”¹å˜å…¶ç•Œé™å€¼(å•ä½ä¸º byte);</li>
<li>è¯¥å±æ€§ä»…é€‚ç”¨äº asset èµ„æºç±»å‹.</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>  ç¤ºä¾‹:</p>
  <figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">      <span class="attr">rules</span>: [<span class="comment">//...</span></span><br><span class="line">      &#123;</span><br><span class="line">          <span class="attr">test</span>: <span class="regexp">/\.(bmp|gif|jpg|jpeg|gif)$/</span>,</span><br><span class="line">          <span class="attr">type</span>: <span class="string">&#x27;asset&#x27;</span>,</span><br><span class="line">          <span class="attr">generator</span>: &#123;</span><br><span class="line">              <span class="attr">publicPath</span>: <span class="string">&#x27;./&#x27;</span>,</span><br><span class="line">              <span class="comment">// æ³¨æ„,è¿™é‡Œèµ„æºæ¨¡å—æ–‡ä»¶åç¼€[ext]ä¸å¼•å…¥ loader æ–¹å¼æ—¶æœ‰æ‰€ä¸åŒ,è¿™é‡Œä»£è¡¨.bmp .png .gif .jpg .jpeg,è€Œå¼•å…¥ loader æ—¶,[ext] æ˜¯ä¸å«æœ‰ &#x27;.&#x27; å­—ç¬¦çš„.</span></span><br><span class="line">              <span class="attr">filename</span>: <span class="string">&#x27;assets/images/[name].[contenthash:6][ext]&#x27;</span></span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="attr">parser</span>: &#123;</span><br><span class="line">              <span class="attr">dataUrlCondition</span>: &#123;</span><br><span class="line">                  <span class="attr">maxSize</span>: <span class="number">5</span> * <span class="number">1024</span></span><br><span class="line">              &#125;</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">//..</span></span><br><span class="line">      ]</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>raw-loader</p>
</blockquote>
<p>  åœ¨ä¹‹å‰çš„ç§»åŠ¨ç«¯åˆ†è¾¨ç‡é€‚é…æ—¶,æ˜¯ä½¿ç”¨ç›¸å¯¹åƒç´ å€¼(rem)+åŠ¨æ€è®¡ç®—å…ƒèŠ‚ç‚¹ç»å¯¹åƒç´ å€¼çš„ç­–ç•¥,ä½†æ˜¯å´ä¼šå­˜åœ¨ raw-loader å†…è”èµ„æºå¿…é¡»ä¸‹è½½ä½ç‰ˆæœ¬ 0.5.1 çš„é™åˆ¶,ä¸ºä»€ä¹ˆå¿…é¡»è¦ä¸‹è½½ä½ç‰ˆæœ¬ 0.5.1 çš„ raw-loader å‘¢?</p>
<p>  è§£: é¦–å…ˆäº†è§£å‡ ä¸ªæ¦‚å¿µ: px2rem-loaderã€lib-flexible ä»¥åŠ raw-loader.</p>
<ul>
<li>px2rem-loader: ç”¨äºå°† px ç»å¯¹åƒç´ å€¼è½¬åŒ–ä¸º rem ç›¸å¯¹åƒç´ å€¼.</li>
<li>lib-flexible: ç”¨äºåŠ¨æ€è®¡ç®—å…ƒèŠ‚ç‚¹ç»å¯¹åƒç´ å€¼çš„å·¥å…·.</li>
<li>raw-loader: ç”¨äºå†…è”èµ„æºæ¨¡å—,å¯¼å‡ºæ–‡ä»¶èµ„æºçš„æºä»£ç .</li>
</ul>
<p>  æ–°ç‰ˆæœ¬çš„ raw-loader å­˜åœ¨ä¸€äº›é—®é¢˜,æŸ¥è¯¢äº†æºä»£ç åå‘ç°,å¯¼å‡ºçš„èµ„æºæ¨¡å—æºä»£ç æ¨¡å—å¯¼å‡ºç±»å‹ä¸º â€˜EsModuleâ€™,è½¬åŒ–æˆå­—ç¬¦ä¸²ä¸ºâ€™[object Object]â€˜,è¦å¯¹ raw-loader è¿›è¡Œå¤„ç†,å¯¹å…¶å±æ€§ esModule è®¾ç½®ä¸º false,å°±å¯è§£å†³å¿…é¡»ä¸‹è½½ä½ç‰ˆæœ¬ 0.5.1 çš„ raw-loader çš„é™åˆ¶.</p>
  <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!-- ä½¿ç”¨ raw-loader å†…è”èµ„æºæ¨¡å—ä¹‹å‰  --&gt;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">  &lt;html lang=&quot;zh-CN&quot;&gt;</span><br><span class="line">  &lt;head&gt;</span><br><span class="line">      &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">      &lt;title&gt;Webpack Emulate&lt;/title&gt;</span><br><span class="line">      &lt;script type=&quot;text/javascript&quot;&gt;&lt;%= require(&quot;raw-loader?esModule=false!babel-loader!../node_modules/lib-flexible/flexible&quot;) %&gt;&lt;/script&gt;</span><br><span class="line">  &lt;/head&gt;</span><br><span class="line">  &lt;body&gt;</span><br><span class="line">  &lt;div id=&quot;root-webpack&quot;&gt;</span><br><span class="line">  </span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">  &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

  <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!-- ä½¿ç”¨ raw-loader å†…è”èµ„æºæ¨¡å—ä¹‹å  --&gt;</span><br><span class="line">&lt;!doctype html&gt;&lt;html lang=&quot;zh-CN&quot;&gt;&lt;head&gt;&lt;meta charset=&quot;UTF-8&quot;&gt;&lt;title&gt;Webpack Emulate&lt;/title&gt;</span><br><span class="line">  &lt;script&gt;;(function (win, lib) &#123;</span><br><span class="line">          var doc = win.document;</span><br><span class="line">          var docEl = doc.documentElement;</span><br><span class="line">          var metaEl = doc.querySelector(&#x27;meta[name=&quot;viewport&quot;]&#x27;);</span><br><span class="line">          var flexibleEl = doc.querySelector(&#x27;meta[name=&quot;flexible&quot;]&#x27;);</span><br><span class="line">          var dpr = 0;</span><br><span class="line">          var scale = 0;</span><br><span class="line">          var tid;</span><br><span class="line">          var flexible = lib.flexible || (lib.flexible = &#123;&#125;);</span><br><span class="line"></span><br><span class="line">          if (metaEl) &#123;</span><br><span class="line">              console.warn(&#x27;å°†æ ¹æ®å·²æœ‰çš„metaæ ‡ç­¾æ¥è®¾ç½®ç¼©æ”¾æ¯”ä¾‹&#x27;);</span><br><span class="line">              var match = metaEl.getAttribute(&#x27;content&#x27;).match(/initial\-scale=([\d\.]+)/);</span><br><span class="line"></span><br><span class="line">              if (match) &#123;</span><br><span class="line">                  scale = parseFloat(match[1]);</span><br><span class="line">                  dpr = parseInt(1 / scale);</span><br><span class="line">              &#125;</span><br><span class="line">          &#125; else if (flexibleEl) &#123;</span><br><span class="line">              var content = flexibleEl.getAttribute(&#x27;content&#x27;);</span><br><span class="line"></span><br><span class="line">              if (content) &#123;</span><br><span class="line">                  var initialDpr = content.match(/initial\-dpr=([\d\.]+)/);</span><br><span class="line">                  var maximumDpr = content.match(/maximum\-dpr=([\d\.]+)/);</span><br><span class="line"></span><br><span class="line">                  if (initialDpr) &#123;</span><br><span class="line">                      dpr = parseFloat(initialDpr[1]);</span><br><span class="line">                      scale = parseFloat((1 / dpr).toFixed(2));</span><br><span class="line">                  &#125;</span><br><span class="line"></span><br><span class="line">                  if (maximumDpr) &#123;</span><br><span class="line">                      dpr = parseFloat(maximumDpr[1]);</span><br><span class="line">                      scale = parseFloat((1 / dpr).toFixed(2));</span><br><span class="line">                  &#125;</span><br><span class="line">              &#125;</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">          if (!dpr &amp;&amp; !scale) &#123;</span><br><span class="line">              var isAndroid = win.navigator.appVersion.match(/android/gi);</span><br><span class="line">              var isIPhone = win.navigator.appVersion.match(/iphone/gi);</span><br><span class="line">              var devicePixelRatio = win.devicePixelRatio;</span><br><span class="line"></span><br><span class="line">              if (isIPhone) &#123;</span><br><span class="line">                  // iOSä¸‹ï¼Œå¯¹äº2å’Œ3çš„å±ï¼Œç”¨2å€çš„æ–¹æ¡ˆï¼Œå…¶ä½™çš„ç”¨1å€æ–¹æ¡ˆ</span><br><span class="line">                  if (devicePixelRatio &gt;= 3 &amp;&amp; (!dpr || dpr &gt;= 3)) &#123;</span><br><span class="line">                      dpr = 3;</span><br><span class="line">                  &#125; else if (devicePixelRatio &gt;= 2 &amp;&amp; (!dpr || dpr &gt;= 2)) &#123;</span><br><span class="line">                      dpr = 2;</span><br><span class="line">                  &#125; else &#123;</span><br><span class="line">                      dpr = 1;</span><br><span class="line">                  &#125;</span><br><span class="line">              &#125; else &#123;</span><br><span class="line">                  // å…¶ä»–è®¾å¤‡ä¸‹ï¼Œä»æ—§ä½¿ç”¨1å€çš„æ–¹æ¡ˆ</span><br><span class="line">                  dpr = 1;</span><br><span class="line">              &#125;</span><br><span class="line"></span><br><span class="line">              scale = 1 / dpr;</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">          docEl.setAttribute(&#x27;data-dpr&#x27;, dpr);</span><br><span class="line"></span><br><span class="line">          if (!metaEl) &#123;</span><br><span class="line">              metaEl = doc.createElement(&#x27;meta&#x27;);</span><br><span class="line">              metaEl.setAttribute(&#x27;name&#x27;, &#x27;viewport&#x27;);</span><br><span class="line">              metaEl.setAttribute(&#x27;content&#x27;, &#x27;initial-scale=&#x27; + scale + &#x27;, maximum-scale=&#x27; + scale + &#x27;, minimum-scale=&#x27; + scale + &#x27;, user-scalable=no&#x27;);</span><br><span class="line"></span><br><span class="line">              if (docEl.firstElementChild) &#123;</span><br><span class="line">                  docEl.firstElementChild.appendChild(metaEl);</span><br><span class="line">              &#125; else &#123;</span><br><span class="line">                  var wrap = doc.createElement(&#x27;div&#x27;);</span><br><span class="line">                  wrap.appendChild(metaEl);</span><br><span class="line">                  doc.write(wrap.innerHTML);</span><br><span class="line">              &#125;</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">          function refreshRem() &#123;</span><br><span class="line">              var width = docEl.getBoundingClientRect().width;</span><br><span class="line"></span><br><span class="line">              if (width / dpr &gt; 540) &#123;</span><br><span class="line">                  width = 540 * dpr;</span><br><span class="line">              &#125;</span><br><span class="line"></span><br><span class="line">              var rem = width / 10;</span><br><span class="line">              docEl.style.fontSize = rem + &#x27;px&#x27;;</span><br><span class="line">              flexible.rem = win.rem = rem;</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">          win.addEventListener(&#x27;resize&#x27;, function () &#123;</span><br><span class="line">              clearTimeout(tid);</span><br><span class="line">              tid = setTimeout(refreshRem, 300);</span><br><span class="line">          &#125;, false);</span><br><span class="line">          win.addEventListener(&#x27;pageshow&#x27;, function (e) &#123;</span><br><span class="line">              if (e.persisted) &#123;</span><br><span class="line">                  clearTimeout(tid);</span><br><span class="line">                  tid = setTimeout(refreshRem, 300);</span><br><span class="line">              &#125;</span><br><span class="line">          &#125;, false);</span><br><span class="line"></span><br><span class="line">          if (doc.readyState === &#x27;complete&#x27;) &#123;</span><br><span class="line">              doc.body.style.fontSize = 12 * dpr + &#x27;px&#x27;;</span><br><span class="line">          &#125; else &#123;</span><br><span class="line">              doc.addEventListener(&#x27;DOMContentLoaded&#x27;, function (e) &#123;</span><br><span class="line">                  doc.body.style.fontSize = 12 * dpr + &#x27;px&#x27;;</span><br><span class="line">              &#125;, false);</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">          refreshRem();</span><br><span class="line">          flexible.dpr = win.dpr = dpr;</span><br><span class="line">          flexible.refreshRem = refreshRem;</span><br><span class="line"></span><br><span class="line">          flexible.rem2px = function (d) &#123;</span><br><span class="line">              var val = parseFloat(d) * this.rem;</span><br><span class="line"></span><br><span class="line">              if (typeof d === &#x27;string&#x27; &amp;&amp; d.match(/rem$/)) &#123;</span><br><span class="line">                  val += &#x27;px&#x27;;</span><br><span class="line">              &#125;</span><br><span class="line"></span><br><span class="line">              return val;</span><br><span class="line">          &#125;;</span><br><span class="line"></span><br><span class="line">          flexible.px2rem = function (d) &#123;</span><br><span class="line">              var val = parseFloat(d) / this.rem;</span><br><span class="line"></span><br><span class="line">              if (typeof d === &#x27;string&#x27; &amp;&amp; d.match(/px$/)) &#123;</span><br><span class="line">                  val += &#x27;rem&#x27;;</span><br><span class="line">              &#125;</span><br><span class="line"></span><br><span class="line">              return val;</span><br><span class="line">          &#125;;</span><br><span class="line">      &#125;)(window, window[&#x27;lib&#x27;] || (window[&#x27;lib&#x27;] = &#123;&#125;));&lt;/script&gt;&lt;link href=&quot;./css/index.5c90e18c.css&quot; rel=&quot;stylesheet&quot;&gt;&lt;/head&gt;&lt;body&gt;&lt;div id=&quot;root-webpack&quot;&gt;&lt;/div&gt;&lt;script defer=&quot;defer&quot; src=&quot;./js/index_7b84cb4c006925aa2404.js&quot;&gt;&lt;/script&gt;&lt;/body&gt;&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>thread-loader</p>
</blockquote>
<p>  thread-loader çš„åŸç†æ˜¯ä»€ä¹ˆ?</p>
<p>  è§£: webpack æ¯ä¸€æ¬¡è§£æ loader æ¨¡å—æ—¶,thread-loader éƒ½ä¼šå°†å®ƒä»¥åŠå®ƒæ‰€ä¾èµ–çš„åŒ…åˆ†é…ç»™æ‰€å¯¹åº”çš„ worker çº¿ç¨‹.</p>
<blockquote>
<p>loader-runner</p>
</blockquote>
<p>  loader-runner çš„ä½œç”¨æ˜¯ä»€ä¹ˆ?</p>
<p>  è§£: æ˜¯ç”¨äºæµ‹è¯•è‡ªå®šä¹‰çš„ loader è€Œå­˜åœ¨çš„,å¯ä»¥ä½¿ç”¨ <a href="mailto:&#108;&#111;&#x61;&#x64;&#101;&#x72;&#x2d;&#x75;&#x74;&#x69;&#x6c;&#x73;&#x40;&#x32;&#46;&#120;">&#108;&#111;&#x61;&#x64;&#101;&#x72;&#x2d;&#x75;&#x74;&#x69;&#x6c;&#x73;&#x40;&#x32;&#46;&#120;</a> ä¸­çš„ getOptions(this) è·å– loader &gt; options,ç”±äºä¸æ˜¯åœ¨çœŸå®çš„ webpack ç¯å¢ƒä¸‹,ä¸å¯ä½¿ç”¨ this.getOptions(è·å– loader -&gt; options),this.emitFile(ç”Ÿæˆæ–‡ä»¶) ç­‰ API,PS: getOptions(this) åœ¨ <a href="mailto:&#x6c;&#111;&#97;&#100;&#101;&#x72;&#x2d;&#117;&#x74;&#x69;&#108;&#115;&#64;&#x33;&#x2e;&#x78;">&#x6c;&#111;&#97;&#100;&#101;&#x72;&#x2d;&#117;&#x74;&#x69;&#108;&#115;&#64;&#x33;&#x2e;&#x78;</a> ä¸­å·²ç»è¢«å‰”é™¤,åœ¨è‡ªå®šä¹‰çš„ loader ä¸­ç›´æ¥ä½¿ç”¨ this.getOptions() å³å¯.</p>
  <figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123;readFile&#125; = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> &#123;resolve&#125; = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> &#123;runLoaders&#125; = <span class="built_in">require</span>(<span class="string">&#x27;loader-runner&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="title function_">runLoaders</span>(&#123;</span><br><span class="line">    <span class="attr">resource</span>: <span class="title function_">resolve</span>(process.<span class="title function_">cwd</span>(), <span class="string">&#x27;./src/styles/index.less&#x27;</span>),</span><br><span class="line">    <span class="attr">context</span>: &#123;<span class="attr">minimize</span>: <span class="literal">true</span>&#125;,</span><br><span class="line">    <span class="attr">loaders</span>: [&#123;</span><br><span class="line">        <span class="attr">loader</span>: <span class="title function_">resolve</span>(process.<span class="title function_">cwd</span>(), <span class="string">&#x27;./lib/loaders/sprite_loader.js&#x27;</span>),</span><br><span class="line">        <span class="attr">options</span>: &#123;</span><br><span class="line">            <span class="attr">name</span>: <span class="string">&#x27;sprite&#x27;</span>,</span><br><span class="line">            <span class="attr">path</span>: <span class="string">&#x27;src/styles&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;],</span><br><span class="line">    <span class="attr">readResource</span>: readFile.<span class="title function_">bind</span>(<span class="variable language_">this</span>)</span><br><span class="line">&#125;, <span class="function">(<span class="params">err, stats</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(err) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">`æµ‹è¯•è‡ªå®šä¹‰ loader å‡ºç°é”™è¯¯: <span class="subst">$&#123;err&#125;</span>`</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(stats);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="devServer"><a href="#devServer" class="headerlink" title="devServer"></a>devServer</h4><blockquote>
<p>contentBase</p>
</blockquote>
<p>  ä¸ºä½•åœ¨ devServer è®¾ç½® contentBase å¤±æ•ˆ?</p>
<p>  è§£: contentBase æŒ‡çš„æ˜¯ devServer æœ¬åœ°ä»£ç†æœåŠ¡çš„ä½œç”¨ç›®å½•,ä¸€èˆ¬è®¾ç½®ä¸ºç»å¯¹è·¯å¾„,åœ¨ webpack 5.x ä¸­æ”¹ä¸º static,webpack 4.x åŠå…¶ä¹‹å‰ç‰ˆæœ¬ä¾ç„¶ç”Ÿæ•ˆ.</p>
<blockquote>
<p>historyApiFallback</p>
</blockquote>
<p>  devServer.historyApiFallback çš„ä½œç”¨æ˜¯ä»€ä¹ˆ?</p>
<p>  è§£: devServer æœ¬åœ°ä»£ç†æœåŠ¡æŒ‡å®šé‡åˆ° 404 æˆ–è€… é”™è¯¯æ—¶é‡å®šå‘çš„é¡µé¢.</p>
<blockquote>
<p>allowedHosts</p>
</blockquote>
<p>  devServer.allowedHosts çš„ä½œç”¨æ˜¯ä»€ä¹ˆ?</p>
<p>  è§£: devServer æœ¬åœ°ä»£ç†æœåŠ¡é¡µé¢è®¿é—®æ—¶ http è¯·æ±‚çš„ç™½åå•.</p>
<blockquote>
<p>https</p>
</blockquote>
<p>  devServer.https çš„ä½œç”¨æ˜¯ä»€ä¹ˆ?</p>
<p>  è§£: devServer æœ¬åœ°ä»£ç†æœåŠ¡æ˜¯å¦å¼€å¯ https å®‰å…¨åè®®.</p>
<blockquote>
<p>compress</p>
</blockquote>
<p>  devServer.compress çš„ä½œç”¨æ˜¯ä»€ä¹ˆ?</p>
<p>  è§£: devServer æœ¬åœ°ä»£ç†æœåŠ¡æ˜¯å¦å¼€å¯ Gzip å‹ç¼©.</p>
<blockquote>
<p>open</p>
</blockquote>
<p>  devServer.open çš„ä½œç”¨æ˜¯ä»€ä¹ˆ?</p>
<p>  è§£: devServer æœ¬åœ°ä»£ç†æœåŠ¡é¦–æ¬¡æ„å»ºæ‰“åŒ…æ—¶,æ˜¯å¦è‡ªåŠ¨æ‰“å¼€è®¾å¤‡é»˜è®¤æµè§ˆå™¨å®è¡Œè®¿é—®.</p>
<blockquote>
<p>hot</p>
</blockquote>
<p>  çƒ­åŠ è½½çš„å·¥ä½œåŸç†æ˜¯ä»€ä¹ˆ?</p>
<p>  è§£: é¦–å…ˆè¦äº†è§£å‡ ä¸ªæ¦‚å¿µ: webpack compileã€bundle serverã€hmr server ä»¥åŠ hmr runtime.</p>
<ul>
<li>webpack compile: æ˜¯å°† js è½¬åŒ–æˆ bundleJs çš„ç¼–è¯‘å™¨,åŒæ—¶å¼€å¯ webpack â€“watch æ–‡ä»¶ç›‘å¬,å¹¶å†™å…¥å†…å­˜.</li>
<li>bundle server: æä¾›æ–‡ä»¶ç»™æµè§ˆå™¨å®è¡Œè®¿é—®.</li>
<li>hmr server: å°† Server ç«¯çƒ­åŠ è½½æ–‡ä»¶è¾“å‡ºç»™ Client ç«¯ hmr runtime.</li>
<li>hmr runtime: æ³¨å…¥è‡³æµè§ˆå™¨å†…å­˜ä¸­;æ¥å— hmr server è¾“å‡ºçš„çƒ­åŠ è½½æ–‡ä»¶å¹¶å®è¡Œæ›´æ–°.</li>
</ul>
<p>  å·¥ä½œåŸç†: é¦–æ¬¡ç¼–è¯‘,webpack compile å°† js ç¼–è¯‘ä¸º bundleJs,åŒæ—¶å¼€å¯ webpack â€“watch æ–‡ä»¶ç›‘å¬å¹¶å†™å…¥å†…å­˜,é€šè¿‡ bundler server æä¾›æ–‡ä»¶ç»™æµè§ˆå™¨å®è¡Œè®¿é—®,ä¸æ­¤å¹¶è¡Œçš„æ˜¯ hmr runtime æ³¨å…¥è‡³æµè§ˆå™¨å†…å­˜ä¸­;æ¥ç€æ–‡ä»¶ç›‘å¬è½®è¯¢å¯ç›‘å¬çš„ç¼–è¾‘æ–‡ä»¶æ˜¯å¦å‘ç”Ÿå˜åŒ–,å¦‚æœå‘ç”Ÿäº†å˜åŒ–,ä¸ä¼šç«‹å³å‘ŠçŸ¥ç›‘å¬è€…,å¼•èµ· webpack é‡æ–°æ„å»ºæ‰“åŒ…,è€Œæ˜¯ä¼šæ”¾å…¥è‡³ç¼“å­˜ä¸­,åœ¨ aggregateTimeout æ—¶é—´æ®µå†…é‡å¤æ­¤ç±»æ“ä½œ,ç­‰æ—¶é—´æ®µç»“æŸä¹‹å,å°†ç¼“å­˜ä¸­çš„æ–‡ä»¶åˆ—è¡¨ç»Ÿä¸€é‡æ–°æ„å»ºæ‰“åŒ…,ä¹‹åé€šè¿‡ hmr server å°†çƒ­åŠ è½½æ–‡ä»¶è¾“å‡ºç»™ hmr runtime,å…¶ä¸­çš„æ–‡ä»¶ä¼ è¾“åè®®ä¸º websocket,ä¼ è¾“æ•°æ®æ ¼å¼ä¸º JSON æ ¼å¼,hmr runtime æ¥æ”¶åˆ° hmr server çƒ­åŠ è½½æ–‡ä»¶å®è¡Œæ›´æ–°.</p>
<h4 id="plugins"><a href="#plugins" class="headerlink" title="plugins"></a>plugins</h4><blockquote>
<p>friendly-errors-webpack-plugin</p>
</blockquote>
<p>  ä¸ºä½• friendly-errors-webpack-plugin æ—¥å¿—ä¼˜åŒ–æ’ä»¶åœ¨ webpack 5.x ä¸­ä¸ç”Ÿæ•ˆ?</p>
<p>  è§£: friendly-errors-webpack-plugin æ—¥å¿—ä¼˜åŒ–æ’ä»¶ç›®å‰åœ¨ github ä¸Šå·²åœæ­¢ç»´æŠ¤,å…¶åªèƒ½ç”Ÿæ•ˆçš„ webpack ç‰ˆæœ¬ä¸º 4.x ä»¥åŠä¹‹å‰çš„ç‰ˆæœ¬,å¯¹äº webpack 5.x æ— æ³•ä¸‹è½½ä½¿ç”¨.</p>
<blockquote>
<p>clean-webpack-plugin</p>
</blockquote>
<p>  å¦‚ä½•é€‰æ‹©æ€§æ¸…ç©ºæ„å»ºæ‰“åŒ…å¯¼å‡ºçš„ä½ç½®ç›®å½•å†…å®¹?</p>
<p>  è§£: clean-webpack-plugin å­˜åœ¨ä¸€ä¸ªå‚æ•°å±æ€§ â€”â€” cleanOnceBeforeBuildPatterns.</p>
<ul>
<li>cleanOnceBeforeBuildPatterns: ç”¨äºç­›é€‰åœ¨ Webpack Compile ç¼–è¯‘å‰å®è¡Œæ¸…ç©ºçš„ä½ç½®ç›®å½•å†…å®¹.</li>
</ul>
<p>  ç”¨æ­¤å±æ€§å°±å¯é€‰æ‹©æ€§æ¸…ç©ºæ„å»ºæ‰“åŒ…å¯¼å‡ºçš„ä½ç½®ç›®å½•å†…å®¹.</p>
<blockquote>
<p>image-minimizer-webpack-plugin</p>
</blockquote>
<p>  image-minimizer-webpack-plugin å›¾ç‰‡èµ„æºæ¨¡å—å‹ç¼©åŠŸèƒ½æ’ä»¶æœ‰ä»€ä¹ˆä½œç”¨?</p>
<p>  è§£: æ˜¯ç”¨äºå°†æ‰€æœ‰ç±»å‹çš„å›¾ç‰‡èµ„æºæ¨¡å—åˆ©ç”¨ imagemin çš„æ–¹å¼ä¼˜åŒ–å‹ç¼©æ‰“åŒ…åŠŸèƒ½çš„æœ€ä½³å¤„ç†æ–¹å¼.</p>
  <figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">ImageMinimizerWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;image-minimizer-webpack-plugin&#x27;</span>);</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line">  <span class="attr">optimization</span>: &#123;</span><br><span class="line">      <span class="attr">minimizer</span>: [</span><br><span class="line">          <span class="comment">//...</span></span><br><span class="line">          <span class="keyword">new</span> <span class="title class_">ImageMinimizerWebpackPlugin</span>(&#123;</span><br><span class="line">              <span class="attr">minimizer</span>: &#123;</span><br><span class="line">                  <span class="attr">implementation</span>: <span class="title class_">ImageMinimizerWebpackPlugin</span>.<span class="property">imageminMinify</span>,</span><br><span class="line">                  <span class="attr">options</span>: &#123;</span><br><span class="line">                      <span class="attr">plugins</span>: [</span><br><span class="line">                          [<span class="string">&quot;gifsicle&quot;</span>, &#123; <span class="attr">interlaced</span>: <span class="literal">true</span> &#125;],</span><br><span class="line">                          [<span class="string">&quot;jpegtran&quot;</span>, &#123; <span class="attr">progressive</span>: <span class="literal">true</span> &#125;],</span><br><span class="line">                          [<span class="string">&quot;optipng&quot;</span>, &#123; <span class="attr">optimizationLevel</span>: <span class="number">5</span> &#125;],</span><br><span class="line">                          [</span><br><span class="line">                              <span class="string">&quot;svgo&quot;</span>,</span><br><span class="line">                              &#123;</span><br><span class="line">                                  <span class="attr">plugins</span>: [</span><br><span class="line">                                      &#123;</span><br><span class="line">                                          <span class="attr">name</span>: <span class="string">&quot;preset-default&quot;</span>,</span><br><span class="line">                                          <span class="attr">params</span>: &#123;</span><br><span class="line">                                              <span class="attr">overrides</span>: &#123;</span><br><span class="line">                                                  <span class="attr">removeViewBox</span>: <span class="literal">false</span>,</span><br><span class="line">                                                  <span class="attr">addAttributesToSVGElement</span>: &#123;</span><br><span class="line">                                                      <span class="attr">params</span>: &#123;</span><br><span class="line">                                                          <span class="attr">attributes</span>: [</span><br><span class="line">                                                              &#123; <span class="attr">xmlns</span>: <span class="string">&quot;http://www.w3.org/2000/svg&quot;</span> &#125;,</span><br><span class="line">                                                          ],</span><br><span class="line">                                                      &#125;,</span><br><span class="line">                                                  &#125;,</span><br><span class="line">                                              &#125;,</span><br><span class="line">                                          &#125;,</span><br><span class="line">                                      &#125;,</span><br><span class="line">                                  ],</span><br><span class="line">                              &#125;,</span><br><span class="line">                          ],</span><br><span class="line">                      ]</span><br><span class="line">                  &#125;</span><br><span class="line">              &#125;</span><br><span class="line">          &#125;),</span><br><span class="line">          <span class="comment">//...</span></span><br><span class="line">      ]</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="commit-rules"><a href="#commit-rules" class="headerlink" title="commit rules"></a>commit rules</h4><blockquote>
<p>è§„èŒƒè¯´æ˜</p>
</blockquote>
<p>  ç°é˜¶æ®µå¤§å¤šæ•°å‰ç«¯å¼€å‘è€…éµä»çš„ git commit message è§„èŒƒéƒ½æ˜¯ Angular å›¢é˜Ÿçš„ Angular commit message.</p>
  <figure class="highlight text"><table><tr><td class="code"><pre><span class="line">&lt;type&gt;(&lt;scope&gt;): &lt;subject&gt;  &lt;!-- è¿™ä¸€è¡Œä¸º header --&gt;</span><br><span class="line">&lt;breakLine&gt;</span><br><span class="line">&lt;body&gt;    </span><br><span class="line">&lt;breakLine&gt;</span><br><span class="line">&lt;footer&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>header: åˆ†ä¸ºä¸‰éƒ¨åˆ†,typeã€scope ä»¥åŠ subject.<ul>
<li>type: è¡¨ç¤ºæäº¤ç±»å‹.å¿…å¡«ä¸”å¿…é¡»ä¸ºä»¥ä¸‹æšä¸¾ä¹‹ä¸€: [â€˜buildâ€™, â€˜choreâ€™, â€˜featâ€™, â€˜fixâ€™, â€˜styleâ€™, â€˜perfâ€™, â€˜docsâ€™, â€˜ciâ€™, â€˜testâ€™, â€˜refactorâ€™].</li>
<li>scope: è¡¨ç¤ºé¡¹ç›®å†…æ–‡ä»¶ä¿®æ”¹çš„èŒƒå›´,æ¯”å¦‚è¯´ fix ä¿®å¤ bug æ—¶,é€‰æ‹© hooks éƒ¨åˆ†è¿˜æ˜¯ component éƒ¨åˆ†,é€‰å¡«.</li>
<li>subject: è¡¨ç¤ºç®€è¦æè¿°æœ¬æ¬¡æäº¤.å¿…é¡»éµå¾ªä¸¤ä¸ªè§„åˆ™: é¦–å­—æ¯ä¸èƒ½å¤§å†™,æœ«å°¾ä¸èƒ½æ·»åŠ  â€˜.â€™ å­—ç¬¦,å¿…å¡«.</li>
</ul>
</li>
<li>body: è¡¨ç¤ºå¯¹æœ¬æ¬¡æäº¤çš„è¯¦ç»†æè¿°,é€‰å¡«.</li>
<li>footer: åˆ†ä¸ºä¸¤ç§æƒ…å†µ,BREAKING CHANGES ä»¥åŠ åˆ é™¤ issue,é€‰å¡«.<ul>
<li>BREAKING CHANGES: ä¸å½“å‰ API äº§ç”Ÿäº†è¾ƒå¤§çš„ä¸å…¼å®¹æ—¶,å¦‚é‡æ„,ä¼šè¯¦ç»†æè¿°æœ¬æ¬¡æäº¤çš„ BREAKING CHANGES,å¿…é¡»ä»¥ BREAKING CHANGES å¼€å¤´.</li>
<li>delete issue: å½“éœ€è¦åˆ é™¤æœ¬æ¬¡ commit æ‰€å¯¹åº”çš„ issue æ—¶,ä¹Ÿå¯è¯¦ç»†æè¿°.</li>
</ul>
</li>
</ul>
<blockquote>
<p>type enum</p>
</blockquote>
<ul>
<li>Angular commit message type.<ul>
<li>build: åˆå§‹åŒ–æ‰“åŒ….</li>
<li>chore: æ„å»º/ä¾èµ–/å·¥å…·.</li>
<li>feat: æ–°åŠŸèƒ½.</li>
<li>fix: ä¿®å¤ Bug.</li>
<li>style: ä»£ç æ ·å¼ç¾åŒ–.</li>
<li>perf: æ€§èƒ½ä¼˜åŒ–.</li>
<li>docs: æ–‡æ¡£å˜æ›´.</li>
<li>test: æµ‹è¯•.</li>
<li>ci: CI related changes.</li>
<li>refactor: é‡æ„.</li>
</ul>
</li>
<li>gitmoji commit message type.<ul>
<li>éµä»ä¸”ç»§æ‰¿ Angular commit message type.</li>
<li>revert: å›æ»š.</li>
<li>wip: å»ºè®¾è¿›ç¨‹ä¸­(ä¸æ¨èä½¿ç”¨).</li>
</ul>
</li>
</ul>
<blockquote>
<p>è§„èŒƒåŒ–å·¥å…·</p>
</blockquote>
<p>  é€šå¸¸ä½¿ç”¨ commitizen + cz-customizable æ¥å®ç° gitmoji commit message è§„èŒƒåŒ–.</p>
  <figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;config&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;commitizen&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">       <span class="attr">&quot;paths&quot;</span><span class="punctuation">:</span> <span class="string">&quot;node_modules/cz-customizable&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

  <figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//.cz-config.js</span></span><br><span class="line"><span class="keyword">const</span> czConfig = &#123;</span><br><span class="line">    <span class="attr">types</span>: [&#123;</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;ğŸ» build: åˆå§‹åŒ–æ‰“åŒ…&#x27;</span>,</span><br><span class="line">        <span class="attr">value</span>: <span class="string">&#x27;:beers: build&#x27;</span></span><br><span class="line">    &#125;, &#123;</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;ğŸ“¦ï¸chore: æ„å»º/ä¾èµ–/å·¥å…·&#x27;</span>,</span><br><span class="line">        <span class="attr">value</span>: <span class="string">&#x27;:package: chore&#x27;</span></span><br><span class="line">    &#125;, &#123;</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;âœ¨  feat: æ–°åŠŸèƒ½&#x27;</span>,</span><br><span class="line">        <span class="attr">value</span>: <span class="string">&#x27;:sparkles: feat&#x27;</span></span><br><span class="line">    &#125;, &#123;</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;ğŸ› fix: ä¿®å¤bug&#x27;</span>,</span><br><span class="line">        <span class="attr">value</span>: <span class="string">&#x27;:bug: fix&#x27;</span></span><br><span class="line">    &#125;, &#123;</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;ğŸ¨ style: ä»£ç æ ·å¼ä¼˜åŒ–&#x27;</span>,</span><br><span class="line">        <span class="attr">value</span>: <span class="string">&#x27;:art: style&#x27;</span></span><br><span class="line">    &#125;, &#123;</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;ğŸ“„ docs: å˜æ›´æ–‡æ¡£&#x27;</span>,</span><br><span class="line">        <span class="attr">value</span>: <span class="string">&#x27;:page_facing_up: docs&#x27;</span></span><br><span class="line">    &#125;, &#123;</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;ğŸš€ perf: æ€§èƒ½ä¼˜åŒ–&#x27;</span>,</span><br><span class="line">        <span class="attr">value</span>: <span class="string">&#x27;:rocket: perf&#x27;</span></span><br><span class="line">    &#125;, &#123;</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;âœ…  test: æµ‹è¯•&#x27;</span>,</span><br><span class="line">        <span class="attr">value</span>: <span class="string">&#x27;:white_check_mark: test&#x27;</span></span><br><span class="line">    &#125;, &#123;</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;ğŸ”¥ refactor: é‡æ„&#x27;</span>,</span><br><span class="line">        <span class="attr">value</span>: <span class="string">&#x27;:fire: refactor&#x27;</span></span><br><span class="line">    &#125;, &#123;</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;ğŸ‘· ci: CI related changes&#x27;</span>,</span><br><span class="line">        <span class="attr">value</span>: <span class="string">&#x27;:construction_worker: ci&#x27;</span></span><br><span class="line">    &#125;],</span><br><span class="line">    <span class="attr">messages</span>: &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&#x27;è¯·è¾“å…¥æ‚¨æœ¬æ¬¡æäº¤ç±»å‹(å¿…å¡«):&#x27;</span>,</span><br><span class="line">        <span class="attr">scope</span>: <span class="string">&#x27;è¯·è¾“å…¥æ‚¨æœ¬æ¬¡æäº¤ä¿®æ”¹èŒƒå›´:&#x27;</span>,</span><br><span class="line">        <span class="attr">customScope</span>: <span class="string">&#x27;è¯·é€‰æ‹©æ‚¨æœ¬æ¬¡æäº¤ä¿®æ”¹èŒƒå›´:&#x27;</span>,</span><br><span class="line">        <span class="attr">subject</span>: <span class="string">&#x27;è¯·ç®€è¦æè¿°æœ¬æ¬¡æäº¤(å¿…å¡«):&#x27;</span>,</span><br><span class="line">        <span class="attr">body</span>: <span class="string">&#x27;è¯·å¯¹æœ¬æ¬¡æäº¤ä½œè¯¦ç»†æè¿°:&#x27;</span>,</span><br><span class="line">        <span class="attr">breaking</span>: <span class="string">&#x27;è¯·å¯¹æœ¬æ¬¡æäº¤ä¸å½“å‰ API äº§ç”Ÿæ¯”è¾ƒå¤§çš„ä¸å…¼å®¹ä½œè¯¦ç»†æè¿°:&#x27;</span>,</span><br><span class="line">        <span class="attr">footer</span>: <span class="string">&#x27;è¯·å¯¹æœ¬æ¬¡æäº¤åˆ é™¤çš„æ‰€å¯¹åº”çš„ issue ä½œè¯¦ç»†æè¿°:&#x27;</span>,</span><br><span class="line">        <span class="attr">confirmCommit</span>: <span class="string">&#x27;æ˜¯å¦ç¡®è®¤æäº¤ä»¥ä¸Šé€‰æ‹©è¾“å…¥?&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">scopes</span>: [&#123;<span class="attr">name</span>: <span class="string">&#x27;components       [ç»„ä»¶éƒ¨åˆ†]&#x27;</span>&#125;, &#123;<span class="attr">name</span>: <span class="string">&#x27;hooks            [hookséƒ¨åˆ†]&#x27;</span>&#125;, &#123;<span class="attr">name</span>: <span class="string">&#x27;logics           [ä»£ç é€»è¾‘éƒ¨åˆ†]&#x27;</span>&#125;],</span><br><span class="line">    <span class="attr">allowCustomScopes</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">allowEmptyScopes</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">customScopesName</span>: <span class="string">&#x27;custom           [è‡ªå®šä¹‰]&#x27;</span>,</span><br><span class="line">    <span class="attr">emptyScopesName</span>: <span class="string">&#x27;empty            [ä¸æŒ‡å®š]&#x27;</span>,</span><br><span class="line">    <span class="attr">allowBreakingChanges</span>: [<span class="string">&#x27;:sparkles: feat&#x27;</span>, <span class="string">&#x27;:bug: fix&#x27;</span>],</span><br><span class="line">    <span class="attr">subjectLimit</span>: <span class="number">80</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>å¼ºåˆ¶æ ¡éªŒ gitmoji commit message</p>
</blockquote>
<p>  é€šå¸¸ä½¿ç”¨ commitlint + husky + commitlint-config-gitmoji æ¥å¼ºåˆ¶æ ¡éªŒ git æäº¤æ—¶çš„ gitmoji commit message è§„èŒƒ.</p>
  <figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// .commitlintrc.js</span></span><br><span class="line"><span class="keyword">const</span> commitlintrcConfig = &#123;</span><br><span class="line">  <span class="attr">extends</span>: [<span class="string">&#x27;gitmoji&#x27;</span>],</span><br><span class="line">&#125;;</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = commitlintrcConfig;</span><br></pre></td></tr></table></figure>

  <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">husky</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ç”Ÿæˆå¼ºåˆ¶æ ¡éªŒ git æ“ä½œçš„ hooks å®¹å™¨.</span></span><br><span class="line">npx husky install</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ·»åŠ å¼ºåˆ¶æ ¡éªŒ gitmoji commit message è§„èŒƒçš„ hooks,å¹¶å†™å…¥é»˜è®¤å‘½ä»¤.</span></span><br><span class="line">npx husky add .husky/commet-msg &quot;yarn run test&quot;</span><br></pre></td></tr></table></figure>

  <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">husky</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/usr/bin/env sh</span></span><br><span class="line">. &quot;$(dirname -- &quot;$0&quot;)/_/husky.sh&quot;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">commitlint --edit æ˜¯å¯¹ git æœ€åä¸€æ¬¡æœ¬åœ°æäº¤è¿›è¡Œå¼ºåˆ¶æ ¡éªŒ,å¦‚è‹¥æ ¡éªŒä¸é€šè¿‡åˆ™å®è¡Œå›é€€,æœ¬åœ°æäº¤ä¸æˆåŠŸ.</span></span><br><span class="line">npx --no-install commitlint --edit &quot;$1&quot;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>å¼ºåˆ¶ç”Ÿæˆ CHANGELOG</p>
</blockquote>
<p>  é€šå¸¸ä½¿ç”¨ husky + standard-version + conventional-changelog-gitmoji-config æ¥å¼ºåˆ¶ç”Ÿæˆ CHANGELOG.md æ–‡ä»¶.</p>
  <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ·»åŠ å¼ºåˆ¶æ ¡éªŒ gitmoji commit message è§„èŒƒçš„ hooks,å¹¶å†™å…¥é»˜è®¤å‘½ä»¤.</span></span><br><span class="line">npx husky add .husky/pre-push &quot;yarn run test&quot;</span><br></pre></td></tr></table></figure>

  <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">husky</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/usr/bin/env sh</span></span><br><span class="line">. &quot;$(dirname -- &quot;$0&quot;)/_/husky.sh&quot;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ç”Ÿæˆ CHANGELOG.md æ–‡ä»¶çš„è§„åˆ™éµå¾ª conventional-changelog-gitmoji-config,ä¸å¯è¿›è¡Œè‡ªå®šä¹‰.</span></span><br><span class="line">npx --no-install standard-version --preset gitmoji-config</span><br></pre></td></tr></table></figure>

<h4 id="speed-optimization"><a href="#speed-optimization" class="headerlink" title="speed optimization"></a>speed optimization</h4><blockquote>
<p>best answer</p>
</blockquote>
<p>  å®éªŒè¯æ˜, webpack 5.x ä¸­ä½¿ç”¨ splitChunks åˆ†å‰²è‡ªå®šä¹‰å…¬ç”¨æ¨¡å—,ä½¿ç”¨ DllPlugin + DllReferencePlugin æŠ½å–å…¬ç”¨ä¾èµ–è‡³ manifest.json æ–‡ä»¶å†…åšé¢„ç¼–è¯‘æ–‡ä»¶,åªéœ€è¦æ„å»ºæ‰“åŒ…ä¸€æ¬¡,åç»­åˆ™ä¸éœ€è¦é‡æ–°æ‰§è¡Œ,å¯ç”±æ­¤çœ‹å‡ºæ˜¯é€Ÿåº¦ä¼˜åŒ–çš„æœ€ä½³ç­”æ¡ˆ.</p>
<blockquote>
<p>BREAKING CHANGES</p>
</blockquote>
<p>åœ¨ webpack 4.x ä¸­åšäº†ä¸€äº›é€Ÿåº¦ä¼˜åŒ–å‡çº§:</p>
<ul>
<li>nodejs å¿…é¡»ä¸‹è½½ v8.5.0 ä»¥ä¸Šçš„ç¨³å®šç‰ˆæœ¬æ‰å¯ä½¿ç”¨,è€Œæ–°ç‰ˆæœ¬çš„ V8 å¸¦æ¥äº†ä¸€äº›è¯­æ³•ä¼˜åŒ–.<ul>
<li>for-of æ›¿ä»£ forEach.</li>
<li>Mapã€Set æ›¿ä»£ Object.</li>
<li>includes æ›¿ä»£ indexOf.</li>
</ul>
</li>
<li>ä½¿ç”¨æ›´å¿«çš„ md4 hash åŠ å¯†ç®—æ³•.</li>
<li>webpack AST å¯ä»¥ç›´æ¥é€šè¿‡ loader ä¼ é€’ç»™ AST,å‡å°‘è§£ææ—¶é—´,è§£æé€Ÿåº¦æ›´å¿«.</li>
<li>ä½¿ç”¨å­—ç¬¦ä¸²æ–¹æ³•æ›¿ä»£æ­£åˆ™è¡¨è¾¾å¼,è¿è¡Œé€Ÿåº¦æ›´å¿«.</li>
</ul>
]]></content>
      <categories>
        <category>webpack</category>
      </categories>
      <tags>
        <tag>webpack</tag>
      </tags>
  </entry>
  <entry>
    <title>think of react</title>
    <url>/2022/11/17/think-of-react/</url>
    <content><![CDATA[<h1 id="react"><a href="#react" class="headerlink" title="react"></a>react</h1><h4 id="ç‰¹æ€§"><a href="#ç‰¹æ€§" class="headerlink" title="ç‰¹æ€§"></a>ç‰¹æ€§</h4><ul>
<li>æ•°æ®é©±åŠ¨</li>
<li>JSX è¯­æ³•ç³–åŠ¨æ€å£°æ˜æ›´åŠ çµæ´»</li>
<li>Virtual DOM ä¸ Diff ç®—æ³•é…åˆä½¿ç”¨,å¯ä¿è¯æ€§èƒ½</li>
<li>Fiber çš„ä»»åŠ¡è°ƒåº¦å’Œæ•°æ®ç»“æ„ä»¤ react çš„æ€§èƒ½æ›´å‡ºè‰²</li>
</ul>
<h4 id="åŸºäº-class"><a href="#åŸºäº-class" class="headerlink" title="åŸºäº class"></a>åŸºäº class</h4><ul>
<li>ç”Ÿå‘½å‘¨æœŸ<ul>
<li>åˆ›å»ºé˜¶æ®µ<ul>
<li>constructor: åˆå§‹åŒ–</li>
<li>getDerivedStateFromProps: åˆå¹¶ç»„ä»¶å¤–çš„ props è‡³ç»„ä»¶å†… state,ä¸æ¨èä½¿ç”¨</li>
<li>render: react ç»„ä»¶å†…å”¯ä¸€çš„æè¿° UI çš„æ–¹æ³•,å¿…é¡»è®¾ç½®</li>
<li>componentDidMount: åœ¨ç»„ä»¶é¦–æ¬¡æŒ‚è½½ç»“æŸä¹‹å,éœ€è¦å®è¡Œçš„å¦‚å¼‚æ­¥ http èµ„æºè¯·æ±‚çš„æ­¥éª¤</li>
</ul>
</li>
<li>æ›´æ–°é˜¶æ®µ<ul>
<li>getDerivedStateFromProps: åˆå¹¶ç»„ä»¶å¤–çš„ props è‡³ç»„ä»¶å†… state,ä¸æ¨èä½¿ç”¨</li>
<li>shouldComponentUpdate: åˆ¤æ–­ç»„ä»¶æ˜¯å¦å¯ä»¥å®è¡Œæ¸²æŸ“æ›´æ–°</li>
<li>getSnapShotBeforeUpdate: åœ¨ç»„ä»¶æ¸²æŸ“æ›´æ–°å‰éœ€è¦çš„ç»Ÿè®¡è®¡ç®—</li>
<li>render: react ç»„ä»¶å†…å”¯ä¸€çš„æè¿° UI çš„æ–¹æ³•,å¿…é¡»è®¾ç½®</li>
<li>componentDidUpdate: åœ¨ç»„ä»¶æ¸²æŸ“æ›´æ–°å®Œæˆåè¦æ‰§è¡Œçš„ä¸€äº›æ“ä½œ</li>
</ul>
</li>
<li>å¸è½½é˜¶æ®µ<ul>
<li>componentWillUnmount: åœ¨ç»„ä»¶å¸è½½æ—¶,ç”¨äºèµ„æºé‡Šæ”¾</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="Diff-ç®—æ³•"><a href="#Diff-ç®—æ³•" class="headerlink" title="Diff ç®—æ³•"></a>Diff ç®—æ³•</h4><blockquote>
<p>å¤æ‚åº¦</p>
</blockquote>
<p>  O(n ^ 3) -&gt; O(n),åªå¯¹æ¯”åŒå±‚å…„å¼Ÿç»„ä»¶èŠ‚ç‚¹,ä¸å®è¡Œè·¨å±‚èŠ‚ç‚¹å¯¹æ¯”</p>
<blockquote>
<p>èŠ‚ç‚¹</p>
</blockquote>
<ul>
<li>å±æ€§å˜åŒ–</li>
<li>ä½ç½®å˜åŒ–</li>
<li>ç±»å‹å˜åŒ–</li>
<li>è·¨å±‚ç§»åŠ¨</li>
</ul>
<p>  ä¸Šè¿°èŠ‚ç‚¹çš„å˜åŒ–,react å¤„ç†çš„éƒ½å¾ˆç®€å•ç²—æš´,ä¸ä¼šå®ç°è·¨å±‚æ£€ç´¢æ ¡éªŒ,åªæ˜¯è¿›è¡Œç®€å•çš„å¢åŠ ã€åˆ é™¤ä»¥åŠæ›¿æ¢,è€Œè¿™ç§æƒ…å†µæ˜¯å»ºç«‹åœ¨ Virtual DOM ç»“æ„ä¸€èˆ¬æ¯”è¾ƒç¨³å®š,åŸºæœ¬ä¸Šä¸ä¼šå‡ºç°è·¨å±‚ç§»åŠ¨çš„æƒ…å†µ,å¤§å¤šæ˜¯åŒå±‚çš„å±æ€§ã€ä½ç½®ä»¥åŠç±»å‹çš„å˜åŒ–</p>
<blockquote>
<p>key</p>
</blockquote>
<p>  key é€‚ç”¨äºé‚£äº›éœ€è¦é¢‘ç¹å˜æ¢ä½ç½®çš„ç»„ä»¶èŠ‚ç‚¹,ç¨³å®šçš„ç±»å‹æŒ‡å‘ä¼šä¿è¯è¿™äº›ç»„ä»¶èŠ‚ç‚¹ä¸ä¼šè¢«å‰ƒæ‰åˆ é™¤,æ›´ä¸ä¼šé¢å¤–å¢åŠ  DOM æ“ä½œå¼€é”€,è€Œåªæ˜¯æ›¿æ¢ä½ç½®è€Œå·²</p>
<h4 id="HOC"><a href="#HOC" class="headerlink" title="HOC"></a>HOC</h4><blockquote>
<p>ç‰¹æ€§</p>
</blockquote>
<ul>
<li>å±æ€§ä»£ç†</li>
<li>åå‘ç»§æ‰¿</li>
<li>æ¸²æŸ“åŠ«æŒ</li>
</ul>
<h4 id="class-ä¸-hooks"><a href="#class-ä¸-hooks" class="headerlink" title="class ä¸ hooks"></a>class ä¸ hooks</h4><blockquote>
<p>åŒºåˆ«</p>
</blockquote>
<ul>
<li>class<ul>
<li>åœ¨ react ä¸­å¾ˆå°‘ä½¿ç”¨ class ç±»çš„ç‰¹æ€§: new æ„é€ è°ƒç”¨ã€ç»§æ‰¿ä¸æ´¾ç”Ÿ</li>
<li>class çš„ react ç»„ä»¶å¤ç”¨è¿‡äºå¤æ‚,å¿…é¡»åŸºäº HOC,äº§ç”Ÿäº†å†—ä½™çš„é€»è¾‘,åˆ›å»ºäº†ä¸å¿…è¦çš„ç»„ä»¶èŠ‚ç‚¹</li>
<li>class å°†ä¸šåŠ¡é€»è¾‘å…¨éƒ¨åˆ†æ•£åœ¨å„ä¸ªç”Ÿå‘½å‘¨æœŸä¸­,æ›´å…³æ³¨äºæŠ€æœ¯éƒ¨åˆ†çš„é€»è¾‘</li>
</ul>
</li>
<li>hooks<ul>
<li>react ç»„ä»¶å¤ç”¨æ›´åŠ ç®€æ´,ä¸ä¼šäº§ç”Ÿé¢å¤–çš„é€»è¾‘,æ›´ä¸ä¼šåˆ›å»ºå¤šä½™çš„ç»„ä»¶èŠ‚ç‚¹</li>
<li>æ›´å…³æ³¨äºä¸šåŠ¡ä¸æŠ€æœ¯çš„é€»è¾‘å½»åº•åˆ†ç¦»</li>
</ul>
</li>
</ul>
<h4 id="hooks"><a href="#hooks" class="headerlink" title="hooks"></a>hooks</h4><blockquote>
<p>åˆ†ç±»</p>
</blockquote>
<ul>
<li>useState<ul>
<li>ç”¨äºç»´æŒç»„ä»¶çš„çŠ¶æ€</li>
<li>ä¸€æ—¦ç»„ä»¶æ‹¥æœ‰äº†çŠ¶æ€,é‚£ä¹ˆæ¯ä¸€æ¬¡ä½¿ç”¨æ—¶éƒ½ä¼šå­˜åœ¨æ¢å¤çŠ¶æ€çš„è¿‡ç¨‹</li>
</ul>
</li>
<li>useEffect<ul>
<li>ç”¨äºåˆ©ç”¨å‰¯ä½œç”¨</li>
<li>åŒ…å«äº†åŸºäº class ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸ: componentDidMountã€componentDidUpdateã€componentWillUnmount</li>
<li>åŸºäºä¾èµ–é¡¹æ•°ç»„å†…çš„æ•°ç»„å…ƒç´ å‘ç”Ÿæ”¹å˜,å›è°ƒå‡½æ•°æ‰ä¼šæ‰§è¡Œ<ul>
<li>ä¾èµ–é¡¹æ•°ç»„å†…çš„æ•°ç»„å…ƒç´ å¿…é¡»åœ¨å›è°ƒå‡½æ•°å†…ä½¿ç”¨,æ‰ä¼šå…·æœ‰æ„ä¹‰</li>
<li>ä¾èµ–é¡¹æ•°ç»„å¿…é¡»æ˜¯ä¸€ä¸ªå¸¸é‡æ•°ç»„,ä¸èƒ½ä¸ºå˜é‡</li>
<li>ä¾èµ–é¡¹æ•°ç»„å†…çš„æ•°ç»„å…ƒç´ ä¸å¯ä¸ºå¼•ç”¨ç±»å‹çš„æ•°æ®</li>
</ul>
</li>
</ul>
</li>
<li>useCallback<ul>
<li>ç”¨äºç¼“å­˜å›è°ƒå‡½æ•°</li>
<li>ä¸ºäº†é¿å…ä¸å¿…è¦çš„åˆ›å»ºå›è°ƒå‡½æ•°å’Œ react ç»„ä»¶çš„æ¸²æŸ“æ›´æ–°</li>
</ul>
</li>
<li>useMemo<ul>
<li>ç”¨äºç¼“å­˜è®¡ç®—ç»“æœ</li>
<li>ä¸ºäº†é¿å…ä¸å¿…è¦çš„è®¡ç®—è¿‡ç¨‹å’Œ react ç»„ä»¶çš„æ¸²æŸ“æ›´æ–°</li>
<li>å¯æ¨¡æ‹Ÿ useCallback</li>
</ul>
</li>
<li>useRef<ul>
<li>ç”¨äºåœ¨å¤šæ¬¡æ¸²æŸ“ä¹‹é—´å­˜å‚¨ã€å…±äº«æ•°æ®</li>
<li>å¤§å¤šåº”ç”¨äºå­˜å‚¨ setTimeoutã€setInterval äº§ç”Ÿçš„ id,å†å°±æ˜¯åº”ç”¨äºå­˜å‚¨ DOM å¯¹è±¡</li>
</ul>
</li>
<li>useContext<ul>
<li>ç”¨äºå®ç°æ•°æ®ç»‘å®š,åœ¨æ¯ä¸€æ¬¡ç¥–å…ˆç»„ä»¶çš„æ•°æ®å‘ç”Ÿæ›´æ–°æ—¶,å­å­™ç”¨åˆ°æ­¤æ•°æ®çš„ç»„ä»¶éƒ½ä¼šè‡ªåŠ¨æ¸²æŸ“æ›´æ–°</li>
</ul>
</li>
</ul>
<blockquote>
<p>é™åˆ¶</p>
</blockquote>
<ul>
<li>hooks åªå¯åœ¨å‡½æ•°ç»„ä»¶æˆ–è€…å…¶ä»– hooks å†…ä½¿ç”¨</li>
<li>hooks åªå¯åœ¨å‡½æ•°ç»„ä»¶çš„é¡¶å±‚ä½œç”¨åŸŸå†…ä½¿ç”¨,ä¸å¯åœ¨å¾ªç¯ã€æ¡ä»¶åˆ¤æ–­æˆ–è€…åµŒå¥—å‡½æ•°å†…ä½¿ç”¨</li>
</ul>
<blockquote>
<p>æ··åˆ</p>
</blockquote>
<p>  è¦æƒ³åœ¨ react ç±»ç»„ä»¶ä¸­ä½¿ç”¨ hooks,é€šè¿‡ HOC çš„å±æ€§ä»£ç†å³å¯</p>
<h4 id="Fiber"><a href="#Fiber" class="headerlink" title="Fiber"></a>Fiber</h4><blockquote>
<p>æ¦‚å¿µ</p>
</blockquote>
<p>  ç”±äº react å¤„ç†ç»„ä»¶çš„æ¸²æŸ“æ›´æ–°æ˜¯åŒæ­¥çš„,é‚£ä¹ˆå½“åŒä¸€æ—¶é—´å†…æœ‰å¤§é‡çš„ react ç»„ä»¶éœ€è¦æ¸²æŸ“æ›´æ–°æ—¶,JS çº¿ç¨‹å¤„ç†çš„æ—¶é—´å¯èƒ½ä¼šå¾ˆé•¿,åœ¨è¿™æœŸé—´æµè§ˆå™¨ä¸ä¼šå“åº”ä»»ä½•äº‹ä»¶,å› ä¸º JS çº¿ç¨‹å’Œ GUI çº¿ç¨‹æ˜¯äº’æ–¥çš„,é‚£ä¹ˆ Fiber å°±æ˜¯ç”¨äºè§£å†³æ­¤ç±»é—®é¢˜çš„,Fiber ä¼šå°†é•¿æ—¶é—´çš„åŒæ­¥ä»»åŠ¡,åˆ‡å‰²æˆå¤šä¸ªå°çš„åŒæ­¥ä»»åŠ¡,å¯ç”¨æ–°çš„ä»»åŠ¡è°ƒåº¦å’Œæ•°æ®ç»“æ„</p>
<blockquote>
<p>ç‰¹æ€§</p>
</blockquote>
<ul>
<li>æ–°çš„ä»»åŠ¡è°ƒåº¦<ul>
<li>å½“å­˜åœ¨æœ‰é«˜ä¼˜å…ˆçº§çš„ä»»åŠ¡æ—¶,ä¼šå…ˆå°†æµè§ˆå™¨è®©å‡ºæ¥å“åº”,ç­‰æµè§ˆå™¨ç©ºé—²äº†,å†ç»§ç»­æ‰§è¡Œ</li>
</ul>
</li>
<li>æ–°çš„æ•°æ®ç»“æ„<ul>
<li>é‡‡ç”¨é“¾è¡¨ç»“æ„,å¯éšæ—¶ä¸­æ–­,ä¹Ÿå¯æ¥å›é‡è¿<ul>
<li>child: çˆ¶ç»„ä»¶æŒ‡å‘çš„ç¬¬ä¸€ä¸ªå­ç»„ä»¶çš„æŒ‡é’ˆ</li>
<li>return: æ‰€æœ‰çš„å­ç»„ä»¶éƒ½å­˜åœ¨æŒ‡å‘çˆ¶ç»„ä»¶çš„æŒ‡é’ˆ</li>
<li>sibling: åœ¨ç¬¬ä¸€ä¸ªç»„ä»¶ä¹‹å,æŒ‡å‘å…„å¼Ÿç»„ä»¶çš„æŒ‡é’ˆ</li>
</ul>
</li>
</ul>
</li>
</ul>
]]></content>
      <categories>
        <category>react</category>
      </categories>
      <tags>
        <tag>react</tag>
        <tag>source</tag>
      </tags>
  </entry>
  <entry>
    <title>javascript outline</title>
    <url>/2022/10/25/javascript-outline/</url>
    <content><![CDATA[<h1 id="javascript-outline"><a href="#javascript-outline" class="headerlink" title="javascript outline"></a>javascript outline</h1><h2 id="ES6"><a href="#ES6" class="headerlink" title="ES6"></a>ES6</h2><h3 id="var"><a href="#var" class="headerlink" title="var"></a>var</h3><ul>
<li>å˜é‡æå‡(ä¼šæå‰åˆ†é…æ ˆç©ºé—´å†…å­˜,ç”¨äºå­˜å‚¨åŸºæœ¬ç±»å‹æ•°æ®æˆ–è€…å¼•ç”¨ç±»å‹æŒ‡é’ˆ)</li>
<li>é‡å¤å£°æ˜</li>
<li>å…¨å±€ä½œç”¨åŸŸç»‘å®š</li>
</ul>
<h3 id="letã€const"><a href="#letã€const" class="headerlink" title="letã€const"></a>letã€const</h3><ul>
<li>ä¸å†æ‹¥æœ‰ var çš„ç¼ºé™·ç‰¹æ€§</li>
<li>TDZ(ä¸´æ—¶æ­»åŒº)</li>
<li>å—çº§ä½œç”¨åŸŸç»‘å®š</li>
</ul>
<h3 id="let"><a href="#let" class="headerlink" title="let"></a>let</h3><ul>
<li>å˜é‡å£°æ˜</li>
</ul>
<h3 id="const"><a href="#const" class="headerlink" title="const"></a>const</h3><ul>
<li>å¸¸é‡å£°æ˜</li>
<li>ä¼˜å…ˆå£°æ˜æœ€ä½³å®è·µ</li>
</ul>
<h3 id="å­—ç¬¦ä¸²"><a href="#å­—ç¬¦ä¸²" class="headerlink" title="å­—ç¬¦ä¸²"></a>å­—ç¬¦ä¸²</h3><blockquote>
<p>utf-8</p>
</blockquote>
<ul>
<li>2^8 ç ä½</li>
<li>åŸºæœ¬å¤šæ–‡ç§å¹³é¢</li>
<li>å­—ç¬¦ä½: charAt</li>
<li>å­—ç¬¦ç¼–ç : charCodeAt</li>
<li>ç¼–ç è½¬æ¢: fromCharCode</li>
</ul>
<blockquote>
<p>utf-16</p>
</blockquote>
<ul>
<li>2^16 ç ä½</li>
<li>è¾…åŠ©å¹³é¢</li>
<li>å­—ç¬¦ä¸²é•¿åº¦</li>
<li>æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…: u</li>
<li>å­—ç¬¦ç¼–ç : codePointAt</li>
<li>ç¼–ç è½¬æ¢: fromCodePoint</li>
</ul>
<blockquote>
<p>æ–¹æ³•</p>
</blockquote>
<ul>
<li>è·å–å­—ç¬¦å­ä¸²: startsWithã€endsWithã€includes</li>
<li>é‡å¤æ·»åŠ : repeat</li>
<li>å¡«å……æ‰©å±•å­—ç¬¦ä¸²<ul>
<li>padStart: ä»å­—ç¬¦ä¸²å·¦è¾¹å¡«å……æŒ‡å®šå­—ç¬¦(ä¸æŒ‡å®šä¸ºç©ºå­—ç¬¦),æ³¨æ„å¦‚æœå¡«å……çš„é•¿åº¦å°äºå­—ç¬¦ä¸²é•¿åº¦åˆ™ç›´æ¥è¿”å›æ­¤å­—ç¬¦ä¸²</li>
</ul>
</li>
</ul>
<blockquote>
<p>æ­£åˆ™è¡¨è¾¾å¼</p>
</blockquote>
<ul>
<li>ç²˜æ»æè¿°ç¬¦: y</li>
<li>åˆ¤æ–­æ˜¯å¦å­˜åœ¨ç²˜æ»æè¿°ç¬¦: sticky</li>
<li>è·å–æè¿°ç¬¦å†…å®¹: flags()</li>
<li>è·å–æ­£åˆ™å†…å®¹: source()</li>
<li>å¤åˆ¶æè¿°ç¬¦è¦†ç›–</li>
</ul>
<blockquote>
<p>æ¨¡æ¿å­—ç¬¦ä¸²</p>
</blockquote>
<ul>
<li>åŸºæœ¬è¯­æ³•(å ä½ç¬¦)</li>
<li>å¤šè¡Œå­—ç¬¦ä¸²</li>
</ul>
<blockquote>
<p>æ¨¡æ¿æ ‡ç­¾</p>
</blockquote>
<ul>
<li>å­—ç¬¦ä¸²é›†åˆé•¿åº¦ - å˜é‡é›†åˆé•¿åº¦ = 1</li>
<li>å­—ç¬¦ä¸²é›†åˆä¸­æ¯ä¸€ä¸ªå…ƒç´ éƒ½æ‹¥æœ‰è·å–å…¶åŸç”Ÿå†…å®¹çš„æ–¹æ³•: raw</li>
</ul>
<h3 id="å‡½æ•°"><a href="#å‡½æ•°" class="headerlink" title="å‡½æ•°"></a>å‡½æ•°</h3><ul>
<li>å‚æ•°çš„é»˜è®¤å€¼,æ³¨æ„ TDZ ä¸´æ—¶æ­»åŒº</li>
<li>ä¸å®šå‚æ•°,æ³¨æ„å‚æ•°é›†åˆå¿…é¡»åœ¨å‚æ•°æœ«å°¾</li>
<li>å±•å¼€è¿ç®—ç¬¦</li>
<li>åŠŸèƒ½å¢å¼ºçš„ Function æ„é€ å£°æ˜æ–¹å¼</li>
<li>name æ•è·å‡½æ•°çš„åç§°ä»¥ä¾¿äºå †æ ˆè¿½è¸ª</li>
<li>å…ƒå±æ€§: new.target, ç»‘å®šå†…ç½®å¯¹è±¡ [[Construct]],å½“å‡½æ•°æ‰§è¡Œè§¦å‘å†…ç½®å¯¹è±¡ [[Call]] æ—¶,è¿”å› undefined</li>
<li>å—çº§å‡½æ•°å£°æ˜</li>
</ul>
<blockquote>
<p>ç®­å¤´å‡½æ•°</p>
</blockquote>
<ul>
<li>ç‰¹æ€§<ul>
<li>æ—  thisã€superã€arguments ä»¥åŠ new.target</li>
<li>æ— åŸå‹é“¾</li>
<li>ä¸èƒ½ä½¿ç”¨ new æ„é€ è°ƒç”¨</li>
</ul>
</li>
<li>åŸºæœ¬è¯­æ³•</li>
<li>thisã€arguments ä¼šç»§æ‰¿è‡ªæœ€è¿‘è¯æ³•ä½œç”¨åŸŸæ‰§è¡Œæ—¶çš„ä¸Šä¸‹æ–‡å¯¹è±¡</li>
</ul>
<blockquote>
<p>å°¾è°ƒç”¨ä¼˜åŒ–</p>
</blockquote>
<ul>
<li>ç‰¹æ€§<ul>
<li>å¿…é¡»ä¸ºå‡½æ•°çš„æœ€åä¸€æ­¥æ‰§è¡Œ</li>
<li>æ‰§è¡Œçš„ç»“æœå¿…é¡»å®è¡Œè¿”å›</li>
<li>æ‰§è¡Œæ—¶ä¸å¾—è¿ç®—æˆ–è€…æ“ä½œå‡½æ•°è¯æ³•ä½œç”¨åŸŸå†…å˜é‡,é˜²æ­¢äº§ç”Ÿé—­åŒ…</li>
</ul>
</li>
<li>åŸç†: é¿å…å»ºç«‹å¤šå †æ ˆå­˜å‚¨,é˜²æ­¢å †æ ˆæº¢å‡ºã€å†…å­˜æ³„éœ²,å•å †æ ˆå¾ªç¯ä½¿ç”¨æé«˜æ•ˆç‡</li>
<li>åº”ç”¨: é€’å½’</li>
<li>è¿˜æ²¡æœ‰è¢«å¤§è§„æ¨¡æ¨è¡Œ,ç›®å‰åªåœ¨ safari æµè§ˆå™¨ä¸­å®ç°,å…¶ä»–æµè§ˆå™¨å¼€å‘ç¯å¢ƒåº”ç”¨æå…¶å®¹æ˜“å‘ç”Ÿå †æ ˆæº¢å‡ºã€å†…å­˜æ³„éœ²</li>
</ul>
<h3 id="å¯¹è±¡"><a href="#å¯¹è±¡" class="headerlink" title="å¯¹è±¡"></a>å¯¹è±¡</h3><ul>
<li>å¯¹è±¡å±æ€§æ–¹æ³•ç®€åŒ–</li>
<li>å¯è®¡ç®—çš„å¯¹è±¡å±æ€§æ–¹æ³•</li>
<li>æ–¹æ³•<ul>
<li>åˆ¤æ–­ä¸¤ä¸ªå€¼æ˜¯å¦ç›¸ç­‰: Object.is,æ³¨æ„é™¤äº† (+0,-0)ã€NaN ä¹‹å¤–,å…¶ä»–æ‰§è¡Œç»“æœä¸ === ç›¸åŒ</li>
<li>æµ…å¤åˆ¶: Object.assign</li>
</ul>
</li>
<li>é‡å¤å¯¹è±¡å±æ€§æ–¹æ³•</li>
<li>è‡ªæœ‰å±æ€§æ–¹æ³•æšä¸¾æ’åº: Object.getOwnPropertyNamesã€Reflect.ownKeysã€for-inã€JSON.stringifyã€Object.keys ä»¥åŠ Object.entries åœ¨å„å¤§å‚å•†éƒ½æ˜¯æŒ‰ç…§æ•°å­—æå‡å‡åºæ’åˆ—,å­—ç¬¦ä¸²æŒ‰ç…§æ·»åŠ é¡ºåºæ’åˆ—.</li>
<li>å¢å¼ºåŸå‹: Object.getPrototypeOfã€Object.setPrototypeOf</li>
<li>åŸå‹è®¿é—® Super å¼•ç”¨: åœ¨æ­£å¼çš„æ–¹æ³•ä¹Ÿå°±æ˜¯ç®€åŒ–çš„å¯¹è±¡æ–¹æ³•å†…,super å¼•ç”¨å¯ç›´æ¥ç»‘å®š [[HomeObject]] è®¿é—®åŸå‹.</li>
</ul>
<h3 id="è§£æ„èµ‹å€¼"><a href="#è§£æ„èµ‹å€¼" class="headerlink" title="è§£æ„èµ‹å€¼"></a>è§£æ„èµ‹å€¼</h3><ul>
<li>å¯¹è±¡è§£æ„<ul>
<li>è§£æ„èµ‹å€¼</li>
<li>é»˜è®¤å€¼</li>
<li>éåŒåå˜é‡èµ‹å€¼</li>
<li>åµŒå¥—è§£æ„</li>
</ul>
</li>
<li>æ•°ç»„è§£æ„<ul>
<li>è§£æ„èµ‹å€¼</li>
<li>é»˜è®¤å€¼</li>
<li>åµŒå¥—è§£æ„</li>
<li>ä¸å®šå…ƒç´ ,æ³¨æ„è·Ÿä¸å®šå‚æ•°ä¸€è‡´,å…ƒç´ é›†åˆå¿…é¡»åœ¨æ•°ç»„æœ«å°¾</li>
</ul>
</li>
<li>æ··åˆè§£æ„</li>
<li>è§£æ„å‚æ•°<ul>
<li>å¿…é¡»ä¼ å€¼</li>
<li>é»˜è®¤å€¼</li>
</ul>
</li>
</ul>
<h3 id="Symbol"><a href="#Symbol" class="headerlink" title="Symbol"></a>Symbol</h3><ul>
<li>åŸºæœ¬ç”¨æ³•,æ³¨æ„ç»‘å®šäºå†…ç½®å¯¹è±¡ [[Description]] å†…</li>
<li>å…±äº«ä½“ç³»: Symbol.forã€Symbol.keyFor</li>
<li>å±æ€§éå†: Object.getOwnPropertySymbolsã€Reflect.ownKeys</li>
<li>wellKnown-Symbols<ul>
<li>Symbol.hasInstance: ä½œä¸ºæ–¹æ³•,ç”¨äºé‡æ–°å®šä¹‰ instanceof,åˆ¤æ–­æ„é€ å¯¹è±¡æ˜¯å¦åœ¨åŸå‹é“¾ä¸Š</li>
<li>Symbol.isConcatSpreadable: ä½œä¸ºå±æ€§,ç”¨äºé‡æ–°å®šä¹‰ç±»æ•°ç»„å¯¹è±¡,åˆ¤æ–­å…¶æ˜¯å¦å¯è¢«åˆå¹¶</li>
<li>Symbol.searchã€Symbol.replaceã€Symbol.matchã€Symbol.split: ä½œä¸ºæ–¹æ³•,ç”¨äºé‡æ–°å®šä¹‰å­—ç¬¦ä¸²æŸ¥æ‰¾ã€æ›¿æ¢ã€åŒ¹é…ä»¥åŠåˆ†å‰²æ–¹æ³•</li>
<li>Symbol.toPrimitive: ä½œä¸ºæ–¹æ³•,ç”¨äºé‡æ–°å®šä¹‰å¯¹è±¡å¼ºåˆ¶ç±»å‹è½¬æ¢åçš„ç»“æœ(åŒ…å«æ•°å­—æ¨¡å¼ä»¥åŠå­—ç¬¦ä¸²æ¨¡å¼è½¬æ¢)</li>
<li>Symbol.toStringTag: ä½œä¸ºå±æ€§,ç”¨äºé‡æ–°å®šä¹‰å¯¹è±¡ç±»å‹è¯†åˆ«</li>
</ul>
</li>
</ul>
<h3 id="Set"><a href="#Set" class="headerlink" title="Set"></a>Set</h3><ul>
<li>åŸºæœ¬ç”¨æ³•</li>
<li>å±æ€§<ul>
<li>size: è·å–é›†åˆçš„é•¿åº¦</li>
</ul>
</li>
<li>æ–¹æ³•<ul>
<li>add: å‘é›†åˆå†…æ·»åŠ æ•°æ®</li>
<li>has: åˆ¤æ–­é›†åˆå†…æ˜¯å¦å­˜åœ¨æŒ‡å®šæ•°æ®</li>
<li>delete: åˆ é™¤é›†åˆå†…æŒ‡å®šæ•°æ®</li>
<li>clear: æ¸…ç©ºé›†åˆå†…æ‰€æœ‰æ•°æ®</li>
<li>forEach: å¾ªç¯é›†åˆå†…æ•°æ®ã€æ•°æ®ç´¢å¼•å®è¡Œæ“ä½œ</li>
<li>keys: å¾ªç¯é›†åˆå†…æ•°æ®ç´¢å¼•å®è¡Œæ“ä½œ</li>
<li>values: å¾ªç¯é›†åˆå†…æ•°æ®å®è¡Œæ“ä½œ</li>
<li>entries: å¾ªç¯é›†åˆå†…æ•°æ®ç´¢å¼•ã€æ•°æ®å®è¡Œæ“ä½œ,ç±»ä¼¼äº forEach</li>
</ul>
</li>
<li>åˆå§‹åŒ–å£°æ˜å¹¶æ·»åŠ æ•°æ®: new Set([])</li>
<li>è½¬åŒ–ä¸ºæ•°ç»„: [â€¦set],æ³¨æ„ set æ„é€ å¯¹è±¡å¿…é¡»é…åˆæ•°ç»„ã€å±•å¼€è¿ç®—ç¬¦æ‰å¯å®è¡Œè½¬åŒ–</li>
</ul>
<h3 id="WeakSet"><a href="#WeakSet" class="headerlink" title="WeakSet"></a>WeakSet</h3><ul>
<li>åŸºæœ¬ç”¨æ³•</li>
<li>åŒºåˆ«<ul>
<li>åªèƒ½å‘å¼±ç±»å‹é›†åˆä¸­æ·»åŠ å¼•ç”¨ç±»å‹æ•°æ®</li>
<li>sizeã€clearã€forEachã€keysã€values ä»¥åŠ entries å¤±æ•ˆ</li>
<li>ä¸€æ—¦ä¸æ·»åŠ çš„å¼•ç”¨ç±»å‹æ•°æ®å¤±å»ç»‘å®šæˆ–è€…å¼•ç”¨ç±»å‹æ•°æ®å¤±æ•ˆ,é›†åˆå†…å¼•ç”¨ç±»å‹æ•°æ®å°±ä¼šè¢«é‡Šæ”¾å¹¶è¢«åƒåœ¾å›æ”¶æœºåˆ¶åŠæ—¶æ¸…ç†,é˜²æ­¢å †æ ˆæº¢å‡ºã€å†…å­˜æ³„éœ²</li>
</ul>
</li>
</ul>
<h3 id="Map"><a href="#Map" class="headerlink" title="Map"></a>Map</h3><ul>
<li>åŸºæœ¬ç”¨æ³•</li>
<li>å±æ€§<ul>
<li>size: è·å–å­—å…¸çš„å¤§å°</li>
</ul>
</li>
<li>æ–¹æ³•<ul>
<li>set: å‘å­—å…¸ä¸­æ·»åŠ æ˜ å°„ã€æ•°æ®</li>
<li>get: æ ¹æ®æŒ‡å®šæ˜ å°„è·å–å­—å…¸å†…ç›¸å¯¹åº”çš„æ•°æ®</li>
<li>has: æ ¹æ®æŒ‡å®šæ˜ å°„åˆ¤æ–­å­—å…¸å†…æ˜¯å¦å­˜åœ¨ç›¸å¯¹åº”çš„æ•°æ®</li>
<li>delete: æ ¹æ®æŒ‡å®šæ˜ å°„åˆ é™¤å­—å…¸å†…ç›¸å¯¹åº”çš„æ•°æ®</li>
<li>clear: æ¸…ç©ºå­—å…¸å†…æ‰€æœ‰çš„æ˜ å°„ã€æ•°æ®</li>
<li>forEach: å¾ªç¯å­—å…¸å†…æ•°æ®ã€æ˜ å°„å®è¡Œæ“ä½œ</li>
<li>keys: å¾ªç¯å­—å…¸å†…æ˜ å°„å®è¡Œæ“ä½œ</li>
<li>values: å¾ªç¯å­—å…¸å†…æ•°æ®å®è¡Œæ“ä½œ</li>
<li>entries: å¾ªç¯å­—å…¸å†…æ˜ å°„ã€æ•°æ®å®è¡Œæ“ä½œ,ç±»ä¼¼äº forEach</li>
</ul>
</li>
<li>åˆå§‹åŒ–å£°æ˜å¹¶æ·»åŠ æ˜ å°„ã€æ•°æ®: new Map([[]])</li>
</ul>
<h3 id="WeakMap"><a href="#WeakMap" class="headerlink" title="WeakMap"></a>WeakMap</h3><ul>
<li>åŸºæœ¬ç”¨æ³•</li>
<li>åŒºåˆ«<ul>
<li>åªèƒ½å‘å¼±ç±»å‹å­—å…¸ä¸­æ·»åŠ å¼•ç”¨ç±»å‹çš„æ˜ å°„ä»¥åŠæ‰€å¯¹åº”çš„æ•°æ®</li>
<li>sizeã€clearã€forEachã€keysã€values ä»¥åŠ entries å¤±æ•ˆ</li>
<li>ä¸€æ—¦ä¸æ·»åŠ çš„å¼•ç”¨ç±»å‹æ˜ å°„å¤±å»ç»‘å®šæˆ–è€…å¼•ç”¨ç±»å‹æ˜ å°„å¤±æ•ˆ,å­—å…¸å†…æ˜ å°„ä»¥åŠæ‰€å¯¹åº”çš„æ•°æ®å°±ä¼šè¢«é‡Šæ”¾å¹¶è¢«åƒåœ¾å›æ”¶æœºåˆ¶åŠæ—¶æ¸…ç†,é˜²æ­¢å †æ ˆæº¢å‡ºã€å†…å­˜æ³„éœ²</li>
<li>ç§æœ‰æ•°æ®<ul>
<li>ES5 ä½¿ç”¨ç§æœ‰å¯¹è±¡ä¿å­˜,é—­åŒ…äº§ç”Ÿçš„å†…å­˜æ•°æ®æ°¸è¿œæ— æ³•è¢«æ¸…é™¤,ä¹…è€Œä¹…ä¹‹ä¼šå‡ºç°å †æ ˆæº¢å‡ºã€å†…å­˜æ³„éœ²</li>
<li>ES6 ä½¿ç”¨ WeakMap ä¿å­˜æ›´åŠ ç®€æ´,ä¸ä¼šäº§ç”Ÿä»»ä½•å †æ ˆæº¢å‡ºã€å†…å­˜æ³„éœ²çš„é—®é¢˜</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="Iterator"><a href="#Iterator" class="headerlink" title="Iterator"></a>Iterator</h3><ul>
<li>åŸºæœ¬ç”¨æ³•,æ³¨æ„å¯ä»¥æ¨¡æ‹Ÿè¿­ä»£å™¨</li>
<li>è®¿é—®é»˜è®¤è¿­ä»£å™¨: å¯è¿­ä»£çš„å¯¹è±¡(æ•°ç»„ã€é›†åˆã€å­—å…¸ä»¥åŠå­—ç¬¦ä¸²ç­‰)è°ƒç”¨ [Symbol.iterator]() å³å¯</li>
<li>åˆ›é€ å¯è¿­ä»£å¯¹è±¡: å®é™…ä¸Šå°±æ˜¯å¯¹äºæ™®é€šå¯¹è±¡æ¨¡æ‹Ÿè¿­ä»£å™¨,{*[Symbol.iterator]() {yield *Object.values(this);}},æ³¨æ„è¿™é‡Œè¿˜ä½¿ç”¨äº†å§”æ‰˜ç”Ÿæˆå™¨</li>
<li>å¯è¿­ä»£å¯¹è±¡<ul>
<li>æ•°ç»„: é»˜è®¤è¿­ä»£å™¨æ˜¯é’ˆå¯¹æ•°ç»„å…ƒç´ ,å®é™…ä¸Šè°ƒç”¨çš„æ˜¯å…¶ values æ–¹æ³•</li>
<li>é›†åˆ: é»˜è®¤è¿­ä»£å™¨æ˜¯é’ˆå¯¹é›†åˆæ•°æ®,å®é™…ä¸Šè°ƒç”¨çš„æ˜¯å…¶ values æ–¹æ³•</li>
<li>å­—å…¸: é»˜è®¤è¿­ä»£å™¨æ˜¯é’ˆå¯¹å­—å…¸æ˜ å°„ä»¥åŠå…¶æ‰€å¯¹åº”çš„æ•°æ®,å®é™…ä¸Šè°ƒç”¨çš„æ˜¯å…¶ entries æ–¹æ³•</li>
<li>å­—ç¬¦ä¸²: é»˜è®¤è¿­ä»£å™¨æ˜¯é’ˆå¯¹å­—ç¬¦ä¸²ä¸­çš„å­—ç¬¦,æ³¨æ„è¿™é‡Œå·²ç»æ‰©å±•è‡³ UTF-16 èŒƒå›´å†…çš„å­—ç¬¦</li>
<li>NodeList å¯¹è±¡: é»˜è®¤è¿­ä»£å™¨æ˜¯é’ˆå¯¹ NodeList é›†åˆä¸­çš„èŠ‚ç‚¹å…ƒç´ </li>
</ul>
</li>
</ul>
<h3 id="Generator"><a href="#Generator" class="headerlink" title="Generator"></a>Generator</h3><ul>
<li>åŸºæœ¬ç”¨æ³•</li>
<li>ç”Ÿæˆå™¨å‡½æ•°è¡¨è¾¾å¼</li>
<li>ç”Ÿæˆå™¨å¯¹è±¡æ–¹æ³•</li>
<li>å‘è¿­ä»£å™¨ä¼ é€’å‚æ•°</li>
<li>åœ¨è¿­ä»£å™¨ä¸­æŠ›å‡ºé”™è¯¯,æ³¨æ„æŠ›å‡ºé”™è¯¯å,åœ¨æ²¡æœ‰ try-catch çš„æƒ…å†µä¸‹,ä¼šç›´æ¥åœæ­¢è¿è¡Œ,ä¸å†ç»§ç»­è¿­ä»£</li>
<li>åœ¨ç”Ÿæˆå™¨ä¸­è¿”å›è¯­å¥</li>
<li>å§”æ‰˜ç”Ÿæˆå™¨,æ³¨æ„å¯¹äºæ•°ç»„ã€å‡½æ•°çš„å§”æ‰˜ç”Ÿæˆ,ä¼šå¯¹å…¶ä¸­çš„å¯è¿­ä»£å…ƒç´ åˆ†åˆ«è¿­ä»£</li>
<li>å¼‚æ­¥ç”Ÿæˆå™¨,æ³¨æ„å¼‚æ­¥æ‰§è¡Œæ—¶çš„äº‹ä»¶å¾ªç¯æ‰§è¡Œæœºåˆ¶</li>
</ul>
<h3 id="class"><a href="#class" class="headerlink" title="class"></a>class</h3><ul>
<li>åŸºæœ¬ç”¨æ³•</li>
<li>ç‰¹æ€§<ul>
<li>å­˜åœ¨ TDZ ä¸´æ—¶æ­»åŒº</li>
<li>ç±»èµ‹å€¼ä¸å¯åœ¨ç±»å†…éƒ¨å®è¡Œä¿®æ”¹</li>
<li>åªå¯ä½¿ç”¨ new æ„é€ è°ƒç”¨</li>
<li>ç±»åŸå‹é“¾ä¸Šçš„æ–¹æ³•ä¸å¯æšä¸¾ä¸”ä¸å¯ä½¿ç”¨ new æ„é€ è°ƒç”¨</li>
<li>ç±»åŸå‹é“¾ä¸Šçš„è®¿é—®å™¨å±æ€§ä¸å¯æšä¸¾</li>
<li>ç›¸å¯¹äº ES5 ç»§æ‰¿æ—¶,ç»§æ‰¿æ˜¯åŸºäºæ´¾ç”Ÿç±»çš„ this,çˆ¶ç±»åªæ˜¯åœ¨æ­¤åŸºç¡€ä¸Šå®è¡Œä¿®é¥°,ES6 çš„ç»§æ‰¿åˆ™æ˜¯æ°¸è¿œåŸºäºçˆ¶ç±»çš„ this,æ´¾ç”Ÿç±»æ˜¯åœ¨æ­¤åŸºç¡€ä¸Šå®è¡Œä¿®æ”¹,ä¸¤å¥—ç»§æ‰¿æ¨¡å¼å®Œå…¨ç›¸å</li>
</ul>
</li>
<li>ç±»è¡¨è¾¾å¼</li>
<li>å‘½åçš„ç±»è¡¨è¾¾å¼</li>
<li>ç±»ä½œä¸ºå‚æ•°ä¼ é€’</li>
<li>ç±»å£°æ˜çš„åŒæ—¶å®è¡Œ new æ„é€ è°ƒç”¨</li>
<li>ç±»çš„è®¿é—®å™¨å±æ€§</li>
<li>å¯è®¡ç®—çš„ç±»æˆå‘˜</li>
<li>ç”Ÿæˆå™¨æ–¹æ³•: æ³¨æ„å¯åˆ›ä½œå¯è¿­ä»£æ„é€ å¯¹è±¡</li>
<li>ç±»é™æ€æˆå‘˜</li>
<li>ç»§æ‰¿ä¸æ´¾ç”Ÿ<ul>
<li>æ´¾ç”Ÿç±»çš„æ–¹æ³•é®è”½</li>
<li>æ´¾ç”Ÿç±»æ‰€ç»§æ‰¿çš„è®¿é—®å™¨å±æ€§</li>
<li>æ´¾ç”Ÿç±»æ‰€ç»§æ‰¿çš„é™æ€æˆå‘˜</li>
<li>ç»§æ‰¿è‡ªæ™®é€šå‡½æ•°æˆ–è€…å‡½æ•°è¡¨è¾¾å¼</li>
<li>å†…ç½®å¯¹è±¡ç»§æ‰¿</li>
<li>Symbol.species: ä½œä¸ºé™æ€çš„è®¿é—®å™¨å±æ€§,ç”¨äºé‡æ–°è‡ªå®šä¹‰åˆ›å»ºæ´¾ç”Ÿç±»å¯¹è±¡,ç¡®å®šå€¼ç±»å‹</li>
</ul>
</li>
<li>å…ƒå±æ€§ new.target åœ¨ç±»ä¸­çš„ä½¿ç”¨<ul>
<li>æŠ½è±¡åŸºç±»</li>
</ul>
</li>
</ul>
<h3 id="æ”¹è¿›çš„æ•°ç»„"><a href="#æ”¹è¿›çš„æ•°ç»„" class="headerlink" title="æ”¹è¿›çš„æ•°ç»„"></a>æ”¹è¿›çš„æ•°ç»„</h3><ul>
<li>Array.of: ç”¨äºè§„æ•´æ•°ç»„å£°æ˜æ—¶æ··ä¹±æ„ä¹‰çš„å‚æ•°,æ³¨æ„ Array.of åˆ›å»ºçš„ç±»å¯¹è±¡å¹¶ä¸æ˜¯ç”±é™æ€è®¿é—®å™¨å±æ€§ [Symbol.species] æ¥ç¡®å®šå€¼ç±»å‹,è€Œæ˜¯ç›´æ¥ç»‘å®šè‡³æ„é€ å¯¹è±¡ this ä¸Š,ç”±æ„é€ å‡½æ•°æ¥ç¡®å®šå€¼ç±»å‹</li>
<li>Array.from: ç”¨äºå°†å¯è¿­ä»£å¯¹è±¡ä»¥åŠç±»æ•°ç»„å¯¹è±¡è½¬åŒ–ä¸ºæ•°ç»„,åŒæ—¶å¯å®è¡Œæ“ä½œ,å¹¶å¯æ”¹å˜æ“ä½œå‡½æ•°çš„ this ç»‘å®š,æ³¨æ„ Array.from åˆ›å»ºçš„ç±»å¯¹è±¡å¹¶ä¸æ˜¯ç”±é™æ€è®¿é—®å™¨å±æ€§ [Symbol.species] æ¥ç¡®å®šå€¼ç±»å‹,è€Œæ˜¯ç›´æ¥ç»‘å®šè‡³æ„é€ å¯¹è±¡ this ä¸Š,ç”±æ„é€ å‡½æ•°æ¥ç¡®å®šå€¼ç±»å‹</li>
<li>æ–¹æ³•<ul>
<li>find: åŒ¹é…ç¬¦åˆæ¡ä»¶çš„ç¬¬ä¸€ä¸ªæ•°ç»„å…ƒç´ </li>
<li>findIndex: åŒ¹é…ç¬¦åˆæ¡ä»¶çš„ç¬¬ä¸€ä¸ªæ•°ç»„å…ƒç´ ä¸‹æ ‡</li>
<li>fill: å‘æŒ‡å®šçš„æ•°ç»„ä½ç½®å¡«å……è¦†ç›–æŒ‡å®šçš„æ•°æ®</li>
<li>copyWithin: å‘æŒ‡å®šçš„æ•°ç»„ä½ç½®å¡«å……è¦†ç›–æŒ‡å®šæ•°ç»„èŒƒå›´çš„æ•°æ®</li>
<li>includes: ç”¨äºåˆ¤æ–­æ•°ç»„å†…æ˜¯å¦å«æœ‰æŸä¸ªæ•°æ®</li>
<li>fromEntries: ç”¨äºå°†äºŒç»´å¯è¿­ä»£å¯¹è±¡æˆ–è€…äºŒç»´ç±»æ•°ç»„å¯¹è±¡è½¬æ¢ä¸ºæ™®é€šå¯¹è±¡</li>
</ul>
</li>
<li>å®šå‹æ•°ç»„<ul>
<li>åˆ›å»ºæ–¹å¼<ul>
<li>ä½¿ç”¨è‡ªå®šä¹‰æ•°ç»„ç¼“å†²åŒºåˆ›å»ºè§†å›¾</li>
<li>ä½¿ç”¨å®šå‹æ•°ç»„å£°æ˜åˆ›å»º</li>
<li>ä½¿ç”¨å·²å£°æ˜çš„å®šå‹æ•°ç»„æ„é€ å¯¹è±¡åˆ›å»º<ul>
<li>æ³¨æ„,ä¸Šè¿°åˆ›å»ºæ–¹å¼éƒ½å¯æŒ‡å®šå­—èŠ‚åç§»é‡ã€ä»¥åŠå­—èŠ‚é•¿åº¦</li>
</ul>
</li>
</ul>
</li>
<li>åŒºåˆ«<ul>
<li>ç›¸ä¼¼ä¹‹å¤„<ul>
<li>é€šç”¨æ–¹æ³•<ul>
<li>map</li>
<li>forEach</li>
<li>keys</li>
<li>values</li>
<li>entries</li>
<li>some</li>
<li>every</li>
<li>filter</li>
<li>reduce</li>
<li>reduceRight</li>
<li>indexOf</li>
<li>lastIndexOf</li>
<li>join</li>
<li>reverse</li>
<li>sort</li>
<li>find</li>
<li>findIndex</li>
<li>fill</li>
<li>copyWithin</li>
</ul>
</li>
<li>åŒå±äºå¯è¿­ä»£å¯¹è±¡,å¯ä½¿ç”¨å±•å¼€è¿ç®—ç¬¦</li>
</ul>
</li>
<li>ä¸åŒä¹‹å¤„<ul>
<li>å®šå‹æ•°ç»„ç¼ºå¤±æ–¹æ³•<ul>
<li>push</li>
<li>pop</li>
<li>shift</li>
<li>unshift</li>
<li>concat</li>
<li>splice</li>
</ul>
</li>
<li>å®šå‹æ•°ç»„ç¼ºå¤±ç‰¹æ€§<ul>
<li>æ•°ç»„å…ƒç´ ä¸å¯æ‰©å±•</li>
<li>æ•°ç»„é•¿åº¦ä¸å¯é…ç½®ã€ä¸å¯ä¿®æ”¹</li>
</ul>
</li>
<li>å®šå‹æ•°ç»„ç‰¹æœ‰æ–¹æ³•<ul>
<li>set: ç”¨äºå‘å®šå‹æ•°ç»„ä¸­è¦†ç›–æŒ‡å®šèŒƒå›´çš„æ•°ç»„å…ƒç´ </li>
<li>subarray: ç±»ä¼¼äº slice æ–¹æ³•,ç”¨äºæˆªå–å®šå‹æ•°ç»„</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="promise"><a href="#promise" class="headerlink" title="promise"></a>promise</h3><ul>
<li>åŸºæœ¬ç”¨æ³•: æ³¨æ„ promise æ˜¯ç»‘å®šè‡³å†…ç½®å¯¹è±¡ [[PromiseState]] å†…<ul>
<li>pending: å¤„ç†ä¸­</li>
<li>fulfilled: å¤„ç†å®Œæˆ</li>
<li>rejected: æ‹’ç»å¤„ç†</li>
</ul>
</li>
<li>åˆ›å»ºæœªå®Œæˆçš„ Promise: new Promise((resolve, reject) =&gt; {})</li>
<li>åˆ›å»ºå·²å¤„ç†çš„ Promise: Promise.resolve,Promise.reject,æ³¨æ„å¯¹äº Promise.resolve å¦‚æœä¼ å…¥ Promise å‚æ•°,åˆ™ä¼šå°†æ­¤ Promise ç›´æ¥è¿”å›</li>
<li>å…¨å±€ Promise æ‹’ç»å¤„ç†ç¨‹åº: åœ¨äº‹ä»¶å¾ªç¯æ‰§è¡Œæœºåˆ¶ä¸­,è‹¥ Promise è¢«æ‹’ç»,ä¸”æ²¡æœ‰æ‹’ç»å¤„ç†ç¨‹åºæ—¶,ä¼šè§¦å‘æ‰§è¡Œ unhandledRejection äº‹ä»¶; è‹¥ Promise è¢«æ‹’ç»,ä¸”ç›‘å¬åˆ°æ‹’ç»å¤„ç†ç¨‹åºæ—¶,åˆ™ä¼šè§¦å‘ rejectionHandled äº‹ä»¶,æ³¨æ„è‹¥åŒæ­¥ç«‹å³è®¾ç½®æ‹’ç»å¤„ç†ç¨‹åº,åˆ™ä¸ä¼šè§¦å‘ä»»ä½•äº‹ä»¶<ul>
<li>unhandledRejection: åœ¨ Node.js ä¸­ä½¿ç”¨ process.on ç›‘å¬,åœ¨ web ä¸­åˆ™æ˜¯è§¦å‘ window äº‹ä»¶ onunhandledrejection</li>
<li>rejectionHandled: åœ¨ Node.js ä¸­ä½¿ç”¨ process.on ç›‘å¬,åœ¨ web ä¸­åˆ™æ˜¯è§¦å‘ window äº‹ä»¶ onrejectionhandled</li>
</ul>
</li>
<li>Promise æ‰§è¡ŒæŠ›å‡ºé”™è¯¯: ä½¿ç”¨ catch æ‹¦æˆª</li>
<li>Promise ä¸²è¡Œé“¾<ul>
<li>åœ¨ Promise é“¾ä¸­æŠ›å‡ºé”™è¯¯</li>
<li>åœ¨ Promise é“¾ä¸­çš„è¿”å›å€¼</li>
<li>åœ¨ Promise é“¾ä¸­è¿”å› Promise</li>
</ul>
</li>
<li>Promise.all: å½“ Promise æ•°ç»„ä¸­çš„æ¯ä¸€ä¸ªå¤„ç†éƒ½å®Œæˆæ—¶,æ‰ä¼šå®è¡Œè¿”å›,æ¥æ”¶åˆ°çš„æ•°æ®ä¹Ÿæ‰æ˜¯ä¸€ä¸ªæ•°ç»„,åˆ†åˆ«ä»£è¡¨ç€æ¯ä¸€ä¸ªå®Œæˆå¤„ç†ä¼ é€’çš„æ•°æ®,ä¸€æ—¦å­˜åœ¨æœ‰ä¸€ä¸ªæ‹’ç»å¤„ç†,åˆ™ä¼šç«‹å³è¿”å›,æ¥æ”¶çš„å°†æ˜¯æ‹’ç»å¤„ç†ç¨‹åºä¼ é€’çš„æ•°æ®</li>
<li>Promise.race: å½“ Promise æ•°ç»„ä¸­ä»»æ„ä¸€ä¸ªå¤„ç†å®Œæˆæˆ–è€…æ‹’ç»æ—¶,éƒ½ä¼šç«‹å³è¿”å›,æ¥æ”¶åˆ°å®Œæˆæˆ–è€…æ‹’ç»å¤„ç†ç¨‹åºä¼ é€’çš„æ•°æ®</li>
<li>æ´¾ç”Ÿç±»ç»§æ‰¿è‡ª Promise: æ³¨æ„ Promise çš„é™æ€æˆå‘˜ resolveã€reject åˆ›å»ºçš„ç±»å¯¹è±¡æ˜¯ç”±é™æ€è®¿é—®å™¨å±æ€§ [Symbol.species] ç¡®å®šå€¼ç±»å‹çš„,ç”±æ­¤,ç±»å¯¹è±¡æ˜¯åœ¨æ´¾ç”Ÿç±»çš„åŸå‹é“¾ä¸Š</li>
<li>Promise çš„å¼‚æ­¥ç”Ÿæˆå™¨</li>
</ul>
<h3 id="proxy"><a href="#proxy" class="headerlink" title="proxy"></a>proxy</h3><ul>
<li>åŸºæœ¬ç”¨æ³•</li>
<li>set ä»£ç†é™·é˜±éªŒè¯å¯¹è±¡å±æ€§</li>
<li>get ä»£ç†é™·é˜±éªŒè¯å¯¹è±¡ç»“æ„</li>
<li>has ä»£ç†é™·é˜±éšè—å¯¹è±¡å±æ€§</li>
<li>deleteProperty ä»£ç†é™·é˜±é˜²æ­¢åˆ é™¤å¯¹è±¡å±æ€§</li>
<li>åŸå‹ä»£ç†é™·é˜±: setPrototypeOfã€getPrototypeOf<ul>
<li>åŒºåˆ«: é™¤äº†ä¸»è¦åŠŸèƒ½ç›¸åŒä¹‹å¤–<ul>
<li>Object.setPrototypeOf: æ˜¯ç»‘å®šè‡³å†…ç½®å¯¹è±¡ [[SetPrototypeOf]] å†…,å…¶æ‰§è¡Œç»“æœå¦‚æœæˆåŠŸåˆ™è¿”å›ç¬¬ä¸€ä¸ªå‚æ•°,å¤±è´¥åˆ™æŠ›å‡ºé”™è¯¯</li>
<li>Reflect.setPrototypeOf: æ˜¯ç»‘å®šè‡³å†…ç½®å¯¹è±¡ [[SetPrototypeOf]] çš„åŒ…è£¹å™¨,å­˜åœ¨æ•°æ®éªŒè¯,åªä¼šè¿”å› true æˆ–è€… false</li>
<li>Object.getPrototypeOf: æ˜¯ç»‘å®šè‡³å†…ç½®å¯¹è±¡ [[GetPrototypeOf]] å†…,å¯å°†åŸºæœ¬ç±»å‹çš„æ•°æ®å¼ºåˆ¶è½¬åŒ–ä¸ºç›¸å…³çš„æ„é€ å¯¹è±¡</li>
<li>Reflect.getPrototypeOf: æ˜¯ç»‘å®šè‡³å†…ç½®å¯¹è±¡ [[GetPrototypeOf]] çš„åŒ…è£¹å™¨,å­˜åœ¨æ•°æ®éªŒè¯,å‚æ•°åªèƒ½æ¥æ”¶å¼•ç”¨ç±»å‹å¯¹è±¡,ä¼ é€’åŸºæœ¬ç±»å‹æ•°æ®ä¼šç›´æ¥æŠ›å‡ºé”™è¯¯</li>
</ul>
</li>
</ul>
</li>
<li>å¯¹è±¡å¯æ‰©å±•æ€§ä»£ç†é™·é˜±: isExtensiableã€preventExtensions<ul>
<li>åŒºåˆ«: é™¤äº†ä¸»è¦åŠŸèƒ½ç›¸åŒä¹‹å¤–<ul>
<li>Object.isExtensiable: å¯å°†åŸºæœ¬ç±»å‹çš„æ•°æ®å¼ºåˆ¶è½¬åŒ–ä¸ºç›¸å…³çš„æ„é€ å¯¹è±¡</li>
<li>Reflect.isExtensiable: å‚æ•°åªèƒ½æ¥æ”¶å¼•ç”¨ç±»å‹æ•°æ®,ä¼ é€’åŸºæœ¬ç±»å‹æ•°æ®ä¼šç›´æ¥æŠ›å‡ºé”™è¯¯</li>
<li>Object.preventExtensions: å¯å°†åŸºæœ¬ç±»å‹çš„æ•°æ®å¼ºåˆ¶è½¬åŒ–ä¸ºç›¸å…³çš„æ„é€ å¯¹è±¡</li>
<li>Reflect.preventExtensions: å‚æ•°åªèƒ½æ¥æ”¶å¼•ç”¨ç±»å‹æ•°æ®,ä¼ é€’åŸºæœ¬ç±»å‹æ•°æ®ä¼šç›´æ¥æŠ›å‡ºé”™è¯¯</li>
</ul>
</li>
</ul>
</li>
<li>å¯¹è±¡å±æ€§æè¿°ç¬¦ä»£ç†é™·é˜±: definePropertyã€getOwnPropertyDescriptor<ul>
<li>ä½¿ç”¨ defineProperty æ¥æ·»åŠ å±æ€§é™åˆ¶</li>
<li>æè¿°ç¬¦å±æ€§çš„é™åˆ¶: definePropertyã€getOwnPropertyDescriptor æ‰€èƒ½æ“ä½œçš„æè¿°ç¬¦å±æ€§åªæœ‰ valueã€getã€setã€writableã€enumerableã€configurable</li>
<li>åŒºåˆ«: é™¤äº†ä¸»è¦åŠŸèƒ½ç›¸åŒä¹‹å¤–<ul>
<li>Object.defineProperty: æ‰§è¡Œç»“æœå¦‚æœæˆåŠŸåˆ™è¿”å›ç¬¬ä¸€ä¸ªå‚æ•°,å¤±è´¥åˆ™æŠ›å‡ºé”™è¯¯</li>
<li>Reflect.defineProperty: åªä¼šè¿”å› true æˆ–è€… false</li>
<li>Object.getOwnPropertyDescriptor: å¯å°†åŸºæœ¬ç±»å‹çš„æ•°æ®å¼ºåˆ¶è½¬åŒ–ä¸ºç›¸å…³çš„æ„é€ å¯¹è±¡</li>
<li>Reflect.getOwnPropertyDescriptor: å‚æ•°åªèƒ½æ¥æ”¶å¼•ç”¨ç±»å‹æ•°æ®,ä¼ é€’åŸºæœ¬ç±»å‹æ•°æ®ä¼šç›´æ¥æŠ›å‡ºé”™è¯¯</li>
</ul>
</li>
</ul>
</li>
<li>ownKeys ä»£ç†é™·é˜±</li>
<li>å‡½æ•°æ‰§è¡Œ applyã€construct ä»£ç†é™·é˜±<ul>
<li>éªŒè¯å‡½æ•°å‚æ•°</li>
<li>ä¸ä½¿ç”¨ new æ„é€ è°ƒç”¨: é€šè¿‡åœ¨ apply ä»£ç†é™·é˜±ä¸­è°ƒç”¨ construct ä»£ç†é™·é˜±å³å¯ç»•è¿‡å‡½æ•°çš„å…ƒå±æ€§ new.target new æ„é€ è°ƒç”¨æ ¡éªŒ</li>
<li>è¦†å†™æŠ½è±¡åŸºç±»: é€šè¿‡åœ¨ construct ä»£ç†é™·é˜±ä¸­å°† new.target ä¿®æ”¹æˆæ™®é€šç±»æˆ–è€…æ™®é€šå‡½æ•°å³å¯ç»•è¿‡ new.target æŠ½è±¡åŸºç±»æ ¡éªŒ</li>
<li>å¯è°ƒç”¨çš„ç±»: é€šè¿‡åœ¨ apply ä»£ç†é™·é˜±ä¸­è°ƒç”¨ construct ä»£ç†é™·é˜±æˆ–è€…ç›´æ¥åœ¨ apply ä»£ç†é™·é˜±ä¸­ä½¿ç”¨ new æ„é€ è°ƒç”¨å³å¯ç»•è¿‡ç±»çš„åªå¯å®è¡Œ new æ„é€ è°ƒç”¨çš„æ ¡éªŒ</li>
</ul>
</li>
<li>å¯æ’¤é”€çš„ä»£ç†é™·é˜±: é€šè¿‡ Proxy.revocable revoke æ–¹æ³•å¯å®ç°æ’¤é”€ä»£ç†é™·é˜±</li>
<li>æ‹¥æœ‰æ•°ç»„ç‰¹æ€§çš„ç±»</li>
<li>å°†ä»£ç†é™·é˜±ä½œä¸ºåŸå‹<ul>
<li>åœ¨åŸå‹ä¸­ä½¿ç”¨ set ä»£ç†é™·é˜±</li>
<li>åœ¨åŸå‹ä¸­ä½¿ç”¨ get ä»£ç†é™·é˜±</li>
<li>åœ¨åŸå‹ä¸­ä½¿ç”¨ has ä»£ç†é™·é˜±</li>
<li>å°†ä»£ç†é™·é˜±ä½œä¸ºç±»çš„åŸå‹</li>
</ul>
</li>
</ul>
<h3 id="æ¨¡å—çš„å¯¼å…¥å¯¼å‡º"><a href="#æ¨¡å—çš„å¯¼å…¥å¯¼å‡º" class="headerlink" title="æ¨¡å—çš„å¯¼å…¥å¯¼å‡º"></a>æ¨¡å—çš„å¯¼å…¥å¯¼å‡º</h3><ul>
<li>æ™®é€šç”¨æ³•<ul>
<li>å¯¼å‡ºæ¨¡å—</li>
<li>å¯¼å…¥æ¨¡å—<ul>
<li>å¯¼å…¥å•ä¸ªç»‘å®š</li>
<li>å¯¼å…¥å¤šä¸ªç»‘å®š</li>
<li>å¯¼å…¥æ•´ä¸ªæ¨¡å—,æ³¨æ„å¯ç›´æ¥å¯¼å…¥æ¨¡å—çš„é»˜è®¤å€¼,é€šè¿‡ default è°ƒç”¨</li>
</ul>
</li>
<li>é‡å‘½åå¯¼å…¥å¯¼å‡ºæ¨¡å—</li>
<li>æ¨¡å—çš„é»˜è®¤å€¼<ul>
<li>å¯¼å…¥æ¨¡å—çš„é»˜è®¤å€¼</li>
<li>å¯¼å‡ºæ¨¡å—çš„é»˜è®¤å€¼: æ³¨æ„åªèƒ½å¯¼å‡ºä¸€ä¸ªæ¨¡å—çš„é»˜è®¤å€¼,å‡ºç°å¯¼å‡ºå¤šä¸ªé»˜è®¤å€¼ä¼šç›´æ¥æŠ›å‡ºè¯­æ³•é”™è¯¯</li>
<li>é‡å‘½åå¯¼å…¥å¯¼å‡ºæ¨¡å—é»˜è®¤å€¼</li>
</ul>
</li>
<li>é‡æ–°å¯¼å‡ºç»‘å®š</li>
<li>æ— ç»‘å®šå¯¼å…¥æ¨¡å—</li>
</ul>
</li>
<li>ESM çš„ç‰¹æ€§<ul>
<li>é™æ€åˆ†æ</li>
<li>èµ‹å€¼å¼•ç”¨</li>
</ul>
</li>
<li>commonjs çš„ç‰¹æ€§<ul>
<li>åŠ¨æ€å¯¼å…¥</li>
<li>èµ‹å€¼å¤åˆ¶</li>
</ul>
</li>
<li>Web æµè§ˆå™¨å†…åŒæ­¥åŠ è½½æ¨¡å—çš„é¡ºåº<ul>
<li>ä¸‹è½½å¹¶è§£æå…¥å£æ¨¡å—</li>
<li>é€’å½’ä¸‹è½½å¹¶è§£æå…¥å£æ¨¡å—æ‰€å¯¼å…¥çš„èµ„æº</li>
<li>é€’å½’æ‰§è¡Œå…¥å£æ¨¡å—æ‰€å¯¼å…¥çš„èµ„æº</li>
<li>æ‰§è¡Œå…¥å£æ¨¡å—</li>
</ul>
</li>
</ul>
<h3 id="æ•°å­—"><a href="#æ•°å­—" class="headerlink" title="æ•°å­—"></a>æ•°å­—</h3><ul>
<li>æ–¹æ³•<ul>
<li>Number.isInteger: åˆ¤æ–­æ•°æ®æ˜¯å¦æ˜¯ä¸€ä¸ªæ•´æ•°</li>
<li>Number.isSafeInteger: åˆ¤æ–­æ•°æ®æ˜¯å¦æ˜¯ä¸€ä¸ªå®‰å…¨æ•´æ•°,æ³¨æ„å®‰å…¨æ•´æ•°çš„èŒƒå›´åœ¨ -(2^53 - 1) ä¸ 2^53 - 1 ä¹‹é—´</li>
<li>Number.MAX_SAFE_INTEGER: å®‰å…¨æ•´æ•°èŒƒå›´å†…çš„æœ€å¤§å€¼</li>
<li>Number.MIN_SAFE_INTEGER: å®‰å…¨æ•´æ•°èŒƒå›´å†…çš„æœ€å°å€¼</li>
</ul>
</li>
<li>è¿ç®—ç¬¦<ul>
<li>**: å¹‚è¿ç®—ç¬¦,ä¸ Math.pow() çš„æ‰§è¡Œç»“æœç›¸åŒ</li>
</ul>
</li>
</ul>
<h3 id="async-await"><a href="#async-await" class="headerlink" title="async/await"></a>async/await</h3><ul>
<li>åŸºæœ¬ç”¨æ³•<ul>
<li>async: async å‡½æ•°æ‰§è¡Œåä¼šè¿”å›ä¸€ä¸ª Promise</li>
<li>await: æ³¨æ„ await å¤„ç† Promise æ‹’ç»å¤„ç†æ—¶,ä¼šç›´æ¥å°† Promise æ‹’ç»å¤„ç†æŠ›å‡º</li>
</ul>
</li>
</ul>
<h2 id="webpack"><a href="#webpack" class="headerlink" title="webpack"></a>webpack</h2><h3 id="tapable"><a href="#tapable" class="headerlink" title="tapable"></a>tapable</h3><ul>
<li><p>è®¢é˜…æ¨¡å¼ç±»å‹</p>
<ul>
<li>tap -&gt; â€˜syncâ€™</li>
<li>tapAsync -&gt; â€˜asyncâ€™</li>
<li>tapPromise -&gt; â€˜promiseâ€™</li>
</ul>
</li>
<li><p>å‘å¸ƒç±»å‹</p>
<ul>
<li>call -&gt; â€˜syncâ€™</li>
<li>callAsync -&gt; â€˜asyncâ€™</li>
<li>promise -&gt; â€˜promiseâ€™</li>
</ul>
</li>
<li><p>åŸç†</p>
<p>tapable å®é™…ä¸Šæ˜¯æ ¹æ®è®¢é˜…æ¨¡å¼ç±»å‹ã€å‘å¸ƒç±»å‹ä»¥åŠä¼ é€’çš„å‚æ•°æ¥æ„å»º Function æ„é€ å£°æ˜çš„</p>
</li>
<li><p>ç±»</p>
<ul>
<li><p>Hook</p>
<ul>
<li>æµç¨‹æ–¹æ³•(important)<ul>
<li>lazyCompile</li>
<li>_createCall</li>
<li>compile</li>
</ul>
</li>
</ul>
</li>
<li><p>HookCodeFactory</p>
<ul>
<li>æµç¨‹æ–¹æ³•(important)<ul>
<li>setup</li>
<li>create(ç»“æœç”±å‘å¸ƒç±»å‹å†³å®š)</li>
<li>header(ç»“æœç”±å‘å¸ƒç±»å‹å†³å®š)</li>
<li>content(ç»“æœç”±è®¢é˜…æ¨¡å¼ç±»å‹å†³å®š)</li>
<li>callTapsSeries(ç»“æœç”±è®¢é˜…æ¨¡å¼ç±»å‹å†³å®š)</li>
<li>callTap(ç»“æœç”±è®¢é˜…æ¨¡å¼ç±»å‹å†³å®š)</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p>ä¼ªä»£ç </p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">this.å‘å¸ƒç±»å‹å‡½æ•° = function lazyCompile(å‚æ•°) &#123;</span><br><span class="line">  function func(å‚æ•°) &#123;</span><br><span class="line">      setup()</span><br><span class="line">      create()</span><br><span class="line">      header()</span><br><span class="line">      content()</span><br><span class="line">      onError()</span><br><span class="line">      onResult()</span><br><span class="line">      onDone()</span><br><span class="line">  &#125;</span><br><span class="line">  func(å‚æ•°)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
]]></content>
      <categories>
        <category>javascript</category>
      </categories>
      <tags>
        <tag>javascript</tag>
        <tag>es6</tag>
        <tag>outline</tag>
      </tags>
  </entry>
  <entry>
    <title>think of tapable</title>
    <url>/2022/10/15/think-of-tapable/</url>
    <content><![CDATA[<h1 id="Tapable"><a href="#Tapable" class="headerlink" title="Tapable"></a>Tapable</h1><blockquote>
<p>ä»€ä¹ˆæ˜¯ Tapable</p>
</blockquote>
<p>  ç®€å•æ¥è¯´,ç±»ä¼¼äº EventEmitter çš„ä¸€ç§å‘å¸ƒè®¢é˜…æ¨¡å¼,ä¹Ÿå°±æ˜¯è§‚å¯Ÿè€…æ¨¡å¼,ä½†ä¸åŒçš„æ˜¯,Tapable çš„æµç¨‹ä»¥åŠåº”ç”¨åœºæ™¯è¦å¹¿æ³›å¤æ‚çš„å¤š.Tapable ä½œä¸º Webpack çš„ä¸»è¦éª¨æ¶è€Œæµè¡Œ,å› æ­¤ä¹Ÿå—åˆ°å‰ç«¯å¼€å‘çˆ±å¥½è€…çš„ç ”ç©¶.</p>
<blockquote>
<p>è®¢é˜…æ¨¡å¼ç±»å‹ â€”â€” Hook</p>
</blockquote>
<p>  åœ¨ Tapable ä¸­è®¢é˜…æ¨¡å¼ç±»å‹è¢«ç§°ä¸º Hook,ä¹Ÿå°±æ˜¯ â€œé’©å­â€,åŸºæœ¬åˆ†ä¸ºå››ç§.</p>
<ul>
<li>æ™®é€šé’©å­</li>
<li>ç†”æ–­é’©å­</li>
<li>ç€‘å¸ƒé’©å­</li>
<li>å¾ªç¯é’©å­</li>
</ul>
<p>  åœ¨æ­¤åˆ†ç±»åŸºç¡€ä¸Š,å†æ·»åŠ å‘å¸ƒæ—¶åŒæ­¥(Sync)ã€å¼‚æ­¥(Async)ä»¥åŠ Promise çš„åŒºåˆ†.</p>
<blockquote>
<p>æ•´ä½“æºç åˆ†æ</p>
</blockquote>
<p>  å…ˆæŒ‰ç…§æ•´ä½“æµç¨‹å¤§ä½“çœ‹ä¸€éæºç ,å†å…·ä½“åˆ†æå„ä¸ªåˆ†ç±»,å°±å…ˆæ‹¿æœ€ç®€å• SyncHook åŒæ­¥æ™®é€šé’©å­ä¸¾ä¾‹.</p>
  <figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    MIT License http://www.opensource.org/licenses/mit-license.php</span></span><br><span class="line"><span class="comment">    Author Tobias Koppers @sokra</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">&quot;use strict&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Hook</span> = <span class="built_in">require</span>(<span class="string">&quot;./Hook&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">HookCodeFactory</span> = <span class="built_in">require</span>(<span class="string">&quot;./HookCodeFactory&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// å†…å®¹åˆ™æ˜¯ç”± HookCodeFactory ç”Ÿæˆ</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SyncHookCodeFactory</span> <span class="keyword">extends</span> <span class="title class_ inherited__">HookCodeFactory</span> &#123;</span><br><span class="line">    <span class="title function_">content</span>(<span class="params">&#123; onError, onDone, rethrowIfPossible &#125;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">callTapsSeries</span>(&#123;</span><br><span class="line">            <span class="attr">onError</span>: <span class="function">(<span class="params">i, err</span>) =&gt;</span> <span class="title function_">onError</span>(err),</span><br><span class="line">            onDone,</span><br><span class="line">            rethrowIfPossible</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> factory = <span class="keyword">new</span> <span class="title class_">SyncHookCodeFactory</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç»§æ‰¿è‡ª Hook æºç±»</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SyncHook</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Hook</span> &#123;</span><br><span class="line">    <span class="comment">// åŒæ­¥çš„è®¢é˜…æ¨¡å¼ç±»å‹ Hook ä¸èƒ½è°ƒç”¨ tapAsyncã€tapPromise å¼‚æ­¥è®¢é˜…æ–¹æ³•</span></span><br><span class="line">    <span class="title function_">tapAsync</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;tapAsync is not supported on a SyncHook&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">tapPromise</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;tapPromise is not supported on a SyncHook&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ç¼–è¯‘æ–¹æ³•ç”Ÿæˆå¹¶å¯¼å‡ºæœ€ç»ˆçš„å‡½æ•°</span></span><br><span class="line">    <span class="title function_">compile</span>(<span class="params">options</span>) &#123;</span><br><span class="line">        factory.<span class="title function_">setup</span>(<span class="variable language_">this</span>, options);</span><br><span class="line">        <span class="keyword">return</span> factory.<span class="title function_">create</span>(options);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="title class_">SyncHook</span>;</span><br></pre></td></tr></table></figure>

<p>  å¯ä»¥çœ‹å‡ºæ¯ä¸€ç§è®¢é˜…æ¨¡å¼ç±»å‹ Hook æ˜¯ç»§æ‰¿è‡ª Hook æºç±»,è€Œå†…å®¹åˆ™æ˜¯ç”± HookCodeFactory ç”Ÿæˆçš„,ç‰¹å®šçš„è®¢é˜…æ¨¡å¼ç±»å‹ä¹Ÿä¼šåšå¯¹åº”çš„é™åˆ¶,å¦‚åŒæ­¥è®¢é˜…ç±»å‹çš„ Hook åªèƒ½è°ƒç”¨ tap åŒæ­¥è®¢é˜…æ–¹æ³•,å´ä¸èƒ½è°ƒç”¨å…¶ä»–å¼‚æ­¥è®¢é˜…æ–¹æ³•.ç»§ç»­çœ‹ Hook æºç±»,å¤‡æ³¨ä¼šè¯¦ç»†è¯´æ˜æ¯ä¸ªä¸»è¦çš„æ–¹æ³•åšçš„äº‹æƒ….</p>
  <figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    MIT License http://www.opensource.org/licenses/mit-license.php</span></span><br><span class="line"><span class="comment">    Author Tobias Koppers @sokra</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">&quot;use strict&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Hook</span> &#123;</span><br><span class="line">    <span class="comment">// æ„é€ å¯¹è±¡æ‹¥æœ‰çš„å±æ€§</span></span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">args</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="title class_">Array</span>.<span class="title function_">isArray</span>(args)) args = [];</span><br><span class="line">        <span class="comment">// æ„é€ æ—¶æŒ‡å®šçš„å‚æ•°åç§°å’Œä¸ªæ•°</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_args</span> = args;</span><br><span class="line">        <span class="comment">// è®¢é˜…çš„æ–¹æ³•é›†åˆ</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">taps</span> = [];</span><br><span class="line">        <span class="comment">// æ‹¦æˆªå™¨é›†åˆ</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">interceptors</span> = [];</span><br><span class="line">        <span class="comment">// ä¸åŒç±»å‹çš„å‘å¸ƒæ–¹æ³•æ‹¥æœ‰ä¸åŒå¤„ç†è®¢é˜…æ¨¡å¼çš„æ–¹å¼</span></span><br><span class="line">        <span class="comment">// call å¯¹åº” sync (åŒæ­¥)</span></span><br><span class="line">        <span class="comment">// promise å¯¹åº” promise å¤„ç†</span></span><br><span class="line">        <span class="comment">// callAsync å¯¹åº” async (å¼‚æ­¥)</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">call</span> = <span class="variable language_">this</span>.<span class="property">_call</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">promise</span> = <span class="variable language_">this</span>.<span class="property">_promise</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">callAsync</span> = <span class="variable language_">this</span>.<span class="property">_callAsync</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_x</span> = <span class="literal">undefined</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">compile</span>(<span class="params">options</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;Abstract: should be overriden&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å°†æ ¹æ®å‘å¸ƒæ—¶çš„ç±»å‹ã€æ„é€ æ—¶æŒ‡å®šçš„å‚æ•°åç§°ã€æ‹¦æˆªå™¨ä»¥åŠè®¢é˜…çš„æ–¹æ³•é›†åˆç¼–è¯‘ç”Ÿæˆ</span></span><br><span class="line">    <span class="title function_">_createCall</span>(<span class="params">type</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">compile</span>(&#123;</span><br><span class="line">            <span class="attr">taps</span>: <span class="variable language_">this</span>.<span class="property">taps</span>,</span><br><span class="line">            <span class="attr">interceptors</span>: <span class="variable language_">this</span>.<span class="property">interceptors</span>,</span><br><span class="line">            <span class="attr">args</span>: <span class="variable language_">this</span>.<span class="property">_args</span>,</span><br><span class="line">            <span class="attr">type</span>: type</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åŒæ­¥è®¢é˜…æ¨¡å¼ç±»å‹å¤„ç†æ–¹æ³•</span></span><br><span class="line">    <span class="title function_">tap</span>(<span class="params">options, fn</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> options === <span class="string">&quot;string&quot;</span>) options = &#123; <span class="attr">name</span>: options &#125;;</span><br><span class="line">        <span class="comment">//...</span></span><br><span class="line">        options = <span class="title class_">Object</span>.<span class="title function_">assign</span>(&#123; <span class="attr">type</span>: <span class="string">&quot;sync&quot;</span>, <span class="attr">fn</span>: fn &#125;, options);</span><br><span class="line">        <span class="comment">//...</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">_insert</span>(options);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¼‚æ­¥è®¢é˜…æ¨¡å¼ç±»å‹å¤„ç†æ–¹æ³•</span></span><br><span class="line">    <span class="title function_">tapAsync</span>(<span class="params">options, fn</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> options === <span class="string">&quot;string&quot;</span>) options = &#123; <span class="attr">name</span>: options &#125;;</span><br><span class="line">        <span class="comment">//...</span></span><br><span class="line">        options = <span class="title class_">Object</span>.<span class="title function_">assign</span>(&#123; <span class="attr">type</span>: <span class="string">&quot;async&quot;</span>, <span class="attr">fn</span>: fn &#125;, options);</span><br><span class="line">        <span class="comment">//...</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">_insert</span>(options);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// promise è®¢é˜…æ¨¡å¼ç±»å‹å¤„ç†æ–¹æ³•</span></span><br><span class="line">    <span class="title function_">tapPromise</span>(<span class="params">options, fn</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> options === <span class="string">&quot;string&quot;</span>) options = &#123; <span class="attr">name</span>: options &#125;;</span><br><span class="line">        <span class="comment">//...</span></span><br><span class="line">        options = <span class="title class_">Object</span>.<span class="title function_">assign</span>(&#123; <span class="attr">type</span>: <span class="string">&quot;promise&quot;</span>, <span class="attr">fn</span>: fn &#125;, options);</span><br><span class="line">        <span class="comment">//...</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">_insert</span>(options);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¸åŒç±»å‹çš„å‘å¸ƒæ–¹æ³•æ‹¥æœ‰ä¸åŒå¤„ç†è®¢é˜…æ¨¡å¼çš„æ–¹å¼</span></span><br><span class="line">    <span class="comment">// call å¯¹åº” sync (åŒæ­¥)</span></span><br><span class="line">    <span class="comment">// promise å¯¹åº” promise å¤„ç†</span></span><br><span class="line">    <span class="comment">// callAsync å¯¹åº” async (å¼‚æ­¥)</span></span><br><span class="line">    <span class="title function_">_resetCompilation</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">call</span> = <span class="variable language_">this</span>.<span class="property">_call</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">callAsync</span> = <span class="variable language_">this</span>.<span class="property">_callAsync</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">promise</span> = <span class="variable language_">this</span>.<span class="property">_promise</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æœ€ç»ˆä¼šæŒ‰ç…§ &#123;type: string, name: string, fn: Function&#125; çš„æ–¹å¼æ·»åŠ è‡³è®¢é˜…æ–¹æ³•é›†åˆä¸­.</span></span><br><span class="line">    <span class="comment">//           type: å¿…å¡«,å¿…é¡»ä¸º &#x27;sync&#x27;ã€&#x27;async&#x27; å’Œ &#x27;promise&#x27; ä¸‰ç§æšä¸¾é€‰é¡¹ä¹‹ä¸€.</span></span><br><span class="line">    <span class="comment">//           name: å¿…å¡«,æ·»åŠ è®¢é˜…æ–¹æ³•æ—¶åšçš„ç®€è¦æè¿°.</span></span><br><span class="line">    <span class="comment">//           fn: å¿…å¡«,æ·»åŠ çš„è®¢é˜…æ–¹æ³•æœ¬èº«.</span></span><br><span class="line">    <span class="title function_">_insert</span>(<span class="params">item</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">_resetCompilation</span>();</span><br><span class="line">        <span class="keyword">let</span> i = <span class="variable language_">this</span>.<span class="property">taps</span>.<span class="property">length</span>;</span><br><span class="line">        <span class="comment">//...</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">taps</span>[i] = item;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿”å›ä¸€ä¸ªå‡½æ•°,è€Œè¿™ä¸ªå‡½æ•°ä¹Ÿå°±æ˜¯å‘å¸ƒæ—¶è°ƒç”¨çš„ call(args1), callAsync(args1, callback), promise(args1)</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createCompileDelegate</span>(<span class="params">name, type</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">function</span> <span class="title function_">lazyCompileHook</span>(<span class="params">...args</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>[name] = <span class="variable language_">this</span>.<span class="title function_">_createCall</span>(type);</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>[name](...args);</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Hook æºç±»åŸå‹é“¾è‡ªå¸¦ _callã€_promiseã€_callAsync æ–¹æ³•.</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">defineProperties</span>(<span class="title class_">Hook</span>.<span class="property"><span class="keyword">prototype</span></span>, &#123;</span><br><span class="line">    <span class="attr">_call</span>: &#123;</span><br><span class="line">        <span class="attr">value</span>: <span class="title function_">createCompileDelegate</span>(<span class="string">&quot;call&quot;</span>, <span class="string">&quot;sync&quot;</span>),</span><br><span class="line">        <span class="attr">configurable</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">writable</span>: <span class="literal">true</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">_promise</span>: &#123;</span><br><span class="line">        <span class="attr">value</span>: <span class="title function_">createCompileDelegate</span>(<span class="string">&quot;promise&quot;</span>, <span class="string">&quot;promise&quot;</span>),</span><br><span class="line">        <span class="attr">configurable</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">writable</span>: <span class="literal">true</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">_callAsync</span>: &#123;</span><br><span class="line">        <span class="attr">value</span>: <span class="title function_">createCompileDelegate</span>(<span class="string">&quot;callAsync&quot;</span>, <span class="string">&quot;async&quot;</span>),</span><br><span class="line">        <span class="attr">configurable</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">writable</span>: <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="title class_">Hook</span>;</span><br></pre></td></tr></table></figure>

<p>  å¯ä»¥çœ‹å‡º Hook çš„æºç±»ç»è¿‡ä¸€ç•ªæ•´åˆå¤„ç†,å°†æ ¹æ®å‘å¸ƒæ—¶çš„ç±»å‹ã€æ„é€ æ—¶æŒ‡å®šçš„å‚æ•°åç§°ã€æ‹¦æˆªå™¨ä»¥åŠè®¢é˜…çš„æ–¹æ³•é›†åˆé€šè¿‡ç¼–è¯‘ç”Ÿæˆ,æœ€ç»ˆéƒ½æŒ‡å‘äº† compile æ–¹æ³•å†…çš„ HookCodeFactory æ„é€ å¯¹è±¡.é‚£ä¹ˆæœ€ç»ˆéœ€è¦å…‹æœçš„å°±æ˜¯ HookCodeFactory ç±»,å¤‡æ³¨ä¼šè¯¦ç»†è¯´æ˜æ¯ä¸ªä¸»è¦çš„æ–¹æ³•åšçš„äº‹æƒ….</p>
  <figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    MIT License http://www.opensource.org/licenses/mit-license.php</span></span><br><span class="line"><span class="comment">    Author Tobias Koppers @sokra</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">&quot;use strict&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">HookCodeFactory</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">config</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">config</span> = config;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">options</span> = <span class="literal">undefined</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_args</span> = <span class="literal">undefined</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆå§‹åŒ–å,æ ¹æ®ä¸åŒçš„å‘å¸ƒæ—¶çš„ç±»å‹,è¿”å›å¡«å……ä¸åŒçš„å†…å®¹çš„åŒ¿åå‡½æ•°.</span></span><br><span class="line">    <span class="title function_">create</span>(<span class="params">options</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">init</span>(options);</span><br><span class="line">        <span class="keyword">let</span> fn;</span><br><span class="line">        <span class="keyword">switch</span> (<span class="variable language_">this</span>.<span class="property">options</span>.<span class="property">type</span>) &#123;</span><br><span class="line">            <span class="comment">// è¿™é‡Œåç»­ä¼šæ›´åŠ è¯¦å°½å¯¹æ¯”çš„åšè®²è§£</span></span><br><span class="line">            <span class="comment">// ...</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// å°†æ„é€ å¯¹è±¡å±æ€§é‡ç½®</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">deinit</span>();</span><br><span class="line">        <span class="keyword">return</span> fn;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å°†å¤„ç†åè®¢é˜…æ–¹æ³•çš„é›†åˆæŒ‡å‘æ„é€ å¯¹è±¡æœ¬èº«,ç›¸å½“äº this._x = [fn1, fn2, fn3, fn4, ...]</span></span><br><span class="line">    <span class="title function_">setup</span>(<span class="params">instance, options</span>) &#123;</span><br><span class="line">        instance.<span class="property">_x</span> = options.<span class="property">taps</span>.<span class="title function_">map</span>(<span class="function"><span class="params">t</span> =&gt;</span> t.<span class="property">fn</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> &#123;<span class="type">&#123; type: &quot;sync&quot; | &quot;promise&quot; | &quot;async&quot;, taps: Array&lt;Tap&gt;, interceptors: Array&lt;Interceptor&gt; </span>&#125;&#125; options</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="comment">// å®è¡Œåˆå§‹åŒ–,å°†ä¼ å…¥çš„å‚æ•°ä»¥åŠå‚æ•°ä¸­æ„é€ æ—¶æŒ‡å®šçš„å‚æ•°åç§°è¿›è¡Œæ„é€ å¯¹è±¡å±æ€§èµ‹å€¼</span></span><br><span class="line">    <span class="comment">// this.options = &#123;taps: [&#123;type: string, fn: Function, name: string&#125;], type: string, interceptors: Array&lt;Interceptor&gt;, args: Array&lt;String&gt;&#125;</span></span><br><span class="line">    <span class="comment">// this.args = Array&lt;String&gt;</span></span><br><span class="line">    <span class="title function_">init</span>(<span class="params">options</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">options</span> = options;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_args</span> = options.<span class="property">args</span>.<span class="title function_">slice</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å°†æ„é€ å¯¹è±¡å±æ€§é‡ç½®</span></span><br><span class="line">    <span class="title function_">deinit</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">options</span> = <span class="literal">undefined</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_args</span> = <span class="literal">undefined</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¿™é‡Œåç»­ä¼šæ›´åŠ è¯¦å°½å¯¹æ¯”çš„åšè®²è§£</span></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="title class_">HookCodeFactory</span>;</span><br></pre></td></tr></table></figure>
<p>  ç”±ä¸Šé¢çš„æµç¨‹,å¯ä»¥åŸºæœ¬ç†æ¸… Tapable Hook å‘å¸ƒè®¢é˜…æ¨¡å¼çš„å…³ç³»å›¾,å…¶å®è¿˜æ˜¯æ¯”è¾ƒç®€å•çš„:</p>
<p>  <img src="https://image.white-than-wood.zone/webpack/tapable.png"></p>
<p>  æ¥ä¸‹æ¥å°†æ˜¯é‡å¤´æˆ,å°†æ ¹æ®ä¸åŒçš„è®¢é˜…æ¨¡å¼ç±»å‹ã€ä¸åŒçš„å‘å¸ƒç±»å‹ä»¥åŠæ„é€ æ—¶æŒ‡å®šçš„å‚æ•°åç§°ç¼–è¯‘ç”Ÿæˆæ‹¼æ¥å¥½ä¸åŒçš„å†…å®¹çš„åŒ¿åå‡½æ•°.</p>
<ul>
<li><p>é¦–å…ˆæ˜¯æ ¹æ®ä¸åŒçš„å‘å¸ƒç±»å‹ä»¥åŠæ„é€ æ—¶æŒ‡å®šçš„å‚æ•°åç§°å®è¡Œç¬¬ä¸€æ­¥æ‹¼æ¥.</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">switch</span> (<span class="variable language_">this</span>.<span class="property">options</span>.<span class="property">type</span>) &#123;</span><br><span class="line">  <span class="keyword">case</span> <span class="string">&quot;sync&quot;</span>:</span><br><span class="line">      fn = <span class="keyword">new</span> <span class="title class_">Function</span>(</span><br><span class="line">          <span class="variable language_">this</span>.<span class="title function_">args</span>(),</span><br><span class="line">          <span class="string">&#x27;&quot;use strict&quot;;\n&#x27;</span> +</span><br><span class="line">          <span class="variable language_">this</span>.<span class="title function_">header</span>() +</span><br><span class="line">          <span class="variable language_">this</span>.<span class="title function_">content</span>(&#123;</span><br><span class="line">              <span class="attr">onError</span>: <span class="function"><span class="params">err</span> =&gt;</span> <span class="string">`throw <span class="subst">$&#123;err&#125;</span>;\n`</span>,</span><br><span class="line">              <span class="attr">onResult</span>: <span class="function"><span class="params">result</span> =&gt;</span> <span class="string">`return <span class="subst">$&#123;result&#125;</span>;\n`</span>,</span><br><span class="line">              <span class="attr">resultReturns</span>: <span class="literal">true</span>,</span><br><span class="line">              <span class="attr">onDone</span>: <span class="function">() =&gt;</span> <span class="string">&quot;&quot;</span>,</span><br><span class="line">              <span class="attr">rethrowIfPossible</span>: <span class="literal">true</span></span><br><span class="line">          &#125;)</span><br><span class="line">      );</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">  <span class="keyword">case</span> <span class="string">&quot;async&quot;</span>:</span><br><span class="line">      fn = <span class="keyword">new</span> <span class="title class_">Function</span>(</span><br><span class="line">          <span class="variable language_">this</span>.<span class="title function_">args</span>(&#123;</span><br><span class="line">              <span class="attr">after</span>: <span class="string">&quot;_callback&quot;</span></span><br><span class="line">          &#125;),</span><br><span class="line">          <span class="string">&#x27;&quot;use strict&quot;;\n&#x27;</span> +</span><br><span class="line">          <span class="variable language_">this</span>.<span class="title function_">header</span>() +</span><br><span class="line">          <span class="variable language_">this</span>.<span class="title function_">content</span>(&#123;</span><br><span class="line">              <span class="attr">onError</span>: <span class="function"><span class="params">err</span> =&gt;</span> <span class="string">`_callback(<span class="subst">$&#123;err&#125;</span>);\n`</span>,</span><br><span class="line">              <span class="attr">onResult</span>: <span class="function"><span class="params">result</span> =&gt;</span> <span class="string">`_callback(null, <span class="subst">$&#123;result&#125;</span>);\n`</span>,</span><br><span class="line">              <span class="attr">onDone</span>: <span class="function">() =&gt;</span> <span class="string">&quot;_callback();\n&quot;</span></span><br><span class="line">          &#125;)</span><br><span class="line">      );</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">  <span class="keyword">case</span> <span class="string">&quot;promise&quot;</span>:</span><br><span class="line">      <span class="keyword">let</span> errorHelperUsed = <span class="literal">false</span>;</span><br><span class="line">      <span class="keyword">const</span> content = <span class="variable language_">this</span>.<span class="title function_">content</span>(&#123;</span><br><span class="line">          <span class="attr">onError</span>: <span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">              errorHelperUsed = <span class="literal">true</span>;</span><br><span class="line">              <span class="keyword">return</span> <span class="string">`_error(<span class="subst">$&#123;err&#125;</span>);\n`</span>;</span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="attr">onResult</span>: <span class="function"><span class="params">result</span> =&gt;</span> <span class="string">`_resolve(<span class="subst">$&#123;result&#125;</span>);\n`</span>,</span><br><span class="line">          <span class="attr">onDone</span>: <span class="function">() =&gt;</span> <span class="string">&quot;_resolve();\n&quot;</span></span><br><span class="line">      &#125;);</span><br><span class="line">      <span class="keyword">let</span> code = <span class="string">&quot;&quot;</span>;</span><br><span class="line">      code += <span class="string">&#x27;&quot;use strict&quot;;\n&#x27;</span>;</span><br><span class="line">      code += <span class="string">&quot;return new Promise((_resolve, _reject) =&gt; &#123;\n&quot;</span>;</span><br><span class="line">      <span class="keyword">if</span> (errorHelperUsed) &#123;</span><br><span class="line">          code += <span class="string">&quot;var _sync = true;\n&quot;</span>;</span><br><span class="line">          code += <span class="string">&quot;function _error(_err) &#123;\n&quot;</span>;</span><br><span class="line">          code += <span class="string">&quot;if(_sync)\n&quot;</span>;</span><br><span class="line">          code += <span class="string">&quot;_resolve(Promise.resolve().then(() =&gt; &#123; throw _err; &#125;));\n&quot;</span>;</span><br><span class="line">          code += <span class="string">&quot;else\n&quot;</span>;</span><br><span class="line">          code += <span class="string">&quot;_reject(_err);\n&quot;</span>;</span><br><span class="line">          code += <span class="string">&quot;&#125;;\n&quot;</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      code += <span class="variable language_">this</span>.<span class="title function_">header</span>();</span><br><span class="line">      code += content;</span><br><span class="line">      <span class="keyword">if</span> (errorHelperUsed) &#123;</span><br><span class="line">          code += <span class="string">&quot;_sync = false;\n&quot;</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      code += <span class="string">&quot;&#125;);\n&quot;</span>;</span><br><span class="line">      fn = <span class="keyword">new</span> <span class="title class_">Function</span>(<span class="variable language_">this</span>.<span class="title function_">args</span>(), code);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">      MIT License http://www.opensource.org/licenses/mit-license.php</span></span><br><span class="line"><span class="comment">      Author Tobias Koppers @sokra</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">&quot;use strict&quot;</span>;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">HookCodeFactory</span> &#123;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">    <span class="title function_">header</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> code = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="title function_">needContext</span>()) &#123;</span><br><span class="line">            code += <span class="string">&quot;var _context = &#123;&#125;;\n&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            code += <span class="string">&quot;var _context;\n&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        code += <span class="string">&quot;var _x = this._x;\n&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">options</span>.<span class="property">interceptors</span>.<span class="property">length</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            code += <span class="string">&quot;var _taps = this.taps;\n&quot;</span>;</span><br><span class="line">            code += <span class="string">&quot;var _interceptors = this.interceptors;\n&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="variable language_">this</span>.<span class="property">options</span>.<span class="property">interceptors</span>.<span class="property">length</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">const</span> interceptor = <span class="variable language_">this</span>.<span class="property">options</span>.<span class="property">interceptors</span>[i];</span><br><span class="line">            <span class="keyword">if</span> (interceptor.<span class="property">call</span>) &#123;</span><br><span class="line">                code += <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.getInterceptor(i)&#125;</span>.call(<span class="subst">$&#123;<span class="variable language_">this</span>.args(&#123;</span></span></span><br><span class="line"><span class="subst"><span class="string">                    before: interceptor.context ? <span class="string">&quot;_context&quot;</span> : <span class="literal">undefined</span></span></span></span><br><span class="line"><span class="subst"><span class="string">                &#125;)&#125;</span>);\n`</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> code;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">      MIT License http://www.opensource.org/licenses/mit-license.php</span></span><br><span class="line"><span class="comment">      Author Tobias Koppers @sokra</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="meta">&quot;use strict&quot;</span>;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">HookCodeFactory</span> &#123;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">    <span class="title function_">args</span>(<span class="params">&#123;before, after&#125; = &#123;&#125;</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> allArgs = <span class="variable language_">this</span>.<span class="property">_args</span>;</span><br><span class="line">        <span class="keyword">if</span> (before) allArgs = [before].<span class="title function_">concat</span>(allArgs);</span><br><span class="line">        <span class="keyword">if</span> (after) allArgs = allArgs.<span class="title function_">concat</span>(after);</span><br><span class="line">        <span class="keyword">if</span> (allArgs.<span class="property">length</span> === <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> allArgs.<span class="title function_">join</span>(<span class="string">&quot;, &quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ·»åŠ ä¸Š header ä»¥åŠ args éƒ¨åˆ†,ä¹çœ‹èµ·æ¥æ˜¯æœ‰ç‚¹å¤šçš„,å¯ä»¥ä½¿ç”¨ä¼ªä»£ç æ¥ç®€åŒ–æµç¨‹:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">fn</span><br><span class="line">if &#x27;sync&#x27;</span><br><span class="line">  fn = args + header + content</span><br><span class="line">if &#x27;async&#x27;</span><br><span class="line">  fn = args with _callback + header + content</span><br><span class="line">if &#x27;promise&#x27;</span><br><span class="line">  fn = (args + header + content) with new Promise</span><br></pre></td></tr></table></figure>

<p>ä¹Ÿå¯ä»¥è½¬åŒ–ä¸ºå®é™…æ‹¼æ¥å¥½çš„ JS ä»£ç æ¥è¡¨ç¤ºæµç¨‹:</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">this</span>.<span class="property">call</span> = <span class="keyword">function</span> <span class="title function_">lazyCompileHook</span>(<span class="params">...args</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (<span class="keyword">function</span> (<span class="params">args1, args2</span>) &#123;</span><br><span class="line">      <span class="string">&#x27;use strict&#x27;</span>;</span><br><span class="line">      <span class="keyword">var</span> _context;</span><br><span class="line">      <span class="keyword">var</span> _x = <span class="variable language_">this</span>.<span class="property">_x</span>;</span><br><span class="line">      <span class="comment">// content(&#123;onError, onResult, resultReturns, onDone, rethrowIfPossible&#125;);</span></span><br><span class="line">  &#125;)(...args);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">this</span>.<span class="property">callAsync</span> = <span class="keyword">function</span> <span class="title function_">lazyCompileHook</span>(<span class="params">...args</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (<span class="keyword">function</span> (<span class="params">args1, args2, _callback</span>) &#123;</span><br><span class="line">      <span class="string">&#x27;use strict&#x27;</span>;</span><br><span class="line">      <span class="keyword">var</span> _context;</span><br><span class="line">      <span class="keyword">var</span> _x = <span class="variable language_">this</span>.<span class="property">_x</span>;</span><br><span class="line">      <span class="comment">// content(&#123;onError, onResult, onDone&#125;);</span></span><br><span class="line">  &#125;)(...args);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">this</span>.<span class="property">promise</span> = <span class="keyword">function</span> <span class="title function_">lazyCompileHook</span>(<span class="params">...args</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (<span class="keyword">function</span> (<span class="params">args1, args2, _callback</span>) &#123;</span><br><span class="line">      <span class="string">&#x27;use strict&#x27;</span>;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">_resolve, _reject</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">var</span> _context;</span><br><span class="line">          <span class="keyword">var</span> _x = <span class="variable language_">this</span>.<span class="property">x</span>;</span><br><span class="line">          <span class="comment">// content(&#123;onError, onResult, onDone&#125;);</span></span><br><span class="line">      &#125;);</span><br><span class="line">  &#125;)(...args);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>æ¥ç€ç€é‡çœ‹ä¸‹ä¸€ä¸ªéƒ¨åˆ†,ä¹Ÿå°±æ˜¯æ ¹æ®ä¸åŒçš„è®¢é˜…æ¨¡å¼ç±»å‹å®è¡Œæœ€åçš„æ‹¼æ¥.</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//å…ˆçœ‹ SyncxxxHook éƒ¨åˆ†,é™¤äº†å¾ªç¯é’©å­,è°ƒç”¨çš„éƒ½æ˜¯ callTapsSeries æ–¹æ³•</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">HookCodeFactory</span> &#123;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">    <span class="title function_">callTapsSeries</span>(<span class="params">&#123;</span></span><br><span class="line"><span class="params">                       onError,</span></span><br><span class="line"><span class="params">                       onResult,</span></span><br><span class="line"><span class="params">                       resultReturns,</span></span><br><span class="line"><span class="params">                       onDone,</span></span><br><span class="line"><span class="params">                       doneReturns,</span></span><br><span class="line"><span class="params">                       rethrowIfPossible</span></span><br><span class="line"><span class="params">                   &#125;</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">options</span>.<span class="property">taps</span>.<span class="property">length</span> === <span class="number">0</span>) <span class="keyword">return</span> <span class="title function_">onDone</span>();</span><br><span class="line">        <span class="keyword">const</span> firstAsync = <span class="variable language_">this</span>.<span class="property">options</span>.<span class="property">taps</span>.<span class="title function_">findIndex</span>(<span class="function"><span class="params">t</span> =&gt;</span> t.<span class="property">type</span> !== <span class="string">&quot;sync&quot;</span>);</span><br><span class="line">        <span class="keyword">const</span> somethingReturns = resultReturns || doneReturns || <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">let</span> code = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">let</span> current = onDone;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> j = <span class="variable language_">this</span>.<span class="property">options</span>.<span class="property">taps</span>.<span class="property">length</span> - <span class="number">1</span>; j &gt;= <span class="number">0</span>; j--) &#123;</span><br><span class="line">            <span class="keyword">const</span> i = j;</span><br><span class="line">            <span class="comment">//...</span></span><br><span class="line">            <span class="keyword">const</span> done = current;</span><br><span class="line">            <span class="comment">//...</span></span><br><span class="line">            <span class="keyword">const</span> content = <span class="variable language_">this</span>.<span class="title function_">callTap</span>(i, &#123;</span><br><span class="line">                <span class="attr">onError</span>: <span class="function"><span class="params">error</span> =&gt;</span> <span class="title function_">onError</span>(i, error, done, doneBreak),</span><br><span class="line">                <span class="attr">onResult</span>:</span><br><span class="line">                    onResult &amp;&amp;</span><br><span class="line">                    (<span class="function"><span class="params">result</span> =&gt;</span> &#123;</span><br><span class="line">                        <span class="keyword">return</span> <span class="title function_">onResult</span>(i, result, done, doneBreak);</span><br><span class="line">                    &#125;),</span><br><span class="line">                <span class="attr">onDone</span>: !onResult &amp;&amp; done,</span><br><span class="line">                <span class="attr">rethrowIfPossible</span>:</span><br><span class="line">                    rethrowIfPossible &amp;&amp; (firstAsync &lt; <span class="number">0</span> || i &lt; firstAsync)</span><br><span class="line">            &#125;);</span><br><span class="line">            current = <span class="function">() =&gt;</span> content;</span><br><span class="line">        &#125;</span><br><span class="line">        code += <span class="title function_">current</span>();</span><br><span class="line">        <span class="keyword">return</span> code;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç”±ä¸Šè¿°éƒ¨åˆ†å¯ä»¥çœ‹å‡º,é€†å¾ªç¯è®¢é˜…æ–¹æ³•é›†åˆ,æœ¬æ¬¡æ‹¼æ¥çš„ç»“æœä¼šä½œä¸ºä¸‹ä¸€æ¬¡æ‹¼æ¥çš„ onDone æˆ–è€… onResult ä¼ å…¥è‡³ callTap æ–¹æ³•ä¸­.é‚£å°±ç»§ç»­æŸ¥çœ‹ callTap æ–¹æ³•.</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ç›¸å¯¹åº”çš„,è¿˜æ˜¯æŸ¥çœ‹ &#x27;sync&#x27; éƒ¨åˆ†</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">HookCodeFactory</span> &#123;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">    <span class="title function_">callTap</span>(<span class="params">tapIndex, &#123;onError, onResult, onDone, rethrowIfPossible&#125;</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> code = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="comment">//...</span></span><br><span class="line">        code += <span class="string">`var _fn<span class="subst">$&#123;tapIndex&#125;</span> = <span class="subst">$&#123;<span class="variable language_">this</span>.getTapFn(tapIndex)&#125;</span>;\n`</span>;</span><br><span class="line">        <span class="keyword">const</span> tap = <span class="variable language_">this</span>.<span class="property">options</span>.<span class="property">taps</span>[tapIndex];</span><br><span class="line">        <span class="keyword">switch</span> (tap.<span class="property">type</span>) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;sync&quot;</span>:</span><br><span class="line">                <span class="keyword">if</span> (!rethrowIfPossible) &#123;</span><br><span class="line">                    code += <span class="string">`var _hasError<span class="subst">$&#123;tapIndex&#125;</span> = false;\n`</span>;</span><br><span class="line">                    code += <span class="string">&quot;try &#123;\n&quot;</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (onResult) &#123;</span><br><span class="line">                    code += <span class="string">`var _result<span class="subst">$&#123;tapIndex&#125;</span> = _fn<span class="subst">$&#123;tapIndex&#125;</span>(<span class="subst">$&#123;<span class="variable language_">this</span>.args(&#123;</span></span></span><br><span class="line"><span class="subst"><span class="string">                        before: tap.context ? <span class="string">&quot;_context&quot;</span> : <span class="literal">undefined</span></span></span></span><br><span class="line"><span class="subst"><span class="string">                    &#125;)&#125;</span>);\n`</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    code += <span class="string">`_fn<span class="subst">$&#123;tapIndex&#125;</span>(<span class="subst">$&#123;<span class="variable language_">this</span>.args(&#123;</span></span></span><br><span class="line"><span class="subst"><span class="string">                        before: tap.context ? <span class="string">&quot;_context&quot;</span> : <span class="literal">undefined</span></span></span></span><br><span class="line"><span class="subst"><span class="string">                    &#125;)&#125;</span>);\n`</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (!rethrowIfPossible) &#123;</span><br><span class="line">                    code += <span class="string">&quot;&#125; catch(_err) &#123;\n&quot;</span>;</span><br><span class="line">                    code += <span class="string">`_hasError<span class="subst">$&#123;tapIndex&#125;</span> = true;\n`</span>;</span><br><span class="line">                    code += <span class="title function_">onError</span>(<span class="string">&quot;_err&quot;</span>);</span><br><span class="line">                    code += <span class="string">&quot;&#125;\n&quot;</span>;</span><br><span class="line">                    code += <span class="string">`if(!_hasError<span class="subst">$&#123;tapIndex&#125;</span>) &#123;\n`</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (onResult) &#123;</span><br><span class="line">                    code += <span class="title function_">onResult</span>(<span class="string">`_result<span class="subst">$&#123;tapIndex&#125;</span>`</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (onDone) &#123;</span><br><span class="line">                    code += <span class="title function_">onDone</span>();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (!rethrowIfPossible) &#123;</span><br><span class="line">                    code += <span class="string">&quot;&#125;\n&quot;</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="comment">//...</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> code;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">HookCodeFactory</span> &#123;</span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line">  <span class="title function_">getTapFn</span>(<span class="params">idx</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">`_x[<span class="subst">$&#123;idx&#125;</span>]`</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è‡³æ­¤,åŸºæœ¬å¯ä»¥å¾—åˆ°ç»“è®º,åœ¨ callTap æ–¹æ³•ä¸­,â€™syncâ€™ éƒ¨åˆ†æ˜¯æ ¹æ®æœ‰æ—  onResult ä»¥åŠæœ‰æ—  onDone æ¥åˆ¤æ–­å¹¶æ‹¼æ¥å†…å®¹çš„.é‚£æœ€åå†ç®€åŒ–ä¸€ä¸‹.</p>
<div style="display: flex;justify-content: space-between;align-items: center;">
  <div style="width: 49%;">
      <img src="https://image.white-than-wood.zone/webpack/on_result.png" alt="on_result">
  </div>
  <div style="width: 48%;">
      <img src="https://image.white-than-wood.zone/webpack/on_done.png" alt="on_done">
  </div>
</div>

<p>å¯¹äº SyncxxxHook éƒ¨åˆ†,é™¤äº†å¾ªç¯é’©å­,æœ€ç»ˆå¾—å‡ºäº†ç­”æ¡ˆ.</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// SyncHook,åœ¨è¿™é‡Œéƒ½ä½¿ç”¨å¤šå‚æ•°åç§°ã€å¤šè®¢é˜…æ–¹æ³•é›†åˆæ¥å±•ç¤ºæœ€ç»ˆæ‹¼æ¥ç»“æœ.</span></span><br><span class="line"><span class="variable language_">this</span>.<span class="property">call</span> = <span class="keyword">function</span> <span class="title function_">lazyCompileHook</span>(<span class="params">...args</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (<span class="keyword">function</span> (<span class="params">args1, args2</span>) &#123;</span><br><span class="line">        <span class="string">&#x27;use strict&#x27;</span>;</span><br><span class="line">        <span class="keyword">var</span> _context;</span><br><span class="line">        <span class="keyword">var</span> _x = <span class="variable language_">this</span>.<span class="property">_x</span>;</span><br><span class="line">        <span class="keyword">var</span> _fn0 = <span class="variable language_">this</span>.<span class="property">_x</span>[<span class="number">0</span>];</span><br><span class="line">        <span class="title function_">_fn0</span>(args1, args2);</span><br><span class="line">        <span class="keyword">var</span> _fn1 = <span class="variable language_">this</span>.<span class="property">_x</span>[<span class="number">1</span>];</span><br><span class="line">        <span class="title function_">_fn1</span>(args1, args2);</span><br><span class="line">    &#125;)(...args);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// SyncBailHook,åœ¨è¿™é‡Œéƒ½ä½¿ç”¨å¤šå‚æ•°åç§°ã€å¤šè®¢é˜…æ–¹æ³•é›†åˆæ¥å±•ç¤ºæœ€ç»ˆæ‹¼æ¥ç»“æœ.</span></span><br><span class="line"><span class="variable language_">this</span>.<span class="property">call</span> = <span class="keyword">function</span> <span class="title function_">lazyCompileHook</span>(<span class="params">...args</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (<span class="keyword">function</span> (<span class="params">args1, args2</span>) &#123;</span><br><span class="line">        <span class="string">&#x27;use strict&#x27;</span>;</span><br><span class="line">        <span class="keyword">var</span> _context;</span><br><span class="line">        <span class="keyword">var</span> _x = <span class="variable language_">this</span>.<span class="property">_x</span>;</span><br><span class="line">        <span class="keyword">var</span> _fn0 = <span class="variable language_">this</span>.<span class="property">_x</span>[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">var</span> _result0 = <span class="title function_">_fn0</span>(args1, args2);</span><br><span class="line">        <span class="keyword">if</span> (_result0 !== <span class="literal">undefined</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> _result0;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">var</span> _fn1 = <span class="variable language_">this</span>.<span class="property">_x</span>[<span class="number">1</span>];</span><br><span class="line">            <span class="keyword">var</span> _result1 = <span class="title function_">_fn1</span>(args1, args2);</span><br><span class="line">            <span class="keyword">if</span> (_result1 !== <span class="literal">undefined</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> _result1;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;&#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)(...args);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// SyncWarterfallHook,åœ¨è¿™é‡Œéƒ½ä½¿ç”¨å¤šå‚æ•°åç§°ã€å¤šè®¢é˜…æ–¹æ³•é›†åˆæ¥å±•ç¤ºæœ€ç»ˆæ‹¼æ¥ç»“æœ.</span></span><br><span class="line"><span class="variable language_">this</span>.<span class="property">call</span> = <span class="keyword">function</span> <span class="title function_">lazyCompileHook</span>(<span class="params">...args</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (<span class="keyword">function</span> (<span class="params">args1, args2</span>) &#123;</span><br><span class="line">        <span class="string">&#x27;use strict&#x27;</span>;</span><br><span class="line">        <span class="keyword">var</span> _context;</span><br><span class="line">        <span class="keyword">var</span> _x = <span class="variable language_">this</span>.<span class="property">_x</span>;</span><br><span class="line">        <span class="keyword">var</span> _fn0 = _x[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">var</span> _result0 = <span class="title function_">_fn0</span>(args1, args2);</span><br><span class="line">        <span class="keyword">if</span> (_result0 !== <span class="literal">undefined</span>) &#123;</span><br><span class="line">            args1 = _result0;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">var</span> _fn1 = _x[<span class="number">1</span>];</span><br><span class="line">        <span class="keyword">var</span> _result1 = <span class="title function_">_fn1</span>(args1, args2);</span><br><span class="line">        <span class="keyword">if</span> (_result1 !== <span class="literal">undefined</span>) &#123;</span><br><span class="line">            args1 = _result1;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> args1;</span><br><span class="line">    &#125;)(...args);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä»¥æ­¤ç±»æ¨,å¼‚æ­¥ AsyncSeriesxxxHook éƒ¨åˆ†,é™¤äº†å¾ªç¯é’©å­,è°ƒç”¨çš„ä¹Ÿéƒ½æ˜¯ callTapsSeries æ–¹æ³•.</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">HookCodeFactory</span> &#123;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">    <span class="title function_">callTapsSeries</span>(<span class="params">&#123;</span></span><br><span class="line"><span class="params">                       onError,</span></span><br><span class="line"><span class="params">                       onResult,</span></span><br><span class="line"><span class="params">                       resultReturns,</span></span><br><span class="line"><span class="params">                       onDone,</span></span><br><span class="line"><span class="params">                       doneReturns,</span></span><br><span class="line"><span class="params">                       rethrowIfPossible</span></span><br><span class="line"><span class="params">                   &#125;</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">options</span>.<span class="property">taps</span>.<span class="property">length</span> === <span class="number">0</span>) <span class="keyword">return</span> <span class="title function_">onDone</span>();</span><br><span class="line">        <span class="keyword">const</span> firstAsync = <span class="variable language_">this</span>.<span class="property">options</span>.<span class="property">taps</span>.<span class="title function_">findIndex</span>(<span class="function"><span class="params">t</span> =&gt;</span> t.<span class="property">type</span> !== <span class="string">&quot;sync&quot;</span>);</span><br><span class="line">        <span class="keyword">const</span> somethingReturns = resultReturns || doneReturns || <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">let</span> code = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">let</span> current = onDone;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> j = <span class="variable language_">this</span>.<span class="property">options</span>.<span class="property">taps</span>.<span class="property">length</span> - <span class="number">1</span>; j &gt;= <span class="number">0</span>; j--) &#123;</span><br><span class="line">            <span class="keyword">const</span> i = j;</span><br><span class="line">            <span class="keyword">if</span> (unroll) &#123;</span><br><span class="line">                code += <span class="string">`function _next<span class="subst">$&#123;i&#125;</span>() &#123;\n`</span>;</span><br><span class="line">                code += <span class="title function_">current</span>();</span><br><span class="line">                code += <span class="string">`&#125;\n`</span>;</span><br><span class="line">                current = <span class="function">() =&gt;</span> <span class="string">`<span class="subst">$&#123;somethingReturns ? <span class="string">&quot;return &quot;</span> : <span class="string">&quot;&quot;</span>&#125;</span>_next<span class="subst">$&#123;i&#125;</span>();\n`</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">const</span> done = current;</span><br><span class="line">            <span class="keyword">const</span> <span class="title function_">doneBreak</span> = skipDone =&gt; &#123;</span><br><span class="line">                <span class="keyword">if</span> (skipDone) <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">                <span class="keyword">return</span> <span class="title function_">onDone</span>();</span><br><span class="line">            &#125;;</span><br><span class="line">            <span class="keyword">const</span> content = <span class="variable language_">this</span>.<span class="title function_">callTap</span>(i, &#123;</span><br><span class="line">                <span class="attr">onError</span>: <span class="function"><span class="params">error</span> =&gt;</span> <span class="title function_">onError</span>(i, error, done, doneBreak),</span><br><span class="line">                <span class="attr">onResult</span>:</span><br><span class="line">                    onResult &amp;&amp;</span><br><span class="line">                    (<span class="function"><span class="params">result</span> =&gt;</span> &#123;</span><br><span class="line">                        <span class="keyword">return</span> <span class="title function_">onResult</span>(i, result, done, doneBreak);</span><br><span class="line">                    &#125;),</span><br><span class="line">                <span class="attr">onDone</span>: !onResult &amp;&amp; done,</span><br><span class="line">                <span class="attr">rethrowIfPossible</span>:</span><br><span class="line">                    rethrowIfPossible &amp;&amp; (firstAsync &lt; <span class="number">0</span> || i &lt; firstAsync)</span><br><span class="line">            &#125;);</span><br><span class="line">            current = <span class="function">() =&gt;</span> content;</span><br><span class="line">        &#125;</span><br><span class="line">        code += <span class="title function_">current</span>();</span><br><span class="line">        <span class="keyword">return</span> code;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åŒç†,å¼‚æ­¥ AsyncSeriesxxxHook éƒ¨åˆ†è¿˜æ˜¯é€†å¾ªç¯è®¢é˜…æ–¹æ³•é›†åˆ,æœ¬æ¬¡æ‹¼æ¥çš„ç»“æœä¼šä½œä¸ºä¸‹ä¸€æ¬¡æ‹¼æ¥çš„ onDone æˆ–è€… onResult ä¼ å…¥è‡³ callTap æ–¹æ³•ä¸­,ä½†æ˜¯æœ¬æ¬¡æ‹¼æ¥çš„ç»“æœä¼šåŠ ä¸€å±‚ next åŒ…è£¹,æ¥ç€è¿˜æ˜¯æŸ¥çœ‹ callTap æ–¹æ³•.</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ç›¸å¯¹åº”çš„,æŸ¥çœ‹ &#x27;async&#x27; éƒ¨åˆ†</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">HookCodeFactory</span> &#123;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">    <span class="title function_">callTap</span>(<span class="params">tapIndex, &#123;onError, onResult, onDone, rethrowIfPossible&#125;</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> code = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="comment">//...</span></span><br><span class="line">        code += <span class="string">`var _fn<span class="subst">$&#123;tapIndex&#125;</span> = <span class="subst">$&#123;<span class="variable language_">this</span>.getTapFn(tapIndex)&#125;</span>;\n`</span>;</span><br><span class="line">        <span class="keyword">const</span> tap = <span class="variable language_">this</span>.<span class="property">options</span>.<span class="property">taps</span>[tapIndex];</span><br><span class="line">        <span class="keyword">switch</span> (tap.<span class="property">type</span>) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;async&quot;</span>:</span><br><span class="line">                <span class="keyword">let</span> cbCode = <span class="string">&quot;&quot;</span>;</span><br><span class="line">                <span class="keyword">if</span> (onResult) cbCode += <span class="string">`(_err<span class="subst">$&#123;tapIndex&#125;</span>, _result<span class="subst">$&#123;tapIndex&#125;</span>) =&gt; &#123;\n`</span>;</span><br><span class="line">                <span class="keyword">else</span> cbCode += <span class="string">`_err<span class="subst">$&#123;tapIndex&#125;</span> =&gt; &#123;\n`</span>;</span><br><span class="line">                cbCode += <span class="string">`if(_err<span class="subst">$&#123;tapIndex&#125;</span>) &#123;\n`</span>;</span><br><span class="line">                cbCode += <span class="title function_">onError</span>(<span class="string">`_err<span class="subst">$&#123;tapIndex&#125;</span>`</span>);</span><br><span class="line">                cbCode += <span class="string">&quot;&#125; else &#123;\n&quot;</span>;</span><br><span class="line">                <span class="keyword">if</span> (onResult) &#123;</span><br><span class="line">                    cbCode += <span class="title function_">onResult</span>(<span class="string">`_result<span class="subst">$&#123;tapIndex&#125;</span>`</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (onDone) &#123;</span><br><span class="line">                    cbCode += <span class="title function_">onDone</span>();</span><br><span class="line">                &#125;</span><br><span class="line">                cbCode += <span class="string">&quot;&#125;\n&quot;</span>;</span><br><span class="line">                cbCode += <span class="string">&quot;&#125;&quot;</span>;</span><br><span class="line">                code += <span class="string">`_fn<span class="subst">$&#123;tapIndex&#125;</span>(<span class="subst">$&#123;<span class="variable language_">this</span>.args(&#123;</span></span></span><br><span class="line"><span class="subst"><span class="string">                    before: tap.context ? <span class="string">&quot;_context&quot;</span> : <span class="literal">undefined</span>,</span></span></span><br><span class="line"><span class="subst"><span class="string">                    after: cbCode</span></span></span><br><span class="line"><span class="subst"><span class="string">                &#125;)&#125;</span>);\n`</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="comment">//...</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> code;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">HookCodeFactory</span> &#123;</span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line">  <span class="title function_">getTapFn</span>(<span class="params">idx</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">`_x[<span class="subst">$&#123;idx&#125;</span>]`</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è‡³æ­¤,ä¹ŸåŸºæœ¬å¯ä»¥å¾—åˆ°ç»“è®º,åœ¨ callTap æ–¹æ³•ä¸­,â€™asyncâ€™ éƒ¨åˆ†æ˜¯æ ¹æ® onErrorã€æœ‰æ—  onResult ä»¥åŠæœ‰æ—  onDone æ¥åˆ¤æ–­å¹¶æ‹¼æ¥å†…å®¹çš„.æœ€åä¹Ÿå†ç®€åŒ–ä¸€ä¸‹.</p>
<div style="display: flex;justify-content: space-between;align-items: center;">
  <div style="width: 49%;">
      <img src="https://image.white-than-wood.zone/webpack/_async_on_result.png" alt="async_on_result">
  </div>
  <div style="width: 49%;">
      <img src="https://image.white-than-wood.zone/webpack/_async_on_done.png" alt="async_on_done">
  </div>
</div>

<p>å¯¹äºå¼‚æ­¥ AsyncSeriesxxxHook éƒ¨åˆ†,é™¤äº†å¾ªç¯é’©å­,æœ€ç»ˆä¹Ÿå¾—å‡ºäº†ç­”æ¡ˆ.</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// AsyncSeriesHook,åœ¨è¿™é‡Œéƒ½ä½¿ç”¨å¤šå‚æ•°åç§°ã€å¤šå¼‚æ­¥è®¢é˜…æ–¹æ³•é›†åˆæ¥å±•ç¤ºæœ€ç»ˆæ‹¼æ¥ç»“æœ.</span></span><br><span class="line"><span class="variable language_">this</span>.<span class="property">callAsync</span> = <span class="keyword">function</span> <span class="title function_">lazyCompileHook</span>(<span class="params">...args</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (<span class="keyword">function</span> (<span class="params">args1, args2, _callback</span>) &#123;</span><br><span class="line">        <span class="string">&#x27;use strict&#x27;</span>;</span><br><span class="line">        <span class="keyword">var</span> _context;</span><br><span class="line">        <span class="keyword">var</span> _x = <span class="variable language_">this</span>.<span class="property">_x</span>;</span><br><span class="line">    </span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">_next0</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">var</span> _fn1 = _x[<span class="number">1</span>];</span><br><span class="line">            <span class="title function_">_fn1</span>(args1, args2, <span class="function">(<span class="params">_err1</span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (_err1) &#123;</span><br><span class="line">                    <span class="title function_">_callback</span>(_err1);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="title function_">_callback</span>();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">        <span class="keyword">var</span> _fn0 = _x[<span class="number">0</span>];</span><br><span class="line">        <span class="title function_">_fn0</span>(args1, args2, <span class="function">(<span class="params">_err0</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (_err0) &#123;</span><br><span class="line">                <span class="title function_">_callback</span>(_err0);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="title function_">_next0</span>();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;)(...args);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// AsyncSeriesBailHook,åœ¨è¿™é‡Œéƒ½ä½¿ç”¨å¤šå‚æ•°åç§°ã€å¤šå¼‚æ­¥è®¢é˜…æ–¹æ³•é›†åˆæ¥å±•ç¤ºæœ€ç»ˆæ‹¼æ¥ç»“æœ.</span></span><br><span class="line"><span class="variable language_">this</span>.<span class="property">callAsync</span> = <span class="keyword">function</span> <span class="title function_">lazyCompileHook</span>(<span class="params">...args</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (<span class="keyword">function</span> (<span class="params">args1, args2, _callback</span>) &#123;</span><br><span class="line">        <span class="string">&#x27;use strict&#x27;</span>;</span><br><span class="line">        <span class="keyword">var</span> _context;</span><br><span class="line">        <span class="keyword">var</span> _x = <span class="variable language_">this</span>.<span class="property">_x</span>;</span><br><span class="line">    </span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">_next0</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">var</span> _fn1 = _x[<span class="number">1</span>];</span><br><span class="line">            <span class="title function_">_fn1</span>(args1, args2, <span class="function">(<span class="params">_err1, _result1</span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (_err1) &#123;</span><br><span class="line">                    <span class="title function_">_callback</span>(_err1);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> (_result1 !== <span class="literal">undefined</span>) &#123;</span><br><span class="line">                        <span class="title function_">_callback</span>(<span class="literal">null</span>, _result1);</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="title function_">_callback</span>();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">        <span class="keyword">var</span> _fn0 = _x[<span class="number">0</span>];</span><br><span class="line">        <span class="title function_">_fn0</span>(args1, args2, <span class="function">(<span class="params">_err0, _result0</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (_err0) &#123;</span><br><span class="line">                <span class="title function_">_callback</span>(_err0);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (_result0 !== <span class="literal">undefined</span>) &#123;</span><br><span class="line">                    <span class="title function_">_callback</span>(<span class="literal">null</span>, _result0);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="title function_">_next0</span>();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;)(...args);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// AsyncSeriesWaterfallHook,åœ¨è¿™é‡Œéƒ½ä½¿ç”¨å¤šå‚æ•°åç§°ã€å¤šå¼‚æ­¥è®¢é˜…æ–¹æ³•é›†åˆæ¥å±•ç¤ºæœ€ç»ˆæ‹¼æ¥ç»“æœ.</span></span><br><span class="line"><span class="variable language_">this</span>.<span class="property">callAsync</span> = <span class="keyword">function</span> <span class="title function_">lazyCompileHook</span>(<span class="params">...args</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (<span class="keyword">function</span> (<span class="params">args1, args2, _callback</span>) &#123;</span><br><span class="line">        <span class="string">&#x27;use strict&#x27;</span>;</span><br><span class="line">        <span class="keyword">var</span> _context;</span><br><span class="line">        <span class="keyword">var</span> _x = <span class="variable language_">this</span>.<span class="property">_x</span>;</span><br><span class="line">    </span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">_next0</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">var</span> _fn1 = _x[<span class="number">1</span>];</span><br><span class="line">            <span class="title function_">_fn1</span>(args1, args2, <span class="function">(<span class="params">_err1, _result1</span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (_err1) &#123;</span><br><span class="line">                    <span class="title function_">_callback</span>(_err1);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> (_result1 !== <span class="literal">undefined</span>) &#123;</span><br><span class="line">                        args1 = _result1;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="title function_">_callback</span>(<span class="literal">null</span>, args1);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">        <span class="keyword">var</span> _fn0 = _x[<span class="number">0</span>];</span><br><span class="line">        <span class="title function_">_fn0</span>(args1, args2, <span class="function">(<span class="params">_err0, _result0</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (_err0) &#123;</span><br><span class="line">                <span class="title function_">_callback</span>(_err0);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (_result0 !== <span class="literal">undefined</span>) &#123;</span><br><span class="line">                    args1 = _result0;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="title function_">_next0</span>();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;)(...args);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åŒæ ·,Promise AsyncSeriesxxxHook éƒ¨åˆ†,é™¤äº†å¾ªç¯é’©å­,è°ƒç”¨çš„ä¹Ÿéƒ½æ˜¯ callTapsSeries æ–¹æ³•,è€Œ callTap æ–¹æ³•åˆ™ä¾ç„¶æ˜¯é€†å¾ªç¯è®¢é˜…æ–¹æ³•é›†åˆ,æœ¬æ¬¡æ‹¼æ¥çš„ç»“æœä¼šä½œä¸ºä¸‹ä¸€æ¬¡æ‹¼æ¥çš„ onDone æˆ–è€… onResult ä¼ å…¥å…¶ä¸­,æœ€å¤§çš„ä¸åŒå°±æ˜¯ç›¸å¯¹äºå¼‚æ­¥æ¥è¯´ç»“æ„æœ‰äº†æ¯”è¾ƒå¤§çš„æ”¹å˜.</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æŸ¥çœ‹ &#x27;promise&#x27; éƒ¨åˆ†</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">HookCodeFactory</span> &#123;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">    <span class="title function_">callTap</span>(<span class="params">tapIndex, &#123;onError, onResult, onDone, rethrowIfPossible&#125;</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> code = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="comment">//...</span></span><br><span class="line">        code += <span class="string">`var _fn<span class="subst">$&#123;tapIndex&#125;</span> = <span class="subst">$&#123;<span class="variable language_">this</span>.getTapFn(tapIndex)&#125;</span>;\n`</span>;</span><br><span class="line">        <span class="keyword">const</span> tap = <span class="variable language_">this</span>.<span class="property">options</span>.<span class="property">taps</span>[tapIndex];</span><br><span class="line">        <span class="keyword">switch</span> (tap.<span class="property">type</span>) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;promise&quot;</span>:</span><br><span class="line">                code += <span class="string">`var _hasResult<span class="subst">$&#123;tapIndex&#125;</span> = false;\n`</span>;</span><br><span class="line">                code += <span class="string">`var _promise<span class="subst">$&#123;tapIndex&#125;</span> = _fn<span class="subst">$&#123;tapIndex&#125;</span>(<span class="subst">$&#123;<span class="variable language_">this</span>.args(&#123;</span></span></span><br><span class="line"><span class="subst"><span class="string">                    before: tap.context ? <span class="string">&quot;_context&quot;</span> : <span class="literal">undefined</span></span></span></span><br><span class="line"><span class="subst"><span class="string">                &#125;)&#125;</span>);\n`</span>;</span><br><span class="line">                code += <span class="string">`if (!_promise<span class="subst">$&#123;tapIndex&#125;</span> || !_promise<span class="subst">$&#123;tapIndex&#125;</span>.then)\n`</span>;</span><br><span class="line">                code += <span class="string">`  throw new Error(&#x27;Tap function (tapPromise) did not return promise (returned &#x27; + _promise<span class="subst">$&#123;tapIndex&#125;</span> + &#x27;)&#x27;);\n`</span>;</span><br><span class="line">                code += <span class="string">`_promise<span class="subst">$&#123;tapIndex&#125;</span>.then(_result<span class="subst">$&#123;tapIndex&#125;</span> =&gt; &#123;\n`</span>;</span><br><span class="line">                code += <span class="string">`_hasResult<span class="subst">$&#123;tapIndex&#125;</span> = true;\n`</span>;</span><br><span class="line">                <span class="keyword">if</span> (onResult) &#123;</span><br><span class="line">                    code += <span class="title function_">onResult</span>(<span class="string">`_result<span class="subst">$&#123;tapIndex&#125;</span>`</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (onDone) &#123;</span><br><span class="line">                    code += <span class="title function_">onDone</span>();</span><br><span class="line">                &#125;</span><br><span class="line">                code += <span class="string">`&#125;, _err<span class="subst">$&#123;tapIndex&#125;</span> =&gt; &#123;\n`</span>;</span><br><span class="line">                code += <span class="string">`if(_hasResult<span class="subst">$&#123;tapIndex&#125;</span>) throw _err<span class="subst">$&#123;tapIndex&#125;</span>;\n`</span>;</span><br><span class="line">                code += <span class="title function_">onError</span>(<span class="string">`_err<span class="subst">$&#123;tapIndex&#125;</span>`</span>);</span><br><span class="line">                code += <span class="string">&quot;&#125;);\n&quot;</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="comment">//...</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> code;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">HookCodeFactory</span> &#123;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">    <span class="title function_">getTapFn</span>(<span class="params">idx</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">`_x[<span class="subst">$&#123;idx&#125;</span>]`</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åˆå¯ä»¥å¾—å‡ºç»“è®º,åœ¨ callTap æ–¹æ³•ä¸­,â€™promiseâ€™ éƒ¨åˆ†æ˜¯æ ¹æ® onErrorã€æœ‰æ—  onResult ä»¥åŠæœ‰æ—  onDone æ¥åˆ¤æ–­å¹¶æ‹¼æ¥å†…å®¹çš„.æœ€åä¹Ÿå†ç®€åŒ–ä¸€ä¸‹.</p>
<div style="display: flex;justify-content: space-between;align-items: center;">
    <div style="width: 49%;">
        <img src="https://image.white-than-wood.zone/webpack/promise_on_result.png" alt="promise_on_result">
    </div>
    <div style="width: 49%;">
        <img src="https://image.white-than-wood.zone/webpack/promise_on_done.png" alt="promise_on_done">
    </div>
</div>

<p>å¯¹äº Promise AsyncSeriesxxxHook éƒ¨åˆ†,é™¤äº†å¾ªç¯é’©å­,æœ€ç»ˆå¾—å‡ºäº†ç­”æ¡ˆ.</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// AsyncSeriesHook,åœ¨è¿™é‡Œéƒ½ä½¿ç”¨å¤šå‚æ•°åç§°ã€å¤š Promise è®¢é˜…æ–¹æ³•é›†åˆæ¥å±•ç¤ºæœ€ç»ˆæ‹¼æ¥ç»“æœ.</span></span><br><span class="line"><span class="variable language_">this</span>.<span class="property">promise</span> = <span class="keyword">function</span> <span class="title function_">lazyCompileHook</span>(<span class="params">...args</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (<span class="keyword">function</span> (<span class="params">args1, args2</span>) &#123;</span><br><span class="line">        <span class="string">&#x27;use strict&#x27;</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">_resolve, _reject</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">var</span> _sync = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">function</span> <span class="title function_">_error</span>(<span class="params">_err</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (_sync)</span><br><span class="line">                    <span class="title function_">_resolve</span>(<span class="title class_">Promise</span>.<span class="title function_">resolve</span>().<span class="title function_">then</span>(<span class="function">() =&gt;</span> <span class="keyword">throw</span> _err));</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    <span class="title function_">_reject</span>(_err);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">var</span> _context;</span><br><span class="line">            <span class="keyword">var</span> _x = <span class="variable language_">this</span>.<span class="property">_x</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">function</span> <span class="title function_">_next0</span>(<span class="params"></span>) &#123;</span><br><span class="line">                <span class="keyword">var</span> _fn1 = _x[<span class="number">1</span>];</span><br><span class="line">                <span class="keyword">var</span> _hasResult1 = <span class="literal">false</span>;</span><br><span class="line">                <span class="keyword">var</span> _promise1 = <span class="title function_">_fn1</span>(args1, args2);</span><br><span class="line">                <span class="keyword">if</span> (!_promise1 || !_promise1.<span class="property">then</span>)</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;Tap function (tapPromise) did not return promise (returned &#x27;</span> + _promise1 + <span class="string">&#x27;)&#x27;</span>);</span><br><span class="line">                _promise1.<span class="title function_">then</span>(<span class="function"><span class="params">_result1</span> =&gt;</span> &#123;</span><br><span class="line">                    _hasResult1 = <span class="literal">true</span>;</span><br><span class="line">                    <span class="title function_">_resolve</span>();</span><br><span class="line">                &#125;, <span class="function"><span class="params">_err1</span> =&gt;</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> (_hasResult1) <span class="keyword">throw</span> _err1;</span><br><span class="line">                    <span class="title function_">_error</span>(_err1);</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">var</span> _fn0 = _x[<span class="number">0</span>];</span><br><span class="line">            <span class="keyword">var</span> _hasResult0 = <span class="literal">false</span>;</span><br><span class="line">            <span class="keyword">var</span> _promise0 = <span class="title function_">_fn0</span>(args1, args2);</span><br><span class="line">            <span class="keyword">if</span> (!_promise0 || !_promise0.<span class="property">then</span>)</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;Tap function (tapPromise) did not return promise (returned &#x27;</span> + _promise0 + <span class="string">&#x27;)&#x27;</span>);</span><br><span class="line">            _promise0.<span class="title function_">then</span>(<span class="function"><span class="params">_result0</span> =&gt;</span> &#123;</span><br><span class="line">                _hasResult0 = <span class="literal">true</span>;</span><br><span class="line">                <span class="title function_">_next0</span>();</span><br><span class="line">            &#125;, <span class="function"><span class="params">_err0</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (_hasResult0) <span class="keyword">throw</span> _err0;</span><br><span class="line">                <span class="title function_">_error</span>(_err0);</span><br><span class="line">            &#125;);</span><br><span class="line">            _sync = <span class="literal">false</span>;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;)(...args);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// AsyncSeriesBailHook,åœ¨è¿™é‡Œéƒ½ä½¿ç”¨å¤šå‚æ•°åç§°ã€å¤š Promise è®¢é˜…æ–¹æ³•é›†åˆæ¥å±•ç¤ºæœ€ç»ˆæ‹¼æ¥ç»“æœ.</span></span><br><span class="line"><span class="variable language_">this</span>.<span class="property">promise</span> = <span class="keyword">function</span> <span class="title function_">lazyCompileHook</span>(<span class="params">...args</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (<span class="keyword">function</span> (<span class="params">args1, args2</span>) &#123;</span><br><span class="line">        <span class="string">&#x27;use strict&#x27;</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">_resolve, _reject</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">var</span> _sync = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">function</span> <span class="title function_">_error</span>(<span class="params">_err</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (_sync)</span><br><span class="line">                    <span class="title function_">_resolve</span>(<span class="title class_">Promise</span>.<span class="title function_">resolve</span>().<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                        <span class="keyword">throw</span> _err;</span><br><span class="line">                    &#125;));</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    <span class="title function_">_reject</span>(_err);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">var</span> _context;</span><br><span class="line">            <span class="keyword">var</span> _x = <span class="variable language_">this</span>.<span class="property">_x</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">function</span> <span class="title function_">_next0</span>(<span class="params"></span>) &#123;</span><br><span class="line">                <span class="keyword">var</span> _fn1 = _x[<span class="number">1</span>];</span><br><span class="line">                <span class="keyword">var</span> _hasResult1 = <span class="literal">false</span>;</span><br><span class="line">                <span class="keyword">var</span> _promise1 = <span class="title function_">_fn1</span>(args1, args2);</span><br><span class="line">                <span class="keyword">if</span> (!_promise1 || !_promise1.<span class="property">then</span>) &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;Tap function (tapPromise) did not return promise (returned &#x27;</span> + _promise1 + <span class="string">&#x27;)&#x27;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                _promise1.<span class="title function_">then</span>(<span class="function"><span class="params">_result1</span> =&gt;</span> &#123;</span><br><span class="line">                    _hasResult1 = <span class="literal">true</span>;</span><br><span class="line">                    <span class="keyword">if</span> (_result1 !== <span class="literal">undefined</span>) &#123;</span><br><span class="line">                        <span class="title function_">_resolve</span>(_result1);</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="title function_">_resolve</span>();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;, <span class="function"><span class="params">_err1</span> =&gt;</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> (_hasResult1) <span class="keyword">throw</span>  _err1;</span><br><span class="line">                    <span class="title function_">_error</span>(_err1);</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">var</span> _fn0 = _x[<span class="number">0</span>];</span><br><span class="line">            <span class="keyword">var</span> _hasResult0 = <span class="literal">false</span>;</span><br><span class="line">            <span class="keyword">var</span> _promise0 = <span class="title function_">_fn0</span>(args1, args2);</span><br><span class="line">            <span class="keyword">if</span> (!_promise0 || !_promise0.<span class="property">then</span>) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;Tap function (tapPromise) did not return promise (returned &#x27;</span> + _promise0 + <span class="string">&#x27;)&#x27;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            _promise0.<span class="title function_">then</span>(<span class="function"><span class="params">_result0</span> =&gt;</span> &#123;</span><br><span class="line">                _hasResult0 = <span class="literal">true</span>;</span><br><span class="line">                <span class="keyword">if</span> (_result0 !== <span class="literal">undefined</span>) &#123;</span><br><span class="line">                    <span class="title function_">_resolve</span>(_result0);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="title function_">_next0</span>();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;, <span class="function"><span class="params">_err0</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (_hasResult0) <span class="keyword">throw</span>  _err0;</span><br><span class="line">                <span class="title function_">_error</span>(_err0);</span><br><span class="line">            &#125;);</span><br><span class="line">            _sync = <span class="literal">false</span>;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;)(...args);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// AsyncSeriesWaterfallHook,åœ¨è¿™é‡Œéƒ½ä½¿ç”¨å¤šå‚æ•°åç§°ã€å¤š Promise è®¢é˜…æ–¹æ³•é›†åˆæ¥å±•ç¤ºæœ€ç»ˆæ‹¼æ¥ç»“æœ.</span></span><br><span class="line"><span class="variable language_">this</span>.<span class="property">promise</span> = <span class="keyword">function</span> <span class="title function_">lazyCompileHook</span>(<span class="params">...args</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (<span class="keyword">function</span> (<span class="params">args1, args2</span>) &#123;</span><br><span class="line">        <span class="string">&#x27;use strict&#x27;</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">_resolve, _reject</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">var</span> _sync = <span class="literal">true</span>;</span><br><span class="line">    </span><br><span class="line">            <span class="keyword">function</span> <span class="title function_">_error</span>(<span class="params">_err</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (_sync)</span><br><span class="line">                    <span class="title function_">_resolve</span>(<span class="title class_">Promise</span>.<span class="title function_">resolve</span>().<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                        <span class="keyword">throw</span> _err;</span><br><span class="line">                    &#125;));</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    <span class="title function_">_reject</span>(_err);</span><br><span class="line">            &#125;</span><br><span class="line">    </span><br><span class="line">            <span class="keyword">var</span> _context;</span><br><span class="line">            <span class="keyword">var</span> _x = <span class="variable language_">this</span>.<span class="property">_x</span>;</span><br><span class="line">    </span><br><span class="line">            <span class="keyword">function</span> <span class="title function_">_next0</span>(<span class="params"></span>) &#123;</span><br><span class="line">                <span class="keyword">var</span> _fn1 = _x[<span class="number">1</span>];</span><br><span class="line">                <span class="keyword">var</span> _hasResult1 = <span class="literal">false</span>;</span><br><span class="line">                <span class="keyword">var</span> _promise1 = <span class="title function_">_fn1</span>(args1, args2);</span><br><span class="line">                <span class="keyword">if</span> (!_promise1 || !_promise1.<span class="property">then</span>)</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;Tap function (tapPromise) did not return promise (returned &#x27;</span> + _promise1 + <span class="string">&#x27;)&#x27;</span>);</span><br><span class="line">                _promise1.<span class="title function_">then</span>(<span class="function"><span class="params">_result1</span> =&gt;</span> &#123;</span><br><span class="line">                    _hasResult1 = <span class="literal">true</span>;</span><br><span class="line">                    <span class="keyword">if</span> (_result1 !== <span class="literal">undefined</span>) &#123;</span><br><span class="line">                        args1 = _result1;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="title function_">_resolve</span>(args1);</span><br><span class="line">                &#125;, <span class="function"><span class="params">_err1</span> =&gt;</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> (_hasResult1) <span class="keyword">throw</span> _err1;</span><br><span class="line">                    <span class="title function_">_error</span>(_err1);</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">    </span><br><span class="line">            <span class="keyword">var</span> _fn0 = _x[<span class="number">0</span>];</span><br><span class="line">            <span class="keyword">var</span> _hasResult0 = <span class="literal">false</span>;</span><br><span class="line">            <span class="keyword">var</span> _promise0 = <span class="title function_">_fn0</span>(args1, args2);</span><br><span class="line">            <span class="keyword">if</span> (!_promise0 || !_promise0.<span class="property">then</span>)</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;Tap function (tapPromise) did not return promise (returned &#x27;</span> + _promise0 + <span class="string">&#x27;)&#x27;</span>);</span><br><span class="line">            _promise0.<span class="title function_">then</span>(<span class="function"><span class="params">_result0</span> =&gt;</span> &#123;</span><br><span class="line">                _hasResult0 = <span class="literal">true</span>;</span><br><span class="line">                <span class="keyword">if</span> (_result0 !== <span class="literal">undefined</span>) &#123;</span><br><span class="line">                    args1 = _result0;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="title function_">_next0</span>();</span><br><span class="line">            &#125;, <span class="function"><span class="params">_err0</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (_hasResult0) <span class="keyword">throw</span> _err0;</span><br><span class="line">                <span class="title function_">_error</span>(_err0);</span><br><span class="line">            &#125;);</span><br><span class="line">            _sync = <span class="literal">false</span>;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;)(...args);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
]]></content>
      <categories>
        <category>webpack</category>
      </categories>
      <tags>
        <tag>webpack</tag>
        <tag>tapable</tag>
      </tags>
  </entry>
  <entry>
    <title>think of css</title>
    <url>/2022/11/21/think-of-css/</url>
    <content><![CDATA[<h1 id="css"><a href="#css" class="headerlink" title="css"></a>css</h1><h4 id="æ°´å¹³å±…ä¸­"><a href="#æ°´å¹³å±…ä¸­" class="headerlink" title="æ°´å¹³å±…ä¸­"></a>æ°´å¹³å±…ä¸­</h4><p>å¯¹äºçˆ¶å­å…³ç³»çš„å¸ƒå±€ï¼Œå¦‚ä½•è®©å­å…ƒç´ å±…ä¸­å°±æ˜¯ä¸€ä¸ªè¯¾é¢˜~</p>
<blockquote>
<p>text-align + inline-block</p>
</blockquote>
  <figure class="highlight css"><table><tr><td class="code"><pre><span class="line">  <span class="selector-class">.parent</span> &#123;</span><br><span class="line">    <span class="attribute">text-align</span>: center;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.children</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: inline-block;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>absolute + transform(translate)</p>
</blockquote>
  <figure class="highlight css"><table><tr><td class="code"><pre><span class="line">  <span class="selector-class">.parent</span> &#123;</span><br><span class="line">    <span class="attribute">position</span>: relative;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.children</span> &#123;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">left</span>: <span class="number">50%</span>;</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">translateX</span>(-<span class="number">50%</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>table + margin</p>
</blockquote>
  <figure class="highlight css"><table><tr><td class="code"><pre><span class="line">  <span class="selector-class">.parent</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: table;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">0</span> auto;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.children</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>flex + justify-content</p>
</blockquote>
  <figure class="highlight css"><table><tr><td class="code"><pre><span class="line">  <span class="selector-class">.parent</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    <span class="attribute">justify-content</span>: center;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.children</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="å‚ç›´å±…ä¸­"><a href="#å‚ç›´å±…ä¸­" class="headerlink" title="å‚ç›´å±…ä¸­"></a>å‚ç›´å±…ä¸­</h4><blockquote>
<p>table-cell + vertical-align</p>
</blockquote>
  <figure class="highlight css"><table><tr><td class="code"><pre><span class="line">  <span class="selector-class">.parent</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: table-cell;</span><br><span class="line">    <span class="attribute">vertical-align</span>: middle;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.children</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>absolute + transform(translate)</p>
</blockquote>
  <figure class="highlight css"><table><tr><td class="code"><pre><span class="line">  <span class="selector-class">.parent</span> &#123;</span><br><span class="line">    <span class="attribute">position</span>: relative;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.children</span> &#123;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">top</span>: <span class="number">50%</span>;</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">translateY</span>(-<span class="number">50%</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>flex + align-items</p>
</blockquote>
  <figure class="highlight css"><table><tr><td class="code"><pre><span class="line">  <span class="selector-class">.parent</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    <span class="attribute">align-items</span>: center;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.children</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="æ°´å¹³å‚ç›´å±…ä¸­"><a href="#æ°´å¹³å‚ç›´å±…ä¸­" class="headerlink" title="æ°´å¹³å‚ç›´å±…ä¸­"></a>æ°´å¹³å‚ç›´å±…ä¸­</h4><blockquote>
<p>flex</p>
</blockquote>
  <figure class="highlight css"><table><tr><td class="code"><pre><span class="line">  <span class="selector-class">.parent</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    <span class="attribute">justify-content</span>: center;</span><br><span class="line">    <span class="attribute">align-items</span>: center;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.children</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>absolute + transform(translate)</p>
</blockquote>
  <figure class="highlight css"><table><tr><td class="code"><pre><span class="line">  <span class="selector-class">.parent</span> &#123;</span><br><span class="line">    <span class="attribute">position</span>: relative;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.children</span> &#123;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">left</span>: <span class="number">50%</span>;</span><br><span class="line">    <span class="attribute">top</span>: <span class="number">50%</span>;</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">translate</span>(-<span class="number">50%</span>, -<span class="number">50%</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="BFC"><a href="#BFC" class="headerlink" title="BFC"></a>BFC</h4><blockquote>
<p>åˆ†ç±»</p>
</blockquote>
<ul>
<li>æµ®åŠ¨å…ƒç´  float,é™¤äº† none ä»¥å¤–çš„æƒ…å†µ</li>
<li>å®šä½å…ƒç´  position(absoluteã€fixed)</li>
<li>display(inline-blockã€table-captionã€table-cell)</li>
<li>overflow(autoã€hiddenã€scroll)</li>
</ul>
<blockquote>
<p>ç‰¹æ€§</p>
</blockquote>
<ul>
<li>BFC ä¼šå½¢æˆä¸€ä¸ªç‹¬ç«‹çš„å®¹å™¨,å®¹å™¨å†…çš„å…ƒç´ ä¸å—å®¹å™¨å¤–å…ƒç´ çš„å½±å“</li>
<li>BFC çš„é«˜åº¦è®¡ç®—ä¼šè”åŒæµ®åŠ¨å…ƒç´ çš„é«˜åº¦</li>
<li>BFC çš„åŒºåŸŸä¸ä¼šä¸æµ®åŠ¨å…ƒç´ çš„åŒºåŸŸé‡å </li>
</ul>
<h4 id="flex"><a href="#flex" class="headerlink" title="flex"></a>flex</h4><blockquote>
<p>åˆ†ç±»</p>
</blockquote>
<ul>
<li>flex-grow: è®¾ç½®å…ƒç´ çš„æ‰©å±•æ¯”ä¾‹</li>
<li>flex-shrink: è®¾ç½®å…ƒç´ çš„æ”¶ç¼©æ¯”ä¾‹</li>
<li>flex-basis: è®¾ç½®å…ƒç´ çš„åˆå§‹å€¼</li>
</ul>
<h4 id="é‡ç»˜å’Œå›æµ"><a href="#é‡ç»˜å’Œå›æµ" class="headerlink" title="é‡ç»˜å’Œå›æµ"></a>é‡ç»˜å’Œå›æµ</h4><blockquote>
<p>åŒºåˆ«</p>
</blockquote>
<ul>
<li>å›æµæ˜¯ç”±äºé¡µé¢ DOM ç»“æ„å‘ç”Ÿå˜åŒ–å¯¼è‡´çš„,è€Œé‡ç»˜åˆ™æ˜¯é¡µé¢ä¸Šå­˜åœ¨ä¸€äº›æ ·å¼å˜åŒ–å°±ä¼šå‘ç”Ÿé‡ç»˜,ä¸ä¸€å®šæ˜¯ DOM ç»“æ„å‘ç”Ÿå˜åŒ–å¯¼è‡´çš„</li>
<li>å›æµä¸€å®šä¼šå¯¼è‡´é‡ç»˜,è€Œé‡ç»˜ä¸ä¸€å®šä¼šå¯¼è‡´å›æµ</li>
</ul>
<h4 id="CSS-ä¸‰è§’å½¢"><a href="#CSS-ä¸‰è§’å½¢" class="headerlink" title="CSS ä¸‰è§’å½¢"></a>CSS ä¸‰è§’å½¢</h4><blockquote>
<p>ç¤ºä¾‹</p>
</blockquote>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.box</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">border-bottom</span>: <span class="number">50px</span> solid gray;</span><br><span class="line">    <span class="attribute">border-top-color</span>: transparent;</span><br><span class="line">    <span class="attribute">border-left-color</span>: transparent;</span><br><span class="line">    <span class="attribute">border-right-color</span>: transparent;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="CSS-æ¢¯å½¢"><a href="#CSS-æ¢¯å½¢" class="headerlink" title="CSS æ¢¯å½¢"></a>CSS æ¢¯å½¢</h4><blockquote>
<p>ç¤ºä¾‹</p>
</blockquote>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.box</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">20px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">20px</span>;</span><br><span class="line">    <span class="attribute">border</span>: <span class="number">50px</span> solid gray;</span><br><span class="line">    <span class="attribute">border-top-color</span>: transparent;</span><br><span class="line">    <span class="attribute">border-left-color</span>: transparent;</span><br><span class="line">    <span class="attribute">border-right-color</span>: transparent;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="position"><a href="#position" class="headerlink" title="position"></a>position</h4><blockquote>
<p>å±æ€§å€¼</p>
</blockquote>
<ul>
<li>absolute: ç»å¯¹å®šä½,æ˜¯åŸºäºé™¤äº† static ä»¥å¤–çš„å®šä½å±æ€§å€¼çš„çˆ¶å…ƒç´ å®šä½</li>
<li>relative: ç›¸å¯¹å®šä½,ä¼šç›¸å¯¹äºå½“å‰å…ƒç´ ä½ç½®å®šä½</li>
<li>fixed: ç»å¯¹å®šä½,æ˜¯åŸºäºæ•´ä¸ªæµè§ˆå™¨ web é¡µé¢å®šä½</li>
<li>static: é»˜è®¤å€¼,ä¸å®šä½</li>
<li>inherit: ç»§æ‰¿çˆ¶å…ƒç´ çš„å®šä½å±æ€§å€¼</li>
<li>sticky: ç»å¯¹å®šä½,åŸºæœ¬æ˜¯åŸºäºæ•´ä¸ªæµè§ˆå™¨ web é¡µé¢å®šä½,æ˜¯ relative ä¸ fixed çš„æ··åˆå®šä½</li>
</ul>
]]></content>
      <categories>
        <category>css</category>
      </categories>
      <tags>
        <tag>css</tag>
      </tags>
  </entry>
  <entry>
    <title>think of v8</title>
    <url>/2022/11/22/think-of-v8/</url>
    <content><![CDATA[<h1 id="v8"><a href="#v8" class="headerlink" title="v8"></a>v8</h1><blockquote>
<p>åƒåœ¾å›æ”¶æœºåˆ¶</p>
</blockquote>
<p>  ä½¿ç”¨åˆ†ä»£å›æ”¶ç­–ç•¥,åˆ†ä¸ºæ–°ã€è€ç”Ÿä»£.</p>
<ul>
<li>æ–°ç”Ÿä»£: æ–°ç”Ÿä»£çš„å †å†…å­˜è¢«åˆ†ä¸ºå¤šä¸ª SemiSpace ç©ºé—´,æ¯ä¸ª SemiSpace åˆ†ä¸ºä¸¤éƒ¨åˆ† from å’Œ to,åˆ†é…å¯¹è±¡ç©ºé—´æ—¶,åªåœ¨ from ä¸­åˆ†é…,to æ˜¯é—²ç½®çš„,åƒåœ¾å›æ”¶æœºåˆ¶ä¼šæŒ‰ç…§ä»¥ä¸‹æ­¥éª¤:<ul>
<li>æŸ¥æ‰¾ from ä¸­è¿˜å­˜æ´»çš„å¯¹è±¡,å°†å…¶å…¨éƒ¨ç§»å…¥åˆ° to</li>
<li>åè½¬ from å’Œ to</li>
<li>å¯¹ to å°½æ•°å›æ”¶</li>
</ul>
</li>
<li>æ–°ç”Ÿä»£ -&gt; è€ç”Ÿä»£<ul>
<li>æ–°ç”Ÿä»£åƒåœ¾å›æ”¶æœºåˆ¶ä¸­,from ä¸­çš„å¯¹è±¡ç»è¿‡å¤šæ¬¡å¤åˆ¶ä¾ç„¶è¿˜å­˜æ´»,å°±å°†å…¶ç§»å…¥è€ç”Ÿä»£</li>
<li>åœ¨åè½¬ from å’Œ to çš„è¿‡ç¨‹ä¸­,å¦‚æœ to ç©ºé—´çš„ä½¿ç”¨é‡è¶…è¿‡äº† 25%,é‚£ä¹ˆ from ä¸­çš„å¯¹è±¡å…¨éƒ¨ç§»å…¥è€ç”Ÿä»£</li>
</ul>
</li>
<li>è€ç”Ÿä»£<ul>
<li>æ ‡è®°åˆ é™¤: å¯¹è±¡å·²æ­»äº¡,ä¼šç›´æ¥è¢«å‰ƒæ‰åˆ é™¤</li>
<li>æ ‡è®°åˆå¹¶: å°†å­˜æ´»çš„å¯¹è±¡ç§»åˆ°ä¸€è¾¹,å°†è¢«å›æ”¶çš„å¯¹è±¡ç§»åˆ°å¦ä¸€è¾¹,ç›´æ¥å¯¹å¯è¢«å›æ”¶çš„åŒºåŸŸè¿›è¡Œæ•´ä½“çš„åƒåœ¾å›æ”¶</li>
</ul>
</li>
</ul>
]]></content>
      <categories>
        <category>v8</category>
      </categories>
      <tags>
        <tag>v8</tag>
      </tags>
  </entry>
  <entry>
    <title>think of browser</title>
    <url>/2022/11/24/think-of-browser/</url>
    <content><![CDATA[<h1 id="browser"><a href="#browser" class="headerlink" title="browser"></a>browser</h1><h4 id="process"><a href="#process" class="headerlink" title="process"></a>process</h4><blockquote>
<p>åˆ†æ</p>
</blockquote>
<ul>
<li>æµè§ˆå™¨çš„è¿›ç¨‹<ul>
<li>æµè§ˆå™¨è¿›ç¨‹</li>
<li>æ¸²æŸ“è¿›ç¨‹<ul>
<li>GUI çº¿ç¨‹: ç”¨äºå¤„ç†ã€è§£æã€æ¸²æŸ“ htmlã€css</li>
<li>JS çº¿ç¨‹: ä¹Ÿå°±æ˜¯ç¨‹åºå‘˜æ‰€è¯´çš„æ‰€è°“ â€œJS å•çº¿ç¨‹â€</li>
<li>å®šæ—¶å™¨çº¿ç¨‹: å¤„ç†å®šæ—¶å™¨(setTimeoutã€setInterval),å°†ç¬¦åˆæ¡ä»¶çš„å›è°ƒäº‹ä»¶ç§»å…¥è‡³äº‹ä»¶è§¦å‘çº¿ç¨‹</li>
<li>äº‹ä»¶è§¦å‘çº¿ç¨‹: Event Loop äº‹ä»¶å¾ªç¯æ‰§è¡Œæœºåˆ¶</li>
<li>å¼‚æ­¥ HTTP è¯·æ±‚çº¿ç¨‹: å¤„ç† http è¯·æ±‚,å°†ç¬¦åˆæ¡ä»¶çš„å›è°ƒäº‹ä»¶ç§»å…¥è‡³äº‹ä»¶è§¦å‘çº¿ç¨‹</li>
</ul>
</li>
<li>GPU è¿›ç¨‹</li>
<li>æ’ä»¶è¿›ç¨‹</li>
<li>ç½‘ç»œè¿›ç¨‹</li>
</ul>
</li>
</ul>
<h4 id="request"><a href="#request" class="headerlink" title="request"></a>request</h4><blockquote>
<p>è¯·æ±‚å¤´</p>
</blockquote>
<ul>
<li>content-type: å‘æœåŠ¡å™¨ç«¯è¯·æ±‚è·å–èµ„æºçš„ç±»å‹</li>
<li>referer: åŒ…å«äº†å½“å‰è¯·æ±‚é¡µé¢çš„æ¥æºé¡µé¢çš„åœ°å€</li>
<li>user-agent: åˆ™æ˜¯ç”¨äºå‘ŠçŸ¥æœåŠ¡å™¨ç«¯,è®¿é—®è€…æ˜¯ç”±ä»€ä¹ˆå·¥å…·è¯·æ±‚çš„</li>
</ul>
<h4 id="OPTIONS"><a href="#OPTIONS" class="headerlink" title="OPTIONS"></a>OPTIONS</h4><blockquote>
<p>æ¦‚å¿µ</p>
</blockquote>
<p>  HTTP request OPTIONS ç›¸å½“äºæ˜¯ Chrome æµè§ˆå™¨å‘çš„ä¸€ä¸ªâ€é¢„æ£€â€è¯·æ±‚,å®ƒä¼šå‘æœåŠ¡å™¨ç”³è¯·æƒé™æ£€æµ‹ä¿¡æ¯,å¦‚æœç”³è¯·é€šè¿‡,æµè§ˆå™¨æ‰ä¼šçœŸæ­£å‘æœåŠ¡å™¨å‘é€ä¸€ä¸ªæ­£å¼çš„ HTTP è¯·æ±‚.</p>
<blockquote>
<p>åœºæ™¯</p>
</blockquote>
<ul>
<li>è·¨åŸŸè¯·æ±‚</li>
</ul>
<h4 id="redirect"><a href="#redirect" class="headerlink" title="redirect"></a>redirect</h4><blockquote>
<p>çŠ¶æ€ç </p>
</blockquote>
<p>  301: A åœ°å€èµ„æºè¢«æ°¸ä¹…æ€§çš„ç§»é™¤,A åœ°å€èµ„æºä¸å¯è¢«è®¿é—®<br>  302: A åœ°å€èµ„æºè¢«æš‚æ—¶æ€§çš„è½¬ç§»,A åœ°å€èµ„æºä»ç„¶å¯è¢«è®¿é—®,åªæ˜¯ä¸´æ—¶çš„ä» A åœ°å€è·³è½¬åˆ°äº† B åœ°å€</p>
<h4 id="HTTP-ç¼“å­˜ç­–ç•¥"><a href="#HTTP-ç¼“å­˜ç­–ç•¥" class="headerlink" title="HTTP ç¼“å­˜ç­–ç•¥"></a>HTTP ç¼“å­˜ç­–ç•¥</h4><blockquote>
<p>åˆ†ç±»</p>
</blockquote>
<ul>
<li>åå•†ç¼“å­˜<ul>
<li>ETag ä¸ If-None-Match: é€šè¿‡ URL èµ„æºæ ‡è¯†ç¬¦ä¸æœåŠ¡å™¨ç«¯å®è¡Œåå•†,å¦‚æœæœåŠ¡å™¨ç«¯å‘ç° ETag ä¸ If-None-Match ä¸ç›¸åŒ,åˆ™ä¼šè¿”å›æ•°æ®,çŠ¶æ€ç  200;å¦åˆ™ä¼šè¿”å›çŠ¶æ€ç  304,æµè§ˆå™¨å–æœ¬åœ°ç¼“å­˜</li>
<li>Last-Modified ä¸ If-Modified-Since: é€šè¿‡æœ€åä¿®æ”¹æ—¶é—´æˆ³ä¸æœåŠ¡å™¨ç«¯å®è¡Œåå•†,å¦‚æœæœåŠ¡å™¨ç«¯å‘ç° Last-Modified ä¸ If-Modified-Since ä¸ç›¸åŒ,åˆ™ä¼šè¿”å›æ•°æ®,çŠ¶æ€ç  200;å¦åˆ™ä¼šè¿”å›çŠ¶æ€ç  304,æµè§ˆå™¨å–æœ¬åœ°ç¼“å­˜</li>
</ul>
</li>
<li>å¼ºåˆ¶ç¼“å­˜<ul>
<li>Expires: æœåŠ¡å™¨ç«¯è¿”å›å“åº”å¤´åŠ å…¥ Expires æ—¶é—´æˆ³,åœ¨è¿™ä¸ªæ—¶é—´æˆ³ä¹‹å‰,æµè§ˆå™¨ç«¯åªèƒ½å–æœ¬åœ°ç¼“å­˜</li>
<li>Cache-Control<ul>
<li>max-age: æœåŠ¡å™¨ç«¯è¿”å›å“åº”å¤´åŠ å…¥ Cache-Control: max-age = 20000,è¡¨ç¤ºå½“å‰èµ„æºåœ¨ 20000 ç§’å†…éƒ½ä¸ä¼šå†è¯·æ±‚,æµè§ˆå™¨å–æœ¬åœ°ç¼“å­˜</li>
<li>immutable: æµè§ˆå™¨æ°¸è¿œåªèƒ½å–æœ¬åœ°ç¼“å­˜</li>
<li>no-cache: ä½¿ç”¨ç¼“å­˜å‰,å¼ºåˆ¶è¦æ±‚æŠŠè¯·æ±‚æäº¤ç»™æœåŠ¡å™¨ç«¯å®è¡ŒéªŒè¯</li>
<li>no-store: ä¸å­˜å‚¨æœ‰å…³å®¢æˆ·ç«¯è¯·æ±‚æˆ–æœåŠ¡ç«¯å“åº”çš„ä»»ä½•å†…å®¹,ä¸ä½¿ç”¨ä»»ä½•ç¼“å­˜</li>
</ul>
</li>
</ul>
</li>
</ul>
<blockquote>
<p>ä¼˜å…ˆçº§</p>
</blockquote>
<ul>
<li>å¼ºåˆ¶ç¼“å­˜ä¸åå•†ç¼“å­˜<ul>
<li>ä¼šå…ˆåˆ¤æ–­å¼ºåˆ¶ç¼“å­˜,å¦‚æœå¼ºåˆ¶ç¼“å­˜ç”Ÿæ•ˆ,ç›´æ¥ä½¿ç”¨ç¼“å­˜,å¦åˆ™å‘è¯·æ±‚è·ŸæœåŠ¡å™¨åå•†,çœ‹è¦ä¸è¦ä½¿ç”¨ç¼“å­˜</li>
</ul>
</li>
<li>åå•†ç¼“å­˜<ul>
<li>ETag ä¸ Last-Modified<ul>
<li>ETag &gt; Last-Modified,åŸå› æ˜¯ Last-Modified è®¾è®¡ä¸Šåªç²¾ç¡®åˆ°ç§’,è€Œ ETag åˆ™æ˜¯éšæ—¶æ›´æ–°çš„,æ¯” Last-Modified æ›´åŠ ç²¾ç¡®</li>
</ul>
</li>
</ul>
</li>
<li>å¼ºåˆ¶ç¼“å­˜<ul>
<li>Expires ä¸ Cache-Control<ul>
<li>Cache-Control &gt; Expires</li>
</ul>
</li>
</ul>
</li>
</ul>
]]></content>
      <categories>
        <category>browser</category>
      </categories>
      <tags>
        <tag>browser</tag>
      </tags>
  </entry>
  <entry>
    <title>think of algorithm</title>
    <url>/2022/11/26/think-of-algorithm/</url>
    <content><![CDATA[<h1 id="ç®—æ³•"><a href="#ç®—æ³•" class="headerlink" title="ç®—æ³•"></a>ç®—æ³•</h1><h4 id="æ’åº"><a href="#æ’åº" class="headerlink" title="æ’åº"></a>æ’åº</h4><blockquote>
<p>å†’æ³¡æ’åº</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">bubbleSort</span>(<span class="params">array</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> result = [...array],</span><br><span class="line">        length = result.<span class="property">length</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; length; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> j = <span class="number">0</span>; j &lt; length - i; j++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (result[j] &gt; result[j + <span class="number">1</span>]) &#123;</span><br><span class="line">                <span class="keyword">const</span> temp = result[j];</span><br><span class="line">                result[j] = result[j + <span class="number">1</span>];</span><br><span class="line">                result[j + <span class="number">1</span>] = temp;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>æ’å…¥æ’åº</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">insertSort</span>(<span class="params">array</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> result = [...array],</span><br><span class="line">        length = result.<span class="property">length</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; length; i++) &#123;</span><br><span class="line">        <span class="keyword">let</span> j = i;</span><br><span class="line">        <span class="keyword">while</span> ((result[j - <span class="number">1</span>] &gt; result[j]) &amp;&amp; j &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">const</span> temp = result[j];</span><br><span class="line">            result[j] = result[j - <span class="number">1</span>];</span><br><span class="line">            result[j - <span class="number">1</span>] = temp;</span><br><span class="line">            j--;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>å½’å¹¶æ’åº</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">merge</span>(<span class="params">a, b</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> a_length = a.<span class="property">length</span>,</span><br><span class="line">        b_length = b.<span class="property">length</span>,</span><br><span class="line">        arr = [];</span><br><span class="line">    <span class="keyword">let</span> i = <span class="number">0</span>,</span><br><span class="line">        j = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (i &lt; a_length &amp;&amp; j &lt; b_length) &#123;</span><br><span class="line">        <span class="keyword">if</span> (a[i] &lt;= b[j]) &#123;</span><br><span class="line">            arr.<span class="title function_">push</span>(a[i]);</span><br><span class="line">            i++;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            arr.<span class="title function_">push</span>(b[j]);</span><br><span class="line">            j++</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (i === a_length &amp;&amp; j &lt; b_length) &#123;</span><br><span class="line">        <span class="keyword">while</span> (j &lt; b_length) &#123;</span><br><span class="line">            arr.<span class="title function_">push</span>(b[j]);</span><br><span class="line">            j++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (j === b_length &amp;&amp; i &lt; a_length) &#123;</span><br><span class="line">        <span class="keyword">while</span> (i &lt; a_length) &#123;</span><br><span class="line">            arr.<span class="title function_">push</span>(a[i]);</span><br><span class="line">            i++</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> arr;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">mergeSort</span>(<span class="params">arr</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> length = arr.<span class="property">length</span>;</span><br><span class="line">    <span class="keyword">if</span> (length &lt;= <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> arr;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> middle = <span class="title class_">Math</span>.<span class="title function_">floor</span>(length / <span class="number">2</span>),</span><br><span class="line">        left = arr.<span class="title function_">slice</span>(<span class="number">0</span>, middle),</span><br><span class="line">        right = arr.<span class="title function_">slice</span>(middle);</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">merge</span>(<span class="title function_">mergeSort</span>(left), <span class="title function_">mergeSort</span>(right));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>å¿«é€Ÿæ’åº</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">benchMark</span>(<span class="params">arr, left, right</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> i = left,</span><br><span class="line">        j = right,</span><br><span class="line">        x = arr[left];</span><br><span class="line">    <span class="keyword">while</span> (i &lt; j) &#123;</span><br><span class="line">        <span class="keyword">while</span> (i &lt; j &amp;&amp; arr[j] &gt;= x) &#123;</span><br><span class="line">            j--;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (i &lt; j) &#123;</span><br><span class="line">            arr[i] = arr[j];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span> (i &lt; j &amp;&amp; arr[i] &lt;= x) &#123;</span><br><span class="line">            i++</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (i &lt; j) &#123;</span><br><span class="line">            arr[j] = arr[i];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    arr[i] = x;</span><br><span class="line">    <span class="keyword">return</span> i;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">quickSort</span>(<span class="params">arr, left = <span class="number">0</span>, right = arr.length - <span class="number">1</span></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (left &lt; right) &#123;</span><br><span class="line">        <span class="keyword">const</span> index = <span class="title function_">benchMark</span>(arr, left, right);</span><br><span class="line">        <span class="title function_">quickSort</span>(arr, left, index - <span class="number">1</span>);</span><br><span class="line">        <span class="title function_">quickSort</span>(arr, index + <span class="number">1</span>, right);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> arr;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="è·å–æœ€é•¿å­—ç¬¦å­ä¸²"><a href="#è·å–æœ€é•¿å­—ç¬¦å­ä¸²" class="headerlink" title="è·å–æœ€é•¿å­—ç¬¦å­ä¸²"></a>è·å–æœ€é•¿å­—ç¬¦å­ä¸²</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">getLongStr</span>(<span class="params">str</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> arr = [], max = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; str.<span class="property">length</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">const</span> index = arr.<span class="title function_">indexOf</span>(str[i]);</span><br><span class="line">        <span class="keyword">if</span> (index !== -<span class="number">1</span>) &#123;</span><br><span class="line">            arr.<span class="title function_">splice</span>(<span class="number">0</span>, index + <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        arr.<span class="title function_">push</span>(str.<span class="title function_">charAt</span>(i));</span><br><span class="line">        max = <span class="title class_">Math</span>.<span class="title function_">max</span>(arr.<span class="property">length</span>, max);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> max;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>algorithm</category>
      </categories>
      <tags>
        <tag>algorithm</tag>
        <tag>ç®—æ³•</tag>
      </tags>
  </entry>
  <entry>
    <title>think of angular</title>
    <url>/2023/01/17/think-of-angular/</url>
    <content><![CDATA[<h1 id="angular"><a href="#angular" class="headerlink" title="angular"></a>angular</h1><h4 id="ç‰¹æ€§"><a href="#ç‰¹æ€§" class="headerlink" title="ç‰¹æ€§"></a>ç‰¹æ€§</h4>]]></content>
      <categories>
        <category>angular</category>
      </categories>
      <tags>
        <tag>angular</tag>
      </tags>
  </entry>
  <entry>
    <title>think of git</title>
    <url>/2023/01/30/think-of-git/</url>
    <content><![CDATA[]]></content>
      <categories>
        <category>git</category>
      </categories>
      <tags>
        <tag>git</tag>
      </tags>
  </entry>
  <entry>
    <title>think of redux</title>
    <url>/2023/02/21/think-of-redux/</url>
    <content><![CDATA[]]></content>
      <categories>
        <category>redux</category>
      </categories>
      <tags>
        <tag>redux</tag>
      </tags>
  </entry>
  <entry>
    <title>think of javascript</title>
    <url>/2022/11/22/think-of-javascript/</url>
    <content><![CDATA[<h1 id="js"><a href="#js" class="headerlink" title="js"></a>js</h1><h4 id="compose"><a href="#compose" class="headerlink" title="compose"></a>compose</h4><blockquote>
<p>ES5</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">compose</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> args = <span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">slice</span>.<span class="title function_">call</span>(<span class="variable language_">arguments</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params">x</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> args.<span class="title function_">reduceRight</span>(<span class="keyword">function</span> (<span class="params">a, b</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="title function_">b</span>(a);</span><br><span class="line">        &#125;, x);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ES6</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">compose</span> = (<span class="params">...args</span>) =&gt; <span class="function"><span class="params">x</span> =&gt;</span> args.<span class="title function_">reduceRight</span>(<span class="function">(<span class="params">a, b</span>) =&gt;</span> <span class="title function_">b</span>(a), x);</span><br></pre></td></tr></table></figure>

<h4 id="pipe"><a href="#pipe" class="headerlink" title="pipe"></a>pipe</h4><blockquote>
<p>ES5</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">pipe</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> args = <span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">slice</span>.<span class="title function_">call</span>(<span class="variable language_">arguments</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params">x</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> args.<span class="title function_">reduce</span>(<span class="keyword">function</span> (<span class="params">a, b</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="title function_">b</span>(a);</span><br><span class="line">        &#125;, x);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ES6</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">pipe</span> = (<span class="params">...args</span>) =&gt; <span class="function"><span class="params">x</span> =&gt;</span> args.<span class="title function_">reduce</span>(<span class="function">(<span class="params">a, b</span>) =&gt;</span> <span class="title function_">b</span>(a), x);</span><br></pre></td></tr></table></figure>

<h4 id="flat"><a href="#flat" class="headerlink" title="flat"></a>flat</h4><blockquote>
<p>ES5</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">flat</span>(<span class="params">source, initial</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> start = initial || [];</span><br><span class="line">    <span class="keyword">return</span> source.<span class="title function_">reduce</span>(<span class="keyword">function</span> (<span class="params">a, b</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title class_">Array</span>.<span class="title function_">isArray</span>(b)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="title function_">flat</span>(b, a);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> a.<span class="title function_">concat</span>(b);</span><br><span class="line">    &#125;, start);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ES6</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">flat</span> = (<span class="params">source, inital = []</span>) =&gt; source.<span class="title function_">reduce</span>(<span class="function">(<span class="params">a, b</span>) =&gt;</span> <span class="title class_">Array</span>.<span class="title function_">isArray</span>(b) ? <span class="title function_">flat</span>(b, a) : a.<span class="title function_">concat</span>(b), inital);</span><br></pre></td></tr></table></figure>

<h4 id="layer-Flat"><a href="#layer-Flat" class="headerlink" title="layer Flat"></a>layer Flat</h4><blockquote>
<p>ES5</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">flat</span>(<span class="params">source, layer, initial</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> start = initial || [];</span><br><span class="line">    <span class="keyword">return</span> source.<span class="title function_">reduce</span>(<span class="keyword">function</span> (<span class="params">a, b</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title class_">Array</span>.<span class="title function_">isArray</span>(b) &amp;&amp; layer &gt; <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="title function_">flat</span>(b, layer - <span class="number">1</span>, a);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> a.<span class="title function_">concat</span>(b);</span><br><span class="line">    &#125;, start);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ES6</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">flat</span> = (<span class="params">source, layer = <span class="number">1</span>, initial = []</span>) =&gt; source.<span class="title function_">reduce</span>(<span class="function">(<span class="params">a, b</span>) =&gt;</span> (<span class="title class_">Array</span>.<span class="title function_">isArray</span>(b) &amp;&amp; layer &gt; <span class="number">1</span>) ? <span class="title function_">flat</span>(b, layer - <span class="number">1</span>, a) : a.<span class="title function_">concat</span>(b), initial);</span><br></pre></td></tr></table></figure>

<h4 id="fibonacci"><a href="#fibonacci" class="headerlink" title="fibonacci"></a>fibonacci</h4><blockquote>
<p>ES5</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">fibonacci</span>(<span class="params">n</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (n === <span class="number">1</span> || n === <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> n;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">fibonacci</span>(n - <span class="number">1</span>) + <span class="title function_">fibonacci</span>(n - <span class="number">2</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ES6</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">fibonacci</span> = n =&gt; (n === <span class="number">1</span> || n === <span class="number">0</span>) ? n : (<span class="title function_">fibonacci</span>(n - <span class="number">1</span>) + <span class="title function_">fibonacci</span>(n - <span class="number">2</span>));</span><br></pre></td></tr></table></figure>

<h4 id="tailCall-Fibonacci"><a href="#tailCall-Fibonacci" class="headerlink" title="tailCall Fibonacci"></a>tailCall Fibonacci</h4><blockquote>
<p>ES5</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">fibonacci</span>(<span class="params">n, n1, n2</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> n1 === <span class="string">&#x27;undefined&#x27;</span> &amp;&amp; <span class="keyword">typeof</span> n2 === <span class="string">&#x27;undefined&#x27;</span>) &#123;</span><br><span class="line">        n1 = <span class="number">0</span>;</span><br><span class="line">        n2 = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (n === <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> n1;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">fibonacci</span>(n - <span class="number">1</span>, n2, n1 + n2);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ES6</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">fibonacci</span> = (<span class="params">n, n1 = <span class="number">0</span>, n2 = <span class="number">1</span></span>) =&gt; (n === <span class="number">0</span>) ? n1 : <span class="title function_">fibonacci</span>(n - <span class="number">1</span>, n2, n1 + n2);</span><br></pre></td></tr></table></figure>

<h4 id="cache-Fibonacci"><a href="#cache-Fibonacci" class="headerlink" title="cache Fibonacci"></a>cache Fibonacci</h4><blockquote>
<p>ES5</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">memo</span>(<span class="params">fn, hasher</span>) &#123;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">memoFunc</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> args = <span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">slice</span>.<span class="title function_">call</span>(<span class="variable language_">arguments</span>),</span><br><span class="line">            cache = memoFunc.<span class="property">cache</span>,</span><br><span class="line">            hashKey = hasher ? hasher.<span class="title function_">apply</span>(<span class="variable language_">this</span>, args) : args[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">if</span> (!cache[hashKey]) &#123;</span><br><span class="line">            cache[hashKey] = fn.<span class="title function_">apply</span>(<span class="variable language_">this</span>, args);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> cache[hashKey];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    memoFunc.<span class="property">cache</span> = &#123;&#125;;</span><br><span class="line">    <span class="keyword">return</span> memoFunc;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fibonacci</span>(<span class="params">n</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (n === <span class="number">1</span> || n === <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> n;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">fibonacci</span>(n - <span class="number">1</span>) + <span class="title function_">fibonacci</span>(n - <span class="number">2</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ES6</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">memo</span> = (<span class="params">fn, hasher</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">memoFunc</span> = (<span class="params">...args</span>) =&gt; &#123;</span><br><span class="line">        <span class="keyword">const</span> cache = memoFunc.<span class="property">cache</span>,</span><br><span class="line">            hashKey = hasher ? <span class="title function_">hasher</span>(...args) : args[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">if</span> (!cache[hashKey]) &#123;</span><br><span class="line">            cache[hashKey] = <span class="title function_">fn</span>(...args);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> cache[hashKey];</span><br><span class="line">    &#125;;</span><br><span class="line">    memoFunc.<span class="property">cache</span> = &#123;&#125;;</span><br><span class="line">    <span class="keyword">return</span> memoFunc;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">fibonacci</span> = n =&gt; (n === <span class="number">0</span> || n === <span class="number">1</span>) ? n : (<span class="title function_">fibonacci</span>(n - <span class="number">1</span>) + <span class="title function_">fibonacci</span>(n - <span class="number">2</span>));</span><br></pre></td></tr></table></figure>

<h4 id="curry"><a href="#curry" class="headerlink" title="curry"></a>curry</h4><blockquote>
<p>ES5</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">curry</span>(<span class="params">fn</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> paramsLength = fn.<span class="property">length</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">function</span> <span class="title function_">callee</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> args = <span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">slice</span>.<span class="title function_">call</span>(<span class="variable language_">arguments</span>),</span><br><span class="line">            length = args.<span class="property">length</span>;</span><br><span class="line">        <span class="keyword">if</span> (length &gt;= paramsLength) &#123;</span><br><span class="line">            <span class="keyword">return</span> fn.<span class="title function_">apply</span>(<span class="variable language_">this</span>, args);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">                <span class="keyword">var</span> calleeArgs = <span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">slice</span>.<span class="title function_">call</span>(<span class="variable language_">arguments</span>);</span><br><span class="line">                <span class="keyword">return</span> callee.<span class="title function_">apply</span>(<span class="variable language_">this</span>, args.<span class="title function_">concat</span>(calleeArgs));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ES6</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">curry</span> = (<span class="params">fn</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> paramsLength = fn.<span class="property">length</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">function</span> <span class="title function_">callee</span>(<span class="params">...args</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123;length&#125; = args;</span><br><span class="line">        <span class="keyword">if</span> (length &gt;= paramsLength) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="title function_">fn</span>(...args);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="function">(<span class="params">...calleeArgs</span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="title function_">callee</span>(...[...args, ...calleeArgs]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="debounce"><a href="#debounce" class="headerlink" title="debounce"></a>debounce</h4><blockquote>
<p>ES5</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">debounce</span>(<span class="params">fn, timeout</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> timer = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (timer) &#123;</span><br><span class="line">            <span class="built_in">clearTimeout</span>(timer);</span><br><span class="line">            timer = <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">var</span> self = <span class="variable language_">this</span>,</span><br><span class="line">            args = <span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">slice</span>.<span class="title function_">call</span>(<span class="variable language_">this</span>);</span><br><span class="line">        timer = <span class="built_in">setTimeout</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            fn.<span class="title function_">apply</span>(self, args);</span><br><span class="line">        &#125;, timeout);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ES6</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">debounce</span> = (<span class="params">fn, timeout</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> timer = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="function">(<span class="params">...args</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (timer) &#123;</span><br><span class="line">            <span class="built_in">clearTimeout</span>(timer);</span><br><span class="line">            timer = <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        timer = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="title function_">fn</span>(...args);</span><br><span class="line">        &#125;, timeout);</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="throttle"><a href="#throttle" class="headerlink" title="throttle"></a>throttle</h4><blockquote>
<p>ES5</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">throttle</span>(<span class="params">fn, timeout</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> timer = <span class="literal">null</span>,</span><br><span class="line">        first = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> self = <span class="variable language_">this</span>,</span><br><span class="line">            args = <span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">slice</span>.<span class="title function_">call</span>(<span class="variable language_">arguments</span>);</span><br><span class="line">        <span class="keyword">if</span> (timer) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (first) &#123;</span><br><span class="line">            fn.<span class="title function_">apply</span>(self, args);</span><br><span class="line">            first = <span class="literal">false</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        timer = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            fn.<span class="title function_">apply</span>(self, args);</span><br><span class="line">            <span class="built_in">clearTimeout</span>(timer);</span><br><span class="line">            timer = <span class="literal">null</span>;</span><br><span class="line">        &#125;, timeout);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ES6</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">throttle</span> = (<span class="params">fn, timeout</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> timer = <span class="literal">null</span>,</span><br><span class="line">        first = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="function">(<span class="params">...args</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (timer) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (first) &#123;</span><br><span class="line">            <span class="title function_">fn</span>(...args);</span><br><span class="line">            first = <span class="literal">false</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        timer = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="title function_">fn</span>(...args);</span><br><span class="line">            <span class="built_in">clearTimeout</span>(timer);</span><br><span class="line">            timer = <span class="literal">null</span>;</span><br><span class="line">        &#125;, timeout);</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="factorial"><a href="#factorial" class="headerlink" title="factorial"></a>factorial</h4><blockquote>
<p>ES5</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">factorial</span>(<span class="params">n</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (n === <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> n;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> n * <span class="title function_">factorial</span>(n - <span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ES6</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">factorial</span> = n =&gt; (n === <span class="number">1</span>) ? n : n * <span class="title function_">factorial</span>(n - <span class="number">1</span>);</span><br></pre></td></tr></table></figure>

<h4 id="tailCall-Factorial"><a href="#tailCall-Factorial" class="headerlink" title="tailCall Factorial"></a>tailCall Factorial</h4><blockquote>
<p>ES5</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">factorial</span>(<span class="params">n, p</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> p === <span class="string">&#x27;undefined&#x27;</span>) &#123;</span><br><span class="line">        p = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (n === <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> p;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">factorial</span>(n - <span class="number">1</span>, p * n);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ES6</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">factorial</span> = (<span class="params">n, p = <span class="number">1</span></span>) =&gt; n === <span class="number">1</span> ? p : <span class="title function_">factorial</span>(n - <span class="number">1</span>, p * n);</span><br></pre></td></tr></table></figure>

<h4 id="shallow-Copy"><a href="#shallow-Copy" class="headerlink" title="shallow Copy"></a>shallow Copy</h4><blockquote>
<p>ES5</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">shallowCopy</span>(<span class="params">o</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> _o = <span class="title class_">Array</span>.<span class="title function_">isArray</span>(o) ? [] : &#123;&#125;;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> key <span class="keyword">in</span> o) &#123;</span><br><span class="line">        <span class="keyword">if</span> (o.<span class="title function_">hasOwnProperty</span>(key)) &#123;</span><br><span class="line">            _o[key] = o[key];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> _o;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ES6</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">shallowCopy</span> = o =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> _o = <span class="title class_">Array</span>.<span class="title function_">isArray</span>(o) ? [] : &#123;&#125;;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">in</span> o) &#123;</span><br><span class="line">        <span class="keyword">if</span> (o.<span class="title function_">hasOwnProperty</span>(key)) &#123;</span><br><span class="line">            _o[key] = o[key];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> _o;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="deep-Clone"><a href="#deep-Clone" class="headerlink" title="deep Clone"></a>deep Clone</h4><blockquote>
<p>ES5</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">deepClone</span>(<span class="params">o</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> _o = <span class="title class_">Array</span>.<span class="title function_">isArray</span>(o) ? [] : &#123;&#125;;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> key <span class="keyword">of</span> <span class="title class_">Reflect</span>.<span class="title function_">ownKeys</span>(o)) &#123;</span><br><span class="line">        <span class="keyword">if</span> (o.<span class="title function_">hasOwnProperty</span>(key)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (o[key] &amp;&amp; <span class="keyword">typeof</span> o[key] === <span class="string">&#x27;object&#x27;</span>) &#123;</span><br><span class="line">                _o[key] = <span class="title function_">deepClone</span>(o[key]);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                _o[key] = o[key];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> _o;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ES6</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">deepClone</span> = o =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> _o = <span class="title class_">Array</span>.<span class="title function_">isArray</span>(o) ? [] : &#123;&#125;;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">of</span> <span class="title class_">Reflect</span>.<span class="title function_">ownKeys</span>(o)) &#123;</span><br><span class="line">        <span class="keyword">if</span> (o.<span class="title function_">hasOwnProperty</span>(key)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (o[key] &amp;&amp; <span class="keyword">typeof</span> o[key] === <span class="string">&#x27;object&#x27;</span>) &#123;</span><br><span class="line">                _o[key] = <span class="title function_">deepClone</span>(o[key]);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                _o[key] = o[key];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> _o;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="deep-Clone-Loop"><a href="#deep-Clone-Loop" class="headerlink" title="deep Clone Loop"></a>deep Clone Loop</h4><blockquote>
<p>ES5</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">deepClone</span>(<span class="params">o</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> weakMap = <span class="keyword">new</span> <span class="title class_">WeakMap</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">deepCloneFunc</span>(<span class="params">o</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> _o = <span class="title class_">Array</span>.<span class="title function_">isArray</span>(o) ? [] : &#123;&#125;;</span><br><span class="line">        <span class="keyword">var</span> existObj = weakMap.<span class="title function_">get</span>(o);</span><br><span class="line">        <span class="keyword">if</span> (existObj) <span class="keyword">return</span> existObj;</span><br><span class="line">        weakMap.<span class="title function_">set</span>(o, o);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> key <span class="keyword">of</span> <span class="title class_">Reflect</span>.<span class="title function_">ownKeys</span>(o)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (o.<span class="title function_">hasOwnProperty</span>(key)) &#123;</span><br><span class="line">                <span class="keyword">if</span> (o[key] &amp;&amp; <span class="keyword">typeof</span> o[key] === <span class="string">&#x27;object&#x27;</span>) &#123;</span><br><span class="line">                    _o[key] = <span class="title function_">deepCloneFunc</span>(o[key]);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    _o[key] = o[key];</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> _o;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">deepCloneFunc</span>(o);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ES6</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">deepClone</span> = o =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> weakMap = <span class="keyword">new</span> <span class="title class_">WeakMap</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">deepCloneFunc</span> = o =&gt; &#123;</span><br><span class="line">        <span class="keyword">const</span> _o = <span class="title class_">Array</span>.<span class="title function_">isArray</span>(o) ? [] : &#123;&#125;;</span><br><span class="line">        <span class="keyword">const</span> existObj = weakMap.<span class="title function_">get</span>(o);</span><br><span class="line">        <span class="keyword">if</span> (existObj) <span class="keyword">return</span> existObj;</span><br><span class="line">        weakMap.<span class="title function_">set</span>(o, o);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">of</span> <span class="title class_">Reflect</span>.<span class="title function_">ownKeys</span>(o)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (o.<span class="title function_">hasOwnProperty</span>(key)) &#123;</span><br><span class="line">                <span class="keyword">if</span> (o[key] &amp;&amp; <span class="keyword">typeof</span> o[key] === <span class="string">&#x27;object&#x27;</span>) &#123;</span><br><span class="line">                    _o[key] = <span class="title function_">deepCloneFunc</span>(o[key]);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    _o[key] = o[key];</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> _o;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">deepCloneFunc</span>(o);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="pick"><a href="#pick" class="headerlink" title="pick"></a>pick</h4><blockquote>
<p>ES5</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">pick</span>(<span class="params">o, property</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> weakMap = <span class="keyword">new</span> <span class="title class_">WeakMap</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">deepClone</span>(<span class="params">o</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> _o = <span class="title class_">Array</span>.<span class="title function_">isArray</span>(o) ? [] : &#123;&#125;;</span><br><span class="line">        <span class="keyword">var</span> existObj = weakMap.<span class="title function_">get</span>(o);</span><br><span class="line">        <span class="keyword">if</span> (existObj) <span class="keyword">return</span> existObj;</span><br><span class="line">        weakMap.<span class="title function_">set</span>(o, o);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> key <span class="keyword">of</span> <span class="title class_">Reflect</span>.<span class="title function_">ownKeys</span>(o)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (o.<span class="title function_">hasOwnProperty</span>(key) &amp;&amp; property.<span class="title function_">includes</span>(key)) &#123;</span><br><span class="line">                <span class="keyword">if</span> (o[key] &amp;&amp; <span class="keyword">typeof</span> o[key] === <span class="string">&#x27;object&#x27;</span>) &#123;</span><br><span class="line">                    _o[key] = <span class="title function_">deepClone</span>(o[key]);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    _o[key] = o[key];</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> _o;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">deepClone</span>(o);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ES6</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">pick</span> = (<span class="params">o, property</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> weakMap = <span class="keyword">new</span> <span class="title class_">WeakMap</span>();</span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">deepClone</span> = (<span class="params">o</span>) =&gt; &#123;</span><br><span class="line">        <span class="keyword">const</span> _o = <span class="title class_">Array</span>.<span class="title function_">isArray</span>(o) ? [] : &#123;&#125;;</span><br><span class="line">        <span class="keyword">const</span> existObj = weakMap.<span class="title function_">get</span>(o);</span><br><span class="line">        <span class="keyword">if</span> (existObj) <span class="keyword">return</span> existObj;</span><br><span class="line">        weakMap.<span class="title function_">set</span>(o, o);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">of</span> <span class="title class_">Reflect</span>.<span class="title function_">ownKeys</span>(o)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (o.<span class="title function_">hasOwnProperty</span>(key) &amp;&amp; property.<span class="title function_">includes</span>(key)) &#123;</span><br><span class="line">                _o[key] = <span class="title function_">deepClone</span>(o[key]);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                _o[key] = o[key];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> _o;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">deepClone</span>(o);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="new"><a href="#new" class="headerlink" title="new"></a>new</h4><blockquote>
<p>ES5</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">myNew</span>(<span class="params">fn</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> fn !== <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">TypeError</span>(<span class="string">&#x27;The first argument to a function must be a method&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> obj = &#123;&#125;,</span><br><span class="line">        args = <span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">slice</span>.<span class="title function_">call</span>(<span class="variable language_">arguments</span>, <span class="number">1</span>),</span><br><span class="line">        result = fn.<span class="title function_">apply</span>(obj, args),</span><br><span class="line">        isObject = <span class="keyword">typeof</span> result === <span class="string">&#x27;object&#x27;</span> &amp;&amp; result !== <span class="literal">null</span>,</span><br><span class="line">        isFunction = <span class="keyword">typeof</span> result === <span class="string">&#x27;function&#x27;</span>;</span><br><span class="line">    <span class="keyword">if</span> (isFunction || isObject) &#123;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    obj.<span class="property">__proto__</span> = fn.<span class="property"><span class="keyword">prototype</span></span>;</span><br><span class="line">    <span class="keyword">return</span> obj;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ES6</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">myNew</span> = (<span class="params">fn, ...args</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> fn !== <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">TypeError</span>(<span class="string">&#x27;The first argument to a function must be a method&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> obj = &#123;&#125;,</span><br><span class="line">        result = fn.<span class="title function_">call</span>(obj, ...args),</span><br><span class="line">        isObject = <span class="keyword">typeof</span> result === <span class="string">&#x27;object&#x27;</span> &amp;&amp; result !== <span class="literal">null</span>,</span><br><span class="line">        isFunction = <span class="keyword">typeof</span> result === <span class="string">&#x27;function&#x27;</span>;</span><br><span class="line">    <span class="keyword">if</span> (isObject || isFunction) &#123;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    obj.<span class="property">__proto__</span> = fn.<span class="property"><span class="keyword">prototype</span></span>;</span><br><span class="line">    <span class="keyword">return</span> obj;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="instanceof"><a href="#instanceof" class="headerlink" title="instanceof"></a>instanceof</h4><blockquote>
<p>ES5</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">myInstanceof</span>(<span class="params">targetObj, targetClass</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!targetObj || !targetClass || !targetObj.<span class="property">__proto__</span> || !targetClass.<span class="property"><span class="keyword">prototype</span></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> current = targetObj;</span><br><span class="line">    <span class="keyword">while</span> (current) &#123;</span><br><span class="line">        <span class="keyword">if</span> (current.<span class="property">__proto__</span> === targetClass.<span class="property"><span class="keyword">prototype</span></span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        current = current.<span class="property">__proto__</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ES6</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">myInstanceof</span> = (<span class="params">targetObj, targetClass</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (!targetObj || !targetClass || !targetObj.<span class="property">__proto__</span> || !targetClass.<span class="property"><span class="keyword">prototype</span></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">let</span> current = targetObj;</span><br><span class="line">    <span class="keyword">while</span> (current) &#123;</span><br><span class="line">        <span class="keyword">if</span> (current.<span class="property">__proto__</span> === targetClass.<span class="property"><span class="keyword">prototype</span></span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        current = current.<span class="property">__proto__</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="unit"><a href="#unit" class="headerlink" title="unit"></a>unit</h4><blockquote>
<p>ES5</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">unit</span>(<span class="params">desc, fn</span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="title function_">fn</span>();</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(desc + <span class="string">&#x27; -&gt; PASS!&#x27;</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">error</span>(desc + <span class="string">&#x27; -&gt; FAILED:&#x27;</span>, e);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">test</span>(<span class="params">res</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="attr">toBe</span>: <span class="keyword">function</span> (<span class="params">expectRes</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (res !== expectRes) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;æœŸæœ›å€¼æ˜¯&#x27;</span> + expectRes + <span class="string">&#x27;, ä½†å®é™…ä¸Šå¾—åˆ°çš„æ˜¯&#x27;</span> + res);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ES6</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">unit</span> = (<span class="params">desc, fn</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="title function_">fn</span>();</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`<span class="subst">$&#123;desc&#125;</span> -&gt; PASS!`</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">`<span class="subst">$&#123;desc&#125;</span> -&gt; FAILED:`</span>, e);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">test</span> = res =&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="title function_">toBe</span>(<span class="params">expectRes</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (res !== expectRes) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">`æœŸæœ›å€¼æ˜¯<span class="subst">$&#123;expectRes&#125;</span>ï¼Œä½†å®é™…ä¸Šå¾—åˆ°çš„æ˜¯<span class="subst">$&#123;res&#125;</span>`</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="call"><a href="#call" class="headerlink" title="call"></a>call</h4><blockquote>
<p>ES5</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Function</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">myCall</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="variable language_">this</span> !== <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">TypeError</span>(<span class="string">&#x27;call æ–¹æ³•å¿…é¡»è¢«ä¸€ä¸ªå‡½æ•°è°ƒç”¨!&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> args = <span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">slice</span>.<span class="title function_">call</span>(<span class="variable language_">arguments</span>),</span><br><span class="line">        o = args[<span class="number">0</span>] || <span class="variable language_">window</span>,</span><br><span class="line">        params = args.<span class="title function_">slice</span>(<span class="number">1</span>) || [],</span><br><span class="line">        symbolFunc = <span class="title class_">Symbol</span>.<span class="title function_">for</span>(<span class="string">&#x27;func&#x27;</span>);</span><br><span class="line">    o[symbolFunc] = <span class="variable language_">this</span>;</span><br><span class="line">    <span class="keyword">const</span> res = o[symbolFunc](...params);</span><br><span class="line">    <span class="keyword">delete</span> o[symbolFunc];</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ES6</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Function</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">myCall</span> = <span class="keyword">function</span> (<span class="params">o = <span class="variable language_">window</span>, ...args</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="variable language_">this</span> !== <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">TypeError</span>(<span class="string">&#x27;call æ–¹æ³•å¿…é¡»è¢«ä¸€ä¸ªå‡½æ•°è°ƒç”¨!&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> symbolFunc = <span class="title class_">Symbol</span>.<span class="title function_">for</span>(<span class="string">&#x27;func&#x27;</span>);</span><br><span class="line">    o[symbolFunc] = <span class="variable language_">this</span>;</span><br><span class="line">    <span class="keyword">const</span> res = o[symbolFunc](...args);</span><br><span class="line">    <span class="keyword">delete</span> o[symbolFunc];</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="apply"><a href="#apply" class="headerlink" title="apply"></a>apply</h4><blockquote>
<p>ES5</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Function</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">myApply</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="variable language_">this</span> !== <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">TypeError</span>(<span class="string">&#x27;apply æ–¹æ³•å¿…é¡»è¢«ä¸€ä¸ªå‡½æ•°è°ƒç”¨!&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> args = <span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">slice</span>.<span class="title function_">call</span>(<span class="variable language_">arguments</span>),</span><br><span class="line">        o = args[<span class="number">0</span>] || <span class="variable language_">window</span>,</span><br><span class="line">        params = args[<span class="number">1</span>] || [],</span><br><span class="line">        symbolFunc = <span class="title class_">Symbol</span>.<span class="title function_">for</span>(<span class="string">&#x27;func&#x27;</span>);</span><br><span class="line">    o[symbolFunc] = <span class="variable language_">this</span>;</span><br><span class="line">    <span class="keyword">const</span> res = o[symbolFunc](...params);</span><br><span class="line">    <span class="keyword">delete</span> o[symbolFunc];</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ES6</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Function</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">myApply</span> = <span class="keyword">function</span> (<span class="params">o = <span class="variable language_">window</span>, args = []</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="variable language_">this</span> !== <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">TypeError</span>(<span class="string">&#x27;apply æ–¹æ³•å¿…é¡»è¢«ä¸€ä¸ªå‡½æ•°è°ƒç”¨!&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> symbolFunc = <span class="title class_">Symbol</span>.<span class="title function_">for</span>(<span class="string">&#x27;func&#x27;</span>);</span><br><span class="line">    o[symbolFunc] = <span class="variable language_">this</span>;</span><br><span class="line">    <span class="keyword">const</span> res = o[symbolFunc](...args);</span><br><span class="line">    <span class="keyword">delete</span> o[symbolFunc];</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="bind"><a href="#bind" class="headerlink" title="bind"></a>bind</h4><blockquote>
<p>ES5</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Function</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">myBind</span> = <span class="keyword">function</span> (<span class="params">context</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="variable language_">this</span> !== <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">TypeError</span>(<span class="string">&#x27;bind æ–¹æ³•å¿…é¡»è¢«ä¸€ä¸ªå‡½æ•°è°ƒç”¨!&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> args = <span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">slice</span>.<span class="title function_">call</span>(<span class="variable language_">arguments</span>, <span class="number">1</span>),</span><br><span class="line">        self = <span class="variable language_">this</span>,</span><br><span class="line">        fBind,</span><br><span class="line">        F = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        &#125;;</span><br><span class="line">    fBind = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> innerArgs = <span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">slice</span>.<span class="title function_">call</span>(<span class="variable language_">arguments</span>);</span><br><span class="line">        <span class="keyword">return</span> self.<span class="title function_">apply</span>(<span class="variable language_">this</span> <span class="keyword">instanceof</span> fBind ? <span class="variable language_">this</span> : context, args.<span class="title function_">concat</span>(innerArgs));</span><br><span class="line">    &#125;;</span><br><span class="line">    F.<span class="property"><span class="keyword">prototype</span></span> = self.<span class="property"><span class="keyword">prototype</span></span>;</span><br><span class="line">    <span class="title class_">Object</span>.<span class="title function_">setPrototypeOf</span>(fBind.<span class="property"><span class="keyword">prototype</span></span>, F.<span class="property"><span class="keyword">prototype</span></span>);</span><br><span class="line">    <span class="keyword">return</span> fBind;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ES6</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Function</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">myBind</span> = <span class="keyword">function</span> (<span class="params">context, ...args</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="variable language_">this</span> !== <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">TypeError</span>(<span class="string">&#x27;bind æ–¹æ³•å¿…é¡»è¢«ä¸€ä¸ªå‡½æ•°è°ƒç”¨!&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> self = <span class="variable language_">this</span>,</span><br><span class="line">        F = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        &#125;;</span><br><span class="line">    <span class="keyword">let</span> fBind;</span><br><span class="line">    fBind = <span class="keyword">function</span> (<span class="params">...innerArgs</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> self.<span class="title function_">apply</span>(<span class="variable language_">this</span> <span class="keyword">instanceof</span> fBind ? <span class="variable language_">this</span> : context, [...args, ...innerArgs]);</span><br><span class="line">    &#125;;</span><br><span class="line">    F.<span class="property"><span class="keyword">prototype</span></span> = self.<span class="property"><span class="keyword">prototype</span></span>;</span><br><span class="line">    <span class="title class_">Object</span>.<span class="title function_">setPrototypeOf</span>(fBind.<span class="property"><span class="keyword">prototype</span></span>, F.<span class="property"><span class="keyword">prototype</span></span>);</span><br><span class="line">    <span class="keyword">return</span> fBind;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="softBind"><a href="#softBind" class="headerlink" title="softBind"></a>softBind</h4><blockquote>
<p>ES5</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Function</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">softBind</span> = <span class="keyword">function</span> (<span class="params">context</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="variable language_">this</span> !== <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">TypeError</span>(<span class="string">&#x27;softBind æ–¹æ³•å¿…é¡»è¢«ä¸€ä¸ªå‡½æ•°è°ƒç”¨!&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> args = <span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">slice</span>.<span class="title function_">call</span>(<span class="variable language_">arguments</span>, <span class="number">1</span>),</span><br><span class="line">        self = <span class="variable language_">this</span>,</span><br><span class="line">        fBind,</span><br><span class="line">        F = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        &#125;;</span><br><span class="line">    fBind = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> innerArgs = <span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">slice</span>.<span class="title function_">call</span>(<span class="variable language_">arguments</span>);</span><br><span class="line">        <span class="keyword">return</span> self.<span class="title function_">apply</span>((<span class="variable language_">this</span> === <span class="variable language_">window</span> || <span class="variable language_">this</span> === <span class="literal">undefined</span>) ? context : <span class="variable language_">this</span>, args.<span class="title function_">concat</span>(innerArgs));</span><br><span class="line">    &#125;;</span><br><span class="line">    F.<span class="property"><span class="keyword">prototype</span></span> = self.<span class="property"><span class="keyword">prototype</span></span>;</span><br><span class="line">    <span class="title class_">Object</span>.<span class="title function_">setPrototypeOf</span>(fBind.<span class="property"><span class="keyword">prototype</span></span>, F.<span class="property"><span class="keyword">prototype</span></span>);</span><br><span class="line">    <span class="keyword">return</span> fBind;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ES6</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Function</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">softBind</span> = <span class="keyword">function</span> (<span class="params">context, ...args</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="variable language_">this</span> !== <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">TypeError</span>(<span class="string">&#x27;softBind æ–¹æ³•å¿…é¡»è¢«ä¸€ä¸ªå‡½æ•°è°ƒç”¨!&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> self = <span class="variable language_">this</span>,</span><br><span class="line">        F = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        &#125;;</span><br><span class="line">    <span class="keyword">let</span> fBind;</span><br><span class="line">    fBind = <span class="keyword">function</span> (<span class="params">...innerArgs</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> self.<span class="title function_">apply</span>((<span class="variable language_">this</span> === <span class="variable language_">window</span> || <span class="variable language_">this</span> === <span class="literal">undefined</span>) ? context : <span class="variable language_">this</span>, [...args, ...innerArgs]);</span><br><span class="line">    &#125;;</span><br><span class="line">    F.<span class="property"><span class="keyword">prototype</span></span> = self.<span class="property"><span class="keyword">prototype</span></span>;</span><br><span class="line">    <span class="title class_">Object</span>.<span class="title function_">setPrototypeOf</span>(fBind.<span class="property"><span class="keyword">prototype</span></span>, F.<span class="property"><span class="keyword">prototype</span></span>);</span><br><span class="line">    <span class="keyword">return</span> fBind;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="Event-Loop"><a href="#Event-Loop" class="headerlink" title="Event Loop"></a>Event Loop</h4><blockquote>
<p>browser</p>
</blockquote>
<p>æµè§ˆå™¨ä¸­çš„ Event Loop å…¶å®æ¯”è¾ƒç®€å•,æŒ‰ç…§æµç¨‹çš„æ­¥éª¤å¦‚ä¸‹:</p>
<ul>
<li>é¦–å…ˆ JS çº¿ç¨‹ä¼šåŒºåˆ†å¼‚/åŒæ­¥ç¨‹åº,é‡åˆ°åŒæ­¥ç¨‹åºä¼˜å…ˆæ‰§è¡Œ,é‡åˆ°å¼‚æ­¥ç¨‹åºä¼šå°†å…¶ç§»å…¥è‡³ç›¸å…³çš„å¤„ç†çº¿ç¨‹(å®šæ—¶å™¨çº¿ç¨‹ã€å¼‚æ­¥ HTTP<br>è¯·æ±‚çº¿ç¨‹)</li>
<li>æ¥ç€,ä¼šå°†ç›¸å…³çš„å¤„ç†çº¿ç¨‹ç¬¦åˆæ¡ä»¶çš„å›è°ƒäº‹ä»¶ç§»å…¥è‡³äº‹ä»¶è§¦å‘çº¿ç¨‹å†…,è¿›å…¥ Event Loop äº‹ä»¶å¾ªç¯æ‰§è¡Œæœºåˆ¶</li>
<li>Event Loop ä¼šç­‰å¾…è‡³åŒæ­¥ç¨‹åºå…¨éƒ¨æ‰§è¡Œå®Œæˆå,è½®è¯¢äº‹ä»¶é˜Ÿåˆ—ä¸­çš„å›è°ƒäº‹ä»¶,è§¦å‘æ‰§è¡Œ</li>
<li>Event Loop ä¸­çš„äº‹ä»¶é˜Ÿåˆ—åˆ†ä¸ºä¸¤ç§: å®äº‹ä»¶ã€å¾®äº‹ä»¶,åœ¨æ¯æ¬¡è§¦å‘å®äº‹ä»¶ä¹‹å‰,éƒ½ä¼šå…ˆå»è½®è¯¢æ‰§è¡Œå¾®äº‹ä»¶<ul>
<li>å®äº‹ä»¶<ul>
<li>script</li>
<li>I/O</li>
<li>setTimeoutã€setInterval</li>
<li>setImmediate(Node.js)</li>
<li>UI äº‹ä»¶</li>
<li>postMessage</li>
</ul>
</li>
<li>å¾®äº‹ä»¶<ul>
<li>Promise</li>
<li>process.nextTick(Node.js)</li>
<li>Object.observe</li>
<li>MutationObserver</li>
</ul>
</li>
</ul>
</li>
</ul>
<blockquote>
<p>nodejs</p>
</blockquote>
<p>nodejs ä¸­çš„ Event Loop å°±æœ‰æ‰€ä¸åŒ, å…¶è¿è¡Œçš„é˜¶æ®µåˆ†ä¸º:</p>
<ul>
<li>timer: æ‰§è¡Œ setTimeoutã€setInterval å›è°ƒäº‹ä»¶</li>
<li>pending callbacks: æ‰§è¡Œå»¶è¿Ÿåˆ°ä¸‹ä¸€ä¸ª I/O å›è°ƒ</li>
<li>idle,prepare: ä»…ç³»ç»Ÿå†…éƒ¨ä½¿ç”¨</li>
<li>poll: æ£€ç´¢æ–°çš„ I/O äº‹ä»¶,æ‰§è¡Œä¸ I/O ç›¸å…³çš„å›è°ƒ</li>
<li>check: æ‰§è¡Œ setImmediate å›è°ƒ</li>
<li>close callbacks: æ‰§è¡Œä¸€äº›å…³é—­çš„å›è°ƒå‡½æ•°,å¦‚ socket.close</li>
</ul>
<p>æ³¨æ„: poll é˜Ÿåˆ—æ‰§è¡Œå®Œæˆå,å¦‚æœæ²¡æœ‰ setImmediate,ä½†æ˜¯æœ‰å®šæ—¶å™¨åˆ°æœŸ,ä¼šç»•å›æ‰§è¡Œå®šæ—¶å™¨ timer é˜¶æ®µ</p>
<h4 id="Promise"><a href="#Promise" class="headerlink" title="Promise"></a>Promise</h4><blockquote>
<p>ES5</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="title class_">Promise</span> = (<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> <span class="variable constant_">PENDING</span> = <span class="string">&#x27;PENDING&#x27;</span>,</span><br><span class="line">        <span class="variable constant_">FULFILLED</span> = <span class="string">&#x27;FULFILLED&#x27;</span>,</span><br><span class="line">        <span class="variable constant_">REJECTED</span> = <span class="string">&#x27;REJECTED&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">Promise</span>(<span class="params">fn</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">status</span> = <span class="variable constant_">PENDING</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">value</span> = <span class="literal">null</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">reason</span> = <span class="literal">null</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">onFulfilledCallbacks</span> = [];</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">onRejectedCallbacks</span> = [];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> that = <span class="variable language_">this</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">resolve</span>(<span class="params">value</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (that.<span class="property">status</span> === <span class="variable constant_">PENDING</span>) &#123;</span><br><span class="line">                that.<span class="property">status</span> = <span class="variable constant_">FULFILLED</span>;</span><br><span class="line">                that.<span class="property">value</span> = value;</span><br><span class="line">                that.<span class="property">onFulfilledCallbacks</span>.<span class="title function_">forEach</span>(<span class="keyword">function</span> (<span class="params">callback</span>) &#123;</span><br><span class="line">                    <span class="title function_">callback</span>(that.<span class="property">value</span>);</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">reject</span>(<span class="params">reason</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (that.<span class="property">status</span> === <span class="variable constant_">PENDING</span>) &#123;</span><br><span class="line">                that.<span class="property">status</span> = <span class="variable constant_">REJECTED</span>;</span><br><span class="line">                that.<span class="property">reason</span> = reason;</span><br><span class="line">                that.<span class="property">onRejectedCallbacks</span>.<span class="title function_">forEach</span>(<span class="keyword">function</span> (<span class="params">callback</span>) &#123;</span><br><span class="line">                    <span class="title function_">callback</span>(that.<span class="property">reason</span>);</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="title function_">fn</span>(resolve, reject);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">            <span class="title function_">reject</span>(err);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title class_">Promise</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">then</span> = <span class="keyword">function</span> (<span class="params">onFulfilled, onRejected</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> onFulfilled !== <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">            onFulfilled = <span class="keyword">function</span> (<span class="params">value</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> value;</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> onRejected !== <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">            onRejected = <span class="keyword">function</span> (<span class="params">reason</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (reason <span class="keyword">instanceof</span> <span class="title class_">Error</span>) &#123;</span><br><span class="line">                    <span class="keyword">throw</span> reason;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(reason);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">let</span> promise,</span><br><span class="line">            then,</span><br><span class="line">            that = <span class="variable language_">this</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">status</span> === <span class="variable constant_">FULFILLED</span>) &#123;</span><br><span class="line">            promise = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="keyword">function</span> (<span class="params">resolve, reject</span>) &#123;</span><br><span class="line">                <span class="built_in">setTimeout</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">                    (<span class="keyword">function</span> <span class="title function_">thenable</span>(<span class="params">value</span>) &#123;</span><br><span class="line">                        <span class="keyword">if</span> (<span class="keyword">typeof</span> onFulfilled !== <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">                            <span class="title function_">resolve</span>(value);</span><br><span class="line">                        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                            then = value.<span class="property">then</span>;</span><br><span class="line">                            <span class="keyword">if</span> (<span class="keyword">typeof</span> then === <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">                                then.<span class="title function_">call</span>(that, <span class="keyword">function</span> (<span class="params">y</span>) &#123;</span><br><span class="line">                                    thenable.<span class="title function_">call</span>(that, y);</span><br><span class="line">                                &#125;, <span class="keyword">function</span> (<span class="params">r</span>) &#123;</span><br><span class="line">                                    <span class="title function_">reject</span>(r);</span><br><span class="line">                                &#125;);</span><br><span class="line">                            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                                <span class="keyword">const</span> x = <span class="title function_">onFulfilled</span>(value);</span><br><span class="line">                                <span class="title function_">resolvePromise</span>(promise, x, resolve, reject);</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;)(that.<span class="property">value</span>);</span><br><span class="line">                &#125;, <span class="number">0</span>);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">status</span> === <span class="variable constant_">REJECTED</span>) &#123;</span><br><span class="line">            promise = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="keyword">function</span> (<span class="params">resolve, reject</span>) &#123;</span><br><span class="line">                <span class="built_in">setTimeout</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        <span class="keyword">if</span> (<span class="keyword">typeof</span> onRejected !== <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">                            <span class="title function_">reject</span>(that.<span class="property">reason</span>);</span><br><span class="line">                        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                            <span class="keyword">const</span> x = <span class="title function_">onRejected</span>(that.<span class="property">reason</span>);</span><br><span class="line">                            <span class="title function_">resolvePromise</span>(promise, x, resolve, reject);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">                        <span class="title function_">reject</span>(error);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;, <span class="number">0</span>);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">status</span> === <span class="variable constant_">PENDING</span>) &#123;</span><br><span class="line">            promise = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="keyword">function</span> (<span class="params">resolve, reject</span>) &#123;</span><br><span class="line">                that.<span class="property">onFulfilledCallbacks</span>.<span class="title function_">push</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">                    <span class="built_in">setTimeout</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">                        <span class="keyword">try</span> &#123;</span><br><span class="line">                            (<span class="keyword">function</span> <span class="title function_">thenable</span>(<span class="params">value</span>) &#123;</span><br><span class="line">                                <span class="keyword">if</span> (<span class="keyword">typeof</span> onFulfilled !== <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">                                    <span class="title function_">resolve</span>(value);</span><br><span class="line">                                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                                    then = value.<span class="property">then</span>;</span><br><span class="line">                                    <span class="keyword">if</span> (<span class="keyword">typeof</span> then === <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">                                        then.<span class="title function_">call</span>(that, <span class="keyword">function</span> (<span class="params">y</span>) &#123;</span><br><span class="line">                                            thenable.<span class="title function_">call</span>(that, y);</span><br><span class="line">                                        &#125;, <span class="keyword">function</span> (<span class="params">r</span>) &#123;</span><br><span class="line">                                            <span class="title function_">reject</span>(r);</span><br><span class="line">                                        &#125;);</span><br><span class="line">                                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                                        <span class="keyword">const</span> x = <span class="title function_">onFulfilled</span>(value);</span><br><span class="line">                                        <span class="title function_">resolvePromise</span>(promise, x, resolve, reject);</span><br><span class="line">                                    &#125;</span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125;)(that.<span class="property">value</span>);</span><br><span class="line">                        &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">                            <span class="title function_">reject</span>(error);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;, <span class="number">0</span>);</span><br><span class="line">                &#125;);</span><br><span class="line">                that.<span class="property">onRejectedCallbacks</span>.<span class="title function_">push</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">                    <span class="built_in">setTimeout</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">                        <span class="keyword">try</span> &#123;</span><br><span class="line">                            <span class="keyword">if</span> (<span class="keyword">typeof</span> onRejected !== <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">                                <span class="title function_">reject</span>(that.<span class="property">reason</span>);</span><br><span class="line">                            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                                <span class="keyword">const</span> x = <span class="title function_">onRejected</span>(that.<span class="property">reason</span>);</span><br><span class="line">                                <span class="title function_">resolvePromise</span>(promise, x, resolve, reject);</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">                            <span class="title function_">reject</span>(error);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;, <span class="number">0</span>);</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> promise</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">resolvePromise</span>(<span class="params">promise, x, resolve, reject</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (promise === x) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="title function_">reject</span>(<span class="keyword">new</span> <span class="title class_">TypeError</span>(<span class="string">&#x27;The promise and the return value are the same&#x27;</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (x <span class="keyword">instanceof</span> <span class="title class_">Promise</span>) &#123;</span><br><span class="line">            x.<span class="title function_">then</span>(<span class="function"><span class="params">y</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="title function_">resolvePromise</span>(promise, y, resolve, reject);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> x === <span class="string">&#x27;object&#x27;</span> || <span class="keyword">typeof</span> x === <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (x === <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="title function_">reject</span>(x);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">var</span> then,</span><br><span class="line">                call = <span class="literal">false</span>;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                then = x.<span class="property">then</span>;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">                <span class="title function_">reject</span>(error);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">typeof</span> then === <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    then.<span class="title function_">call</span>(x, <span class="keyword">function</span> (<span class="params">y</span>) &#123;</span><br><span class="line">                        <span class="keyword">if</span> (call) <span class="keyword">return</span>;</span><br><span class="line">                        call = <span class="literal">true</span>;</span><br><span class="line">                        <span class="title function_">resolvePromise</span>(promise, y, resolve, reject);</span><br><span class="line">                    &#125;, <span class="keyword">function</span> (<span class="params">r</span>) &#123;</span><br><span class="line">                        <span class="keyword">if</span> (call) <span class="keyword">return</span>;</span><br><span class="line">                        call = <span class="literal">true</span>;</span><br><span class="line">                        <span class="title function_">reject</span>(r);</span><br><span class="line">                    &#125;);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (call) <span class="keyword">return</span>;</span><br><span class="line">                    <span class="title function_">reject</span>(error);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="title function_">resolve</span>(x);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="title function_">resolve</span>(x);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Promise</span>;</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ES6</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">Promise</span> = (<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="variable constant_">PENDING</span> = <span class="string">&#x27;PENDING&#x27;</span>,</span><br><span class="line">        <span class="variable constant_">FULFILLED</span> = <span class="string">&#x27;FULFILLED&#x27;</span>,</span><br><span class="line">        <span class="variable constant_">REJECTED</span> = <span class="string">&#x27;REJECTED&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Promise</span> &#123;</span><br><span class="line">        <span class="title function_">constructor</span>(<span class="params">fn</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">status</span> = <span class="variable constant_">PENDING</span>;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">value</span> = <span class="literal">null</span>;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">reason</span> = <span class="literal">null</span>;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">onFulfilledCallbacks</span> = [];</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">onRejectedCallbacks</span> = [];</span><br><span class="line"></span><br><span class="line">            <span class="keyword">const</span> <span class="title function_">resolve</span> = (<span class="params">value</span>) =&gt; &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">status</span> === <span class="variable constant_">PENDING</span>) &#123;</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="property">status</span> = <span class="variable constant_">FULFILLED</span>;</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="property">value</span> = value;</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="property">onFulfilledCallbacks</span>.<span class="title function_">forEach</span>(<span class="function"><span class="params">callback</span> =&gt;</span> &#123;</span><br><span class="line">                        <span class="title function_">callback</span>(<span class="variable language_">this</span>.<span class="property">value</span>);</span><br><span class="line">                    &#125;);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">const</span> <span class="title function_">reject</span> = (<span class="params">reason</span>) =&gt; &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">status</span> === <span class="variable constant_">PENDING</span>) &#123;</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="property">status</span> = <span class="variable constant_">REJECTED</span>;</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="property">reason</span> = reason;</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="property">onRejectedCallbacks</span>.<span class="title function_">forEach</span>(<span class="function"><span class="params">callback</span> =&gt;</span> &#123;</span><br><span class="line">                        <span class="title function_">callback</span>(<span class="variable language_">this</span>.<span class="property">reason</span>);</span><br><span class="line">                    &#125;);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="title function_">fn</span>(resolve, reject);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">                <span class="title function_">reject</span>(err);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="title function_">then</span>(<span class="params">onFulfilled, onRejected</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">typeof</span> onFulfilled !== <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">                onFulfilled = <span class="function"><span class="params">value</span> =&gt;</span> value;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">typeof</span> onRejected !== <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">                onRejected = <span class="function"><span class="params">reason</span> =&gt;</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> (reason <span class="keyword">instanceof</span> <span class="title class_">Error</span>) &#123;</span><br><span class="line">                        <span class="keyword">throw</span> reason</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(reason);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">let</span> promise,</span><br><span class="line">                then;</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">status</span> === <span class="variable constant_">FULFILLED</span>) &#123;</span><br><span class="line">                promise = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">                    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                        <span class="keyword">try</span> &#123;</span><br><span class="line">                            (<span class="keyword">function</span> <span class="title function_">thenable</span>(<span class="params">value</span>) &#123;</span><br><span class="line">                                <span class="keyword">if</span> (<span class="keyword">typeof</span> onFulfilled !== <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">                                    <span class="title function_">resolve</span>(value);</span><br><span class="line">                                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                                    then = value.<span class="property">then</span>;</span><br><span class="line">                                    <span class="keyword">if</span> (<span class="keyword">typeof</span> then === <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">                                        then.<span class="title function_">call</span>(<span class="variable language_">this</span>, <span class="function"><span class="params">y</span> =&gt;</span> &#123;</span><br><span class="line">                                            thenable.<span class="title function_">call</span>(<span class="variable language_">this</span>, y);</span><br><span class="line">                                        &#125;, <span class="function"><span class="params">r</span> =&gt;</span> &#123;</span><br><span class="line">                                            <span class="title function_">reject</span>(r);</span><br><span class="line">                                        &#125;);</span><br><span class="line">                                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                                        <span class="keyword">const</span> x = <span class="title function_">onFulfilled</span>(value);</span><br><span class="line">                                        <span class="title function_">resolvePromise</span>(promise, x, resolve, reject);</span><br><span class="line">                                    &#125;</span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125;.<span class="title function_">bind</span>(<span class="variable language_">this</span>))(<span class="variable language_">this</span>.<span class="property">value</span>);</span><br><span class="line">                        &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">                            <span class="title function_">reject</span>(err);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;, <span class="number">0</span>);</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">status</span> === <span class="variable constant_">REJECTED</span>) &#123;</span><br><span class="line">                promise = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">                    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                        <span class="keyword">try</span> &#123;</span><br><span class="line">                            <span class="keyword">if</span> (<span class="keyword">typeof</span> onRejected !== <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">                                <span class="title function_">reject</span>(<span class="variable language_">this</span>.<span class="property">reason</span>);</span><br><span class="line">                            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                                <span class="keyword">const</span> x = <span class="title function_">onRejected</span>(<span class="variable language_">this</span>.<span class="property">reason</span>);</span><br><span class="line">                                <span class="title function_">resolvePromise</span>(promise, x, resolve, reject);</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">                            <span class="title function_">reject</span>(err);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;, <span class="number">0</span>);</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">status</span> === <span class="variable constant_">PENDING</span>) &#123;</span><br><span class="line">                promise = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="property">onFulfilledCallbacks</span>.<span class="title function_">push</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                        <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                            <span class="keyword">try</span> &#123;</span><br><span class="line">                                (<span class="keyword">function</span> <span class="title function_">thenable</span>(<span class="params">value</span>) &#123;</span><br><span class="line">                                    <span class="keyword">if</span> (<span class="keyword">typeof</span> onFulfilled !== <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">                                        <span class="title function_">resolve</span>(value);</span><br><span class="line">                                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                                        then = value.<span class="property">then</span>;</span><br><span class="line">                                        <span class="keyword">if</span> (<span class="keyword">typeof</span> then === <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">                                            then.<span class="title function_">call</span>(<span class="variable language_">this</span>, <span class="function"><span class="params">y</span> =&gt;</span> &#123;</span><br><span class="line">                                                thenable.<span class="title function_">call</span>(<span class="variable language_">this</span>, y);</span><br><span class="line">                                            &#125;, <span class="function"><span class="params">r</span> =&gt;</span> &#123;</span><br><span class="line">                                                <span class="title function_">reject</span>(r);</span><br><span class="line">                                            &#125;);</span><br><span class="line">                                        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                                            <span class="keyword">const</span> x = <span class="title function_">onFulfilled</span>(value);</span><br><span class="line">                                            <span class="title function_">resolvePromise</span>(promise, x, resolve, reject);</span><br><span class="line">                                        &#125;</span><br><span class="line">                                    &#125;</span><br><span class="line">                                &#125;.<span class="title function_">bind</span>(<span class="variable language_">this</span>))(<span class="variable language_">this</span>.<span class="property">value</span>);</span><br><span class="line">                            &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">                                <span class="title function_">reject</span>(err);</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;, <span class="number">0</span>);</span><br><span class="line">                    &#125;);</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="property">onRejectedCallbacks</span>.<span class="title function_">push</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                        <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                            <span class="keyword">try</span> &#123;</span><br><span class="line">                                <span class="keyword">if</span> (<span class="keyword">typeof</span> onRejected !== <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">                                    <span class="title function_">reject</span>(<span class="variable language_">this</span>.<span class="property">reason</span>);</span><br><span class="line">                                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                                    <span class="keyword">const</span> x = <span class="title function_">onRejected</span>(<span class="variable language_">this</span>.<span class="property">reason</span>);</span><br><span class="line">                                    <span class="title function_">resolvePromise</span>(promise, x, resolve, reject);</span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">                                <span class="title function_">reject</span>(err);</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;, <span class="number">0</span>);</span><br><span class="line">                    &#125;);</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> promise;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">resolvePromise</span>(<span class="params">promise, x, resolve, reject</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (promise === x) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="title function_">reject</span>(<span class="keyword">new</span> <span class="title class_">TypeError</span>(<span class="string">&#x27;The promise and the return value are the same&#x27;</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (x <span class="keyword">instanceof</span> <span class="title class_">Promise</span>) &#123;</span><br><span class="line">            x.<span class="title function_">then</span>(<span class="function"><span class="params">y</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="title function_">resolvePromise</span>(promise, y, resolve, reject);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> x === <span class="string">&#x27;object&#x27;</span> || <span class="keyword">typeof</span> x === <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (x === <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="title function_">reject</span>(x);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">let</span> then,</span><br><span class="line">                call = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                then = x.<span class="property">then</span>;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">                <span class="title function_">reject</span>(err);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">typeof</span> then === <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    then.<span class="title function_">call</span>(x, <span class="function"><span class="params">y</span> =&gt;</span> &#123;</span><br><span class="line">                        <span class="keyword">if</span> (call) <span class="keyword">return</span>;</span><br><span class="line">                        call = <span class="literal">true</span>;</span><br><span class="line">                        <span class="title function_">resolvePromise</span>(promise, y, resolve, reject);</span><br><span class="line">                    &#125;, <span class="function"><span class="params">r</span> =&gt;</span> &#123;</span><br><span class="line">                        <span class="keyword">if</span> (call) <span class="keyword">return</span>;</span><br><span class="line">                        call = <span class="literal">true</span>;</span><br><span class="line">                        <span class="title function_">reject</span>(r);</span><br><span class="line">                    &#125;);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (call) <span class="keyword">return</span>;</span><br><span class="line">                    <span class="title function_">reject</span>(err);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="title function_">resolve</span>(x);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="title function_">resolve</span>(x);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Promise</span>;</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>

<h4 id="complete-Promise"><a href="#complete-Promise" class="headerlink" title="complete Promise"></a>complete Promise</h4><blockquote>
<p>ES5</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="title class_">Promise</span> = (<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> <span class="variable constant_">PENDING</span> = <span class="string">&#x27;PENDING&#x27;</span>,</span><br><span class="line">        <span class="variable constant_">FULFILLED</span> = <span class="string">&#x27;FULFILLED&#x27;</span>,</span><br><span class="line">        <span class="variable constant_">REJECTED</span> = <span class="string">&#x27;REJECTED&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">Promise</span>(<span class="params">fn</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">status</span> = <span class="variable constant_">PENDING</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">value</span> = <span class="literal">null</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">reason</span> = <span class="literal">null</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">onFulfilledCallbacks</span> = [];</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">onRejectedCallbacks</span> = [];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> that = <span class="variable language_">this</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">resolve</span>(<span class="params">value</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (that.<span class="property">status</span> === <span class="variable constant_">PENDING</span>) &#123;</span><br><span class="line">                that.<span class="property">status</span> = <span class="variable constant_">FULFILLED</span>;</span><br><span class="line">                that.<span class="property">value</span> = value;</span><br><span class="line">                that.<span class="property">onFulfilledCallbacks</span>.<span class="title function_">forEach</span>(<span class="keyword">function</span> (<span class="params">callback</span>) &#123;</span><br><span class="line">                    <span class="title function_">callback</span>(that.<span class="property">value</span>);</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">reject</span>(<span class="params">reason</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (that.<span class="property">status</span> === <span class="variable constant_">PENDING</span>) &#123;</span><br><span class="line">                that.<span class="property">status</span> = <span class="variable constant_">REJECTED</span>;</span><br><span class="line">                that.<span class="property">reason</span> = reason;</span><br><span class="line">                that.<span class="property">onRejectedCallbacks</span>.<span class="title function_">forEach</span>(<span class="keyword">function</span> (<span class="params">callback</span>) &#123;</span><br><span class="line">                    <span class="title function_">callback</span>(that.<span class="property">reason</span>);</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="title function_">fn</span>(resolve, reject);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">            <span class="title function_">reject</span>(err);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title class_">Promise</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">then</span> = <span class="keyword">function</span> (<span class="params">onFulfilled, onRejected</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> onFulfiled !== <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">            onFulfilled = <span class="keyword">function</span> (<span class="params">value</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> value;</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> onRejected !== <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">            onRejected = <span class="keyword">function</span> (<span class="params">reason</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (reason <span class="keyword">instanceof</span> <span class="title class_">Error</span>) &#123;</span><br><span class="line">                    <span class="keyword">throw</span> reason;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(reason);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">var</span> promise,</span><br><span class="line">            then,</span><br><span class="line">            that = <span class="variable language_">this</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">status</span> === <span class="variable constant_">FULFILLED</span>) &#123;</span><br><span class="line">            promise = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="keyword">function</span> (<span class="params">resolve, reject</span>) &#123;</span><br><span class="line">                <span class="built_in">setTimeout</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        <span class="keyword">if</span> (<span class="keyword">typeof</span> onFulfilled !== <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">                            <span class="title function_">resolve</span>(that.<span class="property">value</span>);</span><br><span class="line">                        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                            (<span class="keyword">function</span> <span class="title function_">thenable</span>(<span class="params">value</span>) &#123;</span><br><span class="line">                                then = value.<span class="property">then</span>;</span><br><span class="line">                                <span class="keyword">if</span> (<span class="keyword">typeof</span> then === <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">                                    then.<span class="title function_">call</span>(that, <span class="keyword">function</span> (<span class="params">y</span>) &#123;</span><br><span class="line">                                        thenable.<span class="title function_">call</span>(that, y);</span><br><span class="line">                                    &#125;, <span class="keyword">function</span> (<span class="params">r</span>) &#123;</span><br><span class="line">                                        <span class="title function_">reject</span>(r);</span><br><span class="line">                                    &#125;);</span><br><span class="line">                                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                                    <span class="keyword">var</span> x = <span class="title function_">onFulfilled</span>(value);</span><br><span class="line">                                    <span class="title function_">resolvePromise</span>(promise, x, resolve, reject);</span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125;)(that.<span class="property">value</span>);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">                        <span class="title function_">reject</span>(err);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;, <span class="number">0</span>);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">status</span> === <span class="variable constant_">REJECTED</span>) &#123;</span><br><span class="line">            promise = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="keyword">function</span> (<span class="params">resolve, reject</span>) &#123;</span><br><span class="line">                <span class="built_in">setTimeout</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        <span class="keyword">if</span> (<span class="keyword">typeof</span> onRejected !== <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">                            <span class="title function_">reject</span>(that.<span class="property">reason</span>);</span><br><span class="line">                        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                            <span class="keyword">var</span> x = <span class="title function_">onRejected</span>(that.<span class="property">reason</span>);</span><br><span class="line">                            <span class="title function_">resolvePromise</span>(promise, x, resolve, reject);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">                        <span class="title function_">reject</span>(err);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;, <span class="number">0</span>);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">status</span> === <span class="variable constant_">PENDING</span>) &#123;</span><br><span class="line">            promise = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="keyword">function</span> (<span class="params">resolve, reject</span>) &#123;</span><br><span class="line">                that.<span class="property">onFulfilledCallbacks</span>.<span class="title function_">push</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">                    <span class="built_in">setTimeout</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">                        <span class="keyword">try</span> &#123;</span><br><span class="line">                            <span class="keyword">if</span> (<span class="keyword">typeof</span> onFulfilled !== <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">                                <span class="title function_">resolve</span>(that.<span class="property">value</span>);</span><br><span class="line">                            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                                (<span class="keyword">function</span> <span class="title function_">thenable</span>(<span class="params">value</span>) &#123;</span><br><span class="line">                                    then = value.<span class="property">then</span>;</span><br><span class="line">                                    <span class="keyword">if</span> (<span class="keyword">typeof</span> then === <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">                                        then.<span class="title function_">call</span>(that, <span class="keyword">function</span> (<span class="params">y</span>) &#123;</span><br><span class="line">                                            thenable.<span class="title function_">call</span>(that, y);</span><br><span class="line">                                        &#125;, <span class="keyword">function</span> (<span class="params">r</span>) &#123;</span><br><span class="line">                                            <span class="title function_">reject</span>(r);</span><br><span class="line">                                        &#125;);</span><br><span class="line">                                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                                        <span class="keyword">var</span> x = <span class="title function_">onFulfilled</span>(value);</span><br><span class="line">                                        <span class="title function_">resolvePromise</span>(promise, x, resolve, reject);</span><br><span class="line">                                    &#125;</span><br><span class="line">                                &#125;)(that.<span class="property">value</span>);</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">                            <span class="title function_">reject</span>(err);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;, <span class="number">0</span>);</span><br><span class="line">                &#125;);</span><br><span class="line">                that.<span class="property">onRejectedCallbacks</span>.<span class="title function_">push</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">                    <span class="built_in">setTimeout</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">                        <span class="keyword">try</span> &#123;</span><br><span class="line">                            <span class="keyword">if</span> (<span class="keyword">typeof</span> onRejected !== <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">                                <span class="title function_">reject</span>(that.<span class="property">reason</span>);</span><br><span class="line">                            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                                <span class="keyword">var</span> x = <span class="title function_">onRejected</span>(that.<span class="property">reason</span>);</span><br><span class="line">                                <span class="title function_">resolvePromise</span>(promise, x, resolve, reject);</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">                            <span class="title function_">reject</span>(err);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;, <span class="number">0</span>);</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> promise;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="title class_">Promise</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">catch</span> = <span class="keyword">function</span> (<span class="params">onRejected</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">then</span>(<span class="literal">null</span>, onRejected);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="title class_">Promise</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">finally</span> = <span class="keyword">function</span> (<span class="params">fn</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> fn !== <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">TypeError</span>(<span class="string">&#x27;parameter must be a function&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">then</span>(<span class="keyword">function</span> <span class="title function_">_resolve</span>(<span class="params">value</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(<span class="title function_">fn</span>()).<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> value;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;, <span class="keyword">function</span> <span class="title function_">_reject</span>(<span class="params">reason</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(<span class="title function_">fn</span>()).<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">                <span class="keyword">throw</span> reason;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">resolvePromise</span>(<span class="params">promise, x, resolve, reject</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (promise === x) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="title function_">reject</span>(<span class="keyword">new</span> <span class="title class_">TypeError</span>(<span class="string">&#x27;The promise and the return value are the same&#x27;</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (x <span class="keyword">instanceof</span> <span class="title class_">Promise</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> x.<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">y</span>) &#123;</span><br><span class="line">                <span class="title function_">resolvePromise</span>(promise, y, resolve, reject);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> x === <span class="string">&#x27;object&#x27;</span> || <span class="keyword">typeof</span> x === <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (x === <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="title function_">reject</span>(x);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">var</span> then,</span><br><span class="line">                call = <span class="literal">false</span>;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                then = x.<span class="property">then</span>;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">                <span class="title function_">reject</span>(err);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">typeof</span> then === <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    then.<span class="title function_">call</span>(x, <span class="keyword">function</span> (<span class="params">y</span>) &#123;</span><br><span class="line">                        <span class="keyword">if</span> (call) <span class="keyword">return</span>;</span><br><span class="line">                        call = <span class="literal">true</span>;</span><br><span class="line">                        <span class="title function_">resolvePromise</span>(promise, y, resolve, reject);</span><br><span class="line">                    &#125;, <span class="keyword">function</span> (<span class="params">r</span>) &#123;</span><br><span class="line">                        <span class="keyword">if</span> (call) <span class="keyword">return</span>;</span><br><span class="line">                        call = <span class="literal">true</span>;</span><br><span class="line">                        <span class="title function_">reject</span>(r);</span><br><span class="line">                    &#125;);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (call) <span class="keyword">return</span>;</span><br><span class="line">                    <span class="title function_">reject</span>(err);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="title function_">resolve</span>(x);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="title function_">resolve</span>(x);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title class_">Promise</span>.<span class="property">resolve</span> = <span class="keyword">function</span> (<span class="params">params</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (params <span class="keyword">instanceof</span> <span class="title class_">Promise</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> params;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="keyword">function</span> (<span class="params">resolve</span>) &#123;</span><br><span class="line">            <span class="title function_">resolve</span>(params);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="title class_">Promise</span>.<span class="property">reject</span> = <span class="keyword">function</span> (<span class="params">reason</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="keyword">function</span> (<span class="params">resolve, reject</span>) &#123;</span><br><span class="line">            <span class="title function_">reject</span>(reason);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="title class_">Promise</span>.<span class="property">all</span> = <span class="keyword">function</span> (<span class="params">promiseLists</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="keyword">function</span> (<span class="params">resolve, reject</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!<span class="title class_">Array</span>.<span class="title function_">isArray</span>(promiseLists)) &#123;</span><br><span class="line">                <span class="title function_">reject</span>(<span class="keyword">new</span> <span class="title class_">ReferenceError</span>(<span class="string">&#x27;parameter must be an array&#x27;</span>));</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">var</span> count = <span class="number">0</span>,</span><br><span class="line">                result = [],</span><br><span class="line">                length = promiseLists.<span class="property">length</span>;</span><br><span class="line">            promiseLists.<span class="title function_">forEach</span>(<span class="keyword">function</span> (<span class="params">promise</span>) &#123;</span><br><span class="line">                <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(promise).<span class="title function_">then</span>(<span class="keyword">function</span> <span class="title function_">_resolve</span>(<span class="params">value</span>) &#123;</span><br><span class="line">                    result[count++] = value;</span><br><span class="line">                    <span class="keyword">if</span> (count === length) &#123;</span><br><span class="line">                        <span class="title function_">resolve</span>(result);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;, <span class="keyword">function</span> <span class="title function_">_reject</span>(<span class="params">reason</span>) &#123;</span><br><span class="line">                    <span class="title function_">reject</span>(reason);</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="title class_">Promise</span>.<span class="property">race</span> = <span class="keyword">function</span> (<span class="params">promiseLists</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="keyword">function</span> (<span class="params">resolve, reject</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!<span class="title class_">Array</span>.<span class="title function_">isArray</span>(promiseLists)) &#123;</span><br><span class="line">                <span class="title function_">reject</span>(<span class="keyword">new</span> <span class="title class_">ReferenceError</span>(<span class="string">&#x27;parameter must be an array&#x27;</span>));</span><br><span class="line">            &#125;</span><br><span class="line">            promiseLists.<span class="title function_">forEach</span>(<span class="keyword">function</span> (<span class="params">promise</span>) &#123;</span><br><span class="line">                <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(promise).<span class="title function_">then</span>(<span class="keyword">function</span> <span class="title function_">_resolve</span>(<span class="params">value</span>) &#123;</span><br><span class="line">                    <span class="title function_">resolve</span>(value);</span><br><span class="line">                &#125;, <span class="keyword">function</span> <span class="title function_">_reject</span>(<span class="params">reason</span>) &#123;</span><br><span class="line">                    <span class="title function_">reject</span>(reason);</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="title class_">Promise</span>.<span class="property">allSettled</span> = <span class="keyword">function</span> (<span class="params">promiseLists</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="keyword">function</span> (<span class="params">resolve, reject</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!<span class="title class_">Array</span>.<span class="title function_">isArray</span>(promiseLists)) &#123;</span><br><span class="line">                <span class="title function_">reject</span>(<span class="keyword">new</span> <span class="title class_">ReferenceError</span>(<span class="string">&#x27;parameter must be an array&#x27;</span>));</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">var</span> count = <span class="number">0</span>,</span><br><span class="line">                result = [],</span><br><span class="line">                length = promiseLists.<span class="property">length</span>;</span><br><span class="line">            promiseLists.<span class="title function_">forEach</span>(<span class="keyword">function</span> (<span class="params">promise</span>) &#123;</span><br><span class="line">                <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(promise).<span class="title function_">then</span>(<span class="keyword">function</span> <span class="title function_">_resolve</span>(<span class="params">value</span>) &#123;</span><br><span class="line">                    result[count++] = &#123;</span><br><span class="line">                        <span class="attr">status</span>: <span class="string">&#x27;fulfilled&#x27;</span>,</span><br><span class="line">                        value</span><br><span class="line">                    &#125;;</span><br><span class="line">                    <span class="keyword">if</span> (count === length) &#123;</span><br><span class="line">                        <span class="title function_">resolve</span>(result);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;, <span class="keyword">function</span> <span class="title function_">_reject</span>(<span class="params">reason</span>) &#123;</span><br><span class="line">                    result[count++] = &#123;</span><br><span class="line">                        <span class="attr">status</span>: <span class="string">&#x27;rejected&#x27;</span>,</span><br><span class="line">                        reason</span><br><span class="line">                    &#125;;</span><br><span class="line">                    <span class="keyword">if</span> (count === length) &#123;</span><br><span class="line">                        <span class="title function_">resolve</span>(result);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Promise</span>;</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ES6</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">Promise</span> = (<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="variable constant_">PENDING</span> = <span class="string">&#x27;PENDING&#x27;</span>,</span><br><span class="line">        <span class="variable constant_">FULFILLED</span> = <span class="string">&#x27;FULFILLED&#x27;</span>,</span><br><span class="line">        <span class="variable constant_">REJECTED</span> = <span class="string">&#x27;REJECTED&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Promise</span> &#123;</span><br><span class="line">        <span class="title function_">constructor</span>(<span class="params">fn</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">status</span> = <span class="variable constant_">PENDING</span>;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">value</span> = <span class="literal">null</span>;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">reason</span> = <span class="literal">null</span>;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">onFulfilledCallbacks</span> = [];</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">onRejectedCallbacks</span> = [];</span><br><span class="line"></span><br><span class="line">            <span class="keyword">const</span> <span class="title function_">resolve</span> = (<span class="params">value</span>) =&gt; &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">status</span> === <span class="variable constant_">PENDING</span>) &#123;</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="property">status</span> = <span class="variable constant_">FULFILLED</span>;</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="property">value</span> = value;</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="property">onFulfilledCallbacks</span>.<span class="title function_">forEach</span>(<span class="function"><span class="params">callback</span> =&gt;</span> &#123;</span><br><span class="line">                        <span class="title function_">callback</span>(<span class="variable language_">this</span>.<span class="property">value</span>);</span><br><span class="line">                    &#125;);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">const</span> <span class="title function_">reject</span> = (<span class="params">reason</span>) =&gt; &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">status</span> === <span class="variable constant_">PENDING</span>) &#123;</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="property">status</span> = <span class="variable constant_">REJECTED</span>;</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="property">reason</span> = reason;</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="property">onRejectedCallbacks</span>.<span class="title function_">forEach</span>(<span class="function"><span class="params">callback</span> =&gt;</span> &#123;</span><br><span class="line">                        <span class="title function_">callback</span>(<span class="variable language_">this</span>.<span class="property">reason</span>);</span><br><span class="line">                    &#125;);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="title function_">fn</span>(resolve, reject);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">                <span class="title function_">reject</span>(err);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="title function_">then</span>(<span class="params">onFulfilled, onRejected</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">typeof</span> onFulfilled !== <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">                onFulfilled = <span class="function"><span class="params">value</span> =&gt;</span> value;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">typeof</span> onRejected !== <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">                onRejected = <span class="function"><span class="params">reason</span> =&gt;</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> (reason <span class="keyword">instanceof</span> <span class="title class_">Error</span>) &#123;</span><br><span class="line">                        <span class="keyword">throw</span> reason;</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(reason);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">let</span> promise,</span><br><span class="line">                then;</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">status</span> === <span class="variable constant_">FULFILLED</span>) &#123;</span><br><span class="line">                promise = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">                    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                        <span class="keyword">try</span> &#123;</span><br><span class="line">                            <span class="keyword">if</span> (<span class="keyword">typeof</span> onFulfilled !== <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">                                <span class="title function_">resolve</span>(<span class="variable language_">this</span>.<span class="property">value</span>);</span><br><span class="line">                            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                                (<span class="keyword">function</span> <span class="title function_">thenable</span>(<span class="params">value</span>) &#123;</span><br><span class="line">                                    then = value.<span class="property">then</span>;</span><br><span class="line">                                    <span class="keyword">if</span> (<span class="keyword">typeof</span> then === <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">                                        then.<span class="title function_">call</span>(<span class="variable language_">this</span>, <span class="function"><span class="params">y</span> =&gt;</span> &#123;</span><br><span class="line">                                            thenable.<span class="title function_">call</span>(<span class="variable language_">this</span>, y);</span><br><span class="line">                                        &#125;, <span class="function"><span class="params">r</span> =&gt;</span> &#123;</span><br><span class="line">                                            <span class="title function_">reject</span>(r);</span><br><span class="line">                                        &#125;);</span><br><span class="line">                                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                                        <span class="keyword">const</span> x = <span class="title function_">onFulfilled</span>(value);</span><br><span class="line">                                        <span class="title function_">resolvePromise</span>(promise, x, resolve, reject);</span><br><span class="line">                                    &#125;</span><br><span class="line">                                &#125;.<span class="title function_">bind</span>(<span class="variable language_">this</span>))(<span class="variable language_">this</span>.<span class="property">value</span>);</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">                            <span class="title function_">reject</span>(err);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;, <span class="number">0</span>);</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">status</span> === <span class="variable constant_">REJECTED</span>) &#123;</span><br><span class="line">                promise = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">                    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                        <span class="keyword">try</span> &#123;</span><br><span class="line">                            <span class="keyword">if</span> (<span class="keyword">typeof</span> onRejected !== <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">                                <span class="title function_">reject</span>(<span class="variable language_">this</span>.<span class="property">reason</span>);</span><br><span class="line">                            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                                <span class="keyword">const</span> x = <span class="title function_">onRejected</span>(<span class="variable language_">this</span>.<span class="property">reason</span>);</span><br><span class="line">                                <span class="title function_">resolvePromise</span>(promise, x, resolve, reject);</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">                            <span class="title function_">reject</span>(err);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;, <span class="number">0</span>);</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">status</span> === <span class="variable constant_">PENDING</span>) &#123;</span><br><span class="line">                promise = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="property">onFulfilledCallbacks</span>.<span class="title function_">push</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                        <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                            <span class="keyword">try</span> &#123;</span><br><span class="line">                                <span class="keyword">if</span> (<span class="keyword">typeof</span> onFulfilled !== <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">                                    <span class="title function_">resolve</span>(<span class="variable language_">this</span>.<span class="property">value</span>);</span><br><span class="line">                                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                                    (<span class="keyword">function</span> <span class="title function_">thenable</span>(<span class="params">value</span>) &#123;</span><br><span class="line">                                        then = value.<span class="property">then</span>;</span><br><span class="line">                                        <span class="keyword">if</span> (<span class="keyword">typeof</span> then === <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">                                            then.<span class="title function_">call</span>(<span class="variable language_">this</span>, <span class="function"><span class="params">y</span> =&gt;</span> &#123;</span><br><span class="line">                                                thenable.<span class="title function_">call</span>(<span class="variable language_">this</span>, y);</span><br><span class="line">                                            &#125;, <span class="function"><span class="params">r</span> =&gt;</span> &#123;</span><br><span class="line">                                                <span class="title function_">reject</span>(r);</span><br><span class="line">                                            &#125;);</span><br><span class="line">                                        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                                            <span class="keyword">const</span> x = <span class="title function_">onFulfilled</span>(value);</span><br><span class="line">                                            <span class="title function_">resolvePromise</span>(promise, x, resolve, reject);</span><br><span class="line">                                        &#125;</span><br><span class="line">                                    &#125;.<span class="title function_">bind</span>(<span class="variable language_">this</span>))(<span class="variable language_">this</span>.<span class="property">value</span>);</span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">                                <span class="title function_">reject</span>(err);</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;, <span class="number">0</span>);</span><br><span class="line">                    &#125;);</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="property">onRejectedCallbacks</span>.<span class="title function_">push</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                        <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                            <span class="keyword">try</span> &#123;</span><br><span class="line">                                <span class="keyword">if</span> (<span class="keyword">typeof</span> onRejected !== <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">                                    <span class="title function_">reject</span>(<span class="variable language_">this</span>.<span class="property">reason</span>);</span><br><span class="line">                                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                                    <span class="keyword">const</span> x = <span class="title function_">onRejected</span>(<span class="variable language_">this</span>.<span class="property">reason</span>);</span><br><span class="line">                                    <span class="title function_">resolvePromise</span>(promise, x, resolve, reject);</span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">                                <span class="title function_">reject</span>(err);</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;, <span class="number">0</span>);</span><br><span class="line">                    &#125;);</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> promise;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">catch</span>(onRejected) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">then</span>(<span class="literal">null</span>, onRejected);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="title function_">finally</span>(<span class="params">fn</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">typeof</span> fn !== <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">TypeError</span>(<span class="string">&#x27;parameter must be a function&#x27;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">then</span>(<span class="function"><span class="params">value</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(<span class="title function_">fn</span>()).<span class="title function_">then</span>(<span class="function">() =&gt;</span> value);</span><br><span class="line">            &#125;, <span class="function"><span class="params">reason</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(<span class="title function_">fn</span>()).<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                    <span class="keyword">throw</span> reason;</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">resolvePromise</span>(<span class="params">promise, x, resolve, reject</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (promise === x) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="title function_">reject</span>(<span class="keyword">new</span> <span class="title class_">ReferenceError</span>(<span class="string">&#x27;The promise and the return value are the same&#x27;</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (x <span class="keyword">instanceof</span> <span class="title class_">Promise</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> x.<span class="title function_">then</span>(<span class="function"><span class="params">y</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="title function_">resolvePromise</span>(promise, y, resolve, reject);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> x === <span class="string">&#x27;object&#x27;</span> || <span class="keyword">typeof</span> x === <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (x === <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="title function_">reject</span>(x);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">let</span> then,</span><br><span class="line">                call = <span class="literal">false</span>;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                then = x.<span class="property">then</span>;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">                <span class="title function_">reject</span>(err);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">typeof</span> then === <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    then.<span class="title function_">call</span>(x, <span class="function"><span class="params">y</span> =&gt;</span> &#123;</span><br><span class="line">                        <span class="keyword">if</span> (call) <span class="keyword">return</span>;</span><br><span class="line">                        call = <span class="literal">true</span>;</span><br><span class="line">                        <span class="title function_">resolvePromise</span>(promise, y, resolve, reject);</span><br><span class="line">                    &#125;, <span class="function"><span class="params">r</span> =&gt;</span> &#123;</span><br><span class="line">                        <span class="keyword">if</span> (call) <span class="keyword">return</span>;</span><br><span class="line">                        call = <span class="literal">true</span>;</span><br><span class="line">                        <span class="title function_">reject</span>(r);</span><br><span class="line">                    &#125;);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (call) <span class="keyword">return</span>;</span><br><span class="line">                    <span class="title function_">reject</span>(err);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="title function_">resolve</span>(x);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="title function_">resolve</span>(x);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title class_">Promise</span>.<span class="property">resolve</span> = <span class="function"><span class="params">params</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (params <span class="keyword">instanceof</span> <span class="title class_">Promise</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> params;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="title function_">resolve</span>(params);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="title class_">Promise</span>.<span class="property">reject</span> = <span class="function"><span class="params">reason</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="title function_">reject</span>(reason);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="title class_">Promise</span>.<span class="property">all</span> = <span class="function"><span class="params">promiseLists</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (!<span class="title class_">Array</span>.<span class="title function_">isArray</span>(promiseLists)) &#123;</span><br><span class="line">                <span class="title function_">reject</span>(<span class="keyword">new</span> <span class="title class_">ReferenceError</span>(<span class="string">&#x27;parameter must be an array&#x27;</span>));</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">let</span> count = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">const</span> length = promiseLists.<span class="property">length</span>,</span><br><span class="line">                result = [];</span><br><span class="line">            promiseLists.<span class="title function_">forEach</span>(<span class="function"><span class="params">promise</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(promise).<span class="title function_">then</span>(<span class="function"><span class="params">value</span> =&gt;</span> &#123;</span><br><span class="line">                    result[count++] = value;</span><br><span class="line">                    <span class="keyword">if</span> (count === length) &#123;</span><br><span class="line">                        <span class="title function_">resolve</span>(result);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;, <span class="function"><span class="params">reason</span> =&gt;</span> &#123;</span><br><span class="line">                    <span class="title function_">reject</span>(reason);</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="title class_">Promise</span>.<span class="property">race</span> = <span class="function"><span class="params">promiseLists</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (!<span class="title class_">Array</span>.<span class="title function_">isArray</span>(promiseLists)) &#123;</span><br><span class="line">                <span class="title function_">reject</span>(<span class="keyword">new</span> <span class="title class_">ReferenceError</span>(<span class="string">&#x27;parameter must be an array&#x27;</span>));</span><br><span class="line">            &#125;</span><br><span class="line">            promiseLists.<span class="title function_">forEach</span>(<span class="function"><span class="params">promise</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(promise).<span class="title function_">then</span>(<span class="function"><span class="params">value</span> =&gt;</span> &#123;</span><br><span class="line">                    <span class="title function_">resolve</span>(value);</span><br><span class="line">                &#125;, <span class="function"><span class="params">reason</span> =&gt;</span> &#123;</span><br><span class="line">                    <span class="title function_">reject</span>(reason);</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="title class_">Promise</span>.<span class="property">allSettled</span> = <span class="function"><span class="params">promiseLists</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (!<span class="title class_">Array</span>.<span class="title function_">isArray</span>(promiseLists)) &#123;</span><br><span class="line">                <span class="title function_">reject</span>(<span class="keyword">new</span> <span class="title class_">ReferenceError</span>(<span class="string">&#x27;parameter must be an array&#x27;</span>));</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">let</span> count = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">const</span> length = promiseLists.<span class="property">length</span>,</span><br><span class="line">                result = [];</span><br><span class="line">            promiseLists.<span class="title function_">forEach</span>(<span class="function"><span class="params">promise</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(promise).<span class="title function_">then</span>(<span class="function"><span class="params">value</span> =&gt;</span> &#123;</span><br><span class="line">                    result[count++] = &#123;</span><br><span class="line">                        <span class="attr">status</span>: <span class="string">&#x27;fulfilled&#x27;</span>,</span><br><span class="line">                        value</span><br><span class="line">                    &#125;;</span><br><span class="line">                    <span class="keyword">if</span> (count === length) &#123;</span><br><span class="line">                        <span class="title function_">resolve</span>(result);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="title function_">resolve</span>(result);</span><br><span class="line">                &#125;, <span class="function"><span class="params">reason</span> =&gt;</span> &#123;</span><br><span class="line">                    result[count++] = &#123;</span><br><span class="line">                        <span class="attr">status</span>: <span class="string">&#x27;rejected&#x27;</span>,</span><br><span class="line">                        reason</span><br><span class="line">                    &#125;;</span><br><span class="line">                    <span class="keyword">if</span> (count === length) &#123;</span><br><span class="line">                        <span class="title function_">resolve</span>(result);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Promise</span>;</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>

<h4 id="complete-Promise-Test"><a href="#complete-Promise-Test" class="headerlink" title="complete Promise Test"></a>complete Promise Test</h4><blockquote>
<p>ES5</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="title class_">Promise</span> = (<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> <span class="variable constant_">PENDING</span> = <span class="string">&#x27;PENDING&#x27;</span>,</span><br><span class="line">        <span class="variable constant_">FULFILLED</span> = <span class="string">&#x27;FULFILLED&#x27;</span>,</span><br><span class="line">        <span class="variable constant_">REJECTED</span> = <span class="string">&#x27;REJECTED&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">Promise</span>(<span class="params">fn</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">status</span> = <span class="variable constant_">PENDING</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">value</span> = <span class="literal">null</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">reason</span> = <span class="literal">null</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">onFulfilledCallbacks</span> = [];</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">onRejectedCallbacks</span> = [];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> that = <span class="variable language_">this</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">resolve</span>(<span class="params">value</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (that.<span class="property">status</span> === <span class="variable constant_">PENDING</span>) &#123;</span><br><span class="line">                that.<span class="property">status</span> = <span class="variable constant_">FULFILLED</span>;</span><br><span class="line">                that.<span class="property">value</span> = value;</span><br><span class="line">                that.<span class="property">onFulfilledCallbacks</span>.<span class="title function_">forEach</span>(<span class="keyword">function</span> (<span class="params">callback</span>) &#123;</span><br><span class="line">                    <span class="title function_">callback</span>(that.<span class="property">value</span>);</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">reject</span>(<span class="params">reason</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (that.<span class="property">status</span> === <span class="variable constant_">PENDING</span>) &#123;</span><br><span class="line">                that.<span class="property">status</span> = <span class="variable constant_">REJECTED</span>;</span><br><span class="line">                that.<span class="property">reason</span> = reason;</span><br><span class="line">                that.<span class="property">onRejectedCallbacks</span>.<span class="title function_">forEach</span>(<span class="keyword">function</span> (<span class="params">callback</span>) &#123;</span><br><span class="line">                    <span class="title function_">callback</span>(that.<span class="property">reason</span>);</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="title function_">fn</span>(resolve, reject);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">            <span class="title function_">reject</span>(err);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title class_">Promise</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">then</span> = <span class="keyword">function</span> (<span class="params">onFulfilled, onRejected</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> onFulfiled !== <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">            onFulfilled = <span class="keyword">function</span> (<span class="params">value</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> value;</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> onRejected !== <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">            onRejected = <span class="keyword">function</span> (<span class="params">reason</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (reason <span class="keyword">instanceof</span> <span class="title class_">Error</span>) &#123;</span><br><span class="line">                    <span class="keyword">throw</span> reason;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(reason);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">var</span> promise,</span><br><span class="line">            then,</span><br><span class="line">            that = <span class="variable language_">this</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">status</span> === <span class="variable constant_">FULFILLED</span>) &#123;</span><br><span class="line">            promise = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="keyword">function</span> (<span class="params">resolve, reject</span>) &#123;</span><br><span class="line">                <span class="built_in">setTimeout</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        <span class="keyword">if</span> (<span class="keyword">typeof</span> onFulfilled !== <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">                            <span class="title function_">resolve</span>(that.<span class="property">value</span>);</span><br><span class="line">                        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                            (<span class="keyword">function</span> <span class="title function_">thenable</span>(<span class="params">value</span>) &#123;</span><br><span class="line">                                then = value.<span class="property">then</span>;</span><br><span class="line">                                <span class="keyword">if</span> (<span class="keyword">typeof</span> then === <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">                                    then.<span class="title function_">call</span>(that, <span class="keyword">function</span> (<span class="params">y</span>) &#123;</span><br><span class="line">                                        thenable.<span class="title function_">call</span>(that, y);</span><br><span class="line">                                    &#125;, <span class="keyword">function</span> (<span class="params">r</span>) &#123;</span><br><span class="line">                                        <span class="title function_">reject</span>(r);</span><br><span class="line">                                    &#125;);</span><br><span class="line">                                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                                    <span class="keyword">var</span> x = <span class="title function_">onFulfilled</span>(value);</span><br><span class="line">                                    <span class="title function_">resolvePromise</span>(promise, x, resolve, reject);</span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125;)(that.<span class="property">value</span>);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">                        <span class="title function_">reject</span>(err);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;, <span class="number">0</span>);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">status</span> === <span class="variable constant_">REJECTED</span>) &#123;</span><br><span class="line">            promise = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="keyword">function</span> (<span class="params">resolve, reject</span>) &#123;</span><br><span class="line">                <span class="built_in">setTimeout</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        <span class="keyword">if</span> (<span class="keyword">typeof</span> onRejected !== <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">                            <span class="title function_">reject</span>(that.<span class="property">reason</span>);</span><br><span class="line">                        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                            <span class="keyword">var</span> x = <span class="title function_">onRejected</span>(that.<span class="property">reason</span>);</span><br><span class="line">                            <span class="title function_">resolvePromise</span>(promise, x, resolve, reject);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">                        <span class="title function_">reject</span>(err);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;, <span class="number">0</span>);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">status</span> === <span class="variable constant_">PENDING</span>) &#123;</span><br><span class="line">            promise = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="keyword">function</span> (<span class="params">resolve, reject</span>) &#123;</span><br><span class="line">                that.<span class="property">onFulfilledCallbacks</span>.<span class="title function_">push</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">                    <span class="built_in">setTimeout</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">                        <span class="keyword">try</span> &#123;</span><br><span class="line">                            <span class="keyword">if</span> (<span class="keyword">typeof</span> onFulfilled !== <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">                                <span class="title function_">resolve</span>(that.<span class="property">value</span>);</span><br><span class="line">                            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                                (<span class="keyword">function</span> <span class="title function_">thenable</span>(<span class="params">value</span>) &#123;</span><br><span class="line">                                    then = value.<span class="property">then</span>;</span><br><span class="line">                                    <span class="keyword">if</span> (<span class="keyword">typeof</span> then === <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">                                        then.<span class="title function_">call</span>(that, <span class="keyword">function</span> (<span class="params">y</span>) &#123;</span><br><span class="line">                                            thenable.<span class="title function_">call</span>(that, y);</span><br><span class="line">                                        &#125;, <span class="keyword">function</span> (<span class="params">r</span>) &#123;</span><br><span class="line">                                            <span class="title function_">reject</span>(r);</span><br><span class="line">                                        &#125;);</span><br><span class="line">                                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                                        <span class="keyword">var</span> x = <span class="title function_">onFulfilled</span>(value);</span><br><span class="line">                                        <span class="title function_">resolvePromise</span>(promise, x, resolve, reject);</span><br><span class="line">                                    &#125;</span><br><span class="line">                                &#125;)(that.<span class="property">value</span>);</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">                            <span class="title function_">reject</span>(err);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;, <span class="number">0</span>);</span><br><span class="line">                &#125;);</span><br><span class="line">                that.<span class="property">onRejectedCallbacks</span>.<span class="title function_">push</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">                    <span class="built_in">setTimeout</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">                        <span class="keyword">try</span> &#123;</span><br><span class="line">                            <span class="keyword">if</span> (<span class="keyword">typeof</span> onRejected !== <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">                                <span class="title function_">reject</span>(that.<span class="property">reason</span>);</span><br><span class="line">                            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                                <span class="keyword">var</span> x = <span class="title function_">onRejected</span>(that.<span class="property">reason</span>);</span><br><span class="line">                                <span class="title function_">resolvePromise</span>(promise, x, resolve, reject);</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">                            <span class="title function_">reject</span>(err);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;, <span class="number">0</span>);</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> promise;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="title class_">Promise</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">catch</span> = <span class="keyword">function</span> (<span class="params">onRejected</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">then</span>(<span class="literal">null</span>, onRejected);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="title class_">Promise</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">finally</span> = <span class="keyword">function</span> (<span class="params">fn</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> fn !== <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">TypeError</span>(<span class="string">&#x27;parameter must be a function&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">then</span>(<span class="keyword">function</span> <span class="title function_">_resolve</span>(<span class="params">value</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(<span class="title function_">fn</span>()).<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> value;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;, <span class="keyword">function</span> <span class="title function_">_reject</span>(<span class="params">reason</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(<span class="title function_">fn</span>()).<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">                <span class="keyword">throw</span> reason;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">resolvePromise</span>(<span class="params">promise, x, resolve, reject</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (promise === x) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="title function_">reject</span>(<span class="keyword">new</span> <span class="title class_">TypeError</span>(<span class="string">&#x27;The promise and the return value are the same&#x27;</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (x <span class="keyword">instanceof</span> <span class="title class_">Promise</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> x.<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">y</span>) &#123;</span><br><span class="line">                <span class="title function_">resolvePromise</span>(promise, y, resolve, reject);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> x === <span class="string">&#x27;object&#x27;</span> || <span class="keyword">typeof</span> x === <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (x === <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="title function_">reject</span>(x);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">var</span> then,</span><br><span class="line">                call = <span class="literal">false</span>;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                then = x.<span class="property">then</span>;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">                <span class="title function_">reject</span>(err);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">typeof</span> then === <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    then.<span class="title function_">call</span>(x, <span class="keyword">function</span> (<span class="params">y</span>) &#123;</span><br><span class="line">                        <span class="keyword">if</span> (call) <span class="keyword">return</span>;</span><br><span class="line">                        call = <span class="literal">true</span>;</span><br><span class="line">                        <span class="title function_">resolvePromise</span>(promise, y, resolve, reject);</span><br><span class="line">                    &#125;, <span class="keyword">function</span> (<span class="params">r</span>) &#123;</span><br><span class="line">                        <span class="keyword">if</span> (call) <span class="keyword">return</span>;</span><br><span class="line">                        call = <span class="literal">true</span>;</span><br><span class="line">                        <span class="title function_">reject</span>(r);</span><br><span class="line">                    &#125;);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (call) <span class="keyword">return</span>;</span><br><span class="line">                    <span class="title function_">reject</span>(err);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="title function_">resolve</span>(x);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="title function_">resolve</span>(x);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title class_">Promise</span>.<span class="property">resolve</span> = <span class="keyword">function</span> (<span class="params">params</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (params <span class="keyword">instanceof</span> <span class="title class_">Promise</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> params;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="keyword">function</span> (<span class="params">resolve</span>) &#123;</span><br><span class="line">            <span class="title function_">resolve</span>(params);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="title class_">Promise</span>.<span class="property">reject</span> = <span class="keyword">function</span> (<span class="params">reason</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="keyword">function</span> (<span class="params">resolve, reject</span>) &#123;</span><br><span class="line">            <span class="title function_">reject</span>(reason);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="title class_">Promise</span>.<span class="property">all</span> = <span class="keyword">function</span> (<span class="params">promiseLists</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="keyword">function</span> (<span class="params">resolve, reject</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!<span class="title class_">Array</span>.<span class="title function_">isArray</span>(promiseLists)) &#123;</span><br><span class="line">                <span class="title function_">reject</span>(<span class="keyword">new</span> <span class="title class_">ReferenceError</span>(<span class="string">&#x27;parameter must be an array&#x27;</span>));</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">var</span> count = <span class="number">0</span>,</span><br><span class="line">                result = [],</span><br><span class="line">                length = promiseLists.<span class="property">length</span>;</span><br><span class="line">            promiseLists.<span class="title function_">forEach</span>(<span class="keyword">function</span> (<span class="params">promise</span>) &#123;</span><br><span class="line">                <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(promise).<span class="title function_">then</span>(<span class="keyword">function</span> <span class="title function_">_resolve</span>(<span class="params">value</span>) &#123;</span><br><span class="line">                    result[count++] = value;</span><br><span class="line">                    <span class="keyword">if</span> (count === length) &#123;</span><br><span class="line">                        <span class="title function_">resolve</span>(result);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;, <span class="keyword">function</span> <span class="title function_">_reject</span>(<span class="params">reason</span>) &#123;</span><br><span class="line">                    <span class="title function_">reject</span>(reason);</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="title class_">Promise</span>.<span class="property">race</span> = <span class="keyword">function</span> (<span class="params">promiseLists</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="keyword">function</span> (<span class="params">resolve, reject</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!<span class="title class_">Array</span>.<span class="title function_">isArray</span>(promiseLists)) &#123;</span><br><span class="line">                <span class="title function_">reject</span>(<span class="keyword">new</span> <span class="title class_">ReferenceError</span>(<span class="string">&#x27;parameter must be an array&#x27;</span>));</span><br><span class="line">            &#125;</span><br><span class="line">            promiseLists.<span class="title function_">forEach</span>(<span class="keyword">function</span> (<span class="params">promise</span>) &#123;</span><br><span class="line">                <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(promise).<span class="title function_">then</span>(<span class="keyword">function</span> <span class="title function_">_resolve</span>(<span class="params">value</span>) &#123;</span><br><span class="line">                    <span class="title function_">resolve</span>(value);</span><br><span class="line">                &#125;, <span class="keyword">function</span> <span class="title function_">_reject</span>(<span class="params">reason</span>) &#123;</span><br><span class="line">                    <span class="title function_">reject</span>(reason);</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="title class_">Promise</span>.<span class="property">allSettled</span> = <span class="keyword">function</span> (<span class="params">promiseLists</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="keyword">function</span> (<span class="params">resolve, reject</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!<span class="title class_">Array</span>.<span class="title function_">isArray</span>(promiseLists)) &#123;</span><br><span class="line">                <span class="title function_">reject</span>(<span class="keyword">new</span> <span class="title class_">ReferenceError</span>(<span class="string">&#x27;parameter must be an array&#x27;</span>));</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">var</span> count = <span class="number">0</span>,</span><br><span class="line">                result = [],</span><br><span class="line">                length = promiseLists.<span class="property">length</span>;</span><br><span class="line">            promiseLists.<span class="title function_">forEach</span>(<span class="keyword">function</span> (<span class="params">promise</span>) &#123;</span><br><span class="line">                <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(promise).<span class="title function_">then</span>(<span class="keyword">function</span> <span class="title function_">_resolve</span>(<span class="params">value</span>) &#123;</span><br><span class="line">                    result[count++] = &#123;</span><br><span class="line">                        <span class="attr">status</span>: <span class="string">&#x27;fulfilled&#x27;</span>,</span><br><span class="line">                        value</span><br><span class="line">                    &#125;;</span><br><span class="line">                    <span class="keyword">if</span> (count === length) &#123;</span><br><span class="line">                        <span class="title function_">resolve</span>(result);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;, <span class="keyword">function</span> <span class="title function_">_reject</span>(<span class="params">reason</span>) &#123;</span><br><span class="line">                    result[count++] = &#123;</span><br><span class="line">                        <span class="attr">status</span>: <span class="string">&#x27;rejected&#x27;</span>,</span><br><span class="line">                        reason</span><br><span class="line">                    &#125;;</span><br><span class="line">                    <span class="keyword">if</span> (count === length) &#123;</span><br><span class="line">                        <span class="title function_">resolve</span>(result);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="title class_">Promise</span>.<span class="property">deferred</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> dfd = &#123;&#125;;</span><br><span class="line">        dfd.<span class="property">promise</span> = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">            dfd.<span class="property">resolve</span> = resolve;</span><br><span class="line">            dfd.<span class="property">reject</span> = reject;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">return</span> dfd;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Promise</span>;</span><br><span class="line">&#125;)();</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="title class_">Promise</span>;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ES6</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">Promise</span> = (<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="variable constant_">PENDING</span> = <span class="string">&#x27;PENDING&#x27;</span>,</span><br><span class="line">        <span class="variable constant_">FULFILLED</span> = <span class="string">&#x27;FULFILLED&#x27;</span>,</span><br><span class="line">        <span class="variable constant_">REJECTED</span> = <span class="string">&#x27;REJECTED&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Promise</span> &#123;</span><br><span class="line">        <span class="title function_">constructor</span>(<span class="params">fn</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">status</span> = <span class="variable constant_">PENDING</span>;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">value</span> = <span class="literal">null</span>;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">reason</span> = <span class="literal">null</span>;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">onFulfilledCallbacks</span> = [];</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">onRejectedCallbacks</span> = [];</span><br><span class="line"></span><br><span class="line">            <span class="keyword">const</span> <span class="title function_">resolve</span> = (<span class="params">value</span>) =&gt; &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">status</span> === <span class="variable constant_">PENDING</span>) &#123;</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="property">status</span> = <span class="variable constant_">FULFILLED</span>;</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="property">value</span> = value;</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="property">onFulfilledCallbacks</span>.<span class="title function_">forEach</span>(<span class="function"><span class="params">callback</span> =&gt;</span> &#123;</span><br><span class="line">                        <span class="title function_">callback</span>(<span class="variable language_">this</span>.<span class="property">value</span>);</span><br><span class="line">                    &#125;);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">const</span> <span class="title function_">reject</span> = (<span class="params">reason</span>) =&gt; &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">status</span> === <span class="variable constant_">PENDING</span>) &#123;</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="property">status</span> = <span class="variable constant_">REJECTED</span>;</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="property">reason</span> = reason;</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="property">onRejectedCallbacks</span>.<span class="title function_">forEach</span>(<span class="function"><span class="params">callback</span> =&gt;</span> &#123;</span><br><span class="line">                        <span class="title function_">callback</span>(<span class="variable language_">this</span>.<span class="property">reason</span>);</span><br><span class="line">                    &#125;);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="title function_">fn</span>(resolve, reject);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">                <span class="title function_">reject</span>(err);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="title function_">then</span>(<span class="params">onFulfilled, onRejected</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">typeof</span> onFulfilled !== <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">                onFulfilled = <span class="function"><span class="params">value</span> =&gt;</span> value;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">typeof</span> onRejected !== <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">                onRejected = <span class="function"><span class="params">reason</span> =&gt;</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> (reason <span class="keyword">instanceof</span> <span class="title class_">Error</span>) &#123;</span><br><span class="line">                        <span class="keyword">throw</span> reason;</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(reason);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">let</span> promise,</span><br><span class="line">                then;</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">status</span> === <span class="variable constant_">FULFILLED</span>) &#123;</span><br><span class="line">                promise = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">                    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                        <span class="keyword">try</span> &#123;</span><br><span class="line">                            <span class="keyword">if</span> (<span class="keyword">typeof</span> onFulfilled !== <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">                                <span class="title function_">resolve</span>(<span class="variable language_">this</span>.<span class="property">value</span>);</span><br><span class="line">                            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                                (<span class="keyword">function</span> <span class="title function_">thenable</span>(<span class="params">value</span>) &#123;</span><br><span class="line">                                    then = value.<span class="property">then</span>;</span><br><span class="line">                                    <span class="keyword">if</span> (<span class="keyword">typeof</span> then === <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">                                        then.<span class="title function_">call</span>(<span class="variable language_">this</span>, <span class="function"><span class="params">y</span> =&gt;</span> &#123;</span><br><span class="line">                                            thenable.<span class="title function_">call</span>(<span class="variable language_">this</span>, y);</span><br><span class="line">                                        &#125;, <span class="function"><span class="params">r</span> =&gt;</span> &#123;</span><br><span class="line">                                            <span class="title function_">reject</span>(r);</span><br><span class="line">                                        &#125;);</span><br><span class="line">                                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                                        <span class="keyword">const</span> x = <span class="title function_">onFulfilled</span>(value);</span><br><span class="line">                                        <span class="title function_">resolvePromise</span>(promise, x, resolve, reject);</span><br><span class="line">                                    &#125;</span><br><span class="line">                                &#125;.<span class="title function_">bind</span>(<span class="variable language_">this</span>))(<span class="variable language_">this</span>.<span class="property">value</span>);</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">                            <span class="title function_">reject</span>(err);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;, <span class="number">0</span>);</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">status</span> === <span class="variable constant_">REJECTED</span>) &#123;</span><br><span class="line">                promise = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">                    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                        <span class="keyword">try</span> &#123;</span><br><span class="line">                            <span class="keyword">if</span> (<span class="keyword">typeof</span> onRejected !== <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">                                <span class="title function_">reject</span>(<span class="variable language_">this</span>.<span class="property">reason</span>);</span><br><span class="line">                            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                                <span class="keyword">const</span> x = <span class="title function_">onRejected</span>(<span class="variable language_">this</span>.<span class="property">reason</span>);</span><br><span class="line">                                <span class="title function_">resolvePromise</span>(promise, x, resolve, reject);</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">                            <span class="title function_">reject</span>(err);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;, <span class="number">0</span>);</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">status</span> === <span class="variable constant_">PENDING</span>) &#123;</span><br><span class="line">                promise = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="property">onFulfilledCallbacks</span>.<span class="title function_">push</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                        <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                            <span class="keyword">try</span> &#123;</span><br><span class="line">                                <span class="keyword">if</span> (<span class="keyword">typeof</span> onFulfilled !== <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">                                    <span class="title function_">resolve</span>(<span class="variable language_">this</span>.<span class="property">value</span>);</span><br><span class="line">                                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                                    (<span class="keyword">function</span> <span class="title function_">thenable</span>(<span class="params">value</span>) &#123;</span><br><span class="line">                                        then = value.<span class="property">then</span>;</span><br><span class="line">                                        <span class="keyword">if</span> (<span class="keyword">typeof</span> then === <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">                                            then.<span class="title function_">call</span>(<span class="variable language_">this</span>, <span class="function"><span class="params">y</span> =&gt;</span> &#123;</span><br><span class="line">                                                thenable.<span class="title function_">call</span>(<span class="variable language_">this</span>, y);</span><br><span class="line">                                            &#125;, <span class="function"><span class="params">r</span> =&gt;</span> &#123;</span><br><span class="line">                                                <span class="title function_">reject</span>(r);</span><br><span class="line">                                            &#125;);</span><br><span class="line">                                        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                                            <span class="keyword">const</span> x = <span class="title function_">onFulfilled</span>(value);</span><br><span class="line">                                            <span class="title function_">resolvePromise</span>(promise, x, resolve, reject);</span><br><span class="line">                                        &#125;</span><br><span class="line">                                    &#125;.<span class="title function_">bind</span>(<span class="variable language_">this</span>))(<span class="variable language_">this</span>.<span class="property">value</span>);</span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">                                <span class="title function_">reject</span>(err);</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;, <span class="number">0</span>);</span><br><span class="line">                    &#125;);</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="property">onRejectedCallbacks</span>.<span class="title function_">push</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                        <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                            <span class="keyword">try</span> &#123;</span><br><span class="line">                                <span class="keyword">if</span> (<span class="keyword">typeof</span> onRejected !== <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">                                    <span class="title function_">reject</span>(<span class="variable language_">this</span>.<span class="property">reason</span>);</span><br><span class="line">                                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                                    <span class="keyword">const</span> x = <span class="title function_">onRejected</span>(<span class="variable language_">this</span>.<span class="property">reason</span>);</span><br><span class="line">                                    <span class="title function_">resolvePromise</span>(promise, x, resolve, reject);</span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">                                <span class="title function_">reject</span>(err);</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;, <span class="number">0</span>);</span><br><span class="line">                    &#125;);</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> promise;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">catch</span>(onRejected) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">then</span>(<span class="literal">null</span>, onRejected);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="title function_">finally</span>(<span class="params">fn</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">typeof</span> fn !== <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">TypeError</span>(<span class="string">&#x27;parameter must be a function&#x27;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">then</span>(<span class="function"><span class="params">value</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(<span class="title function_">fn</span>()).<span class="title function_">then</span>(<span class="function">() =&gt;</span> value);</span><br><span class="line">            &#125;, <span class="function"><span class="params">reason</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(<span class="title function_">fn</span>()).<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                    <span class="keyword">throw</span> reason;</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">resolvePromise</span>(<span class="params">promise, x, resolve, reject</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (promise === x) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="title function_">reject</span>(<span class="keyword">new</span> <span class="title class_">ReferenceError</span>(<span class="string">&#x27;The promise and the return value are the same&#x27;</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (x <span class="keyword">instanceof</span> <span class="title class_">Promise</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> x.<span class="title function_">then</span>(<span class="function"><span class="params">y</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="title function_">resolvePromise</span>(promise, y, resolve, reject);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> x === <span class="string">&#x27;object&#x27;</span> || <span class="keyword">typeof</span> x === <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (x === <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="title function_">reject</span>(x);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">let</span> then,</span><br><span class="line">                call = <span class="literal">false</span>;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                then = x.<span class="property">then</span>;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">                <span class="title function_">reject</span>(err);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">typeof</span> then === <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    then.<span class="title function_">call</span>(x, <span class="function"><span class="params">y</span> =&gt;</span> &#123;</span><br><span class="line">                        <span class="keyword">if</span> (call) <span class="keyword">return</span>;</span><br><span class="line">                        call = <span class="literal">true</span>;</span><br><span class="line">                        <span class="title function_">resolvePromise</span>(promise, y, resolve, reject);</span><br><span class="line">                    &#125;, <span class="function"><span class="params">r</span> =&gt;</span> &#123;</span><br><span class="line">                        <span class="keyword">if</span> (call) <span class="keyword">return</span>;</span><br><span class="line">                        call = <span class="literal">true</span>;</span><br><span class="line">                        <span class="title function_">reject</span>(r);</span><br><span class="line">                    &#125;);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (call) <span class="keyword">return</span>;</span><br><span class="line">                    <span class="title function_">reject</span>(err);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="title function_">resolve</span>(x);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="title function_">resolve</span>(x);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title class_">Promise</span>.<span class="property">resolve</span> = <span class="function"><span class="params">params</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (params <span class="keyword">instanceof</span> <span class="title class_">Promise</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> params;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="title function_">resolve</span>(params);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="title class_">Promise</span>.<span class="property">reject</span> = <span class="function"><span class="params">reason</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="title function_">reject</span>(reason);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="title class_">Promise</span>.<span class="property">all</span> = <span class="function"><span class="params">promiseLists</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (!<span class="title class_">Array</span>.<span class="title function_">isArray</span>(promiseLists)) &#123;</span><br><span class="line">                <span class="title function_">reject</span>(<span class="keyword">new</span> <span class="title class_">ReferenceError</span>(<span class="string">&#x27;parameter must be an array&#x27;</span>));</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">let</span> count = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">const</span> length = promiseLists.<span class="property">length</span>,</span><br><span class="line">                result = [];</span><br><span class="line">            promiseLists.<span class="title function_">forEach</span>(<span class="function"><span class="params">promise</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(promise).<span class="title function_">then</span>(<span class="function"><span class="params">value</span> =&gt;</span> &#123;</span><br><span class="line">                    result[count++] = value;</span><br><span class="line">                    <span class="keyword">if</span> (count === length) &#123;</span><br><span class="line">                        <span class="title function_">resolve</span>(result);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;, <span class="function"><span class="params">reason</span> =&gt;</span> &#123;</span><br><span class="line">                    <span class="title function_">reject</span>(reason);</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="title class_">Promise</span>.<span class="property">race</span> = <span class="function"><span class="params">promiseLists</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (!<span class="title class_">Array</span>.<span class="title function_">isArray</span>(promiseLists)) &#123;</span><br><span class="line">                <span class="title function_">reject</span>(<span class="keyword">new</span> <span class="title class_">ReferenceError</span>(<span class="string">&#x27;parameter must be an array&#x27;</span>));</span><br><span class="line">            &#125;</span><br><span class="line">            promiseLists.<span class="title function_">forEach</span>(<span class="function"><span class="params">promise</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(promise).<span class="title function_">then</span>(<span class="function"><span class="params">value</span> =&gt;</span> &#123;</span><br><span class="line">                    <span class="title function_">resolve</span>(value);</span><br><span class="line">                &#125;, <span class="function"><span class="params">reason</span> =&gt;</span> &#123;</span><br><span class="line">                    <span class="title function_">reject</span>(reason);</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="title class_">Promise</span>.<span class="property">allSettled</span> = <span class="function"><span class="params">promiseLists</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (!<span class="title class_">Array</span>.<span class="title function_">isArray</span>(promiseLists)) &#123;</span><br><span class="line">                <span class="title function_">reject</span>(<span class="keyword">new</span> <span class="title class_">ReferenceError</span>(<span class="string">&#x27;parameter must be an array&#x27;</span>));</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">let</span> count = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">const</span> length = promiseLists.<span class="property">length</span>,</span><br><span class="line">                result = [];</span><br><span class="line">            promiseLists.<span class="title function_">forEach</span>(<span class="function"><span class="params">promise</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(promise).<span class="title function_">then</span>(<span class="function"><span class="params">value</span> =&gt;</span> &#123;</span><br><span class="line">                    result[count++] = &#123;</span><br><span class="line">                        <span class="attr">status</span>: <span class="string">&#x27;fulfilled&#x27;</span>,</span><br><span class="line">                        value</span><br><span class="line">                    &#125;;</span><br><span class="line">                    <span class="keyword">if</span> (count === length) &#123;</span><br><span class="line">                        <span class="title function_">resolve</span>(result);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="title function_">resolve</span>(result);</span><br><span class="line">                &#125;, <span class="function"><span class="params">reason</span> =&gt;</span> &#123;</span><br><span class="line">                    result[count++] = &#123;</span><br><span class="line">                        <span class="attr">status</span>: <span class="string">&#x27;rejected&#x27;</span>,</span><br><span class="line">                        reason</span><br><span class="line">                    &#125;;</span><br><span class="line">                    <span class="keyword">if</span> (count === length) &#123;</span><br><span class="line">                        <span class="title function_">resolve</span>(result);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="title class_">Promise</span>.<span class="property">deferred</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> dfd = &#123;&#125;;</span><br><span class="line">        dfd.<span class="property">promise</span> = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">            dfd.<span class="property">resolve</span> = resolve;</span><br><span class="line">            dfd.<span class="property">reject</span> = reject;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">return</span> dfd;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Promise</span>;</span><br><span class="line">&#125;)();</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="title class_">Promise</span>;</span><br></pre></td></tr></table></figure>

<h4 id="generator-Thunk"><a href="#generator-Thunk" class="headerlink" title="generator Thunk"></a>generator Thunk</h4><blockquote>
<p>ES5</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Thunk</span>(<span class="params">fn</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> that = <span class="variable language_">this</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params">...args</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params">callback</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> fn.<span class="title function_">call</span>(that, ...args, callback);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">run</span>(<span class="params">taskRun</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> task = <span class="title function_">taskRun</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">next</span>(<span class="params">err, data</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (err) <span class="keyword">return</span> task.<span class="keyword">throw</span>(err <span class="keyword">instanceof</span> <span class="title class_">Error</span> ? err : <span class="keyword">new</span> <span class="title class_">Error</span>(err));</span><br><span class="line">        <span class="keyword">const</span> result = task.<span class="title function_">next</span>(data);</span><br><span class="line">        <span class="keyword">if</span> (result.<span class="property">done</span>) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> result.<span class="property">value</span> === <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">            result.<span class="title function_">value</span>(next);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="title function_">next</span>(<span class="literal">null</span>, result.<span class="property">value</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">next</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ES6</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">Thunk</span> = fn =&gt; <span class="function">(<span class="params">...args</span>) =&gt;</span> <span class="function"><span class="params">callback</span> =&gt;</span> fn.<span class="title function_">call</span>(<span class="variable language_">this</span>, ...args, callback);</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">run</span> = taskRun =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> task = <span class="title function_">taskRun</span>();</span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">next</span> = (<span class="params">err, data</span>) =&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span> (err) <span class="keyword">return</span> task.<span class="keyword">throw</span>(err <span class="keyword">instanceof</span> <span class="title class_">Error</span> ? err : <span class="keyword">new</span> <span class="title class_">Error</span>(err));</span><br><span class="line">        <span class="keyword">const</span> &#123;value, done&#125; = task.<span class="title function_">next</span>(data);</span><br><span class="line">        <span class="keyword">if</span> (done) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> value === <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">            <span class="title function_">value</span>(next);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="title function_">next</span>(<span class="literal">null</span>, value);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">next</span>();</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="promise-Generator-Thunk"><a href="#promise-Generator-Thunk" class="headerlink" title="promise Generator Thunk"></a>promise Generator Thunk</h4><blockquote>
<p>ES5</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Thunk</span>(<span class="params">fn</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> that = <span class="variable language_">this</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params">...args</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params">callback</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> fn.<span class="title function_">call</span>(that, ...args, callback);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">run</span>(<span class="params">taskRun</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="keyword">function</span> (<span class="params">resolve, reject</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> task = <span class="title function_">taskRun</span>();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">next</span>(<span class="params">err, data</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (err) <span class="keyword">return</span> <span class="title function_">reject</span>(task.<span class="keyword">throw</span>(err <span class="keyword">instanceof</span> <span class="title class_">Error</span> ? err : <span class="keyword">new</span> <span class="title class_">Error</span>(err)));</span><br><span class="line">            <span class="keyword">const</span> &#123;value, done&#125; = task.<span class="title function_">next</span>(data);</span><br><span class="line">            <span class="keyword">if</span> (done) <span class="keyword">return</span> <span class="title function_">resolve</span>(value);</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">typeof</span> value === <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="title function_">value</span>(next);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">const</span> promise = <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(value);</span><br><span class="line">            promise.<span class="title function_">then</span>(<span class="function"><span class="params">val</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="title function_">next</span>(<span class="literal">null</span>, val);</span><br><span class="line">            &#125;, <span class="function"><span class="params">reason</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="title function_">next</span>(reason);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="title function_">next</span>();</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ES6</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">Thunk</span> = fn =&gt; <span class="function">(<span class="params">...args</span>) =&gt;</span> <span class="function"><span class="params">callback</span> =&gt;</span> <span class="title function_">fn</span>(...args, callback);</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">run</span> = taskRun =&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> task = <span class="title function_">taskRun</span>();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">next</span>(<span class="params">err, data</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (err) <span class="keyword">return</span> <span class="title function_">reject</span>(task.<span class="keyword">throw</span>(err <span class="keyword">instanceof</span> <span class="title class_">Error</span> ? err : <span class="keyword">new</span> <span class="title class_">Error</span>(err)));</span><br><span class="line">            <span class="keyword">const</span> &#123;value, done&#125; = task.<span class="title function_">next</span>(data);</span><br><span class="line">            <span class="keyword">if</span> (done) <span class="keyword">return</span> <span class="title function_">resolve</span>(value);</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">typeof</span> value === <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="title function_">value</span>(next);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">const</span> promise = <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(value);</span><br><span class="line">            promise.<span class="title function_">then</span>(<span class="function"><span class="params">val</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="title function_">next</span>(<span class="literal">null</span>, val);</span><br><span class="line">            &#125;, <span class="function"><span class="params">reason</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="title function_">next</span>(reason);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="title function_">next</span>();</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="promise-Timeout"><a href="#promise-Timeout" class="headerlink" title="promise Timeout"></a>promise Timeout</h4><blockquote>
<p>ES5</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">timeoutPromise</span>(<span class="params">promise, timeout</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">race</span>([<span class="title class_">Promise</span>.<span class="title function_">resolve</span>(promise).<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">value</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="keyword">typeof</span> value !== <span class="string">&#x27;object&#x27;</span> || !value.<span class="title function_">hasOwnProperty</span>(<span class="string">&#x27;status&#x27;</span>)) ? &#123;</span><br><span class="line">            <span class="attr">status</span>: <span class="string">&#x27;fulfilled&#x27;</span>,</span><br><span class="line">            value</span><br><span class="line">        &#125; : value</span><br><span class="line">    &#125;), <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="keyword">function</span> (<span class="params">resolve, rejected</span>) &#123;</span><br><span class="line">        <span class="built_in">setTimeout</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            <span class="title function_">rejected</span>(&#123;</span><br><span class="line">                <span class="attr">status</span>: <span class="string">&#x27;rejected&#x27;</span>,</span><br><span class="line">                <span class="attr">reason</span>: <span class="string">&#x27;è¯·æ±‚è¶…æ—¶!&#x27;</span></span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;, timeout);</span><br><span class="line">    &#125;)]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ES6</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">timerPromise</span> = (<span class="params">promise, timeout</span>) =&gt; <span class="title class_">Promise</span>.<span class="title function_">race</span>([<span class="title class_">Promise</span>.<span class="title function_">resolve</span>(promise).<span class="title function_">then</span>(<span class="function"><span class="params">value</span> =&gt;</span></span><br><span class="line">    (<span class="keyword">typeof</span> value !== <span class="string">&#x27;object&#x27;</span> || !value.<span class="title function_">hasOwnProperty</span>(<span class="string">&#x27;status&#x27;</span>)) ? &#123;</span><br><span class="line">        <span class="attr">status</span>: <span class="string">&#x27;fulfilled&#x27;</span>,</span><br><span class="line">        value</span><br><span class="line">    &#125; : value), <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, rejected</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="title function_">rejected</span>(&#123;</span><br><span class="line">            <span class="attr">status</span>: <span class="string">&#x27;rejected&#x27;</span>,</span><br><span class="line">            <span class="attr">reason</span>: <span class="string">&#x27;è¯·æ±‚è¶…æ—¶!&#x27;</span></span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;, timeout);</span><br><span class="line">&#125;)]);</span><br></pre></td></tr></table></figure>

<h4 id="get-Characterâ€™s-Length"><a href="#get-Characterâ€™s-Length" class="headerlink" title="get Characterâ€™s Length"></a>get Characterâ€™s Length</h4><blockquote>
<p>ES5</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">getLength</span>(<span class="params">str</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> strTransform = str.<span class="title function_">toString</span>() || <span class="title class_">String</span>(str);</span><br><span class="line">    <span class="keyword">return</span> strTransform.<span class="title function_">match</span>(<span class="regexp">/[\s\S]/ug</span>).<span class="property">length</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ES6</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">getLength</span> = str =&gt; (str.<span class="title function_">toString</span>() || <span class="title class_">String</span>(str)).<span class="title function_">match</span>(<span class="regexp">/[\s\S]/ug</span>).<span class="property">length</span>;</span><br></pre></td></tr></table></figure>

<h4 id="judge-UTF-16-Character"><a href="#judge-UTF-16-Character" class="headerlink" title="judge UTF-16 Character"></a>judge UTF-16 Character</h4><blockquote>
<p>ES5</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">isUTF16</span>(<span class="params">str</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> strTransform = str.<span class="title function_">toString</span>() || <span class="title class_">String</span>(str);</span><br><span class="line">    <span class="keyword">return</span> strTransform.<span class="title function_">codePointAt</span>(<span class="number">0</span>) &gt; <span class="number">0xFFFF</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ES6</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">isUTF16</span> = str =&gt; (str.<span class="title function_">toString</span>() || <span class="title class_">String</span>(str)).<span class="title function_">codePointAt</span>(<span class="number">0</span>) &gt; <span class="number">0xFFFF</span>;</span><br></pre></td></tr></table></figure>

<h4 id="flags-Method-Imitate"><a href="#flags-Method-Imitate" class="headerlink" title="flags Method Imitate"></a>flags Method Imitate</h4><blockquote>
<p>ES5</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">flagsImitate</span>(<span class="params">regExp</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!regExp <span class="keyword">instanceof</span> <span class="title class_">RegExp</span>)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">TypeError</span>(<span class="string">&#x27;parameter mast be a RegExp&#x27;</span>);</span><br><span class="line">    <span class="keyword">var</span> regExpStr = regExp.<span class="title function_">toString</span>() || <span class="title class_">String</span>(regExp);</span><br><span class="line">    <span class="keyword">return</span> regExpStr.<span class="title function_">substring</span>(regExpStr.<span class="title function_">lastIndexOf</span>(<span class="string">&#x27;/&#x27;</span>) + <span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ES6</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">flagsImitate</span> = (<span class="params">regExp</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (!regExp <span class="keyword">instanceof</span> <span class="title class_">RegExp</span>)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">TypeError</span>(<span class="string">&#x27;parameter mast be a RegExp&#x27;</span>);</span><br><span class="line">    <span class="keyword">const</span> regExpStr = regExp.<span class="title function_">toString</span>() || <span class="title class_">String</span>(regExp);</span><br><span class="line">    <span class="keyword">return</span> regExpStr.<span class="title function_">substring</span>(regExpStr.<span class="title function_">lastIndexOf</span>(<span class="string">&#x27;/&#x27;</span>) + <span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="class-imitate"><a href="#class-imitate" class="headerlink" title="class imitate"></a>class imitate</h4><blockquote>
<p>ES5</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> classImitate = (<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> classImitate = <span class="keyword">function</span> (<span class="params">...args</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">new</span>.<span class="property">target</span> === <span class="literal">undefined</span>)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">TypeError</span>(<span class="string">&#x27;This class can only be called by the new constructor&#x27;</span>);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">args</span> = args;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(classImitate.<span class="property"><span class="keyword">prototype</span></span>, <span class="string">&#x27;method&#x27;</span>, &#123;</span><br><span class="line">        <span class="attr">value</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">new</span>.<span class="property">target</span> === <span class="literal">undefined</span>)</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">TypeError</span>(<span class="string">&#x27;This method cannot be called by the new constructor&#x27;</span>);</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Contains class parameters:&#x27;</span>, args);</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">enumerable</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">writable</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">configurable</span>: <span class="literal">true</span></span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(classImitate.<span class="property"><span class="keyword">prototype</span></span>, <span class="string">&#x27;getter&#x27;</span>, &#123;</span><br><span class="line">        <span class="attr">get</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">args</span>.<span class="title function_">join</span>(<span class="string">&#x27;,&#x27;</span>);</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">enumerable</span>: <span class="literal">false</span></span><br><span class="line">    &#125;);</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ES6</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> classImitate = (<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> classImitate = <span class="keyword">function</span> (<span class="params">...args</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">new</span>.<span class="property">target</span> === <span class="literal">undefined</span>)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">TypeError</span>(<span class="string">&#x27;This class can only be called by the new constructor&#x27;</span>);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">args</span> = args;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(classImitate.<span class="property"><span class="keyword">prototype</span></span>, <span class="string">&#x27;method&#x27;</span>, &#123;</span><br><span class="line">        <span class="title function_">value</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">new</span>.<span class="property">target</span> !== <span class="literal">undefined</span>)</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">TypeError</span>(<span class="string">&#x27;This method cannot be called by the new constructor&#x27;</span>);</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Contains class parameters:&#x27;</span>, args);</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">enumerable</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">writable</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">configurable</span>: <span class="literal">true</span></span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(classImitate.<span class="property"><span class="keyword">prototype</span></span>, <span class="string">&#x27;getter&#x27;</span>, &#123;</span><br><span class="line">        <span class="title function_">get</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">args</span>.<span class="title function_">join</span>(<span class="string">&#x27;,&#x27;</span>);</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">enumerable</span>: <span class="literal">false</span></span><br><span class="line">    &#125;);</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>

<h4 id="class-Rename-Imitate"><a href="#class-Rename-Imitate" class="headerlink" title="class Rename Imitate"></a>class Rename Imitate</h4><blockquote>
<p>ES5</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> classImitate = (<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> classImitateAnother = <span class="keyword">function</span> (<span class="params">...args</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">new</span>.<span class="property">target</span> === <span class="literal">undefined</span>)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">TypeError</span>(<span class="string">&#x27;This class can only be called by the new constructor&#x27;</span>);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">args</span> = args;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(classImitateAnother.<span class="property"><span class="keyword">prototype</span></span>, <span class="string">&#x27;method&#x27;</span>, &#123;</span><br><span class="line">        <span class="attr">value</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">new</span>.<span class="property">target</span> !== <span class="literal">undefined</span>)</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">TypeError</span>(<span class="string">&#x27;This method cannot be called by the new constructor&#x27;</span>);</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Contains class parameters:&#x27;</span>, args);</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">enumerable</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">writable</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">configurable</span>: <span class="literal">true</span></span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(classImitateAnother.<span class="property"><span class="keyword">prototype</span></span>, <span class="string">&#x27;getter&#x27;</span>, &#123;</span><br><span class="line">        <span class="attr">get</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">args</span>.<span class="title function_">join</span>(<span class="string">&#x27;,&#x27;</span>);</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">enumerable</span>: <span class="literal">false</span></span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> classImitateAnother;</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ES6</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> classImitate = (<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> classImitateAnother = <span class="keyword">function</span> (<span class="params">...args</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">new</span>.<span class="property">target</span> === <span class="literal">undefined</span>)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">TypeError</span>(<span class="string">&#x27;This class can only be called by the new constructor&#x27;</span>);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">args</span> = args;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(classImitateAnother.<span class="property"><span class="keyword">prototype</span></span>, <span class="string">&#x27;method&#x27;</span>, &#123;</span><br><span class="line">        <span class="title function_">value</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">new</span>.<span class="property">target</span> !== <span class="literal">undefined</span>)</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">TypeError</span>(<span class="string">&#x27;This method cannot be called by the new constructor&#x27;</span>);</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Contains class parameters:&#x27;</span>, <span class="variable language_">this</span>.<span class="property">args</span>);</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">enumerable</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">writable</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">configurable</span>: <span class="literal">true</span></span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(classImitateAnother.<span class="property"><span class="keyword">prototype</span></span>, <span class="string">&#x27;getter&#x27;</span>, &#123;</span><br><span class="line">        <span class="title function_">get</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">args</span>.<span class="title function_">join</span>(<span class="string">&#x27;,&#x27;</span>);</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">enumerable</span>: <span class="literal">false</span></span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> classImitateAnother;</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>

<h4 id="class-with-array-attributes"><a href="#class-with-array-attributes" class="headerlink" title="class with array attributes"></a>class with array attributes</h4><blockquote>
<p>ES5</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">toUnit32</span>(<span class="params">key</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">abs</span>(<span class="title class_">Number</span>(key))) % <span class="title class_">Math</span>.<span class="title function_">pow</span>(<span class="number">2</span>, <span class="number">32</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">isArrayIndex</span>(<span class="params">key</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> numberRicKey = <span class="title function_">toUnit32</span>(key);</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">String</span>(numberRicKey) === key &amp;&amp; numberRicKey &lt; <span class="title class_">Math</span>.<span class="title function_">pow</span>(<span class="number">2</span>, <span class="number">32</span>) - <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">MyArray</span>(<span class="params">...args</span>) &#123;</span><br><span class="line">    <span class="title class_">Array</span>.<span class="title function_">call</span>(<span class="variable language_">this</span>, ...args);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Proxy</span>(<span class="variable language_">this</span>, &#123;</span><br><span class="line">        <span class="title function_">set</span>(<span class="params">target, key, value</span>) &#123;</span><br><span class="line">            <span class="keyword">const</span> length = <span class="title class_">Reflect</span>.<span class="title function_">get</span>(target, <span class="string">&#x27;length&#x27;</span>);</span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_">isArrayIndex</span>(key)) &#123;</span><br><span class="line">                <span class="keyword">if</span> (key &gt;= length) &#123;</span><br><span class="line">                    <span class="title class_">Reflect</span>.<span class="title function_">set</span>(target, <span class="string">&#x27;length&#x27;</span>, key + <span class="number">1</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (key &lt; length) &#123;</span><br><span class="line">                    <span class="keyword">for</span> (<span class="keyword">let</span> i = length; i &gt;= key; i--) &#123;</span><br><span class="line">                        <span class="title class_">Reflect</span>.<span class="title function_">deleteProperty</span>(target, i);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="title class_">Reflect</span>.<span class="title function_">set</span>(target, key, value);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">setPrototypeOf</span>(<span class="title class_">MyArray</span>.<span class="property"><span class="keyword">prototype</span></span>, <span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span>);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ES6</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyArray</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Array</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">...args</span>) &#123;</span><br><span class="line">        <span class="variable language_">super</span>(...args);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Proxy</span>(<span class="variable language_">this</span>, &#123;</span><br><span class="line">            <span class="title function_">set</span>(<span class="params">target, key, value</span>) &#123;</span><br><span class="line">                <span class="keyword">const</span> length = <span class="title class_">Reflect</span>.<span class="title function_">get</span>(target, <span class="string">&#x27;length&#x27;</span>);</span><br><span class="line">                <span class="keyword">if</span> (target.<span class="title function_">isArrayIndex</span>(key)) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (key &gt;= length) &#123;</span><br><span class="line">                        <span class="title class_">Reflect</span>.<span class="title function_">set</span>(target, <span class="string">&#x27;length&#x27;</span>, key + <span class="number">1</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> (key &lt; length) &#123;</span><br><span class="line">                        <span class="keyword">for</span> (<span class="keyword">let</span> i = length; i &gt;= key; i--) &#123;</span><br><span class="line">                            <span class="title class_">Reflect</span>.<span class="title function_">deleteProperty</span>(target, i);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> <span class="title class_">Reflect</span>.<span class="title function_">set</span>(target, key, value);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">isArrayIndex</span>(<span class="params">key</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> numberRic = <span class="variable language_">this</span>.<span class="title function_">toUnit32</span>(key);</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">String</span>(numberRic) === key &amp;&amp; numberRic &lt; <span class="title class_">MyArray</span>.<span class="title function_">pow</span>(<span class="number">2</span>, <span class="number">32</span>) - <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">toUnit32</span>(<span class="params">key</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">abs</span>(<span class="title class_">Number</span>(key))) % <span class="title class_">Math</span>.<span class="title function_">pow</span>(<span class="number">2</span>, <span class="number">32</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="redux-imitate"><a href="#redux-imitate" class="headerlink" title="redux imitate"></a>redux imitate</h4><blockquote>
<p>ES5</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">createStore</span>(<span class="params">state, stateChanger</span>) &#123;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">getState</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> state;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">dispatch</span>(<span class="params">action</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">stateChanger</span>(state, action);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        getState,</span><br><span class="line">        dispatch</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">stateChanger</span>(<span class="params">state, action</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123;type, payload&#125; = action;</span><br><span class="line">    <span class="keyword">switch</span> (type) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;UPLOAD_TITLE&#x27;</span>:</span><br><span class="line">            state.<span class="property">title</span>.<span class="property">txt</span> = payload.<span class="property">title</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;UPLOAD_CONTENT&#x27;</span>:</span><br><span class="line">            state.<span class="property">content</span>.<span class="property">txt</span> = payload.<span class="property">content</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="attr">default</span>:</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> state;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> appState = &#123;</span><br><span class="line">    <span class="attr">title</span>: &#123;</span><br><span class="line">        <span class="attr">txt</span>: <span class="string">&#x27;å‰ç«¯è¿™ä»¶å°äº‹å„¿&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">content</span>: &#123;</span><br><span class="line">        <span class="attr">txt</span>: <span class="string">&#x27;Redux æºç è§£æ&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> store = <span class="title function_">createStore</span>(appState, stateChanger);</span><br><span class="line"><span class="keyword">var</span> state = store.<span class="title function_">getState</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;state&#x27;</span>, state.<span class="property">title</span>.<span class="property">txt</span>, state.<span class="property">content</span>.<span class="property">txt</span>);</span><br><span class="line">store.<span class="title function_">dispatch</span>(&#123;<span class="attr">type</span>: <span class="string">&#x27;UPLOAD_TITLE&#x27;</span>, <span class="attr">payload</span>: &#123;<span class="attr">title</span>: <span class="string">&#x27;è¿›å‡»çš„å¤§å‰ç«¯&#x27;</span>&#125;&#125;);</span><br><span class="line">state = store.<span class="title function_">getState</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;state&#x27;</span>, state.<span class="property">title</span>.<span class="property">txt</span>, state.<span class="property">content</span>.<span class="property">txt</span>);</span><br><span class="line">store.<span class="title function_">dispatch</span>(&#123;<span class="attr">type</span>: <span class="string">&#x27;UPLOAD_CONTENT&#x27;</span>, <span class="attr">payload</span>: &#123;<span class="attr">content</span>: <span class="string">&#x27;æ‰‹å†™ Promise&#x27;</span>&#125;&#125;);</span><br><span class="line">state = store.<span class="title function_">getState</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;state&#x27;</span>, state.<span class="property">title</span>.<span class="property">txt</span>, state.<span class="property">content</span>.<span class="property">txt</span>);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ES6</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">createStore</span> = (<span class="params">state, stateChanger</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">getState</span> = (<span class="params"></span>) =&gt; state;</span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">dispatch</span> = action =&gt; <span class="title function_">stateChanger</span>(state, action);</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        getState,</span><br><span class="line">        dispatch</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">stateChanger</span> = (<span class="params">state, action</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123;type, payload&#125; = action;</span><br><span class="line">    <span class="keyword">switch</span> (type) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;UPLOAD_TITLE&#x27;</span>:</span><br><span class="line">            state.<span class="property">title</span>.<span class="property">txt</span> = payload.<span class="property">title</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;UPLOAD_CONTENT&#x27;</span>:</span><br><span class="line">            state.<span class="property">content</span>.<span class="property">txt</span> = payload.<span class="property">content</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="attr">default</span>:</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> state;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> appState = &#123;</span><br><span class="line">    <span class="attr">title</span>: &#123;</span><br><span class="line">        <span class="attr">txt</span>: <span class="string">&#x27;å‰ç«¯è¿™ä»¶å°äº‹å„¿&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">content</span>: &#123;</span><br><span class="line">        <span class="attr">txt</span>: <span class="string">&#x27;Redux æºç è§£æ&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> store = <span class="title function_">createStore</span>(appState, stateChanger);</span><br><span class="line"><span class="keyword">let</span> state = store.<span class="title function_">getState</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;state:&#x27;</span>, state.<span class="property">title</span>.<span class="property">txt</span>, state.<span class="property">content</span>.<span class="property">txt</span>);</span><br><span class="line">store.<span class="title function_">dispatch</span>(&#123;<span class="attr">type</span>: <span class="string">&#x27;UPLOAD_TITLE&#x27;</span>, <span class="attr">payload</span>: &#123;<span class="attr">title</span>: <span class="string">&#x27;è¿›å‡»çš„å¤§å‰ç«¯&#x27;</span>&#125;&#125;);</span><br><span class="line">state = store.<span class="title function_">getState</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;state:&#x27;</span>, state.<span class="property">title</span>.<span class="property">txt</span>, state.<span class="property">content</span>.<span class="property">txt</span>);</span><br><span class="line">store.<span class="title function_">dispatch</span>(&#123;<span class="attr">type</span>: <span class="string">&#x27;UPLOAD_CONTENT&#x27;</span>, <span class="attr">payload</span>: &#123;<span class="attr">content</span>: <span class="string">&#x27;æ‰‹å†™ Promise&#x27;</span>&#125;&#125;);</span><br><span class="line">state = store.<span class="title function_">getState</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;state:&#x27;</span>, state.<span class="property">title</span>.<span class="property">txt</span>, state.<span class="property">content</span>.<span class="property">txt</span>);</span><br></pre></td></tr></table></figure>

<h4 id="redux-complete-imitate"><a href="#redux-complete-imitate" class="headerlink" title="redux complete imitate"></a>redux complete imitate</h4><blockquote>
<p>ES5</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">createStore</span>(<span class="params">reducer</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> state = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">var</span> listeners = [];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">getState</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> state;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">subscribe</span>(<span class="params">listener</span>) &#123;</span><br><span class="line">        listeners.<span class="title function_">push</span>(listener);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">dispatch</span>(<span class="params">action</span>) &#123;</span><br><span class="line">        state = <span class="title function_">reducer</span>(state, action);</span><br><span class="line">        listeners.<span class="title function_">forEach</span>(<span class="keyword">function</span> (<span class="params">listener</span>) &#123;</span><br><span class="line">            <span class="title function_">listener</span>();</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆå§‹åŒ–</span></span><br><span class="line">    <span class="title function_">dispatch</span>(&#123;&#125;);</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        getState,</span><br><span class="line">        subscribe,</span><br><span class="line">        dispatch</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> appState = &#123;</span><br><span class="line">    <span class="attr">title</span>: &#123;</span><br><span class="line">        <span class="attr">txt</span>: <span class="string">&#x27;å‰ç«¯è¿™ä»¶å°äº‹å„¿&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">content</span>: &#123;</span><br><span class="line">        <span class="attr">txt</span>: <span class="string">&#x27;Redux æºç è§£æ&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">reducer</span>(<span class="params">state, action</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!state)</span><br><span class="line">        <span class="keyword">return</span> appState;</span><br><span class="line">    <span class="keyword">const</span> &#123;type, payload&#125; = action;</span><br><span class="line">    <span class="keyword">switch</span> (type) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;UPLOAD_TITLE&#x27;</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="title class_">Object</span>.<span class="title function_">assign</span>(&#123;&#125;, state, &#123;</span><br><span class="line">                <span class="attr">title</span>: &#123;</span><br><span class="line">                    <span class="attr">txt</span>: payload.<span class="property">title</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;UPLOAD_CONTENT&#x27;</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="title class_">Object</span>.<span class="title function_">assign</span>(&#123;&#125;, state, &#123;</span><br><span class="line">                <span class="attr">content</span>: &#123;</span><br><span class="line">                    <span class="attr">txt</span>: payload.<span class="property">content</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        <span class="attr">default</span>:</span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                ...state</span><br><span class="line">            &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">renderApp</span>(<span class="params">state</span>) &#123;</span><br><span class="line">    <span class="title function_">renderTitle</span>(state);</span><br><span class="line">    <span class="title function_">renderContent</span>(state);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">renderTitle</span>(<span class="params">state</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> title = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;title&#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> title === <span class="string">&#x27;undefined&#x27;</span> || title === <span class="literal">null</span>) &#123;</span><br><span class="line">        title = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;div&#x27;</span>);</span><br><span class="line">        title.<span class="property">id</span> = <span class="string">&#x27;title&#x27;</span>;</span><br><span class="line">        <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">append</span>(title);</span><br><span class="line">        <span class="title function_">renderTitle</span>(state);</span><br><span class="line">    &#125;</span><br><span class="line">    title.<span class="property">innerHTML</span> = state.<span class="property">title</span>.<span class="property">txt</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">renderContent</span>(<span class="params">state</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> content = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;content&#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> content === <span class="string">&#x27;undefined&#x27;</span> || content === <span class="literal">null</span>) &#123;</span><br><span class="line">        content = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;div&#x27;</span>);</span><br><span class="line">        content.<span class="property">id</span> = <span class="string">&#x27;content&#x27;</span>;</span><br><span class="line">        <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">append</span>(content);</span><br><span class="line">        <span class="title function_">renderContent</span>(state);</span><br><span class="line">    &#125;</span><br><span class="line">    content.<span class="property">innerHTML</span> = state.<span class="property">content</span>.<span class="property">txt</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> store = <span class="title function_">createStore</span>(reducer);</span><br><span class="line"><span class="title function_">renderApp</span>(store.<span class="title function_">getState</span>());</span><br><span class="line">store.<span class="title function_">subscribe</span>(<span class="function">() =&gt;</span> <span class="title function_">renderApp</span>(store.<span class="title function_">getState</span>()));</span><br><span class="line">store.<span class="title function_">dispatch</span>(&#123;<span class="attr">type</span>: <span class="string">&#x27;UPLOAD_TITLE&#x27;</span>, <span class="attr">payload</span>: &#123;<span class="attr">title</span>: <span class="string">&#x27;è¿›å‡»çš„å¤§å‰ç«¯&#x27;</span>&#125;&#125;);</span><br><span class="line">store.<span class="title function_">dispatch</span>(&#123;<span class="attr">type</span>: <span class="string">&#x27;UPLOAD_CONTENT&#x27;</span>, <span class="attr">payload</span>: &#123;<span class="attr">content</span>: <span class="string">&#x27;æ‰‹å†™ Promise&#x27;</span>&#125;&#125;);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ES6</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">createStore</span> = reducer =&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> state = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">const</span> listeners = [];</span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">getState</span> = (<span class="params"></span>) =&gt; state;</span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">subscribe</span> = listener =&gt; listeners.<span class="title function_">push</span>(listener);</span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">dispatch</span> = action =&gt; &#123;</span><br><span class="line">        state = <span class="title function_">reducer</span>(state, action);</span><br><span class="line">        listeners.<span class="title function_">forEach</span>(<span class="function"><span class="params">listener</span> =&gt;</span> <span class="title function_">listener</span>());</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="comment">// åˆå§‹åŒ–</span></span><br><span class="line">    <span class="title function_">dispatch</span>(&#123;&#125;);</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        getState,</span><br><span class="line">        subscribe,</span><br><span class="line">        dispatch</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> appState = &#123;</span><br><span class="line">    <span class="attr">title</span>: &#123;</span><br><span class="line">        <span class="attr">txt</span>: <span class="string">&#x27;å‰ç«¯è¿™ä»¶å°äº‹å„¿&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">content</span>: &#123;</span><br><span class="line">        <span class="attr">txt</span>: <span class="string">&#x27;Redux æºç è§£æ&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">reducer</span> = (<span class="params">state, action</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (!state)</span><br><span class="line">        <span class="keyword">return</span> appState;</span><br><span class="line">    <span class="keyword">const</span> &#123;type, payload&#125; = action;</span><br><span class="line">    <span class="keyword">switch</span> (type) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;UPLOAD_TITLE&#x27;</span>:</span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                ...state,</span><br><span class="line">                <span class="attr">title</span>: &#123;</span><br><span class="line">                    <span class="attr">txt</span>: payload.<span class="property">title</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;UPLOAD_CONTENT&#x27;</span>:</span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                ...state,</span><br><span class="line">                <span class="attr">content</span>: &#123;</span><br><span class="line">                    <span class="attr">txt</span>: payload.<span class="property">content</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;;</span><br><span class="line">        <span class="attr">default</span>:</span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                ...state</span><br><span class="line">            &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">renderTitle</span> = state =&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> title = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;title&#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> title === <span class="string">&#x27;undefined&#x27;</span> || title === <span class="literal">null</span>) &#123;</span><br><span class="line">        title = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;div&#x27;</span>);</span><br><span class="line">        title.<span class="property">id</span> = <span class="string">&#x27;title&#x27;</span>;</span><br><span class="line">        <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">append</span>(title);</span><br><span class="line">        <span class="title function_">renderTitle</span>(state);</span><br><span class="line">    &#125;</span><br><span class="line">    title.<span class="property">innerHTML</span> = state.<span class="property">title</span>.<span class="property">txt</span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">renderContent</span> = state =&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> content = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;content&#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> content === <span class="string">&#x27;undefined&#x27;</span> || content === <span class="literal">null</span>) &#123;</span><br><span class="line">        content = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;div&#x27;</span>);</span><br><span class="line">        content.<span class="property">id</span> = <span class="string">&#x27;content&#x27;</span>;</span><br><span class="line">        <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">append</span>(content);</span><br><span class="line">        <span class="title function_">renderContent</span>(state);</span><br><span class="line">    &#125;</span><br><span class="line">    content.<span class="property">innerHTML</span> = state.<span class="property">content</span>.<span class="property">txt</span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">renderApp</span> = state =&gt; &#123;</span><br><span class="line">    <span class="title function_">renderTitle</span>(state);</span><br><span class="line">    <span class="title function_">renderContent</span>(state);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> store = <span class="title function_">createStore</span>(reducer);</span><br><span class="line"><span class="title function_">renderApp</span>(store.<span class="title function_">getState</span>());</span><br><span class="line">store.<span class="title function_">subscribe</span>(<span class="function">() =&gt;</span> <span class="title function_">renderApp</span>(store.<span class="title function_">getState</span>()));</span><br><span class="line">store.<span class="title function_">dispatch</span>(&#123;<span class="attr">type</span>: <span class="string">&#x27;UPLOAD_TITLE&#x27;</span>, <span class="attr">payload</span>: &#123;<span class="attr">title</span>: <span class="string">&#x27;è¿›å‡»çš„å¤§å‰ç«¯&#x27;</span>&#125;&#125;);</span><br><span class="line">store.<span class="title function_">dispatch</span>(&#123;<span class="attr">type</span>: <span class="string">&#x27;UPLOAD_CONTENT&#x27;</span>, <span class="attr">payload</span>: &#123;<span class="attr">content</span>: <span class="string">&#x27;æ‰‹å†™ Promise&#x27;</span>&#125;&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="isPlainObject"><a href="#isPlainObject" class="headerlink" title="isPlainObject"></a>isPlainObject</h4><blockquote>
<p>ES5</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">isObject</span>(<span class="params">o</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>.<span class="title function_">call</span>(o) === <span class="string">&#x27;[object Object]&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">isPlainObject</span>(<span class="params">o</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_">isObject</span>(o) === <span class="literal">false</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> ctor, proto;</span><br><span class="line">    ctor = o.<span class="property">constructor</span>;</span><br><span class="line">    <span class="keyword">if</span> (ctor === <span class="literal">undefined</span>) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    proto = o.<span class="property"><span class="keyword">prototype</span></span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_">isObject</span>(proto) === <span class="literal">false</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (o.<span class="title function_">hasOwnProperty</span>(<span class="string">&#x27;isPrototypeOf&#x27;</span>) === <span class="literal">false</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ES6</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">isObject</span> = o =&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>.<span class="title function_">call</span>(o) === <span class="string">&#x27;[object Object]&#x27;</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">isPlainObject</span> = o =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_">isObject</span>(o) === <span class="literal">false</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> ctor, proto;</span><br><span class="line">    ctor = o.<span class="property">constructor</span>;</span><br><span class="line">    <span class="keyword">if</span> (ctor === <span class="literal">undefined</span>) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    proto = o.<span class="property"><span class="keyword">prototype</span></span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_">isObject</span>(proto) === <span class="literal">false</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (o.<span class="title function_">hasOwnProperty</span>(<span class="string">&#x27;isPrototypeOf&#x27;</span>) === <span class="literal">false</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="redux-isPlainObject"><a href="#redux-isPlainObject" class="headerlink" title="redux isPlainObject"></a>redux isPlainObject</h4><blockquote>
<p>ES5</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">isPlainObject</span>(<span class="params">o</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> o !== <span class="string">&#x27;object&#x27;</span> || o === <span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">var</span> currentObject = o;</span><br><span class="line">    <span class="keyword">while</span> (<span class="title class_">Object</span>.<span class="title function_">getPrototypeOf</span>(currentObject) !== <span class="literal">null</span>) &#123;</span><br><span class="line">        currentObject = <span class="title class_">Object</span>.<span class="title function_">getPrototypeOf</span>(currentObject);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Object</span>.<span class="title function_">getPrototypeOf</span>(o) === currentObject;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ES6</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">isPlainObject</span> = o =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> o !== <span class="string">&#x27;object&#x27;</span> || o === <span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">let</span> currentObject = o;</span><br><span class="line">    <span class="keyword">while</span> (<span class="title class_">Object</span>.<span class="title function_">getPrototypeOf</span>(currentObject) !== <span class="literal">null</span>) &#123;</span><br><span class="line">        currentObject = <span class="title class_">Object</span>.<span class="title function_">getPrototypeOf</span>(currentObject);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Object</span>.<span class="title function_">getPrototypeOf</span>(o) === currentObject;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="redux-createStore-sourceCode"><a href="#redux-createStore-sourceCode" class="headerlink" title="redux createStore sourceCode"></a>redux createStore sourceCode</h4><blockquote>
<p>ES5</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">Action</span>_Types = &#123;</span><br><span class="line">    <span class="attr">INIT</span>: <span class="string">&#x27;@@redux/INIT&#x27;</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">isPlainObject</span>(<span class="params">o</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> o !== <span class="string">&#x27;object&#x27;</span> || o === <span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">var</span> currentObject = o;</span><br><span class="line">    <span class="keyword">while</span> (<span class="title class_">Object</span>.<span class="title function_">getPrototypeOf</span>(currentObject) !== <span class="literal">null</span>) &#123;</span><br><span class="line">        currentObject = <span class="title class_">Object</span>.<span class="title function_">getPrototypeOf</span>(currentObject);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Object</span>.<span class="title function_">getPrototypeOf</span>(o) === currentObject;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createStore</span>(<span class="params">reducer, preloadedState, enhancer</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> enhancer === <span class="string">&#x27;undefined&#x27;</span> &amp;&amp; <span class="keyword">typeof</span> preloadedState === <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">        enhancer = preloadedState;</span><br><span class="line">        preloadedState = <span class="literal">undefined</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> enhancer !== <span class="string">&#x27;undefined&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> enhancer !== <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;Expected the enhancer to be a function.&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">enhancer</span>(createStore)(reducer, preloadedState);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> reducer !== <span class="string">&#x27;function&#x27;</span>)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;Expected the reducer to be a function.&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> currentState = preloadedState;</span><br><span class="line">    <span class="keyword">var</span> currentReducer = reducer;</span><br><span class="line">    <span class="keyword">var</span> currentListeners = [];</span><br><span class="line">    <span class="keyword">var</span> nextListeners = currentListeners;</span><br><span class="line">    <span class="keyword">var</span> isDispatching = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">getState</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> currentState;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">ensureCanMutateNextListener</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (nextListeners !== currentListeners) &#123;</span><br><span class="line">            nextListeners = currentListeners.<span class="title function_">slice</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">subscribe</span>(<span class="params">listener</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> listener !== <span class="string">&#x27;function&#x27;</span>)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;Expected listener to be a function.&#x27;</span>);</span><br><span class="line">        <span class="keyword">var</span> isSubscribe = <span class="literal">true</span>;</span><br><span class="line">        <span class="title function_">ensureCanMutateNextListener</span>();</span><br><span class="line">        nextListeners.<span class="title function_">push</span>(listener);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">function</span> <span class="title function_">unsubscibe</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!isSubscribe) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            isSubscribe = <span class="literal">false</span>;</span><br><span class="line">            <span class="keyword">var</span> index = nextListeners.<span class="title function_">indexOf</span>(listener);</span><br><span class="line">            nextListeners.<span class="title function_">splice</span>(index, <span class="number">1</span>);</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">dispatch</span>(<span class="params">action</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_">isPlainObject</span>(action))</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(</span><br><span class="line">                <span class="string">`</span></span><br><span class="line"><span class="string">                Actions must be plain objects. </span></span><br><span class="line"><span class="string">                Use custom middleware for async actions.</span></span><br><span class="line"><span class="string">                `</span></span><br><span class="line">            );</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> action.<span class="property">type</span> === <span class="string">&#x27;undefined&#x27;</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(</span><br><span class="line">                <span class="string">`</span></span><br><span class="line"><span class="string">                Actions may not have an undefined &quot;type&quot; property.</span></span><br><span class="line"><span class="string">                Have you misspelled a constant?</span></span><br><span class="line"><span class="string">                `</span></span><br><span class="line">            );</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (isDispatching) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;Reducers may not dispatch actions.&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            isDispatching = <span class="literal">true</span>;</span><br><span class="line">            currentState = <span class="title function_">currentReducer</span>(currentState, action);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            isDispatching = <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">var</span> listeners = currentListeners = nextListeners;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; listeners.<span class="property">length</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">var</span> listener = listeners[i];</span><br><span class="line">            <span class="title function_">listener</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> action;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">dispatch</span>(&#123;<span class="attr">type</span>: <span class="title class_">Action</span>_Types.<span class="property">INIT</span>&#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        getState,</span><br><span class="line">        subscribe,</span><br><span class="line">        dispatch</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ES6</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">Action</span>_Types = &#123;</span><br><span class="line">    <span class="attr">INIT</span>: <span class="string">&#x27;@@redux/INIT&#x27;</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">isPlainObject</span>(<span class="params">o</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> o !== <span class="string">&#x27;object&#x27;</span> || o !== <span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">let</span> currentObject = o;</span><br><span class="line">    <span class="keyword">while</span> (<span class="title class_">Object</span>.<span class="title function_">getPrototypeOf</span>(currentObject) !== <span class="literal">null</span>) &#123;</span><br><span class="line">        currentObject = <span class="title class_">Object</span>.<span class="title function_">getPrototypeOf</span>(currentObject);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Object</span>.<span class="title function_">getPrototypeOf</span>(o) === currentObject;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createStore</span>(<span class="params">reducer, preloadedState, enhancer</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> preloadedState === <span class="string">&#x27;function&#x27;</span> &amp;&amp; <span class="keyword">typeof</span> enhancer === <span class="string">&#x27;undefined&#x27;</span>) &#123;</span><br><span class="line">        enhancer = preloadedState;</span><br><span class="line">        preloadedState = <span class="literal">undefined</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> enhancer !== <span class="string">&#x27;undefined&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> enhancer !== <span class="string">&#x27;function&#x27;</span>)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;Expected the enhancer to be a function.&#x27;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">enhancer</span>(createStore)(reducer, preloadedState);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> reducer !== <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;Expected the reducer to be a function.&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">let</span> currentState = preloadedState;</span><br><span class="line">    <span class="keyword">let</span> currentReducer = reducer;</span><br><span class="line">    <span class="keyword">let</span> currentListeners = [];</span><br><span class="line">    <span class="keyword">let</span> nextListeners = currentListeners;</span><br><span class="line">    <span class="keyword">let</span> isDispatching = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">getState</span> = (<span class="params"></span>) =&gt; currentState;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">ensureCanMutateNextListener</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span> (nextListeners !== currentListeners)</span><br><span class="line">            nextListeners = currentListeners.<span class="title function_">slice</span>();</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">subscribe</span> = listener =&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> listener !== <span class="string">&#x27;function&#x27;</span>)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;Expected listener to be a function.&#x27;</span>);</span><br><span class="line">        <span class="keyword">let</span> isSubscribe = <span class="literal">true</span>;</span><br><span class="line">        <span class="title function_">ensureCanMutateNextListener</span>();</span><br><span class="line">        nextListeners.<span class="title function_">push</span>(listener);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">function</span> <span class="title function_">unscribe</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!isSubscribe) <span class="keyword">return</span>;</span><br><span class="line">            isSubscribe = <span class="literal">false</span>;</span><br><span class="line">            <span class="keyword">const</span> index = nextListeners.<span class="title function_">indexOf</span>(listener);</span><br><span class="line">            nextListeners.<span class="title function_">splice</span>(index, <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">dispatch</span> = action =&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_">isPlainObject</span>(action)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(</span><br><span class="line">                <span class="string">`</span></span><br><span class="line"><span class="string">                Actions must be plain objects. </span></span><br><span class="line"><span class="string">                Use custom middleware for async actions.</span></span><br><span class="line"><span class="string">                `</span></span><br><span class="line">            );</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> action.<span class="property">type</span> === <span class="string">&#x27;undefined&#x27;</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(</span><br><span class="line">                <span class="string">`</span></span><br><span class="line"><span class="string">                Actions may not have an undefined &quot;type&quot; property.</span></span><br><span class="line"><span class="string">                Have you misspelled a constant?</span></span><br><span class="line"><span class="string">                `</span></span><br><span class="line">            );</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (isDispatching) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;Reducers may not dispatch actions.&#x27;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            isDispatching = <span class="literal">true</span>;</span><br><span class="line">            currentState = <span class="title function_">currentReducer</span>(currentState, action);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            isDispatching = <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">const</span> listeners = currentListeners = nextListeners;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; listeners.<span class="property">length</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">const</span> listener = listeners[i];</span><br><span class="line">            <span class="title function_">listener</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> action;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">dispatch</span>(&#123;<span class="attr">type</span>: <span class="title class_">Action</span>_Types.<span class="property">INIT</span>&#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        getState,</span><br><span class="line">        subscribe,</span><br><span class="line">        dispatch</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="dateFormat-ago"><a href="#dateFormat-ago" class="headerlink" title="dateFormat ago"></a>dateFormat ago</h4><blockquote>
<p>ES5</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Date</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="title function_">__defineGetter__</span>(<span class="string">&#x27;ago&#x27;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> differ = (<span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">getTime</span>() - <span class="variable language_">this</span>.<span class="title function_">getTime</span>()) / <span class="number">1000</span>,</span><br><span class="line">        day_differ = <span class="title class_">Math</span>.<span class="title function_">floor</span>(differ / <span class="number">86400</span>);</span><br><span class="line">    <span class="keyword">return</span> !day_differ &amp;&amp; (differ &lt; <span class="number">60</span> &amp;&amp; <span class="string">&#x27;Just now&#x27;</span> ||</span><br><span class="line">        differ &lt; <span class="number">120</span> &amp;&amp; <span class="string">&#x27;1 minute ago&#x27;</span> ||</span><br><span class="line">        differ &lt; <span class="number">3600</span> &amp;&amp; <span class="title class_">Math</span>.<span class="title function_">floor</span>(differ / <span class="number">60</span>) + <span class="string">&#x27; minutes ago&#x27;</span> ||</span><br><span class="line">        differ &lt; <span class="number">7200</span> &amp;&amp; <span class="string">&#x27;1 hour ago&#x27;</span> ||</span><br><span class="line">        differ &lt; <span class="number">86400</span> &amp;&amp; <span class="title class_">Math</span>.<span class="title function_">floor</span>(differ / <span class="number">3600</span>) + <span class="string">&#x27; hours ago&#x27;</span></span><br><span class="line">    ) || (day_differ === <span class="number">1</span> &amp;&amp; <span class="string">&#x27;Yesterday&#x27;</span> ||</span><br><span class="line">        day_differ &lt; <span class="number">7</span> &amp;&amp; day_differ + <span class="string">&#x27; days ago&#x27;</span> ||</span><br><span class="line">        <span class="title class_">Math</span>.<span class="title function_">ceil</span>(day_differ / <span class="number">7</span>) + <span class="string">&#x27; weeks ago&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ES6</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Date</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="title function_">__defineGetter__</span>(<span class="string">&#x27;ago&#x27;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> differ = (<span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">getTime</span>() - <span class="variable language_">this</span>.<span class="title function_">getTime</span>()) / <span class="number">1000</span>,</span><br><span class="line">        day_differ = <span class="title class_">Math</span>.<span class="title function_">floor</span>(differ / <span class="number">86400</span>);</span><br><span class="line">    <span class="keyword">return</span> !day_differ &amp;&amp;</span><br><span class="line">        (differ &lt; <span class="number">60</span> &amp;&amp; <span class="string">&#x27;Just now&#x27;</span> ||</span><br><span class="line">            differ &lt; <span class="number">120</span> &amp;&amp; <span class="string">&#x27;1 minute ago&#x27;</span> ||</span><br><span class="line">            differ &lt; <span class="number">3600</span> &amp;&amp; <span class="string">`<span class="subst">$&#123;<span class="built_in">Math</span>.floor(differ / <span class="number">60</span>)&#125;</span> minutes ago`</span> ||</span><br><span class="line">            differ &lt; <span class="number">7200</span> &amp;&amp; <span class="string">&#x27;1 hour ago&#x27;</span> ||</span><br><span class="line">            differ &lt; <span class="number">86400</span> &amp;&amp; <span class="string">`<span class="subst">$&#123;<span class="built_in">Math</span>.floor(differ / <span class="number">3600</span>)&#125;</span> hours ago`</span>) ||</span><br><span class="line">        (day_differ === <span class="number">1</span> &amp;&amp; <span class="string">&#x27;Yesterday&#x27;</span> ||</span><br><span class="line">            day_differ &lt; <span class="number">7</span> &amp;&amp; <span class="string">`<span class="subst">$&#123;day_differ&#125;</span> days ago`</span> ||</span><br><span class="line">            <span class="string">`<span class="subst">$&#123;<span class="built_in">Math</span>.ceil(day_differ / <span class="number">7</span>)&#125;</span> weeks ago`</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="resolvePath-CLI"><a href="#resolvePath-CLI" class="headerlink" title="resolvePath CLI"></a>resolvePath CLI</h4><blockquote>
<p>ES5</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"><span class="built_in">require</span>(<span class="string">&#x27;colors&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">resolvePathCli</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> map = <span class="keyword">new</span> <span class="title class_">Map</span>();</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;å½“å‰è·¯å¾„ä¸‹çš„æ–‡ä»¶/ç›®å½•åˆ—è¡¨å¦‚ä¸‹:&#x27;</span>);</span><br><span class="line">    fs.<span class="title function_">readdir</span>(process.<span class="title function_">cwd</span>() + <span class="string">&#x27;/&#x27;</span>, <span class="keyword">function</span> (<span class="params">err, files</span>) &#123;</span><br><span class="line">        <span class="title function_">error</span>(err);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">        <span class="keyword">var</span> length = files.<span class="property">length</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">filesOrDirFunc</span>(<span class="params">i = <span class="number">0</span></span>) &#123;</span><br><span class="line">            <span class="keyword">var</span> filesOrDir = files[i];</span><br><span class="line">            fs.<span class="title function_">stat</span>(process.<span class="title function_">cwd</span>() + <span class="string">&#x27;/&#x27;</span> + filesOrDir, <span class="keyword">function</span> (<span class="params">err, stats</span>) &#123;</span><br><span class="line">                <span class="keyword">var</span> statsResult = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">                map.<span class="title function_">set</span>(i, stats);</span><br><span class="line">                <span class="keyword">if</span> (stats.<span class="title function_">isDirectory</span>()) &#123;</span><br><span class="line">                    statsResult = <span class="string">&#x27;        &#x27;</span> + i + <span class="string">&#x27;: &#x27;</span> + filesOrDir + <span class="string">&#x27;/&#x27;</span>;</span><br><span class="line">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(statsResult.<span class="property">blue</span>);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    statsResult = <span class="string">&#x27;        &#x27;</span> + i + <span class="string">&#x27;: &#x27;</span> + filesOrDir;</span><br><span class="line">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(statsResult.<span class="property">cyan</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (++i === length) &#123;</span><br><span class="line">                    <span class="title function_">read</span>();</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="title function_">filesOrDirFunc</span>(i);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">read</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">            process.<span class="property">stdout</span>.<span class="title function_">write</span>(<span class="string">&#x27;è¯·æ‚¨é€‰æ‹©å½“å‰è·¯å¾„ä¸‹çš„æ–‡ä»¶/ç›®å½•åºå·: &#x27;</span>);</span><br><span class="line">            process.<span class="property">stdin</span>.<span class="title function_">on</span>(<span class="string">&#x27;data&#x27;</span>, options);</span><br><span class="line">            process.<span class="property">stdin</span>.<span class="title function_">setEncoding</span>(<span class="string">&#x27;utf-8&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">options</span>(<span class="params">number</span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">            number = <span class="title class_">Number</span>(number);</span><br><span class="line">            <span class="keyword">if</span> (!files[number]) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">TypeError</span>(<span class="string">&#x27;å¿…é¡»è¾“å…¥çš„æ˜¯æ–‡ä»¶/ç›®å½•åºå·!&#x27;</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">const</span> filesOrDirStats = map.<span class="title function_">get</span>(number);</span><br><span class="line">                <span class="keyword">if</span> (filesOrDirStats.<span class="title function_">isDirectory</span>()) &#123;</span><br><span class="line">                    fs.<span class="title function_">readdir</span>(process.<span class="title function_">cwd</span>() + <span class="string">&#x27;/&#x27;</span> + files[number], <span class="string">&#x27;utf-8&#x27;</span>, <span class="keyword">function</span> (<span class="params">err, files</span>) &#123;</span><br><span class="line">                        <span class="title function_">error</span>(err);</span><br><span class="line">                        <span class="keyword">const</span> filesLength = files.<span class="property">length</span>;</span><br><span class="line">                        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;        å…±æœ‰ &#x27;</span> + filesLength + <span class="string">&#x27; ä»¶æ–‡ä»¶&#x27;</span>);</span><br><span class="line">                        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">                        files.<span class="title function_">forEach</span>(<span class="keyword">function</span> <span class="title function_">file</span>(<span class="params">item</span>) &#123;</span><br><span class="line">                            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;            - &#x27;</span> + item);</span><br><span class="line">                        &#125;);</span><br><span class="line">                        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">                        process.<span class="property">stdin</span>.<span class="title function_">pause</span>();</span><br><span class="line">                    &#125;);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    fs.<span class="title function_">readFile</span>(process.<span class="title function_">cwd</span>() + <span class="string">&#x27;/&#x27;</span> + files[number], <span class="string">&#x27;utf-8&#x27;</span>, <span class="keyword">function</span> (<span class="params">err, data</span>) &#123;</span><br><span class="line">                        <span class="title function_">error</span>(err);</span><br><span class="line">                        <span class="variable language_">console</span>.<span class="title function_">log</span>(data.<span class="title function_">replace</span>(<span class="regexp">/(.*)/g</span>, <span class="string">&#x27;        $1&#x27;</span>));</span><br><span class="line">                        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">                        process.<span class="property">stdin</span>.<span class="title function_">pause</span>();</span><br><span class="line">                    &#125;);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="title function_">filesOrDirFunc</span>();</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">error</span>(<span class="params">err</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (err) &#123;</span><br><span class="line">            <span class="keyword">if</span> (err <span class="keyword">instanceof</span> <span class="title class_">Error</span>)</span><br><span class="line">                <span class="keyword">throw</span> err;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(err);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ES6</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"><span class="built_in">require</span>(<span class="string">&#x27;colors&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">resolvePathCli</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> map = <span class="keyword">new</span> <span class="title class_">Map</span>();</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;å½“å‰è·¯å¾„ä¸‹çš„æ–‡ä»¶/ç›®å½•åˆ—è¡¨å¦‚ä¸‹:&#x27;</span>);</span><br><span class="line">    fs.<span class="title function_">readdir</span>(<span class="string">`<span class="subst">$&#123;process.cwd()&#125;</span>/`</span>, <span class="function">(<span class="params">err, files</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="title function_">error</span>(err);</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">        <span class="keyword">const</span> length = files.<span class="property">length</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> <span class="title function_">filesOrDirFunc</span> = (<span class="params">i = <span class="number">0</span></span>) =&gt; &#123;</span><br><span class="line">            <span class="keyword">const</span> filesOrDir = files[i];</span><br><span class="line">            fs.<span class="title function_">stat</span>(<span class="string">`<span class="subst">$&#123;process.cwd()&#125;</span>/<span class="subst">$&#123;filesOrDir&#125;</span>`</span>, <span class="function">(<span class="params">err, stats</span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="title function_">error</span>(err);</span><br><span class="line">                map.<span class="title function_">set</span>(i, stats);</span><br><span class="line">                <span class="keyword">if</span> (stats.<span class="title function_">isDirectory</span>()) &#123;</span><br><span class="line">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`        <span class="subst">$&#123;i&#125;</span>: <span class="subst">$&#123;filesOrDir&#125;</span>/`</span>.<span class="property">blue</span>);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`        <span class="subst">$&#123;i&#125;</span>: <span class="subst">$&#123;filesOrDir&#125;</span>`</span>.<span class="property">cyan</span>);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (++i === length) &#123;</span><br><span class="line">                    <span class="title function_">read</span>();</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="title function_">filesOrDirFunc</span>(i);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> <span class="title function_">read</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">            process.<span class="property">stdout</span>.<span class="title function_">write</span>(<span class="string">&#x27;è¯·æ‚¨é€‰æ‹©å½“å‰è·¯å¾„ä¸‹çš„æ–‡ä»¶/ç›®å½•åºå·: &#x27;</span>);</span><br><span class="line">            process.<span class="property">stdin</span>.<span class="title function_">on</span>(<span class="string">&#x27;data&#x27;</span>, options);</span><br><span class="line">            process.<span class="property">stdin</span>.<span class="title function_">setEncoding</span>(<span class="string">&#x27;utf-8&#x27;</span>);</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> <span class="title function_">options</span> = (<span class="params">number</span>) =&gt; &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">            number = <span class="title class_">Number</span>(number);</span><br><span class="line">            <span class="keyword">const</span> filesDir = files[number];</span><br><span class="line">            <span class="keyword">if</span> (!filesDir) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">TypeError</span>(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">const</span> stats = map.<span class="title function_">get</span>(number);</span><br><span class="line">                <span class="keyword">if</span> (stats.<span class="title function_">isDirectory</span>()) &#123;</span><br><span class="line">                    fs.<span class="title function_">readdir</span>(<span class="string">`<span class="subst">$&#123;process.cwd()&#125;</span>/<span class="subst">$&#123;filesDir&#125;</span>`</span>, <span class="string">&#x27;utf-8&#x27;</span>, <span class="function">(<span class="params">err, files</span>) =&gt;</span> &#123;</span><br><span class="line">                        <span class="title function_">error</span>(err);</span><br><span class="line">                        <span class="keyword">const</span> filesLength = files.<span class="property">length</span>;</span><br><span class="line">                        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`        å…±æœ‰ <span class="subst">$&#123;filesLength&#125;</span> ä»¶æ–‡ä»¶:`</span>);</span><br><span class="line">                        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">                        files.<span class="title function_">forEach</span>(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">                            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`            - <span class="subst">$&#123;item&#125;</span>`</span>);</span><br><span class="line">                        &#125;);</span><br><span class="line">                        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">                        process.<span class="property">stdin</span>.<span class="title function_">pause</span>();</span><br><span class="line">                    &#125;);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    fs.<span class="title function_">readFile</span>(<span class="string">`<span class="subst">$&#123;process.cwd()&#125;</span>/<span class="subst">$&#123;filesDir&#125;</span>`</span>, <span class="string">&#x27;utf-8&#x27;</span>, <span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123;</span><br><span class="line">                        <span class="title function_">error</span>(err);</span><br><span class="line">                        <span class="variable language_">console</span>.<span class="title function_">log</span>(data.<span class="title function_">replace</span>(<span class="regexp">/(.*)/g</span>, <span class="string">&#x27;        $1&#x27;</span>));</span><br><span class="line">                        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">                        process.<span class="property">stdin</span>.<span class="title function_">pause</span>();</span><br><span class="line">                    &#125;);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="title function_">filesOrDirFunc</span>();</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">error</span>(<span class="params">err</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (err) &#123;</span><br><span class="line">            <span class="keyword">if</span> (err <span class="keyword">instanceof</span> <span class="title class_">Error</span>)</span><br><span class="line">                <span class="keyword">throw</span> err;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(err);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="tcp-chat"><a href="#tcp-chat" class="headerlink" title="tcp chat"></a>tcp chat</h4><blockquote>
<p>ES5</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> net = <span class="built_in">require</span>(<span class="string">&#x27;net&#x27;</span>);</span><br><span class="line"><span class="built_in">require</span>(<span class="string">&#x27;colors&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> <span class="variable constant_">PORT</span> = <span class="number">4000</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">tcpChat</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> count = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">var</span> userCount = &#123;&#125;;</span><br><span class="line">    <span class="keyword">var</span> server = net.<span class="title function_">createServer</span>(<span class="keyword">function</span> (<span class="params">socket</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> nickName = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">bucket</span>(<span class="params">msg, expectUser</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> key <span class="keyword">in</span> userCount) &#123;</span><br><span class="line">                <span class="keyword">if</span> (!expectUser || key !== nickName) &#123;</span><br><span class="line">                    userCount[key].<span class="title function_">write</span>(msg);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        socket.<span class="title function_">write</span>(<span class="string">&#x27;æ¬¢è¿æ¥åˆ° node chat èŠå¤©å®¤!\n&#x27;</span> +</span><br><span class="line">            <span class="string">&#x27;å…±æœ‰ &#x27;</span> + count + <span class="string">&#x27; ä½ç”¨æˆ·åœ¨èŠå¤©å®¤å†…~\n&#x27;</span> +</span><br><span class="line">            <span class="string">&#x27;è¯·æ‚¨è¾“å…¥è‡ªå·±çš„ç”¨æˆ·å: &#x27;</span>.<span class="property">blue</span>);</span><br><span class="line">        count++;</span><br><span class="line">        socket.<span class="title function_">on</span>(<span class="string">&#x27;data&#x27;</span>, <span class="keyword">function</span> (<span class="params">buffer</span>) &#123;</span><br><span class="line">            buffer = buffer.<span class="title function_">replace</span>(<span class="string">&#x27;\r\n&#x27;</span>, <span class="string">&#x27;&#x27;</span>);</span><br><span class="line">            <span class="keyword">if</span> (!nickName) &#123;</span><br><span class="line">                <span class="keyword">if</span> (userCount[nickName]) &#123;</span><br><span class="line">                    socket.<span class="title function_">write</span>(<span class="string">&#x27;æ­¤ç”¨æˆ·åé‡å¤,è¯·é‡æ–°è¾“å…¥:&#x27;</span>);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    nickName = buffer;</span><br><span class="line">                    userCount[nickName] = socket;</span><br><span class="line">                    <span class="title function_">bucket</span>(nickName + <span class="string">&#x27; join this room~\n&#x27;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="title function_">bucket</span>((nickName + <span class="string">&#x27; &gt; &#x27;</span> + buffer + <span class="string">&#x27;\n&#x27;</span>).<span class="property">cyan</span>, <span class="literal">true</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        socket.<span class="title function_">on</span>(<span class="string">&#x27;close&#x27;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            count--;</span><br><span class="line">            <span class="keyword">delete</span> userCount[nickName];</span><br><span class="line">            <span class="title function_">bucket</span>(nickName + <span class="string">&#x27; left this room\n&#x27;</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">        socket.<span class="title function_">setEncoding</span>(<span class="string">&#x27;utf-8&#x27;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">    server.<span class="title function_">listen</span>(<span class="variable constant_">PORT</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Server is running at &#x27;</span> + <span class="variable constant_">PORT</span> + <span class="string">&#x27;~&#x27;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ES6</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> net = <span class="built_in">require</span>(<span class="string">&#x27;net&#x27;</span>);</span><br><span class="line"><span class="built_in">require</span>(<span class="string">&#x27;colors&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">PORT</span> = <span class="number">4000</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">tcpChat</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> count = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">const</span> userAccount = &#123;&#125;;</span><br><span class="line">    <span class="keyword">const</span> server = net.<span class="title function_">createServer</span>(<span class="function"><span class="params">socket</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> nickName = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">        <span class="keyword">const</span> <span class="title function_">bucket</span> = (<span class="params">msg, expectUser</span>) =&gt; &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">in</span> userAccount) &#123;</span><br><span class="line">                <span class="keyword">if</span> (!expectUser || key !== nickName) &#123;</span><br><span class="line">                    userAccount[key].<span class="title function_">write</span>(msg);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        socket.<span class="title function_">write</span>(<span class="string">`æ¬¢è¿æ¥åˆ° node chat èŠå¤©å®¤!</span></span><br><span class="line"><span class="string">å…±æœ‰ <span class="subst">$&#123;count&#125;</span> ä½ç”¨æˆ·åœ¨èŠå¤©å®¤å†…~</span></span><br><span class="line"><span class="string">è¯·æ‚¨è¾“å…¥è‡ªå·±çš„ç”¨æˆ·å: `</span>.<span class="property">blue</span>);</span><br><span class="line">        count++;</span><br><span class="line">        socket.<span class="title function_">on</span>(<span class="string">&#x27;data&#x27;</span>, <span class="function"><span class="params">buffer</span> =&gt;</span> &#123;</span><br><span class="line">            buffer = buffer.<span class="title function_">replace</span>(<span class="string">&#x27;\r\n&#x27;</span>, <span class="string">&#x27;&#x27;</span>);</span><br><span class="line">            <span class="keyword">if</span> (!nickName) &#123;</span><br><span class="line">                <span class="keyword">if</span> (userAccount[nickName]) &#123;</span><br><span class="line">                    socket.<span class="title function_">write</span>(<span class="string">&#x27;æ­¤ç”¨æˆ·åé‡å¤,è¯·é‡æ–°è¾“å…¥:&#x27;</span>);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    nickName = buffer;</span><br><span class="line">                    userAccount[nickName] = socket;</span><br><span class="line">                    <span class="title function_">bucket</span>(<span class="string">`<span class="subst">$&#123;nickName&#125;</span> join this room~\n`</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="title function_">bucket</span>(<span class="string">`<span class="subst">$&#123;nickName&#125;</span> &gt; <span class="subst">$&#123;buffer&#125;</span>\n`</span>.<span class="property">cyan</span>, <span class="literal">true</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        socket.<span class="title function_">on</span>(<span class="string">&#x27;close&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">            count--;</span><br><span class="line">            <span class="keyword">delete</span> userAccount[nickName];</span><br><span class="line">            <span class="title function_">bucket</span>(<span class="string">`<span class="subst">$&#123;nickName&#125;</span> left this room~\n`</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">        socket.<span class="title function_">setEncoding</span>(<span class="string">&#x27;utf-8&#x27;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">    server.<span class="title function_">listen</span>(<span class="variable constant_">PORT</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Server is running at <span class="subst">$&#123;PORT&#125;</span>~`</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>javascript</category>
      </categories>
      <tags>
        <tag>javascript</tag>
      </tags>
  </entry>
</search>
